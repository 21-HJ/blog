<?xml version="1.0" encoding="UTF-8"?>
<rss  xmlns:atom="http://www.w3.org/2005/Atom" 
      xmlns:media="http://search.yahoo.com/mrss/" 
      xmlns:content="http://purl.org/rss/1.0/modules/content/" 
      xmlns:dc="http://purl.org/dc/elements/1.1/" 
      version="2.0">
<channel>
<title>차라투 블로그</title>
<link>https://blog.zarathu.com/</link>
<atom:link href="https://blog.zarathu.com/index.xml" rel="self" type="application/rss+xml"/>
<description>차라투의 소식, 인사이트 및 심층 사례 연구</description>
<generator>quarto-1.4.555</generator>
<lastBuildDate>Thu, 12 Sep 2024 15:00:00 GMT</lastBuildDate>
<item>
  <title>jstable을 이용한 분석 모형 table 만들기</title>
  <dc:creator>Hyungwoo Jo</dc:creator>
  <link>https://blog.zarathu.com/posts/2024-09-13 jstable/</link>
  <description><![CDATA[ <!-- Google tag (gtag.js) --><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-L0DYYSH9KM"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-L0DYYSH9KM');
</script><section id="개요" class="level1"><h1>개요</h1>
<p>이 문서에서는 GLM, GEE, GLMM, Cox 모델에 대한 개요와 이를 jstable 패키지와 더불어 활용하는 방법을 소개합니다.</p>
</section><section id="glm" class="level1"><h1>1. GLM</h1>
<section id="glm의-개요" class="level2"><h2 class="anchored" data-anchor-id="glm의-개요">GLM의 개요</h2>
<p>GLM은 Generalized Linear Model의 약자로 일반화 선형 모델을 의미합니다. 이는 선형 회귀 모델을 조금더 일반화한 모형으로, 반응변수가 정규분포를 따르지 않는 경우에도 사용하기 위해 만들어진 모델입니다. 정규 분포가 아닌 흔한 예시로는 이항분포, 포아송 분포 등이 있습니다. 나이에 따른 생존 상태(생존은 1, 사망은 0)인 이항분포 반응변수를 예시로 일반적 선형회귀 모델과 GLM을 통해 로지스틱 회귀 분석을 한 결과를 비교해보겠습니다.</p>
<div class="cell">
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">123</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">n</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">age</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">n</span>, mean <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>, sd <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span>  </span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">logit_prob</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.2</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">age</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span>  </span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">dead</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/stats/Binomial.html">rbinom</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">n</span>, size <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, prob <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">logit_prob</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> </span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">data</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>age <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">age</span>, dead <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">dead</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">logit_model</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">dead</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">age</span>, family <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">binomial</span>, data <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">data</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">linear_model</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">dead</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">age</span>, data <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">data</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">age_seq</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">data</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">age</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">data</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">age</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span>, length.out <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">logit_pred</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">logit_model</span>, newdata <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>age <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">age_seq</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span>, type <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"response"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">linear_pred</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">linear_model</span>, newdata <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>age <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">age_seq</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span></span>
<span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">data</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>x <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">age</span>, y <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">dead</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>color <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">dead</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span>, size <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2.5</span>, alpha <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>  </span>
<span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>x <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">age_seq</span>, y <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">logit_pred</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span>, color <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"blue"</span>, linewidth <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.2</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>  </span>
<span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>x <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">age_seq</span>, y <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">linear_pred</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span>, color <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>, linewidth <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.2</span>, linetype <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dashed"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>  </span>
<span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>title <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Logistic vs. Linear Regression on Binomial Data (1 = Death, 0 = Alive)"</span>,</span>
<span>       x <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Age"</span>, y <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Probability of Death"</span>,</span>
<span>       color <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Death (1 = Death, 0 = Alive)"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_color_manual</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>values <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"purple"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"green"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>  </span>
<span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span></code></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="https://blog.zarathu.com/posts/2024-09-13 jstable/index_files/figure-html/unnamed-chunk-1-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>일반적인 선형 회귀 함수를 적용했을 때 나이가 어린 경우에는 사망 확률이 음수가 나오며, 고령인 경우 사망 확률이 1이 넘는 등의 문제가 발생합니다. 이를 해결하기 위해 GLM(로지스틱 회귀모형)을 적용하면 모든 나이에서 사망 확률이 0에서 1사이가 됨을 알 수 있습니다.</p>
</section><section id="glm을-적용하기-위한-데이터의-조건" class="level2"><h2 class="anchored" data-anchor-id="glm을-적용하기-위한-데이터의-조건">GLM을 적용하기 위한 데이터의 조건</h2>
<p>이항 분포에 대해 GLM을 적용하였지만, 모든 데이터에 GLM을 적용할 수 있는 것은 아닙니다. GLM을 적용하기 위한 조건에 대해 알아보겠습니다.</p>
<section id="반응변수의-분포" class="level3"><h3 class="anchored" data-anchor-id="반응변수의-분포">반응변수의 분포</h3>
<p>반응 변수의 분포 형태가 Exponential family(지수 분포군)를 따를 때 GLM을 적용할 수 있다. Exponential family는 아래와 같은 수식으로 나타낼 수 있다. <img src="https://latex.codecogs.com/png.latex?%0Af(y%20%7C%20%5Ctheta,%20%5Cphi)%20=%20%5Cexp%5Cleft(%20%5Cfrac%7By%5Ctheta%20-%20b(%5Ctheta)%7D%7B%5Cphi%7D%20+%20c(y,%20%5Cphi)%20%5Cright)%0A"> 여기서<img src="https://latex.codecogs.com/png.latex?y">는 반응 변수 $ $는 정규화 매게 변수, <img src="https://latex.codecogs.com/png.latex?%5Cphi">는 분산을 나타냅니다. 이항분포의 경우 성공 확률 <img src="https://latex.codecogs.com/png.latex?p">로 정의되며 아래 함수의 경우 위의 지수 분포군 함수로 변환이 가능합니다. 위와 같이 변형이 가능한 분포의 다른른 예시로는는 포아송 분포, 감마 분포 등이 있습니다. <img src="https://latex.codecogs.com/png.latex?%0AP(Y%20=%20y)%20=%20%5Cbinom%7Bn%7D%7By%7D%20p%5Ey%20(1%20-%20p)%5E%7Bn%20-%20y%7D%0A"></p>
</section><section id="링크-함수" class="level3"><h3 class="anchored" data-anchor-id="링크-함수">링크 함수</h3>
<p>링크 함수는 반응 변수의 평균과 예측 변수의 선형 관계를 나타내는 함수입니다. 반응변수의 분포가 지수 분포군에 있을 때 링크함수가 존재하며 포아송 분포의 경우 예시는 이와 같습니다. 아래 함수를 적용하면 선형 관계의 그래프를 얻을 수 있습니다. 함수를 적용하니 평소에 알던 선형 회귀의 형태로 식이 나타나는 것을 알 수 있습니다. <img src="https://latex.codecogs.com/png.latex?%0A%5Clog%5Cleft(%20%5Cfrac%7B1%20-%20%5Cmu%7D%7B%5Cmu%7D%20%5Cright)%20=%20X%5Cbeta%0A"></p>
</section><section id="관측치-독립" class="level3"><h3 class="anchored" data-anchor-id="관측치-독립">관측치 독립</h3>
<p>관측치들이 독립되어야 적용이 가능합니다. 예를 들어, 한 사람의 혈압을 반복측정하는 경우 관측치들이 독립되어 있지 않기 때문에 다른 모델을 사용하여야 합니다. 이 경우에 대해서는 문서의 아래 GEE, GLMM 서술에서 다루겠습니다.</p>
</section></section><section id="jstable-패키지를-사용한-glm-table만들기" class="level2"><h2 class="anchored" data-anchor-id="jstable-패키지를-사용한-glm-table만들기">jstable 패키지를 사용한 GLM table만들기</h2>
<p>jstable 패키지를 사용하여 이항 분포와 가우스 분포의 GLM 모델의 결과를 직관적인 표로 만들 수 있습니다. 아래 코드는 R에서 기본으로 제공되는 mtcars 데이터를 사용하여과 이항 회귀 모델을 만들고 결과를 표로 나타낸 것입니다. 이항분포를 가지는 am(자동미션 =0, 수동미션 =1)을 wt(차량무게), hp(마력)을 통해 예측하는 GLM에 대해 알아보겠습니다.</p>
<div class="cell">
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">binomial_model</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">am</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">wt</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">hp</span>, family <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">binomial</span>, data <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">mtcars</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">binomial_model</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = am ~ wt + hp, family = binomial, data = mtcars)

Coefficients:
            Estimate Std. Error z value Pr(&gt;|z|)   
(Intercept) 18.86630    7.44356   2.535  0.01126 * 
wt          -8.08348    3.06868  -2.634  0.00843 **
hp           0.03626    0.01773   2.044  0.04091 * 
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 43.230  on 31  degrees of freedom
Residual deviance: 10.059  on 29  degrees of freedom
AIC: 16.059

Number of Fisher Scoring iterations: 8</code></pre>
</div>
</div>
<p>R에서 기본적으로 제공하는 summary 함수를 통해서 모델에 대해서 알아보았습니다. 많은 정보가 이 안에 담겨있으나, 다소 직관적이지 않을 수 있습니다. jstable 패키지를 사용하여 table로 변수들을 살펴보겠습니다.</p>
<div class="cell">
<div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">binomial_model</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">am</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">wt</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">hp</span>, family <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">binomial</span>, data <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">mtcars</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">glmshow.display</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">binomial_model</span>, decimal <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$first.line
[1] "Logistic regression predicting am\n"

$table
   crude OR.(95%CI) crude P value adj. OR.(95%CI) adj. P value
wt "0.02 (0,0.3)"   "0.005"       "0 (0,0.13)"    "0.008"     
hp "0.99 (0.98,1)"  "0.181"       "1.04 (1,1.07)" "0.041"     

$last.lines
[1] "No. of observations = 32\nAIC value = 16.0591\n\n"

attr(,"class")
[1] "display" "list"   </code></pre>
</div>
</div>
<p>이항 분포의 glm에 대하여 첫줄에서는 로지스틱 회귀 분석을 사용했음을 알 수 있습니다. 테이블 출력 결과를 통해 wt 변수는 p-value가 0.0001로 유의미하게 am에 영향을 미치는 것을 알 수 있습니다. Crude OR 변수를 통해 wt변수가 1이 증가할때마다 수동미션을 가질 odds 비율이 98프로 씩 감소한다는 것을 알 수 있습니다. Adjusted OR 변수가 0이라는 것을 통해 hp변수를 보정했을 경우에 Odds 비율이 더 강하게 연관되어 있다는 것을 알 수 있으며, adjusted p value또한 유의미하다는 것을 확인 할 수 있습니다. hp의 경우 OR과 p value를 통해 관련이 적음을 유추할 수 있습니다. 마지막 줄에서는 총 몇 개의 관측치가 있었는지, 그리고 AIC 수치(낮을 수록 더 좋은 모델)를 알 수 있습니다.</p>
<div class="cell">
<div class="sourceCode" id="cb6" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">gaussian_model</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">mpg</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">cyl</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">disp</span>, data <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">mtcars</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">glmshow.display</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">gaussian_model</span>, decimal <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$first.line
[1] "Linear regression predicting mpg\n"

$table
     crude coeff.(95%CI)   crude P value adj. coeff.(95%CI)    adj. P value
cyl  "-2.88 (-3.51,-2.24)" "&lt; 0.001"     "-1.59 (-2.98,-0.19)" "0.034"     
disp "-0.04 (-0.05,-0.03)" "&lt; 0.001"     "-0.02 (-0.04,0)"     "0.054"     

$last.lines
[1] "No. of observations = 32\nR-squared = 0.7596\nAIC value = 167.1456\n\n"

attr(,"class")
[1] "display" "list"   </code></pre>
</div>
</div>
<p>정규분포를 나타내는 데이터에 대해서도 적용해보겠습니다.첫줄에서는 정규분포에 대하여 선형 회귀 분석을 사용했음을 알 수 있고, 해당하는 p value 들 그리고 선형 회귀의 경우 OR 대신 Coeffecient를 제공함을 알 수 있습니다. 해당 테이블을 통해 cyl(실린더의 갯수)변수는 mpg(연비)에 유의미한 영향을 미치는 것을 알 수 있습니다. disp(배기량)변수는 보정 전에는 영향이 있어 보였으나 보정 이후 0.05보다 크기 때문에 통계적으로 유의미한 영향을 미치지 않는 것을 알 수 있습니다.</p>
</section></section><section id="gee" class="level1"><h1>2. GEE</h1>
<p>GEE(Generalized Estimating Equations)는 GLM에서 반복 측정 혹은 군집화 데이터와 같이 상관된 데이터를 처리하기 위해 만들어진 확장된 모델입니다. GLM의 경우 링크 함수를 통한 선형 회귀 분석을 하기 때문에 기본적으로 관측치들 간의 상관관계가 없어야 한다는 선형 회귀분석의 기본 가정을 따르게 됩니다. 하지만 실제 데이터의 경우(반복된 혈압의 측정, 병원 내 환자들)과 같은 반복, 군집 데이터들을 통해 반응 변수를 분석해야 하는 경우가 많습니다. 당뇨병 환자의 혈당 측정을 예시로 생각해보겠습니다. 이를 일반적인 GLM 모형인</p>
<p><img src="https://latex.codecogs.com/png.latex?%0Ag(%5Cmu_%7Bi%7D)%20=%20X_%7Bi%7D%20%5Cbeta%0A"></p>
<p>에 적용한다면, 여기서 <img src="https://latex.codecogs.com/png.latex?g"> 는 링크 함수, <img src="https://latex.codecogs.com/png.latex?X">는 종속 변수를 나타냅니다. 이 모델은 같은 환자에서 반복된 혈당 측정치들이 모두 <strong>독립적</strong>이라는 가정을 필요로 합니다.</p>
<p>그러나, 같은 환자의 경우 혈당 측정치들이 상관관계를 가지기 때문에, 이러한 상관관계를 반영한 모델은 다음과 같이 쓸 수 있습니다:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0Ag(%5Cmu_%7Bij%7D)%20=%20X_%7Bij%7D%20%5Cbeta%0A"></p>
<p>여기서 <img src="https://latex.codecogs.com/png.latex?X_%7Bij%7D">는 <img src="https://latex.codecogs.com/png.latex?i">번째 환자의 <img src="https://latex.codecogs.com/png.latex?j">번째 관측치를 나타냅니다.( <img src="https://latex.codecogs.com/png.latex?g(%5Cmu_%7Bij%7D)">의 경우 혈당). 간단한 예시 적용을 위해, <img src="https://latex.codecogs.com/png.latex?X_%7Bij1%7D">를 환자 <img src="https://latex.codecogs.com/png.latex?i">의 나이, <img src="https://latex.codecogs.com/png.latex?X_%7Bij2%7D">를를 치료 그룹 (1 = 치료군, 0 = 대조군),<img src="https://latex.codecogs.com/png.latex?X_%7Bij3%7D">)를 혈압, <img src="https://latex.codecogs.com/png.latex?X_%7Bij4%7D">를 시간(측정 시점)이라 가정해보겠습니다.</p>


</section><div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-reuse"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div class="quarto-appendix-contents"><div><a rel="license" href="https://creativecommons.org/licenses/by-nc/4.0/">CC BY-NC 4.0</a></div></div></section><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{jo2024,
  author = {Jo, Hyungwoo},
  title = {Jstable을 {이용한} {분석} {모형} Table {만들기}},
  date = {2024-09-13},
  url = {https://blog.zarathu.com/posts/2024-09-13 jstable},
  langid = {en}
}
</code></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-jo2024" class="csl-entry quarto-appendix-citeas">
Jo, Hyungwoo. 2024. <span>“Jstable을 이용한 분석 모형 Table
만들기.”</span> September 13, 2024. <a href="https://blog.zarathu.com/posts/2024-09-13 jstable">https://blog.zarathu.com/posts/2024-09-13
jstable</a>.
</div></div></section></div> ]]></description>
  <category>R</category>
  <category>statistics</category>
  <guid>https://blog.zarathu.com/posts/2024-09-13 jstable/</guid>
  <pubDate>Thu, 12 Sep 2024 15:00:00 GMT</pubDate>
  <media:content url="https://blog.zarathu.com/posts/2024-09-13 jstable/img/main2.jpg" medium="image" type="image/jpeg"/>
</item>
<item>
  <title>Wald Confidence Interval for a Difference of Binomial Proportions Based on Paired Data</title>
  <dc:creator>Hyojong Myung</dc:creator>
  <link>https://blog.zarathu.com/posts/2024-08-26-sensspec-waldinterval/</link>
  <description><![CDATA[ <!-- Google tag (gtag.js) --><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-L0DYYSH9KM"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-L0DYYSH9KM');
</script><p>2x2 table에서 민감도와 특이도는 본래 McNemar’s test를 통해 <img src="https://latex.codecogs.com/png.latex?z%20=%20%5Cfrac%7B(f_%7B21%7D%20-%20f_%7B12%7D)%7D%7B%5Csqrt%7Bf_%7B12%7D%20+%20f_%7B21%7D%7D%7D">로 정의된 z값의 p-value를 확인하는 방법으로 진행되었습니다. 하지만 위 방식으로는 민감도와 특이도의 신뢰 구간에 대한 정보를 알 수 없기에, 신뢰 구간까지 정할 수 있는 방법인 Wald confidence interval을 적용함으로써 더 많은 정보를 얻을 수 있습니다.</p>
<section id="개요" class="level1"><h1>개요</h1>
<p>이 문서에서는 진단 테스트 1과 테스트 2의 민감도 차이를 기반으로 신뢰 구간(CI)을 계산하는 방법을 다룹니다. 이를 위해 두 테스트의 결과를 기반으로 2x2 테이블을 구성하고, 각 민감도를 계산합니다. 최종적으로 두 민감도의 차이에 대한 신뢰 구간을 계산하는 수식을 도출합니다.</p>
</section><section id="기본-개념" class="level1"><h1>1. 기본 개념</h1>
<p>각 테스트의 민감도 <img src="https://latex.codecogs.com/png.latex?p_1">과 <img src="https://latex.codecogs.com/png.latex?p_2">는 아래와 같이 정의됩니다:</p>
<ul>
<li>
<img src="https://latex.codecogs.com/png.latex?p_1">은 테스트 1이 진정한 양성을 탐지한 비율입니다.</li>
<li>
<img src="https://latex.codecogs.com/png.latex?p_2">은 테스트 2가 진정한 양성을 탐지한 비율입니다.</li>
</ul>
<p>2x2 테이블은 아래와 같이 구성될 수 있습니다:</p>
<img src="https://latex.codecogs.com/png.latex?%5Cbegin%7Barray%7D%7Bc%7Cc%7Cc%7Cc%7D%0A&amp;%20%5Ctext%7BTest%202%20Positive%7D%20&amp;%20%5Ctext%7BTest%202%20Negative%7D%20&amp;%20%5Ctext%7BTotal%7D%20%5C%5C%0A%5Chline%0A%5Ctext%7BTest%201%20Positive%7D%20&amp;%20a%20&amp;%20b%20&amp;%20a%20+%20b%20%5C%5C%0A%5Chline%0A%5Ctext%7BTest%201%20Negative%7D%20&amp;%20c%20&amp;%20d%20&amp;%20c%20+%20d%20%5C%5C%0A%5Chline%0A%5Ctext%7BTotal%7D%20&amp;%20a%20+%20c%20&amp;%20b%20+%20d%20&amp;%20n%20%5C%5C%0A%5Cend%7Barray%7D">
<p>여기서 각 테스트의 민감도는 다음과 같이 계산됩니다.(특이도 역시 모든 데이터들이 양성인 것을 음성으로 바꾸어 생각하면 아래 과정이 동일해집니다)</p>
<p><img src="https://latex.codecogs.com/png.latex?p_1%20=%20%5Cfrac%7Ba%20+%20b%7D%7Bn%7D,%20%5Cquad%20p_2%20=%20%5Cfrac%7Ba%20+%20c%7D%7Bn%7D"></p>
</section><section id="신뢰-구간의-도출" class="level1"><h1>2. 신뢰 구간의 도출</h1>
<p>두 민감도의 차이에 대한 신뢰 구간을 계산하기 위해 Wald 방법을 사용할 수 있습니다. Wald 신뢰 구간은 아래와 같이 정의됩니다:</p>
<section id="분산의-기본-식" class="level2"><h2 class="anchored" data-anchor-id="분산의-기본-식">2.1. 분산의 기본 식</h2>
<p>두 확률 변수 <img src="https://latex.codecogs.com/png.latex?p_1">과 <img src="https://latex.codecogs.com/png.latex?p_2">의 차이의 분산은 다음과 같이 계산됩니다:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Ctext%7BVar%7D(p_2%20-%20p_1)%20=%20%5Ctext%7BVar%7D(p_2)%20+%20%5Ctext%7BVar%7D(p_1)%20-%202%5Ctext%7BCov%7D(p_2,%20p_1)%0A"></p>
</section><section id="각-분산의-계산" class="level2"><h2 class="anchored" data-anchor-id="각-분산의-계산">2.2. 각 분산의 계산</h2>
<p>우리는 <img src="https://latex.codecogs.com/png.latex?p_1">과 <img src="https://latex.codecogs.com/png.latex?p_2">를 비율로 간주할 수 있습니다. 이 비율들의 분산은 다음과 같이 계산됩니다:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Ctext%7BVar%7D(p_1)%20=%20%5Cfrac%7Bp_1(1%20-%20p_1)%7D%7Bn%7D%20=%20%5Cfrac%7Bp_%7B12%7D%20+%20p_%7B11%7D%7D%7Bn%7D%20%5Ccdot%20%5Cleft(1%20-%20%5Cfrac%7Bp_%7B12%7D%20+%20p_%7B11%7D%7D%7Bn%7D%5Cright)%0A"></p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Ctext%7BVar%7D(p_2)%20=%20%5Cfrac%7Bp_2(1%20-%20p_2)%7D%7Bn%7D%20=%20%5Cfrac%7Bp_%7B21%7D%20+%20p_%7B11%7D%7D%7Bn%7D%20%5Ccdot%20%5Cleft(1%20-%20%5Cfrac%7Bp_%7B21%7D%20+%20p_%7B11%7D%7D%7Bn%7D%5Cright)%0A"></p>
</section><section id="공분산-textcovp_2-p_1-의-계산" class="level2"><h2 class="anchored" data-anchor-id="공분산-textcovp_2-p_1-의-계산">2.3. 공분산 <img src="https://latex.codecogs.com/png.latex?%5Ctext%7BCov%7D(p_2,%20p_1)"> 의 계산</h2>
<p><img src="https://latex.codecogs.com/png.latex?p_2"> 와 <img src="https://latex.codecogs.com/png.latex?p_1"> 의 공분산은 다음과 같이 정의됩니다:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Ctext%7BCov%7D(p_2,%20p_1)%20=%20%5Ctext%7BCov%7D(p_%7B11%7D%20+%20p_%7B21%7D,%20p_%7B11%7D%20+%20p_%7B12%7D)%0A"></p>
<p>이를 확장하면 다음과 같은 네 가지 항으로 분리할 수 있습니다:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Ctext%7BCov%7D(p_2,%20p_1)%20=%20%5Ctext%7BCov%7D(p_%7B11%7D,%20p_%7B11%7D)%20+%20%5Ctext%7BCov%7D(p_%7B11%7D,%20p_%7B12%7D)%20+%20%5Ctext%7BCov%7D(p_%7B21%7D,%20p_%7B11%7D)%20+%20%5Ctext%7BCov%7D(p_%7B21%7D,%20p_%7B12%7D)%0A"></p>
<p>공분산은 다음과 같이 정리할 수 있습니다.</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Ctext%7BVar%7D(p_%7B11%7D)%20=%20%5Cfrac%7Bp_%7B11%7D(1%20-%20p_%7B11%7D)%7D%7Bn%7D%0A"></p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Ctext%7BCov%7D(p_%7B11%7D,%20p_%7B12%7D)%20=%20-%5Cfrac%7Bp_%7B11%7Dp_%7B12%7D%7D%7Bn%7D%0A"></p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Ctext%7BCov%7D(p_%7B11%7D,%20p_%7B21%7D)%20=%20-%5Cfrac%7Bp_%7B11%7Dp_%7B21%7D%7D%7Bn%7D%0A"></p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Ctext%7BCov%7D(p_%7B21%7D,%20p_%7B12%7D)%20=%20-%5Cfrac%7Bp_%7B21%7Dp_%7B12%7D%7D%7Bn%7D%0A"></p>
<p>이를 바탕으로 <img src="https://latex.codecogs.com/png.latex?%5Ctext%7BCov%7D(p_2,%20p_1)">를 계산하면:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Ctext%7BCov%7D(p_2,%20p_1)%20=%20%5Cfrac%7Bp_%7B11%7D(1%20-%20p_%7B11%7D%20-%20p_%7B12%7D%20-%20p_%7B21%7D)%20-%20p_%7B21%7Dp_%7B12%7D%7D%7Bn%7D%0A"></p>
<p>여기서 <img src="https://latex.codecogs.com/png.latex?p_%7B11%7D%20+%20p_%7B12%7D%20+%20p_%7B21%7D%20+%20p_%7B22%7D%20=%201">임을 이용하여, 공분산을 다음과 같이 단순화할 수 있습니다:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Ctext%7BCov%7D(p_2,%20p_1)%20=%20%5Cfrac%7Bp_%7B11%7Dp_%7B22%7D%20-%20p_%7B21%7Dp_%7B12%7D%7D%7Bn%7D%0A"></p>
</section><section id="최종적으로-textvarp_2---p_1-의-유도" class="level2"><h2 class="anchored" data-anchor-id="최종적으로-textvarp_2---p_1-의-유도">2.4. 최종적으로 <img src="https://latex.codecogs.com/png.latex?%5Ctext%7BVar%7D(p_2%20-%20p_1)"> 의 유도</h2>
<p>이제 분산 공식을 대입하여 최종적으로 <img src="https://latex.codecogs.com/png.latex?p_2%20-%20p_1">의 분산을 계산합니다:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Ctext%7BVar%7D(p_2%20-%20p_1)%20=%20%5Ctext%7BVar%7D(p_2)%20+%20%5Ctext%7BVar%7D(p_1)%20-%202%5Ctext%7BCov%7D(p_2,%20p_1)%0A"></p>
<p>따라서 <img src="https://latex.codecogs.com/png.latex?p_2%20-%20p_1">의 분산은 다음과 같습니다:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Ctext%7BVar%7D(p_2%20-%20p_1)%20=%20%5Cfrac%7B(p_%7B12%7D%20+%20p_%7B21%7D)%20-%20(p_%7B21%7D%20-%20p_%7B12%7D)%5E2/n%7D%7Bn%7D%0A"></p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Ctext%7BVar%7D(p_2%20-%20p_1)%20=%20%5Cfrac%7B(b%20+%20c)%20-%20(b%20-%20c)%5E2/n%7D%7Bn%7D%0A"></p>
<p>이를 적용한 민감도의 차이에 대한 신뢰 구간은 다음과 같이 계산됩니다. <img src="https://latex.codecogs.com/png.latex?%0A%5C%20CI_%7B1-%5Calpha/2%7D(%5Chat%7B%5Ctheta%7D)%20=%20%5Cleft%5B%20%5Chat%7B%5Ctheta%7D%20%5Cpm%20z_%7B1-%5Calpha/2%7D%20%5Ccdot%20%5Cfrac%7B1%7D%7Bn%7D%20%5Ccdot%20%5Csqrt%7Bb%20+%20c%20-%20%5Cfrac%7B(b%20-%20c)%5E2%7D%7Bn%7D%7D%20%5Cright%5D%20%5C%0A"></p>
<div class="cell">
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span>  <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">ci.method</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"wald"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">cont.corr</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span>    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># sensitivity</span></span>
<span>    <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">b</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">tab</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">diseased</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">]</span>; <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">c</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">tab</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">diseased</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">]</span>; <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">n</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">tab</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">diseased</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">]</span></span>
<span>    <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">sens.diff.se</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">b</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">c</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">b</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">c</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">n</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">n</span></span>
<span>    <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">sens.diff.cl</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">sens.diff</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/stats/Normal.html">qnorm</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">alpha</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">sens.diff.se</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div>
</div>
<p>만약 이항분포로 얻어진 값을 정규분포에 맞도록 조정하기 위해 continuity correction을 진행한다면 wald에서는 확률 <img src="https://latex.codecogs.com/png.latex?p"> 하나당 <img src="https://latex.codecogs.com/png.latex?%5Cfrac%7B1%7D%7B2n%7D">만큼 분산을 늘려, 아래와 같은 값을 갖게 된다.</p>
<p><img src="https://latex.codecogs.com/png.latex?%0ACI_%7B1-%5Calpha/2%7D(%5Chat%7B%5Ctheta%7D)%20=%20%5Cleft%5B%20%5Chat%7B%5Ctheta%7D%20%5Cpm%20%5Cleft(%20z_%7B1-%5Calpha/2%7D%20%5Ccdot%20%5Cfrac%7B1%7D%7Bn%7D%20%5Csqrt%7Bb%20+%20c%20-%20%5Cfrac%7B(b%20-%20c)%5E2%7D%7Bn%7D%20%7D+%20%5Cfrac%7B1%7D%7Bn%7D%20%5Cright)%20%5Cright%5D.%0A"></p>
<div class="cell">
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span>  <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">ci.method</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"wald"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">cont.corr</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span>    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># sensitivity</span></span>
<span>    <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">b</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">tab</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">diseased</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">]</span>; <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">c</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">tab</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">diseased</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">]</span>; <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">n</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">tab</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">diseased</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">]</span></span>
<span>    <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">sens.diff.se</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">b</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">c</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">b</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">c</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">n</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">n</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">n</span></span>
<span>    <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">sens.diff.cl</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">sens.diff</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/stats/Normal.html">qnorm</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">alpha</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">sens.diff.se</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div>
</div>
</section></section><section id="wald-이외-신뢰구간-계산-방법" class="level1"><h1>3. Wald 이외 신뢰구간 계산 방법</h1>
<section id="agresti-신뢰-구간agresti-ci" class="level2"><h2 class="anchored" data-anchor-id="agresti-신뢰-구간agresti-ci">3.1. Agresti 신뢰 구간(Agresti CI)</h2>
<p>Wald 신뢰 구간을 수정한 방법 중 하나로, 샘플 크기에 특정 상수를 더한 후 위 wald와 같은 방식으로 전체 샘플 크기 𝑛에 1에서 4까지의 상수를 더한 후 이 방법들을 비교했습니다. 그 결과, n+2를 사용하는 것이 표준 Wald 신뢰 구간과 비교했을 때 표본 증가의 효과로 신뢰 구간의 성능(coverage probability)을 향상시킴을 확인했습니다. <img src="https://latex.codecogs.com/png.latex?%0A%5C%20CI_%7B1-%5Calpha/2%7D(%5Chat%7B%5Ctheta%7D)%20=%20%5Cleft%5B%20%5Chat%7B%5Ctheta%7D%20%5Cpm%20z_%7B1-%5Calpha/2%7D%20%5Ccdot%20%5Cfrac%7B1%7D%7Bn+2%7D%20%5Ccdot%20%5Csqrt%7B(b+0.5)%20+%20(c+0.5)%20-%20%5Cfrac%7B(b%20-%20c)%5E2%7D%7Bn+2%7D%7D%20%5Cright%5D%20%5C%0A"></p>
<div class="cell">
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span>  <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">ci.method</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"agresti-min"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span>    <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">k</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span></span>
<span>    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># sensitivity    </span></span>
<span>    <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">b</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">tab</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">diseased</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">]</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">k</span>; <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">c</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">tab</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">diseased</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">]</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">k</span>; <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">n</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">tab</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">diseased</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">]</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">k</span></span>
<span>    <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">sens.diff.se</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">b</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">c</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">b</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">c</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">n</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">n</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> </span>
<span>    <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">sens.diff.cl</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">sens.diff</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/stats/Normal.html">qnorm</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">alpha</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">sens.diff.se</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div>
</div>
</section><section id="tango" class="level2"><h2 class="anchored" data-anchor-id="tango">3.2. Tango</h2>
<p>Tango는 귀무가설과 함수는 두 비율 간의 차이와, 주어진 정보 행렬(<img src="https://latex.codecogs.com/png.latex?b">, <img src="https://latex.codecogs.com/png.latex?c">, <img src="https://latex.codecogs.com/png.latex?n">)을 기반으로 likelihood를 계산해 신뢰구간을 계산하는 방법입니다. R에서는 <code>scoreci.mp</code>라는 별도의 함수를 사용해 진행합니다.</p>
<div class="cell">
<div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span>  <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">ci.method</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"tango"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span>    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># sensitivity    </span></span>
<span>    <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">b</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">tab</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">diseased</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">]</span>; <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">c</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">tab</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">diseased</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">]</span>; <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">n</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">tab</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">diseased</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">]</span></span>
<span>    <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">tango</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scoreci.mp</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">b</span>, <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">c</span>, <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">n</span>, conf.level<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">alpha</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span>    </span>
<span>    <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">sens.diff.se</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>    </span>
<span>    <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">sens.diff.cl</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/sort.html">sort</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">tango</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">conf.int</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">]</span>, <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">tango</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">conf.int</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">]</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span>    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">tango</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">conf.int</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">]</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">sens.diff</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">tango</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">conf.int</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">]</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">sens.diff</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span>      <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">sens.diff.cl</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/sort.html">sort</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">sens.diff.cl</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div>
</div>
</section></section><section id="예시-코드" class="level1"><h1>4. 예시 코드</h1>
<section id="일반적인-민감도-특이도-검정" class="level2"><h2 class="anchored" data-anchor-id="일반적인-민감도-특이도-검정">4.1. 일반적인 민감도, 특이도 검정</h2>
<div class="cell">
<div class="sourceCode" id="cb5" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;"><a href="https://github.com/chstock/DTComPair">DTComPair</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: PropCIs</code></pre>
</div>
<div class="sourceCode" id="cb7" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">t1</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://chstock.github.io/DTComPair/reference/read.tab.paired.html">read.tab.paired</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">18</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">14</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">18</span>,</span>
<span>                      <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">18</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">18</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">t1</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Two binary diagnostic tests (paired design)

Test1: 'Noname 1'
Test2: 'Noname 2'

Diseased:
           Test1 pos. Test1 neg. Total
Test2 pos.         18         14    32
Test2 neg.          0         18    18
Total              18         32    50

Non-diseased:
           Test1 pos. Test1 neg. Total
Test2 pos.         18         12    30
Test2 neg.          2         18    20
Total              20         30    50</code></pre>
</div>
<div class="sourceCode" id="cb9" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://chstock.github.io/DTComPair/reference/sesp.diff.ci.html">sesp.diff.ci</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">t1</span>, ci.method<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"wald"</span>, cont.corr<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$sensitivity
     test1      test2       diff    diff.se   diff.lcl   diff.ucl 
0.36000000 0.64000000 0.28000000 0.06349803 0.15554615 0.40445385 

$specificity
      test1       test2        diff     diff.se    diff.lcl    diff.ucl 
 0.60000000  0.40000000 -0.20000000  0.06928203 -0.33579029 -0.06420971 

$ci.method
[1] "wald"

$alpha
[1] 0.05

$cont.corr
[1] FALSE</code></pre>
</div>
<div class="sourceCode" id="cb11" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://chstock.github.io/DTComPair/reference/sesp.diff.ci.html">sesp.diff.ci</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">t1</span>, ci.method<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"wald"</span>, cont.corr<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$sensitivity
     test1      test2       diff    diff.se   diff.lcl   diff.ucl 
0.36000000 0.64000000 0.28000000 0.08349803 0.11634687 0.44365313 

$specificity
      test1       test2        diff     diff.se    diff.lcl    diff.ucl 
 0.60000000  0.40000000 -0.20000000  0.08928203 -0.37498957 -0.02501043 

$ci.method
[1] "wald"

$alpha
[1] 0.05

$cont.corr
[1] TRUE</code></pre>
</div>
<div class="sourceCode" id="cb13" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://chstock.github.io/DTComPair/reference/sesp.diff.ci.html">sesp.diff.ci</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">t1</span>, ci.method<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"agresti-min"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$sensitivity
     test1      test2       diff    diff.se   diff.lcl   diff.ucl 
0.36000000 0.64000000 0.28000000 0.06444681 0.15368658 0.40631342 

$specificity
      test1       test2        diff     diff.se    diff.lcl    diff.ucl 
 0.60000000  0.40000000 -0.20000000  0.06954236 -0.33630053 -0.06369947 

$ci.method
[1] "agresti-min"

$alpha
[1] 0.05

$cont.corr
[1] FALSE</code></pre>
</div>
<div class="sourceCode" id="cb15" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://chstock.github.io/DTComPair/reference/sesp.diff.ci.html">sesp.diff.ci</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">t1</span>, ci.method<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"tango"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$sensitivity
    test1     test2      diff   diff.se  diff.lcl  diff.ucl 
0.3600000 0.6400000 0.2800000        NA 0.1747417 0.4166512 

$specificity
      test1       test2        diff     diff.se    diff.lcl    diff.ucl 
 0.60000000  0.40000000 -0.20000000          NA -0.34470882 -0.06111243 

$ci.method
[1] "tango"

$alpha
[1] 0.05

$cont.corr
[1] FALSE</code></pre>
</div>
</div>
<p>아래와 같은 방법으로 answer, test1, test2를 열로 가지고, 각 결과 데이터가 1,0(1은 diseased sample, 2는 non-diseased sample)로 표시되어 있는 경우에는 바로 paired table을 제작할 수 있습니다.</p>
<div class="cell">
<div class="sourceCode" id="cb17" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;"><a href="https://github.com/chstock/DTComPair">DTComPair</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">tb</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://chstock.github.io/DTComPair/reference/tab.paired.html">tab.paired</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">answer</span>, <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">test1</span>, <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">test2</span>, data <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/stats/na.fail.html">na.omit</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">sample_data</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span></code></pre></div>
</div>
</section><section id="민감도-특이도의-비열등성-검정" class="level2"><h2 class="anchored" data-anchor-id="민감도-특이도의-비열등성-검정">4.2. 민감도, 특이도의 비열등성 검정</h2>
<p>어떤 테스트의 민감도와 특이도가 대조 테스트에 비해 떨어지지 않는다는 것을 확인하기 위해서는 비열등성 검정을 사용해야 합니다. 이 때는 <code>sesp.diff.ci</code> 함수를 통해 구한 standard error 값과 두 민감도/특이도의 차이를 통해 p value를 계산합니다. 아래 예시에서는 민감도에 대한 비열등성 마진(<code>sens_margin</code>)을 5%, 특이도에 대한 비열등성 마진(<code>spec_margin</code>)을 10%로 설정했습니다.<br>
민감도를 예로 들자면 귀무가설은 아래와 같고, 아래 수식에 따라 p value를 계산합니다.</p>
<p><img src="https://latex.codecogs.com/png.latex?H_0%20%5Ccolon%20%5Ctext%7Btest1%20sensitivity%7D%20-%20%5Ctext%7Btest2%20sensitivity%7D%20%5Cleq%20-%5Ctext%7B%20sensitivity%20margin%7D"> <img src="https://latex.codecogs.com/png.latex?p-value%20=%201%20-%20%CE%A6%5Cleft(%5Cfrac%7B%5Ctext%7Btest1%20sensitivity%7D%20-%20%5Ctext%7Btest2%20sensitivity%7D%20+%20%5Ctext%7Bsensitivity%20margin%7D%7D%7B%5Ctext%7Bsensitivity%20diff.SE%7D%7D%5Cright)"></p>
<div class="cell">
<div class="sourceCode" id="cb18" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;"><a href="https://github.com/chstock/DTComPair">DTComPair</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">t1</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://chstock.github.io/DTComPair/reference/read.tab.paired.html">read.tab.paired</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">18</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">14</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">18</span>,</span>
<span>                      <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">18</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">18</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">t1.wald</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://chstock.github.io/DTComPair/reference/sesp.diff.ci.html">sesp.diff.ci</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">t1</span>, ci.method<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"wald"</span>, cont.corr<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">sens_margin</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span>  <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.05</span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">spec_margin</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span>  <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span></span>
<span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">p_value_sensitivity</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/stats/Normal.html">pnorm</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">t1.wald</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">sensitivity</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'diff'</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">]</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">sens_margin</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">t1.wald</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">sensitivity</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'diff.se'</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">]</span>, lower.tail <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">p_value_specificity</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/stats/Normal.html">pnorm</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">t1.wald</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">specificity</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'diff'</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">]</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">spec_margin</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">t1.wald</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">specificity</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'diff.se'</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">]</span>, lower.tail <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">p_value_sensitivity</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        diff 
1.012589e-07 </code></pre>
</div>
<div class="sourceCode" id="cb20" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">p_value_specificity</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     diff 
0.9255427 </code></pre>
</div>
</div>
<p>따라서 민감도에 대해서는 위 귀무가설이 기각 되었음으로 test1의 민감도가 test2보다 열등하지 않다고 말할 수 있지만, 특이도에 대해서는 귀무가설이 기각되지 않았기 때문에 test1의 특이도가 test2에 비해 열등하지 않다는 결론을 내릴 수 없습니다.</p>


</section></section><div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-reuse"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div class="quarto-appendix-contents"><div><a rel="license" href="https://creativecommons.org/licenses/by-nc/4.0/">CC BY-NC 4.0</a></div></div></section><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{myung2024,
  author = {Myung, Hyojong},
  title = {Wald {Confidence} {Interval} for a {Difference} of {Binomial}
    {Proportions} {Based} on {Paired} {Data}},
  date = {2024-08-26},
  url = {https://blog.zarathu.com/posts/2024-08-26-sensspec-waldinterval},
  langid = {en}
}
</code></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-myung2024" class="csl-entry quarto-appendix-citeas">
Myung, Hyojong. 2024. <span>“Wald Confidence Interval for a Difference
of Binomial Proportions Based on Paired Data.”</span> August 26, 2024.
<a href="https://blog.zarathu.com/posts/2024-08-26-sensspec-waldinterval">https://blog.zarathu.com/posts/2024-08-26-sensspec-waldinterval</a>.
</div></div></section></div> ]]></description>
  <category>R</category>
  <category>statistics</category>
  <guid>https://blog.zarathu.com/posts/2024-08-26-sensspec-waldinterval/</guid>
  <pubDate>Sun, 25 Aug 2024 15:00:00 GMT</pubDate>
  <media:content url="https://blog.zarathu.com/posts/2024-08-26-sensspec-waldinterval/img/main2.jpg" medium="image" type="image/jpeg"/>
</item>
<item>
  <title>competing risk 생존분석, fine-and-gray method와 multi-state model</title>
  <dc:creator>Hyojong Myung</dc:creator>
  <link>https://blog.zarathu.com/posts/2024-08-22-competingrisk/</link>
  <description><![CDATA[ <!-- Google tag (gtag.js) --><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-L0DYYSH9KM"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-L0DYYSH9KM');
</script><p>관심이 있는 어떤 event가 outcome에 미치는 영향에 대한 생존분석을 진행할 때 다른 사건에 의해 follow up이 중단되는 상황이 발생할 수 있습니다. 이렇게 관측을 끝내게 만드는 의도치 않은 event를 ’competing risk’라 부릅니다. competing risk로 인한 데이터의 손실과, 결과의 왜곡을 줄이기 위한 2가지 방법으로 fine and gray method와 multi state model을 소개합니다.</p>
<section id="fine-and-gray-method" class="level1"><h1>1. fine and gray method</h1>
<p>Competing risk 모델은 하나의 사건(event)이 발생하는 것을 다른 경쟁 위험들(competing risks)이 방해하는 상황을 가정합니다. 예를 들어, 환자가 A라는 질병으로 인해 사망할 수도 있지만, 다른 이유로도 사망할 수도 있습니다. 이 경우, 질병 A으로 인한 사망이 관찰하고자 하는 사건이고, 다른 이유로 인한 사망은 경쟁 위험이 됩니다.</p>
<p>Fine-Gray method는 환자의 다른 질병으로 인한 사망(다른 risk로 endpoint에 도달한 경우)한 케이스를, ‘만약 다른 질병에 걸리지 않았다면?’ 이라는 가정을 기반으로 가공해 새로운 데이터를 만들어냅니다. 가정을 통해 만들어진 데이터인 만큼 해당 데이터가 존재할만한 확률을 계산해 이를 가중치로서 사용합니다. 데이터와 함께 과정을 살펴보도록 하겠습니다.</p>
<section id="데이터-전처리" class="level2"><h2 class="anchored" data-anchor-id="데이터-전처리">1.1 데이터 전처리</h2>
<p>실습에서는 <code>mgus2</code> 데이터를 사용하겠습니다. <code>mgus</code> 데이터는 다발성 골수종 환자에 대한 데이터로, <code>pstat</code>이 1인 경우 다발성 골수종에 걸린 것으로 표시됩니다.</p>
<div class="cell">
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">data</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">mgus2</span></span>
<span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">data</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  id age sex dxyr  hgb creat mspike ptime pstat futime death
1  1  88   F 1981 13.1   1.3    0.5    30     0     30     1
2  2  78   F 1968 11.5   1.2    2.0    25     0     25     1
3  3  94   M 1980 10.5   1.5    2.6    46     0     46     1
4  4  68   M 1977 15.2   1.2    1.2    92     0     92     1
5  5  90   F 1973 10.7   0.8    1.0     8     0      8     1
6  6  90   M 1990 12.9   1.0    0.5     4     0      4     1</code></pre>
</div>
</div>
<p>이후 <code>data</code>의 <code>even</code>t를 다발성 골수종에 걸렸을 경우(<code>pcm</code>) 1, 다발성 골수종에 걸리지 않았지만 사망한 경우(<code>death</code>) 2, 다발성 골수종에 걸리지도 않았고 생존한 경우(<code>censor</code>) 0으로 코딩합니다. competing risk가 고려하고자 하는 데이터는 다벌성 골수종이 아닌 다른 이유로 사망한 2번 케이스 일것입니다.</p>
<div class="cell">
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">data</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">etime</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/with.html">with</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">data</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">pstat</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">futime</span>, <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">ptime</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">data</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">event</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/with.html">with</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">data</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">pstat</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">death</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">data</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">event</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">data</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">event</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, labels<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"censor"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"pcm"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"death"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span></code></pre></div>
</div>
</section><section id="competing-risk-제거" class="level2"><h2 class="anchored" data-anchor-id="competing-risk-제거">1.2 competing risk 제거</h2>
<p><code>finegray</code> 함수를 사용하면 해당 데이터가 <code>death</code>로 끝났을 경우, 환자가 사망하지 않았다고 가정한 새로운 데이터들을 여러 시간대 별로 제작합니다. 각 시간대별로 환자가 생존했을 확률을 Kaplan-meier estimate로 계산함으로서 이를 weight로 사용합니다.</p>
<div class="cell">
<div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">pdata</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">finegray</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">Surv</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">etime</span>, <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">event</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">.</span>, data<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">data</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">pdata</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  id age sex dxyr  hgb creat mspike ptime pstat futime death fgstart fgstop
1  1  88   F 1981 13.1   1.3    0.5    30     0     30     1       0     35
2  1  88   F 1981 13.1   1.3    0.5    30     0     30     1      35     44
3  1  88   F 1981 13.1   1.3    0.5    30     0     30     1      44     47
4  1  88   F 1981 13.1   1.3    0.5    30     0     30     1      48     52
5  1  88   F 1981 13.1   1.3    0.5    30     0     30     1      53     56
6  1  88   F 1981 13.1   1.3    0.5    30     0     30     1      56     57
  fgstatus      fgwt
1        0 1.0000000
2        0 0.9990449
3        0 0.9980368
4        0 0.9959629
5        0 0.9905896
6        0 0.9873022</code></pre>
</div>
</div>
<p><code>pdata</code>에서 볼 수 있다 싶이 <code>id</code> 1번 환자는 실제로 30일 follow up 이후 사망했지만, pdata에서는 환자가 30일 이후 생존했을 경우를 가정하고, <code>fgwt</code>로 인위적인 데이터의 weight를 보여주고 있습니다. 실제로 시간이 길어질 수록 환자가 생존할 가능성은 떨어지기에 weight 역시 감소하는 것을 볼 수 있습니다. <code>pdata</code>의 event로 사용되는 <code>fgstatus</code>는 다발성 골수종의 발생에만 집중하여 다발성 골수종 발생 경우 1,(<code>data</code>의 <code>pcm</code>과 동일) 미발생시 0(<code>censor</code>와 동일)으로 표시하고 있습니다.</p>
<p>이제 competing risk로 인한 데이터를 제거했기 때문에 기존의 cox 분석으로 결과를 얻을 수 있습니다.</p>
<div class="cell">
<div class="sourceCode" id="cb6" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">fgfit</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coxph</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">Surv</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">fgstart</span>, <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">fgstop</span>, <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">fgstatus</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">age</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">sex</span>,</span>
<span>               weight<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">fgwt</span>, data<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">pdata</span>, model <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">T</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">fgfit</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(fgstart, fgstop, fgstatus) ~ age + sex, 
    data = pdata, weights = fgwt, model = T)

  n= 41775, number of events= 115 

          coef exp(coef)  se(coef) robust se     z Pr(&gt;|z|)   
age  -0.017302  0.982847  0.007022  0.005528 -3.13  0.00175 **
sexM -0.259757  0.771239  0.187049  0.181707 -1.43  0.15285   
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

     exp(coef) exp(-coef) lower .95 upper .95
age     0.9828      1.017    0.9723    0.9936
sexM    0.7712      1.297    0.5402    1.1012

Concordance= 0.548  (se = 0.026 )
Likelihood ratio test= 7.28  on 2 df,   p=0.03
Wald test            = 11.19  on 2 df,   p=0.004
Score (logrank) test = 7.58  on 2 df,   p=0.02,   Robust = 9.28  p=0.01

  (Note: the likelihood ratio and score tests assume independence of
     observations within a cluster, the Wald and robust score tests do not).</code></pre>
</div>
</div>
</section></section><section id="multi-state-model" class="level1"><h1>2. multi-state model</h1>
<p>Multi-State Model(MSM)은 시간에 따라 환자가 여러 상태 사이를 전이하는 과정을 가정합니다. 예를 들어, 환자가 “건강한 상태”에서 “질병 상태”로, 그리고 “사망 상태”로 변화하는 것을 수치화해 생존 분석을 진행합니다.</p>
<p>환자의 상태를 계층화된 factor로 지정해준 후, Aalen-Johansen Estimator을 이용해 각 시간 지점에서 특정 상태에 있을 확률을 계산합니다(<a href="https://www.openriskmanual.org/wiki/Aalen-Johansen_Estimator" class="uri">https://www.openriskmanual.org/wiki/Aalen-Johansen_Estimator</a>). 데이터를 기반으로 각 고유한 시간에 전이하는 환자의 비율을 나타내는 전이행렬을 초기 확률 벡터와 곱함으로서 특정 시간에 각 상태에 있는 확률을 계산할 수 있습니다.</p>
<section id="데이터-전처리-1" class="level2"><h2 class="anchored" data-anchor-id="데이터-전처리-1">2.1 데이터 전처리</h2>
<p>이번 실습에서도 <code>mgus2</code> 데이터를 사용합니다. 다만 해당 MSM 모델에서는 <code>data</code>의 event 역시 <code>censor</code>, <code>pcm</code>, <code>death</code>를 위 fine and gray method와 동일하게 설정했습니다. 이 경우 역시, <code>pcm</code>을 거치지 않고 바로 <code>death</code>로 가는 상황이 competing risk라 할 수 있습니다.</p>
<p><img src="https://blog.zarathu.com/posts/2024-08-22-competingrisk/img/risk.png" width="100%"></p>
<div class="cell">
<div class="sourceCode" id="cb8" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">data</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">mgus2</span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">data</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">etime</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/with.html">with</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">data</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">pstat</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">futime</span>, <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">ptime</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">data</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">event</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/with.html">with</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">data</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">pstat</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">death</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">data</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">event</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">data</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">event</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, labels<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"censor"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"pcm"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"death"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span></code></pre></div>
</div>
</section><section id="msm-모델-제작" class="level2"><h2 class="anchored" data-anchor-id="msm-모델-제작">2.2 MSM 모델 제작</h2>
<p>이후 <code>data</code>를 기존에 0과 1로 outcome이 이진 분류된 데이터로 cox 모델을 돌리듯 모델을 제작해주면 각 상태(<code>pcm</code>, <code>death by pcm</code>)로의 진행에 대한 회귀분석이 진행됩니다. MSM를 통해 ’다발성 골수종으로의 진행’에 대한 생존 분석과, ’그 이외 영향으로 인한 사망’에 대한 생존 분석을 한 번에 진행할 수 있습니다.</p>
<div class="cell">
<div class="sourceCode" id="cb9" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">MSMfit</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coxph</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">Surv</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">etime</span>, <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">event</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">sex</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">age</span>, data <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">data</span>, id <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">id</span>, model <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">T</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">MSMfit</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(etime, event) ~ sex + age, data = data, 
    model = T, id = id)

  n= 1384, number of events= 975 

              coef exp(coef)  se(coef) robust se      z Pr(&gt;|z|)    
sexM_1:2 -0.025138  0.975176  0.188456  0.189391 -0.133   0.8944    
age_1:2   0.013039  1.013124  0.008259  0.006678  1.953   0.0509 .  
sexM_1:3  0.393226  1.481753  0.069698  0.066156  5.944 2.78e-09 ***
age_1:3   0.064824  1.066971  0.003620  0.003691 17.562  &lt; 2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

         exp(coef) exp(-coef) lower .95 upper .95
sexM_1:2    0.9752     1.0255    0.6728     1.413
age_1:2     1.0131     0.9870    1.0000     1.026
sexM_1:3    1.4818     0.6749    1.3016     1.687
age_1:3     1.0670     0.9372    1.0593     1.075

Concordance= 0.66  (se = 0.01 )
Likelihood ratio test= 389.5  on 4 df,   p=&lt;2e-16
Wald test            = 326.7  on 4 df,   p=&lt;2e-16
Score (logrank) test = 335.4  on 4 df,   p=&lt;2e-16,   Robust = 285.9  p=&lt;2e-16

  (Note: the likelihood ratio and score tests assume independence of
     observations within a cluster, the Wald and robust score tests do not).</code></pre>
</div>
</div>
</section></section><section id="fine-and-gray-method와-msm의-비교" class="level1"><h1>3. fine and gray method와 MSM의 비교</h1>
<section id="fine-and-gray의-장단점-적용" class="level2"><h2 class="anchored" data-anchor-id="fine-and-gray의-장단점-적용">3.1 fine and gray의 장단점, 적용</h2>
<p>Fine and Gray의 가장 큰 장점은 단순성입니다. competing risks를 다룰 때 문제를 단순화하여, multi state한 상황을 binomial한 문제로 축소시켜 데이터 해석이 쉬워집니다. 이런 장점은 lifetime risk를 추정하는 것을 용이하게 해주며, 특정 사건이 발생할 종합적인 위험을 평가하는데 강점을 가집니다(ex, 여성의 경우 PCM에 대한 평생 리스크가 나이와 혈청 m-스파이크를 조정한 후에도 1.2배 더 높다).</p>
<p>다만 모델이 새로운 데이터를 인위적으로 만들고, 비례위험 가정을 통해 weight를 부여하기에 그만큼 잘못된 결과가 나올 위험성이 있습니다. 더불어 간단한 competing risk 상황에만 적용 가능하며, risk들간의 관계(ex. <code>pcm</code>으로 인한 <code>death</code>가 일어날 수 있는 케이스)를 반영할 수 없다는 한계가 있습니다.</p>
</section><section id="msm의-장단점-적용" class="level2"><h2 class="anchored" data-anchor-id="msm의-장단점-적용">3.2 MSM의 장단점, 적용</h2>
<p>MSM은 다양한 competing risk 상황을 구현할 수 있다는 장점이 있습니다. <code>pstate</code>, <code>death</code> 등의 변수로 <code>event</code>를 더 세부화할시 Fine and Gray에서는 구현하지 못하는 <code>pcm</code>으로 인한 <code>death</code> 등의 관계를 적용시킬 수 있습니다. 위에서 살펴본 것 같이 competing risk를 제거하는 것이 아닌, competing risk에 의한 효과도 확인할 수 있다는 점에서 더욱 더 세심한 분석이 가능합니다.</p>
<p>다만 더 자세한 모델을 구현하기 위해 state간 전이시간 등 model의 제작을 위해 더 많은 정보를 필요로 한다는 것이 단점입니다. 따라서 MSM은 환자에 질병 진행 과정에 대한 세세한 데이터가 존재할 때 각 상태의 전이의 확인이 필요할 때 적용할 수 있습니다.</p>
<p>따라서 ’관찰하려는 event의 발생에만 관심이 있고, 그 이외 영향은 모두 제거하고 싶다’는 목적으로 competing risk를 처리하고자 할 때는 fine and gray 방법을,’관측 중 발생한 모든 event에 대한 세세한 정보를 얻고 싶다’는 목적일 때는 MSM을 쓰면 되겠습니다.</p>


</section></section><div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-reuse"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div class="quarto-appendix-contents"><div><a rel="license" href="https://creativecommons.org/licenses/by-nc/4.0/">CC BY-NC 4.0</a></div></div></section><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{myung2024,
  author = {Myung, Hyojong},
  title = {Competing Risk {생존분석,} Fine-and-Gray {method와}
    Multi-State Model},
  date = {2024-08-22},
  url = {https://blog.zarathu.com/posts/2024-08-22-competingrisk},
  langid = {en}
}
</code></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-myung2024" class="csl-entry quarto-appendix-citeas">
Myung, Hyojong. 2024. <span>“Competing Risk 생존분석, Fine-and-Gray
Method와 Multi-State Model.”</span> August 22, 2024. <a href="https://blog.zarathu.com/posts/2024-08-22-competingrisk">https://blog.zarathu.com/posts/2024-08-22-competingrisk</a>.
</div></div></section></div> ]]></description>
  <category>R</category>
  <category>statistics</category>
  <guid>https://blog.zarathu.com/posts/2024-08-22-competingrisk/</guid>
  <pubDate>Wed, 21 Aug 2024 15:00:00 GMT</pubDate>
  <media:content url="https://blog.zarathu.com/posts/2024-08-22-competingrisk/img/main.png" medium="image" type="image/png" height="51" width="144"/>
</item>
<item>
  <title>the Extended DLNM 소개</title>
  <dc:creator>Suhyeon Kwon</dc:creator>
  <link>https://blog.zarathu.com/posts/2024-06-05-theExtendedDLNM/</link>
  <description><![CDATA[ <!-- Google tag (gtag.js) --><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-L0DYYSH9KM"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-L0DYYSH9KM');
</script><p>지연 효과와 비선형 관계를 모두 고려한 모델인 DLNM의 확장 버전, <strong>the Extended DLNM</strong>에 대해 소개하고, R의 <code>dlnm</code> 패키지를 이용하여 the Extended DLNM을 적합시키는 방법에 대해 소개합니다.</p>
<section id="dlnm이란" class="level1"><h1>1. DLNM이란?</h1>
<p>어떤 노출 요인(exposure, <img src="https://latex.codecogs.com/png.latex?X">)은 관측 당시 뿐만 아니라, 일정 시간이 지난 후 그 효과가 발생할 수 있습니다. 즉, <strong>‘지연 효과’</strong>를 가집니다. 모형에 지연 효과를 포함한다면 더 효과적인 예측을 진행할 수 있으며, 이를 위해 <strong>시차</strong>에 대한 차원이 추가적으로 필요합니다.</p>
<p>지연 효과를 고려한 모델로 DLM(Distributed Lag Models)가 존재합니다. 하지만 DLM은 선형적 효과를 다루는데 더 적합하므로, 비선형적 효과를 표현하는데 한계가 있습니다. DLNM은 DLM과 달리 비선형적 효과를 반영한, 더 flexible한 모형입니다.</p>
<p>DLNM은 <strong>cross-basis(교차 기저)</strong>를 정의하여 <img src="https://latex.codecogs.com/png.latex?X">(exposure)와 그것의 시차(lag)에 따른 <img src="https://latex.codecogs.com/png.latex?Y">(response)의 관계를 고려함으로써 지연 효과까지 반영합니다. 즉, cross-basis란 <strong>exposure-lag-response</strong>의 관계를 3차원 상의 공간에서 표현한 것입니다. cross-basis를 정의하기 위해 exposure-response 차원과 lag-response 차원에서 사용할 <strong>basis function(기저 함수)</strong>을 선택해야 하는데, 어떤 basis function을 선택하느냐에 따라 선형적/비선형적 관계를 고려할지 결정할 수 있습니다.</p>
<p><img src="https://blog.zarathu.com/posts/2024-06-05-theExtendedDLNM/img/crossbasis.png" width="100%"></p>
</section><section id="the-extended-dlnm이란" class="level1"><h1>2. the Extended DLNM이란?</h1>
<p>DLNM과 the Extended DLNM의 주요 차이점은 <strong>matrix of exposure histories</strong>의 정의입니다. matrix of exposure histories는 <img src="https://latex.codecogs.com/png.latex?n">개의 관측치 각각에 대한 lag <img src="https://latex.codecogs.com/png.latex?%5Cell">에서의 exposure 값들로 이루어진 행렬입니다. 즉, exposure 값들로 이루어진 <img src="https://latex.codecogs.com/png.latex?n%20%5Ctimes%20(L%20-%20%5Cell_0%20+%201)"> 크기의 행렬을 말합니다. 이 matrix of exposure histories는 study design과 수집된 정보에 따라 다르게 구성됩니다.</p>
<p>DLNM을 사용하는 일반적인 시계열 데이터에서 matrix of exposure histories의 <img src="https://latex.codecogs.com/png.latex?%5Bt,%20%5Cell%5D"> 값은 <img src="https://latex.codecogs.com/png.latex?%5Bt+1,%20%5Cell+1%5D"> 값과 동일합니다. <img src="https://latex.codecogs.com/png.latex?n">개의 관측치가 하나의 변수에 대한 여러 시점의 관측값이기 때문입니다.</p>
<p>예를 들어, 다음과 같은 데이터를 살펴봅시다. 아래 시계열 데이터는 1987-01-01부터 1987-01-15까지의 미세먼지(<code>pm10</code>)를 기록한 것입니다.</p>
<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>This is dlnm 2.4.7. For details: help(dlnm) and vignette('dlnmOverview').</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>         date     pm10
1  1987-01-01 26.95607
2  1987-01-02       NA
3  1987-01-03 32.83869
4  1987-01-04 39.95607
5  1987-01-05       NA
6  1987-01-06 40.95607
7  1987-01-07 33.95607
8  1987-01-08 28.95607
9  1987-01-09 32.34877
10 1987-01-10       NA
11 1987-01-11 14.95607
12 1987-01-12 18.95607
13 1987-01-13 45.95607
14 1987-01-14 35.95607
15 1987-01-15 26.93720</code></pre>
</div>
</div>
<p>이 데이터의 matrix of exposure histories는 아래와 같습니다. 이 경우, <img src="https://latex.codecogs.com/png.latex?%5Bt,%20%5Cell%5D"> 값은 <img src="https://latex.codecogs.com/png.latex?%5Bt+1,%20%5Cell+1%5D"> 값과 동일합니다.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>               lag0     lag1     lag2     lag3     lag4     lag5
1987-01-10       NA 32.34877 28.95607 33.95607 40.95607       NA
1987-01-11 14.95607       NA 32.34877 28.95607 33.95607 40.95607
1987-01-12 18.95607 14.95607       NA 32.34877 28.95607 33.95607
1987-01-13 45.95607 18.95607 14.95607       NA 32.34877 28.95607
1987-01-14 35.95607 45.95607 18.95607 14.95607       NA 32.34877
1987-01-15 26.93720 35.95607 45.95607 18.95607 14.95607       NA</code></pre>
</div>
</div>
<p>하지만 <img src="https://latex.codecogs.com/png.latex?n">개의 관측치가 서로 관련이 없는 경우, 이는 성립하지 않습니다. 이런 데이터는 the Extended DLNM을 사용해야 합니다.</p>
<p>예를 들어, 아래의 데이터는 각 환자들별로 매 시차의 약물 복용량을 기록한 것입니다. 이 경우, <img src="https://latex.codecogs.com/png.latex?%5Bt,%20%5Cell%5D"> 값은 <img src="https://latex.codecogs.com/png.latex?%5Bt+1,%20%5Cell+1%5D"> 값과 동일하지 않습니다.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>  lag0 lag1 lag2 lag3 lag4 lag5 lag6 lag7 lag8 lag9 lag10 lag11 lag12 lag13
1   37   37   37   37   37   37   37   40   40   40    40    40    40    40
2    0    0    0    0    0    0    0   55   55   55    55    55    55    55
3    0    0    0    0    0    0    0    0    0    0     0     0     0     0</code></pre>
</div>
</div>
</section><section id="r-dlnm-패키지" class="level1"><h1>3. R <code>dlnm</code> 패키지</h1>
<p>R의 <code>dlnm</code> 패키지를 이용하여 the Extended DLNM을 적합시키는 방법에 대해 소개하겠습니다. 사실, 함수의 input으로 시계열 데이터 대신 matrix of exposure histories를 입력한다는 부분을 제외하면 기본 DLNM을 적합시키는 방법과 크게 다르지 않습니다.</p>
<p>먼저 R에서 <code>dlnm</code> 패키지를 불러옵니다.</p>
<div class="cell">
<div class="sourceCode" id="cb5" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># install.packages("dlnm")</span></span>
<span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;"><a href="https://github.com/gasparrini/dlnm">dlnm</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span></code></pre></div>
</div>
<section id="data" class="level2"><h2 class="anchored" data-anchor-id="data">3.1 Data</h2>
<p><strong>the Extended DLNM</strong>의 R 실습에서 사용될 데이터는 <code>dlnm</code> 패키지에 포함되어 있는 <code>drug</code>와 <code>nested</code> 데이터셋입니다.</p>
<p><code>drug</code> 데이터는 환자별 시간에 따른 약물 복용량의 효과에 대한 데이터입니다. 해당 실험은 200명의 무작위 추출된 환자들에 대해 진행되었으며, 각 환자들은 4주 중 무작위로 선정된 2주동안 투약을 받게 되고, 약물 복용량은 매주 달라집니다. 아래 데이터를 보면, 각 환자별로 주별 복용량(<code>day1.7</code>, <code>day8.14</code>, <code>day15.21</code>, <code>day22.28</code>)이 기록되어 있으며, <code>out</code>에 28일째에 측정된 outcome 값이 기록되어 있습니다.</p>
<div class="cell">
<div class="sourceCode" id="cb6" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">drug</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  id out sex day1.7 day8.14 day15.21 day22.28
1  1  46   M      0       0       40       37
2  2  50   F      0      47       55        0
3  3   7   F     56      22        0        0
4  4  70   M     91       0        0       87
5  5  -3   F      0      42       28        0</code></pre>
</div>
</div>
<p><code>nested</code> 데이터는 시간에 따른 노출 요인(exposure)과 암 사이의 연관성에 대한 nested case-control study 데이터입니다. 300명의 case 집단과 300명의 control 집단에 대한 데이터가 포함되어 있습니다. 아래 데이터의 <code>case</code>에 case(1)/control(0) 여부가 기록되어 있으며, <code>exp15</code>-<code>exp60</code>은 15세부터 65세까지 5년 간격으로 평균 노출 요인(exposure)을 구한 값입니다. 만약, 환자의 나이(<code>age</code>)가 컬럼에 해당하는 나이보다 적다면 해당 컬럼에는 NA가 입력됩니다. 예를 들어, 아래 데이터의 4번 환자는 52세이기 때문에 exp55 이후의 컬럼에는 NA가 입력되어 있습니다.</p>
<div class="cell">
<div class="sourceCode" id="cb8" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">nested</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  id case age riskset exp15 exp20 exp25 exp30 exp35 exp40 exp45 exp50 exp55
1  1    1  81     240     5    84    34    45   128    81    14    52    11
2  2    1  69     129    11     8    25     6     8    12    19    60    16
3  3    1  73     180    14    15     7    69    10   143    18    19    44
4  4    0  52      19    10    16     5    30    24    33    14   122    NA
5  4    0  66      96    10    16     5    30    24    33    14   122     2
  exp60
1    16
2    10
3    23
4    NA
5    11</code></pre>
</div>
</div>
<section id="the-matrix-of-exposure-histories" class="level3"><h3 class="anchored" data-anchor-id="the-matrix-of-exposure-histories">The matrix of exposure histories</h3>
<p>DLNM을 적합시키기 전, 데이터의 형태를 <strong>matrix of exposure histories</strong> 형태로 바꿔주어야 합니다.</p>
<p><code>drug</code> 데이터의 matrix of exposure histories에서 <code>lag0</code>에 해당하는 값은 28일째의 약물 복용량입니다. 즉, <code>lag0</code>-<code>lag6</code>은 마지막 주의 약물 복용량, <code>lag7</code>-<code>lag13</code>은 셋째 주의 약물 복용량입니다. <code>drug</code> 데이터의 주별 약물 복용량 값을 7번씩 반복하여 다음과 같은 matrix of exposure histories를 만들어줍니다.</p>
<div class="cell">
<div class="sourceCode" id="cb10" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">Qdrug</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">drug</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[</span>,<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>, each<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">]</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">Qdrug</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lag"</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">27</span>, sep<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">Qdrug</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">14</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">]</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  lag0 lag1 lag2 lag3 lag4 lag5 lag6 lag7 lag8 lag9 lag10 lag11 lag12 lag13
1   37   37   37   37   37   37   37   40   40   40    40    40    40    40
2    0    0    0    0    0    0    0   55   55   55    55    55    55    55
3    0    0    0    0    0    0    0    0    0    0     0     0     0     0</code></pre>
</div>
</div>
<p><code>nested</code> 데이터의 matrix of exposure histories에서 <code>lag0</code>에 해당하는 시점은 환자의 나이마다 다릅니다. 예를 들어, 52세 환자의 lag0 시점은 52년의 값이고, 65세 환자의 lag0 시점은 65년의 값입니다. 이런 경우, matrix of exposure histories를 만들기 까다로운데, <code>dlnm</code> 패키지에서는 이런 경우의 matrix of exposure histories를 만들어주는 <code>exphist()</code>라는 함수를 제공합니다. <code>exphist()</code> 함수는 다음과 같이 이용합니다.</p>
<div class="cell">
<div class="sourceCode" id="cb12" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exphist</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">exp</span>, <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">times</span>, <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">lag</span>, fill<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span></code></pre></div>
</div>
<p><code>exp</code>에는 exposure profile(관측 첫 시점부터 매 시점의 exposure 값)을 입력합니다. <code>times</code>에는 lag0에 해당하는 시점을 입력합니다. <code>times</code>에 입력된 시점부터 시점을 거슬러가며 각 시차별 exposure 값이 구해집니다. <code>lag</code>에는 maximum lag 또는 lag range를 입력합니다. <code>fill</code>에는 어떤 시차에 해당하는 exposure 값이 존재하지 않을 때 채울 값을 입력합니다.</p>
<p><code>exphist()</code> 함수를 이용하여 다음과 같은 matrix of exposure histories를 만들어줍니다. <code>nested</code> 데이터의 평균 노출 요인 값에 0, 0, 0을 추가하고 각 데이터를 5번씩 반복하여 1년부터 65년까지에 해당하는 exposure profile을 만들고 이 값을 <code>exp</code>에 넣습니다. <code>times</code>에는 각 환자별 나이(<code>age</code>)를 넣습니다. <code>nested</code> 데이터를 이용한 분석에서는 lag3부터 lag40까지의 데이터만 사용할 예정이기 때문에 <code>lag</code>에는 다음과 같이 lag range를 벡터로 넣어줍니다. <code>nested</code> 데이터의 matrix of exposure histories는 다음과 같습니다.</p>
<div class="cell">
<div class="sourceCode" id="cb13" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">Qnest</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">nested</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">sub</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exphist</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">sub</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">14</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">]</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span>,</span>
<span>                                                      each<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span>, <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">sub</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"age"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">]</span>, lag<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">40</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">Qnest</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lag"</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">40</span>, sep<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">Qnest</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">11</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">]</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  lag3 lag4 lag5 lag6 lag7 lag8 lag9 lag10 lag11 lag12 lag13
1    0    0    0    0    0    0    0     0     0     0     0
2    0   10   10   10   10   10   16    16    16    16    16
3    0    0    0    0    0   23   23    23    23    23    44</code></pre>
</div>
</div>
</section></section><section id="a-simple-dlm" class="level2"><h2 class="anchored" data-anchor-id="a-simple-dlm">3.2 A simple DLM</h2>
<p><code>drug</code> 데이터와 <code>dlnm</code> 패키지의 함수를 이용하여 약물 복용량과 outcome 사이의 관계에 대해 분석해보고자 합니다.</p>
<p>먼저, 약물 복용량에 대한 cross-basis matrix를 만들어야 합니다. <code>crossbasis()</code> 함수를 이용합니다. <code>crossbasis()</code>의 첫 번째 인수에는 matrix of exposure histories를 넣어줍니다. <code>lag</code>에는 lag-response 차원에서 시차를 얼마나 고려할지 lag period를 입력합니다. maximum lag 또는 lag range를 입력해야하며, minimum lag는 기본값이 0으로 지정되어 있습니다. 이때, lag period는 matrix of exposure histories의 시차 범위와 일치해야 합니다. <code>argvar</code>에는 exposure-response 차원에서 사용할 basis function, <code>arglag</code>에는 lag-response 차원에서 사용할 basis function을 입력합니다.</p>
<p><code>drug</code> 데이터의 cross-basis는, exposure-response 차원에서 simple linear function을 이용하고, lag-response 차원에서 natural cubic spline을 이용합니다. 이 때, natural cubic spline에서 lag9, 18을 <code>knots</code>로 이용하는데, 이는 lag9, 18을 기준으로 구간을 나눠 각 구간에서 cubic regression model을 적합시킨다는 의미입니다.</p>
<p><code><a href="https://rdrr.io/r/base/summary.html">summary()</a></code> 함수를 통해 cross-basis matrix의 세부 사항을 확인할 수 있습니다.</p>
<div class="cell">
<div class="sourceCode" id="cb15" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">cbdrug</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">crossbasis</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">Qdrug</span>, lag<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">27</span>, argvar<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lin"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span>,</span>
<span>                     arglag<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>fun<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ns"</span>,knots<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">9</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">18</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">cbdrug</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>CROSSBASIS FUNCTIONS
observations: 200 
range: 0 to 100 
lag period: 0 27 
total df:  4 

BASIS FOR VAR:
fun: lin 
intercept: FALSE 

BASIS FOR LAG:
fun: ns 
knots: 9 18 
intercept: TRUE 
Boundary.knots: 0 27 </code></pre>
</div>
</div>
<p>위에서 생성된 cross-basis 객체인 <code>cbdrug</code>를 회귀식에 포함시키고, 성별에 대한 효과를 보정하여 단순 선형 회귀 분석을 진행합니다. 모형을 통해 추정된 약물 복용량 및 그 시차에 대한 효과를 <code>crosspred()</code> 함수를 통해 확인할 수 있습니다. <code>crosspred()</code>의 첫 번째 인수에는 cross-basis 객체를, 두 번째 인수에는 cross-basis 객체를 사용한 모델을 입력합니다. 다음 코드에서, <code>crosspred()</code>의 <code>at</code>은 약물 복용량이 <code>0:20*5</code>(즉, 0, 5, 10, 15, …, 100)일 때의 outcome을 예측하라는 뜻입니다.</p>
<div class="cell">
<div class="sourceCode" id="cb17" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">mdrug</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">out</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">cbdrug</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">sex</span>, <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">drug</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">pdrug</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">crosspred</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">cbdrug</span>, <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">mdrug</span>, at<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span></code></pre></div>
</div>
<p>crosspred 객체인 <code>pdrug</code>에 저장된 effect summaries는 다음과 같이 추출될 수 있습니다.</p>
<div class="cell">
<div class="sourceCode" id="cb18" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/with.html">with</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">pdrug</span>,<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">allfit</span>,<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">alllow</span>,<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">allhigh</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"50"</span>,<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">]</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  allfit   alllow  allhigh 
30.29584 20.12871 40.46298 </code></pre>
</div>
</div>
<p>위 코드는 약물 복용량이 50일때의 overall cumulative effects 추정치(<code>allfit</code>)와 95% 신뢰구간(<code>alllow</code>, <code>allhigh</code>) 추출한 것입니다. 이때, overall cumulative effects는 lag period인 28일동안 약물 복용량이 50으로 유지되었을 때 outcome의 전체적인 증가량 또는 약물 복용량 50이 28일 뒤 미치는 총 영향으로 해석될 수 있습니다.</p>
<p>위에서처럼 <code>all-</code>로 시작하는 객체들을 통해서는 전반적인 추정값을 확인할 수 있고, <code>mat-</code>으로 시작하는 객체들을 통해서는 특정 약물 복용량과 시차의 조합에 따른 추정 결과를 확인할 수 있습니다. 다음 코드는 lag3에서의 약물 복용량이 20일 때, outcome의 증가량을 추출한 것입니다. <code>?crosspred</code>를 통해 <code>crosspred()</code>의 더 많은 기능을 확인할 수 있습니다.</p>
<div class="cell">
<div class="sourceCode" id="cb20" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">pdrug</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">matfit</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"20"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lag3"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">]</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.118139</code></pre>
</div>
</div>
<p><code><a href="https://rdrr.io/r/graphics/plot.default.html">plot()</a></code> 함수를 이용해 추정 결과를 시각화할 수 있습니다.</p>
<div class="cell">
<div class="sourceCode" id="cb22" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>mfrow<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">pdrug</span>, zlab<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Effect"</span>, xlab<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Dose"</span>, ylab<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Lag (days)"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">pdrug</span>, var<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">60</span>, ylab<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Effect at dose 60"</span>, xlab<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Lag (days)"</span>, ylim<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">pdrug</span>, lag<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, ylab<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Effect at lag 10"</span>, xlab<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Dose"</span>, ylim<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span></code></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="https://blog.zarathu.com/posts/2024-06-05-theExtendedDLNM/index_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>첫 번째 그래프는 회귀 모델을 통해 추정한 exposure-lag-response 관계를 3차원 공간에 그려놓은 것입니다. 약물 복용량과 시차의 변화에 따라 effect가 어떻게 달라지는지 확인할 수 있습니다. 그래프에 따르면 약물 복용량의 효과는 복용 후 첫 번째 날에 나타나고 15-20일 후에 사라지는 경향이 있음을 알 수 있습니다.</p>
<p>두 번째와 세 번째 그래프는 약물 복용량이 60일 때의 lag-response curve와 lag가 10일 때 exposure-response curve를 그린 것입니다. 각각 <code>var=60</code>, <code>lag=10</code>을 지정하여 3차원상의 첫 번째 그래프의 단면을 자른 것과 같습니다. cross-basis matrix를 만들 때 basis function을 지정했던대로, lag-response 차원에서는 natural cubic spline, exposure-response 차원에서는 simple linear function 형태로 나타나는 것을 확인할 수 있습니다.</p>
</section><section id="a-more-complex-dlnm" class="level2"><h2 class="anchored" data-anchor-id="a-more-complex-dlnm">3.3 A more complex DLNM</h2>
<p><code>neseted</code> 데이터와 <code>dlnm</code> 패키지의 함수를 이용하여 노출 요인(exposure)에 대한 장기간의 노출이 암에 어떤 영향을 미치는지 분석하고자 합니다.</p>
<p>최근 3년(lag0-2)간의 노출은 암에 영향을 주지 않는다고 가정해봅시다. 따라서 matrix of exposure histories에는 lag3부터의 데이터만 있으면 됩니다.</p>
<p>먼저, cross-basis matrix를 만듭니다. <code>crossbasis()</code> 함수를 이용합니다. lag3부터 lag40까지의 데이터만 이용할 것이므로, <code>lag</code>에 <code>c(3,40)</code>을 넣어줍니다. exposure-response 차원에서는 basis 함수로 quadratic spline을 사용하고, exposure-lag 차원에서는 natural cubic spline을 사용합니다. quadratic spline의 자유도(<code>df</code>)와 차수(<code>degree</code>)를 입력해야하며, single knot는 별도로 지정하지 않으면 중앙값으로 지정됩니다. natural cubic spline은 <code>intercept=F</code>를 입력하여 intercept를 제외합니다. 위에서 lag0-2는 고려하지 않는다고 하였으므로, intercept를 제외함으로써 위 가정과 일치하게 시차 차원에서의 null effect를 예측할 수 있습니다.</p>
<div class="cell">
<div class="sourceCode" id="cb23" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">cbnest</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">crossbasis</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">Qnest</span>, lag<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">40</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span>, argvar<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bs"</span>,degree<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,df<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span>,</span>
<span>                     arglag<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>fun<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ns"</span>,knots<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span>,intercept<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">F</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">cbnest</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>CROSSBASIS FUNCTIONS
observations: 600 
range: 0 to 1064 
lag period: 3 40 
total df:  9 

BASIS FOR VAR:
fun: bs 
knots: 15 
degree: 2 
intercept: FALSE 
Boundary.knots: 0 1064 

BASIS FOR LAG:
fun: ns 
knots: 10 30 
intercept: FALSE 
Boundary.knots: 3 40 </code></pre>
</div>
</div>
<p>앞에서와 마찬가지로, cross-basis 객체를 회귀 모형에 포함시킵니다. <code>nested</code> 데이터는 nested case-control study 데이터이기 때문에, <strong>conditional logistic regression</strong>을 이용합니다. <code>survival</code> 패키지의 <code><a href="https://rdrr.io/pkg/survival/man/clogit.html">clogit()</a></code> 함수를 이용합니다.</p>
<p>crosspred 객체를 만들 때, <code>cen=0</code>을 입력하여 reference value를 0으로 지정합니다. 즉, 노출 요인에 따른 암의 OR은 exposure=0일 때를 기준으로 계산됩니다.</p>
<div class="cell">
<div class="sourceCode" id="cb25" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;"><a href="https://github.com/therneau/survival">survival</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">mnest</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/pkg/survival/man/clogit.html">clogit</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">case</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">cbnest</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/pkg/survival/man/strata.html">strata</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">riskset</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span>, <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">nested</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">pnest</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">crosspred</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">cbnest</span>, <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">mnest</span>, cen<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, at<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span></code></pre></div>
</div>
<p>effect summaries는 <code>pnest</code>를 통해 확인할 수 있습니다. 이번에는 <code>allRR-</code>이나 <code>matRR-</code>로 시작하는 객체를 추출하여 OR 추정값을 확인할 수 있습니다.</p>
<div class="cell">
<div class="sourceCode" id="cb26" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/with.html">with</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">pnest</span>,<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">allRRfit</span>,<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">allRRlow</span>,<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">allRRhigh</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"50"</span>,<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">]</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  allRRfit   allRRlow  allRRhigh 
 32.061676   2.561702 401.276652 </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb28" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">pnest</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">matRRfit</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"50"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lag5"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">]</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.058661</code></pre>
</div>
</div>
<p>앞에서와 마찬가지로, plot() 함수를 통해 추정 결과를 시각화할 수 있습니다.</p>
<div class="cell">
<div class="sourceCode" id="cb30" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>mfrow<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">pnest</span>, zlab<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"OR"</span>, xlab<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Exposure"</span>, ylab<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Lag (years)"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">pnest</span>, var<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>, ylab<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"OR for exposure 50"</span>, xlab<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Lag (years)"</span>, xlim<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">40</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">pnest</span>, lag<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, ylab<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"OR at lag 5"</span>, xlab<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Exposure"</span>, ylim<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.95</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.15</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span></code></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="https://blog.zarathu.com/posts/2024-06-05-theExtendedDLNM/index_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>첫 번째 그래프는 노출 요인과 암 사이의 exposure-lag-response 관계를 3차원 상에서 시각화한 것입니다. 그래프에 따르면 노출 초기엔 암의 위험성을 증가시키다가 점차 감소한다는 사실을 확인할 수 있습니다.</p>
<p>두 번째와 세 번째 그래프는 exposure이 50일 때의 lag-response curve와 lag가 5일 때 exposure-response curve를 그린 것입니다. 두 번째 그래프를 통해 노출 후 10-15년이 지났을 때 암의 위험성이 가장 크게 증가하며, 30년이 지났을 때쯤부턴 거의 원 상태로 되돌아온다는 사실을 확인할 수 있습니다. 세 번째 그림을 통해 노출 요인의 양이 20으로 증가할 때까지는 위험성이 크게 증가하지만 그 이후로는 위험성이 천천히 증가함을 확인할 수 있습니다.</p>
</section><section id="extended-prediction-summaries" class="level2"><h2 class="anchored" data-anchor-id="extended-prediction-summaries">3.4 Extended prediction summaries</h2>
<p><code>crosspred()</code>의 <code>at</code>과 <code>lag</code> 인자를 통해 특정 exposure 값 또는 lag에서의 effect summaries를 얻을 수 있습니다. 이때, <code>nested</code> 데이터의 matrix of exposure histories를 만들 때 사용한 함수인 <code>exphist()</code>를 사용한다면, 특정 exposure history에서의 effect summaries를 얻을 수 있습니다.</p>
<p>예를 들어, ’3.3 A more complex DLNM’에서 이용한 nested 데이터를 다시 분석해봅시다. 5년 동안의 exposure 값이 10이고, 그 이후 5년 간은 0, 그 이후 10년간은 13일 때의 effect summary를 구하고자 할 때, 아래와 같이 exposure history를 만들 수 있습니다.</p>
<div class="cell">
<div class="sourceCode" id="cb31" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">expnested</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">13</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">hist</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exphist</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">expnested</span>, time<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">expnested</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span>, lag<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">40</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">hist</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   lag3 lag4 lag5 lag6 lag7 lag8 lag9 lag10 lag11 lag12 lag13 lag14 lag15 lag16
20   13   13   13   13   13   13   13     0     0     0     0     0    10    10
   lag17 lag18 lag19 lag20 lag21 lag22 lag23 lag24 lag25 lag26 lag27 lag28
20    10    10    10     0     0     0     0     0     0     0     0     0
   lag29 lag30 lag31 lag32 lag33 lag34 lag35 lag36 lag37 lag38 lag39 lag40
20     0     0     0     0     0     0     0     0     0     0     0     0</code></pre>
</div>
</div>
<p><code>time</code> 인자에는 <code>expnested</code>의 길이를 입력하고, <code>lag</code>는 lag3부터 40까지만 고려한다고 입력합니다. 이때, <code>expnested</code>의 길이는 20이기 때문에 lag20-40의 exposure 값은 0으로 입력됩니다.</p>
<p>이렇게 만들어진 exposure history를 <code>crosspred()</code>의 <code>at</code> 인자에 넣어줍니다.</p>
<div class="cell">
<div class="sourceCode" id="cb33" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">pnesthist</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">crosspred</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">cbnest</span>, <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">mnest</span>, cen<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, at<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">hist</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/with.html">with</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">pnesthist</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">allRRfit</span>,<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">allRRlow</span>,<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">allRRhigh</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      20       20       20 
3.503928 1.240109 9.900351 </code></pre>
</div>
</div>
<p>위의 코드를 통해 해당 exposure history에서의 OR 추정치는 3.5임을 알 수 있습니다.</p>
<p>이 방법을 통해 여러 개의 time-varying exposure histories를 만들어 effect summaries를 구할 수 있습니다. ’3.2 A simple DLM’에서 이용한 <code>drug</code> 데이터를 다시 분석해봅시다. 환자의 2주 동안의 약물 복용량이 10이고, 그 후 1주간은 50이고, 그 후 1주간은 복용하지 않았을 때, 각 시점에서의 effect summary를 구해봅시다. 아래와 같이 각 시점에서의 exposure history을 만들어줍니다.</p>
<div class="cell">
<div class="sourceCode" id="cb35" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">expdrug</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span>,<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">dynhist</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exphist</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">expdrug</span>, lag<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">27</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">dynhist</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>,<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">]</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   lag0 lag1 lag2 lag3 lag4 lag5 lag6 lag7 lag8 lag9 lag10 lag11 lag12 lag13
1    10    0    0    0    0    0    0    0    0    0     0     0     0     0
2    10   10    0    0    0    0    0    0    0    0     0     0     0     0
3    10   10   10    0    0    0    0    0    0    0     0     0     0     0
4    10   10   10   10    0    0    0    0    0    0     0     0     0     0
5    10   10   10   10   10    0    0    0    0    0     0     0     0     0
6    10   10   10   10   10   10    0    0    0    0     0     0     0     0
7    10   10   10   10   10   10   10    0    0    0     0     0     0     0
8    10   10   10   10   10   10   10   10    0    0     0     0     0     0
9    10   10   10   10   10   10   10   10   10    0     0     0     0     0
10   10   10   10   10   10   10   10   10   10   10     0     0     0     0
   lag14 lag15 lag16 lag17 lag18 lag19 lag20 lag21 lag22 lag23 lag24 lag25
1      0     0     0     0     0     0     0     0     0     0     0     0
2      0     0     0     0     0     0     0     0     0     0     0     0
3      0     0     0     0     0     0     0     0     0     0     0     0
4      0     0     0     0     0     0     0     0     0     0     0     0
5      0     0     0     0     0     0     0     0     0     0     0     0
6      0     0     0     0     0     0     0     0     0     0     0     0
7      0     0     0     0     0     0     0     0     0     0     0     0
8      0     0     0     0     0     0     0     0     0     0     0     0
9      0     0     0     0     0     0     0     0     0     0     0     0
10     0     0     0     0     0     0     0     0     0     0     0     0
   lag26 lag27
1      0     0
2      0     0
3      0     0
4      0     0
5      0     0
6      0     0
7      0     0
8      0     0
9      0     0
10     0     0</code></pre>
</div>
</div>
<p><code>exphist()</code> 함수의 <code>time</code> 인자가 지정되지 않았을 경우에는 모든 time point에 대하여 exposure history가 만들어집니다. 이렇게 만들어진 exposure histories를 <code>crosspred()</code>의 <code>at</code> 인자에 넣어줍니다.</p>
<div class="cell">
<div class="sourceCode" id="cb37" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">pdyndrug</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">crosspred</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">cbdrug</span>, <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">mdrug</span>, at<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">dynhist</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span></code></pre></div>
</div>
<p>아래 코드로 그린 plot을 통해 각 시점에서의 exposure history의 effect summary를 확인할 수 있습니다.</p>
<div class="cell">
<div class="sourceCode" id="cb38" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">pdyndrug</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"overall"</span>, ylab<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Effect"</span>, xlab<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Time (days)"</span>, ylim<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">27</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span>,</span>
<span>     xlim<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span>, yaxt<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"n"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/graphics/axis.html">axis</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, at<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>new<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">expdrug</span>, type<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"h"</span>, xlim<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span>, ylim<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">300</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span>, axes<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">F</span>, ann<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">F</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/graphics/axis.html">axis</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>, at<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, cex.axis<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/graphics/mtext.html">mtext</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Dose"</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>, line<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.5</span>, at<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span>, cex<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span></code></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="https://blog.zarathu.com/posts/2024-06-05-theExtendedDLNM/index_files/figure-html/unnamed-chunk-24-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section><section id="applying-user-defined-functions" class="level2"><h2 class="anchored" data-anchor-id="applying-user-defined-functions">3.5 Applying user-defined functions</h2>
<p>cross-basis 객체를 생성할 때, exposure와 lag 차원에서 사용할 basis function을 사용자 정의 함수로 지정할 수 있습니다. 이때, 사용자 정의 함수의 첫 번째 인자는 반드시 <img src="https://latex.codecogs.com/png.latex?X">값이어야하고, return 값은 변환된 벡터 혹은 행렬이어야 합니다.</p>
<p>’3.3 A more complex DLNM’의 세 번째 plot을 보면, exposure-response 차원에서의 quadratic spline은 log 함수와 비슷한 형태임을 알 수 있습니다. cross-basis 객체를 생성할 때, exposure-response 차원에서의 basis function을 quadratic spline이 아닌 log 함수를 이용해봅시다.</p>
<p>다음과 같이 log 함수를 정의합니다.</p>
<div class="cell">
<div class="sourceCode" id="cb39" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">mylog</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">x</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">x</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span></code></pre></div>
</div>
<p>위에서 정의한 <code>mylog</code> 함수를 <code>crossbasis()</code> 함수에 넣어줍니다.</p>
<div class="cell">
<div class="sourceCode" id="cb40" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">cbnest2</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">crossbasis</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">Qnest</span>, lag<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">40</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span>, argvar<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mylog"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span>,</span>
<span>                      arglag<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>fun<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ns"</span>,knots<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span>,intercept<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">F</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">cbnest2</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>CROSSBASIS FUNCTIONS
observations: 600 
range: 0 to 1064 
lag period: 3 40 
total df:  3 

BASIS FOR VAR:
fun: mylog 

BASIS FOR LAG:
fun: ns 
knots: 10 30 
intercept: FALSE 
Boundary.knots: 3 40 </code></pre>
</div>
</div>
<p>3.3에서 정의한 cross-basis <code>cbnest</code>와 비교하여 자유도가 9에서 3으로 감소한 것을 확인할 수 있습니다.</p>
<p>아래 plot을 통해 추정 결과를 비교해봅시다.</p>
<div class="cell">
<div class="sourceCode" id="cb42" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">mnest2</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/pkg/survival/man/clogit.html">clogit</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">case</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">cbnest2</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/pkg/survival/man/strata.html">strata</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">riskset</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span>, <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">nested</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">pnest2</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">crosspred</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">cbnest2</span>, <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">mnest2</span>, cen<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, at<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span></span>
<span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>mfrow<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">pnest2</span>, zlab<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"OR"</span>, xlab<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Exposure"</span>, ylab<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Lag (years)"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">pnest2</span>, var<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>, ylab<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"OR for exposure 50"</span>, xlab<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Lag (years)"</span>, xlim<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">40</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">pnest</span>, var<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>, lty<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">pnest2</span>, lag<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, ylab<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"OR at lag 5"</span>, xlab<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Exposure"</span>, ylim<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.95</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.15</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">pnest</span>, lag<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, lty<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span></code></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="https://blog.zarathu.com/posts/2024-06-05-theExtendedDLNM/index_files/figure-html/unnamed-chunk-27-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>점선은 3.3에서 추정한 결과를 나타낸 것입니다. exposure-response 차원에서 basis function으로 log 함수를 사용했을 때와 quadratic spline을 사용했을 때의 결과가 유사함을 확인할 수 있습니다.</p>
<p>’3.2 A simple DLM’의 두 번째 plot을 보면, lag-response 차원에서의 natural cubic spline은 지수적으로 감소하는 형태를 보입니다. 다음과 같이 exponential decay 함수를 정의합니다.</p>
<div class="cell">
<div class="sourceCode" id="cb43" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">fdecay</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">x</span>,<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">scale</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span>  <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">basis</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">x</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">scale</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/attributes.html">attributes</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">basis</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">scale</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">scale</span></span>
<span>  <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">basis</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div>
</div>
<p>다음과 같이 crossbasis() 함수에 인자로 넣어주고, plot을 그려 결과를 확인합니다.</p>
<div class="cell">
<div class="sourceCode" id="cb44" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">cbdrug2</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">crossbasis</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">Qdrug</span>, lag<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">27</span>, argvar<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lin"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span>,</span>
<span>                      arglag<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>fun<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"fdecay"</span>,scale<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">cbdrug2</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>CROSSBASIS FUNCTIONS
observations: 200 
range: 0 to 100 
lag period: 0 27 
total df:  1 

BASIS FOR VAR:
fun: lin 
intercept: FALSE 

BASIS FOR LAG:
fun: fdecay 
scale: 6 </code></pre>
</div>
<div class="sourceCode" id="cb46" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">mdrug2</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">out</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">cbdrug2</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">sex</span>, <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">drug</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">pdrug2</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">crosspred</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">cbdrug2</span>, <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">mdrug2</span>, at<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span></span>
<span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>mfrow<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">pdrug2</span>, zlab<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Effect"</span>, xlab<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Dose"</span>, ylab<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Lag (days)"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">pdrug2</span>, var<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">60</span>, ylab<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Effect at dose 60"</span>, xlab<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Lag (days)"</span>, ylim<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">pdrug</span>, var<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">60</span>, lty<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">pdrug2</span>, lag<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, ylab<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Effect at lag 10"</span>, xlab<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Dose"</span>, ylim<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">pdrug</span>, lag<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, lty<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span></code></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="https://blog.zarathu.com/posts/2024-06-05-theExtendedDLNM/index_files/figure-html/unnamed-chunk-29-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>점선은 3.2에서 추정한 결과를 나타낸 것입니다. lag-response 차원에서 basis function으로 exponential decay 함수를 사용했을 때와 natural cubic spline을 사용했을 때의 결과가 유사함을 확인할 수 있습니다.</p>
</section></section><section id="references" class="level1"><h1>References</h1>
<ul>
<li>
<p>Gasparrini A, Armstrong B, Kenward MG. Distributed lag non-linear models. Stat Med. 2010 Sep 20;29(21):2224-34. doi: 10.1002/sim.3940. PMID: 20812303; PMCID: PMC2998707.</p>
<p><a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC2998707/pdf/sim0029-2224.pdf" class="uri">https://www.ncbi.nlm.nih.gov/pmc/articles/PMC2998707/pdf/sim0029-2224.pdf</a></p>
</li>
<li><p><a href="https://cran.r-project.org/web/packages/dlnm/vignettes/dlnmExtended.pdf" class="uri">https://cran.r-project.org/web/packages/dlnm/vignettes/dlnmExtended.pdf</a></p></li>
</ul>


</section><div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{kwon2024,
  author = {Kwon, Suhyeon},
  title = {The {Extended} {DLNM} {소개}},
  date = {2024-06-05},
  url = {https://blog.zarathu.com/posts/2024-06-05-theExtendedDLNM},
  langid = {en}
}
</code></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-kwon2024" class="csl-entry quarto-appendix-citeas">
Kwon, Suhyeon. 2024. <span>“The Extended DLNM 소개.”</span> June 5,
2024. <a href="https://blog.zarathu.com/posts/2024-06-05-theExtendedDLNM">https://blog.zarathu.com/posts/2024-06-05-theExtendedDLNM</a>.
</div></div></section></div> ]]></description>
  <category>R</category>
  <category>Statistics</category>
  <guid>https://blog.zarathu.com/posts/2024-06-05-theExtendedDLNM/</guid>
  <pubDate>Tue, 04 Jun 2024 15:00:00 GMT</pubDate>
  <media:content url="https://blog.zarathu.com/posts/2024-06-05-theExtendedDLNM/img/crossbasis.png" medium="image" type="image/png" height="164" width="144"/>
</item>
<item>
  <title>Shiny app 꾸미기</title>
  <dc:creator>Heeseok Choi</dc:creator>
  <link>https://blog.zarathu.com/posts/2024-05-24-app-design/</link>
  <description><![CDATA[ <!-- Google tag (gtag.js) --><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-L0DYYSH9KM"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-L0DYYSH9KM');
</script><section id="개요" class="level1"><h1>개요</h1>
<p>기본 shiny app은 스타일이 아쉽습니다. 디자인은 신경 쓰지 않고 기능에만 집중하시는 분들에게는 큰 문제가 되지 않지만 디자인도 서비스에서 매우 중요한 역할을 한다는 점은 부정할 수 없습니다. 이번 포스트에서는 간단하게 shiny app을 꾸밀 수 있는 방법을 소개합니다.</p>
</section><section id="기본-shiny-app" class="level1"><h1>기본 shiny app</h1>
<p>생활습관과 신체조건, 그리고 비만도를 포함하는 <a href="https://archive.ics.uci.edu/dataset/544/estimation+of+obesity+levels+based+on+eating+habits+and+physical+condition">데이터</a>를 가지고 기본적인 shiny app을 만든 후 하나씩 다듬어보겠습니다.</p>
<div class="cell">
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;"><a href="https://shiny.posit.co/">shiny</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">ui</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/pkg/shiny/man/navbarPage.html">navbarPage</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>title <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Obesity classification"</span>,</span>
<span>                 <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/pkg/shiny/man/tabPanel.html">tabPanel</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>title <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Data"</span>, <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">...</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span>,</span>
<span>                 <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">...</span></span>
<span>                 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">server</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">input</span>, <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">ouput</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span>  <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">...</span></span>
<span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span></span>
<span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/pkg/shiny/man/shinyApp.html">shinyApp</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>ui <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">ui</span>, server <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">server</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span></code></pre></div>
</div>
<p><img src="https://blog.zarathu.com/posts/2024-05-24-app-design/img/overall.png" width="100%"></p>
<p>차라투에서 서비스하는 대부분의 웹은 위와 같은 형식으로 이루어져있습니다.</p>
<p>shiny의 <code>navbarPage</code>와 <code>tabPanel</code>로 웹의 상단에 항목별 탭을 만들어 각 탭의 왼쪽에서 변수를 선택하고 중앙-오른쪽에서 그래프, 테이블 등의 분석 결과를 확인할 수 있습니다.</p>
</section><section id="bslib" class="level1"><h1>bslib</h1>
<section id="page_navbar-nav_panel" class="level2"><h2 class="anchored" data-anchor-id="page_navbar-nav_panel">page_navbar, nav_panel</h2>
<p>전반적인 테마를 바꾸기 위해 <code>bslib</code>을 불러옵니다. <code>bslib</code> 패키지가 설치되어있지 않다면 <code>install.packages("bslib")</code>을 입력하여 패키지를 설치합니다. 그리고 <code>navbarPage</code>를 <code>page_navbar</code>로, <code>tabPanel</code>을 <code>nav_panel</code>로 바꿔줍니다. 두 함수 모두 <code>shiny</code> 패키지의 함수와 기능은 동일하지만 스타일을 커스텀하기에 더 적합합니다.</p>
<div class="cell">
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;"><a href="https://shiny.posit.co/">shiny</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span>; <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;"><a href="https://rstudio.github.io/bslib/">bslib</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">ui</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rstudio.github.io/bslib/reference/page_navbar.html">page_navbar</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>title <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Obesity classification"</span>,</span>
<span>                 <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rstudio.github.io/bslib/reference/nav-items.html">nav_panel</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>title <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Data"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span>,</span>
<span>                 <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">...</span></span>
<span>                 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">server</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">input</span>, <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">ouput</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span>  <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">...</span></span>
<span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span></span>
<span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/pkg/shiny/man/shinyApp.html">shinyApp</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>ui <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">ui</span>, server <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">server</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span></code></pre></div>
</div>
<p><img src="https://blog.zarathu.com/posts/2024-05-24-app-design/img/modified_overall.png" width="100%"></p>
<p>전반적으로 버튼의 디자인이 바뀌었고 선택된 탭을 표시하는 방법도 바뀌었습니다.</p>
<p><code>page_navbar</code>함수에는 <code>theme = bs_theme(version = 5)</code>가 기본값으로 적용됩니다. 필요에 따라 해당 인자를 조정하여 부트스트랩 버전을 변경할 수 있습니다.</p>
<p>차라투 홈페이지와 shiny app의 내비게이션 바의 배경색을 동일하게 하여 통일감을 주고 글자크기도 변경해보겠습니다.</p>
<p>웹에서 마우스 오른쪽 버튼을 눌러 ’페이지 소스 보기’를 클릭하면 차라투 홈페이지 내비게이션 바 색상의 hex color code는 “#051F20”이고 shiny app의 내비게이션 바 타이틀의 클래스는 <code>navbar-brand</code>, 각 탭의 클래스는 <code>nav-link</code>인 것을 확인할 수 있습니다. 여기서 알아낸 것들을 아래와 같이 적용해보겠습니다.</p>
<div class="cell">
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;"><a href="https://shiny.posit.co/">shiny</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span>; <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;"><a href="https://rstudio.github.io/bslib/">bslib</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">ui</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rstudio.github.io/bslib/reference/page_navbar.html">page_navbar</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>title <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Obesity classification"</span>,</span>
<span>                  bg <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#051F20"</span>,</span>
<span>                  header <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">tags</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span></span>
<span>                    <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">tags</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">style</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rstudio.github.io/htmltools/reference/HTML.html">HTML</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span></span>
<span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">                        .navbar-brand {</span></span>
<span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">                            font-size: 30px;</span></span>
<span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">                        }</span></span>
<span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">                        .nav-link {</span></span>
<span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">                            font-size: 18px;</span></span>
<span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">                        }"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span>                        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span>                    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span>,</span>
<span>                  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rstudio.github.io/bslib/reference/nav-items.html">nav_panel</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>title <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Data"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span>,</span>
<span>                  <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">...</span></span>
<span>                  <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">server</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">input</span>, <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">ouput</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span>  <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">...</span></span>
<span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span></span>
<span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/pkg/shiny/man/shinyApp.html">shinyApp</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>ui <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">ui</span>, server <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">server</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span></code></pre></div>
</div>
<p><img src="https://blog.zarathu.com/posts/2024-05-24-app-design/img/bg_font.png" width="100%"></p>
<p>설정했던 대로 내비게이션 바의 배경색과 글자크기가 바뀐 것을 확인할 수 있습니다.</p>
</section><section id="nav_spacer-nav_menu" class="level2"><h2 class="anchored" data-anchor-id="nav_spacer-nav_menu">nav_spacer, nav_menu</h2>
<p><a href="https://rstudio.github.io/bslib/reference/navset.html#examples">여기</a>를 참고해서 내비게이션 바의 우측에 드롭다운 메뉴로 회사 홈페이지와 커뮤니티 페이지 바로가기를 만들겠습니다.</p>
<div class="cell">
<div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;"><a href="https://shiny.posit.co/">shiny</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span>; <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;"><a href="https://rstudio.github.io/bslib/">bslib</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span>; <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;"><a href="https://github.com/dreamRs/shinyWidgets">shinyWidgets</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">link_zarathu</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">tags</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">a</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span></span>
<span>  <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">tags</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">div</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span></span>
<span>    style <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"display: inline-block; background-color: #white;"</span>,</span>
<span>    <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">tags</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">img</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>src <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://raw.githubusercontent.com/zarathucorp/blog/master/img/logo_favicon.png"</span>,</span>
<span>             height <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"35px"</span>, width <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"35px"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span>  <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span>,</span>
<span>  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"차라투 홈페이지"</span>,</span>
<span>  href <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://www.zarathu.com/"</span>,</span>
<span>  target <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"_blank"</span></span>
<span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">link_community</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">tags</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">a</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span></span>
<span>  <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">tags</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">div</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span></span>
<span>    style <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"display: inline-block; background-color: #white;"</span>,</span>
<span>    <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">tags</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">img</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>src <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://raw.githubusercontent.com/zarathucorp/zarathu/master/public/img/about/logo.jpg"</span>,</span>
<span>             height <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"40px"</span>, width <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"40px"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span>  <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span>,</span>
<span>  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"연구지원 신청"</span>,</span>
<span>  href <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://community.zarathu.com/"</span>,</span>
<span>  target <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"_blank"</span></span>
<span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span></span>
<span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">ui</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rstudio.github.io/bslib/reference/page_navbar.html">page_navbar</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">...</span>,</span>
<span>                  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rstudio.github.io/bslib/reference/nav-items.html">nav_panel</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>title <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Logistic regression"</span>,</span>
<span>                            <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">...</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span>,</span>
<span>                  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rstudio.github.io/bslib/reference/nav-items.html">nav_spacer</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span>,</span>
<span>                  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rstudio.github.io/bslib/reference/nav-items.html">nav_menu</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span></span>
<span>                    title <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Links"</span>,</span>
<span>                    align <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"right"</span>,</span>
<span>                    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rstudio.github.io/bslib/reference/nav-items.html">nav_item</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">link_zarathu</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span>,</span>
<span>                    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rstudio.github.io/bslib/reference/nav-items.html">nav_item</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">link_community</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span>                    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span>                  <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span></code></pre></div>
</div>
<p><img src="https://blog.zarathu.com/posts/2024-05-24-app-design/img/dropdown.png" width="100%"></p>
<p><code>tags$div()</code>의 인자들을 가지고 로고, 글자크기, 배경색 등을 필요에 맞게 조절할 수 있습니다.</p>
</section></section><section id="shinywidgets" class="level1"><h1>shinyWidgets</h1>
<p>이번에는 <code>shinyWidgets</code> 패키지를 가지고 input 버튼들을 바꾸어보겠습니다.</p>
<section id="radiogroupbuttons" class="level2"><h2 class="anchored" data-anchor-id="radiogroupbuttons">radioGroupButtons</h2>
<p>shiny의 <code>radioButtons</code>를 shinyWidgets의 <code>radioGroupButtons</code>로 다음과 같이 박스로 바꾸어 선택된 박스에 색이 채워지도록 할 수 있습니다.</p>
<div class="cell">
<div class="sourceCode" id="cb5" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;"><a href="https://shiny.posit.co/">shiny</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span>; <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;"><a href="https://rstudio.github.io/bslib/">bslib</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span>; <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;"><a href="https://github.com/dreamRs/shinyWidgets">shinyWidgets</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">ui</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rstudio.github.io/bslib/reference/page_navbar.html">page_navbar</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">...</span>,</span>
<span>                  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rstudio.github.io/bslib/reference/nav-items.html">nav_panel</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>title <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Plot"</span>,</span>
<span>                            <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/pkg/shiny/man/sidebarLayout.html">sidebarLayout</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span></span>
<span>                              <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/pkg/shiny/man/sidebarLayout.html">sidebarPanel</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span></span>
<span>                                <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># radioButtons(inputId = "plot_type", label = "Plot type",</span></span>
<span>                                <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#              choices = c("violin", "box"), inline = TRUE),</span></span>
<span>                                <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">radioGroupButtons</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>inputId <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"plot_type"</span>, label <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Plot type"</span>,</span>
<span>                                                  choices <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"violin"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"box"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span>, direction <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"horizontal"</span>,</span>
<span>                                                  individual <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span>,</span>
<span>                                <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">...</span></span>
<span>                              <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span>,</span>
<span>                              <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/pkg/shiny/man/sidebarLayout.html">mainPanel</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">...</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span>                              <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span>                            <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span>,</span>
<span>                  <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">...</span></span>
<span>                  <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span></code></pre></div>
</div>
<div class="columns" style="text-align: center;">
<div class="column" style="width:50%;">
<figure class="figure"><p><img src="https://blog.zarathu.com/posts/2024-05-24-app-design/img/radio.png" alt="shiny::radioButtons" width="95%" class="figure-img"></p>
<figcaption style="text-align: center;"><p>shiny::radioButtons</p>
</figcaption></figure>
</div><div class="column" style="width:50%;">
<figure class="figure"><p><img src="https://blog.zarathu.com/posts/2024-05-24-app-design/img/radio_modified.png" alt="shinyWidgets::radioGroupButtons" width="95%" class="figure-img"></p>
<figcaption style="text-align: center;"><p>shinyWidgets::radioGroupButtons</p>
</figcaption></figure>
</div>
</div>
<p>당연히 세 개 이상의 버튼도 만들 수 있습니다.</p>
</section><section id="virtualselectinput" class="level2"><h2 class="anchored" data-anchor-id="virtualselectinput">virtualSelectInput</h2>
<p>shiny의 <code>selectInput</code>을 shinyWidgets의 <code>virtualSelectInput</code>으로 바꿔보겠습니다.</p>
<div class="cell">
<div class="sourceCode" id="cb6" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;"><a href="https://shiny.posit.co/">shiny</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span>; <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;"><a href="https://rstudio.github.io/bslib/">bslib</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span>; <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;"><a href="https://github.com/dreamRs/shinyWidgets">shinyWidgets</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">varlist</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span></span>
<span>  base <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Gender"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Age"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Height"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Weight"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"family_history_with_overweight"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span>,</span>
<span>  condition <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"FAVC"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"FCVC"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"NCP"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"CAEC"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"SMOKE"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"CH2O"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"SCC"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"FAF"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"TUE"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"CALC"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"MTRANS"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span>,</span>
<span>  outcome <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"NObeyesdad"</span></span>
<span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">ui</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rstudio.github.io/bslib/reference/page_navbar.html">page_navbar</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">...</span>,</span>
<span>                  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rstudio.github.io/bslib/reference/nav-items.html">nav_panel</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>title <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Linear regression"</span>,</span>
<span>                            <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/pkg/shiny/man/sidebarLayout.html">sidebarLayout</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span></span>
<span>                              <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/pkg/shiny/man/sidebarLayout.html">sidebarPanel</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span></span>
<span>                                <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">...</span>,</span>
<span>                                <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># selectInput(inputId = "ind_var", label = "Independent variable",</span></span>
<span>                                <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#             choices = list("base" = varlist$base, "condition" = varlist$condition),</span></span>
<span>                                <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#             multiple = TRUE),</span></span>
<span>                                <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">virtualSelectInput</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>inputId <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ind_var"</span>, label <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Independent variable"</span>,</span>
<span>                                                   choices <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"base"</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">varlist</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">base</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"condition"</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">varlist</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">condition</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span>,</span>
<span>                                                   multiple <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>, search <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>, showValueAsTags <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span>                              <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span>,</span>
<span>                              <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/pkg/shiny/man/sidebarLayout.html">mainPanel</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">...</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span>                              <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span>                            <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span>,</span>
<span>                  <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">...</span></span>
<span>                  <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span></code></pre></div>
</div>
<div class="columns" style="text-align: center;">
<div class="column" style="width:50%;">
<figure class="figure"><p><img src="https://blog.zarathu.com/posts/2024-05-24-app-design/img/selinput.png" width="95%" class="figure-img"></p>
<figcaption style="text-align: center;"><p>shiny::selectInput</p>
</figcaption></figure>
</div><div class="column" style="width:50%;">
<figure class="figure"><p><img src="https://blog.zarathu.com/posts/2024-05-24-app-design/img/selinput_modified.png" width="95%" class="figure-img"></p>
<figcaption style="text-align: center;"><p>shinyWidgets::virtualSelectInput</p>
</figcaption></figure>
</div>
</div>
<p>기존의 <code>seletInput</code>과는 다르게 전체선택/해제가 가능하고, <code>choices</code>인자에 리스트를 넣었을 때 카테고리별로 선택/해제가 가능하다는 점이 큰 장점으로 다가왔습니다.</p>
</section></section><section id="vov" class="level1"><h1>vov</h1>
<p><a href="https://github.com/tylerlittlefield/vov"><code>vov</code> 패키지</a>는 shiny app에 애니메이션 효과를 줄 수 있는 패키지입니다.</p>
<p><code>install.packages("vov")</code>로 패키지를 설치하고 불러온 후 다른 탭을 선택할때마다 화면이 부드럽게 전환되도록 <code>fade_in</code>함수를 사용하겠습니다.</p>
<p><code>vov</code>패키지에서 제공하는 애니메이션 효과를 사용하려면 <code>page_navbar</code>함수 안에 <code>use_vov</code>함수를 실행하고 애니메이션 효과가 다타나길 원하는 UI를 애니메이션 함수로 감쌉니다.</p>
<div class="cell">
<div class="sourceCode" id="cb7" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;"><a href="https://shiny.posit.co/">shiny</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span>; <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;"><a href="https://rstudio.github.io/bslib/">bslib</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span>; <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;"><a href="https://github.com/dreamRs/shinyWidgets">shinyWidgets</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span>; <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;"><a href="https://github.com/tyluRp/vov">vov</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">ui</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rstudio.github.io/bslib/reference/page_navbar.html">page_navbar</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">...</span>,</span>
<span>                  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">use_vov</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span>,</span>
<span>                  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">fade_in</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span></span>
<span>                    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rstudio.github.io/bslib/reference/nav-items.html">nav_panel</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>title <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Data"</span>, <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">...</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span>                    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span>,</span>
<span>                  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">fade_in</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span></span>
<span>                    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rstudio.github.io/bslib/reference/nav-items.html">nav_panel</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>title <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Table 1"</span>, <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">...</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span>                    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span>,</span>
<span>                  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">fade_in</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span></span>
<span>                    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rstudio.github.io/bslib/reference/nav-items.html">nav_panel</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>title <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Plot"</span>, <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">...</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span>                    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span>,</span>
<span>                  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">fade_in</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span></span>
<span>                    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rstudio.github.io/bslib/reference/nav-items.html">nav_panel</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>title <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Linear regression"</span>, <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">...</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span>                    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span>                  <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span></code></pre></div>
</div>
<p>아래와 같이 다른 탭을 누를때마다 fade in 효과가 적용된 것을 확인할 수 있습니다.</p>
<p><img src="https://blog.zarathu.com/posts/2024-05-24-app-design/img/fade_in.gif" width="100%"></p>
</section><section id="마치며" class="level1"><h1>마치며</h1>
<p>지금까지 여러 패키지들을 가지고 shiny app을 꾸밀 수 있는 방법을 알아보았습니다.</p>
<p>CSS를 조금도 모른다면 사소한 것 하나까지 커스텀하기는 힘들어 보였지만 웹 개발 관련 지식이 부족한 상태에서 보다 세련된 shiny app을 만들 수 있었습니다.</p>
<p>그리고 가장 중요한 점은 아이디어 또는 디자인적인 감각이라는 생각이 들었습니다. “shiny app을 꾸며보자”의 다음 단계가 “무슨 요소를, 어떻게 꾸미지?” 였는데 이런 쪽으로 세심한 편이 아니라서 고민하는 데 시간이 오래 걸렸고 결과도 썩 좋지 못했다는 생각이 들었습니다.</p>
<p>추후에 차라투가 서비스하는 shiny app에도 멋있는 스타일이 적용되기를 바라면서 글을 마치겠습니다.</p>


</section><div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{choi2024,
  author = {Choi, Heeseok},
  title = {Shiny App {꾸미기}},
  date = {2024-05-24},
  url = {https://blog.zarathu.com/posts/2024-05-24-app-design},
  langid = {en}
}
</code></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-choi2024" class="csl-entry quarto-appendix-citeas">
Choi, Heeseok. 2024. <span>“Shiny App 꾸미기.”</span> May 24, 2024. <a href="https://blog.zarathu.com/posts/2024-05-24-app-design">https://blog.zarathu.com/posts/2024-05-24-app-design</a>.
</div></div></section></div> ]]></description>
  <category>R</category>
  <category>shiny</category>
  <category>bslib</category>
  <guid>https://blog.zarathu.com/posts/2024-05-24-app-design/</guid>
  <pubDate>Thu, 23 May 2024 15:00:00 GMT</pubDate>
  <media:content url="https://blog.zarathu.com/posts/2024-05-24-app-design/img/logo.png" medium="image" type="image/png" height="61" width="144"/>
</item>
<item>
  <title>patchwork를 활용한 고급 시각화</title>
  <dc:creator>Jinhwan Kim</dc:creator>
  <link>https://blog.zarathu.com/posts/2024-05-17-patchwork/</link>
  <description><![CDATA[ <!-- Google tag (gtag.js) --><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-L0DYYSH9KM"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-L0DYYSH9KM');
</script><section id="data-visualization" class="level2"><h2 class="anchored" data-anchor-id="data-visualization">data visualization</h2>
<p>데이터 시각화는 데이터 분석에서 중요한 역할을 한다. 다행히 R은 이 방면에서는 <code>ggplot2</code>를 필두로 다른 프로그래밍 언어들 이상의 뛰어난 여러 기능들을 사용할 수 있다는 장점이 있다.</p>
<p>한편 데이터 시각화는 제작 이후 색상이나 레이아웃 등의 <strong>추가적인 커스텀 수정</strong>을 필요로 하기도 한다. 이를 위해 R 내에서 할 수 있다면 더할 나위 없이 좋지만 떄로는 단순한 작업을 위해 여러줄 코드를 사용하는 것보다 간단히 ppt 같은 외부 프로그램을 활용하는 것이 더 간편한 경우도 많다.</p>
<p>이전의 다른 <a href="https://blog.zarathu.com/posts/2023-07-01-officer/" target="_blank">아티클</a>에서 <code>officer</code> 패키지를 활용해 MS powerpoint로 벡터 이미지를 만들고 편집하는 방법을 소개하였는데, 이번 글에서는 여러 장의 이미지를 대상으로 R에서 할 수 있는 고급 방법들과 이에 쓰이는 R 패키지를 소개한다.</p>
</section><section id="result" class="level2"><h2 class="anchored" data-anchor-id="result">result</h2>
<p>이번 글에서 소개하는 방법들을 적용한 ppt 결과물을 먼저 소개한다.</p>
<p><img src="https://blog.zarathu.com/posts/2024-05-17-patchwork/img/res2.png" width="100%"></p>
<p>우선 위 이미지는</p>
<ol type="1">
<li>R에서 <code>ggplot2</code>를 사용하여 만든 <strong>시각화</strong>를</li>
<li>
<code>cowplot</code>을 이용하여 <strong>박스</strong>로 감싸고</li>
<li>
<code>patchwork</code>와 를 사용해 <strong>시각화</strong>와 설명을 위한 <strong>텍스트</strong>를 <strong>레이아웃</strong>에 따라 배치한 뒤</li>
<li>
<code>officer</code>를 활용하여 와이드스크린(혹은 16:9) 해상도 크기의 <strong>MS powerpoint</strong>로 만들어 낸 결과물이다.</li>
</ol>
<p>이 결과물들은 벡터 그래픽스를 활용한 만큼, 다음 이미지처럼 ppt에서 편리하게 커스텀 수정이 가능하다.</p>
<p><img src="https://blog.zarathu.com/posts/2024-05-17-patchwork/img/tuning.png" width="100%"></p>
</section><section id="patchwork" class="level2"><h2 class="anchored" data-anchor-id="patchwork">patchwork</h2>
<p>예시에서 사용할 이미지는 <code>ggplot2</code>의 <code>mtcars</code> 데이터셋을 사용하는 <code>patchwork</code>의 예시 코드를 사용한다. <code>ggplot2</code>과 각 차트에 대해서는 별도로 설명하지 않는다.</p>
<div class="cell">
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 27%">
<col style="width: 6%">
<col style="width: 5%">
<col style="width: 8%">
<col style="width: 5%">
<col style="width: 6%">
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 4%">
<col style="width: 4%">
<col style="width: 6%">
<col style="width: 6%">
</colgroup>
<thead><tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: right;">mpg</th>
<th style="text-align: right;">cyl</th>
<th style="text-align: right;">disp</th>
<th style="text-align: right;">hp</th>
<th style="text-align: right;">drat</th>
<th style="text-align: right;">wt</th>
<th style="text-align: right;">qsec</th>
<th style="text-align: right;">vs</th>
<th style="text-align: right;">am</th>
<th style="text-align: right;">gear</th>
<th style="text-align: right;">carb</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Mazda RX4</td>
<td style="text-align: right;">21.0</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">160.0</td>
<td style="text-align: right;">110</td>
<td style="text-align: right;">3.90</td>
<td style="text-align: right;">2.620</td>
<td style="text-align: right;">16.46</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">4</td>
</tr>
<tr class="even">
<td style="text-align: left;">Mazda RX4 Wag</td>
<td style="text-align: right;">21.0</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">160.0</td>
<td style="text-align: right;">110</td>
<td style="text-align: right;">3.90</td>
<td style="text-align: right;">2.875</td>
<td style="text-align: right;">17.02</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">4</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Datsun 710</td>
<td style="text-align: right;">22.8</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">108.0</td>
<td style="text-align: right;">93</td>
<td style="text-align: right;">3.85</td>
<td style="text-align: right;">2.320</td>
<td style="text-align: right;">18.61</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">Hornet 4 Drive</td>
<td style="text-align: right;">21.4</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">258.0</td>
<td style="text-align: right;">110</td>
<td style="text-align: right;">3.08</td>
<td style="text-align: right;">3.215</td>
<td style="text-align: right;">19.44</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Hornet Sportabout</td>
<td style="text-align: right;">18.7</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">360.0</td>
<td style="text-align: right;">175</td>
<td style="text-align: right;">3.15</td>
<td style="text-align: right;">3.440</td>
<td style="text-align: right;">17.02</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="even">
<td style="text-align: left;">Valiant</td>
<td style="text-align: right;">18.1</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">225.0</td>
<td style="text-align: right;">105</td>
<td style="text-align: right;">2.76</td>
<td style="text-align: right;">3.460</td>
<td style="text-align: right;">20.22</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Duster 360</td>
<td style="text-align: right;">14.3</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">360.0</td>
<td style="text-align: right;">245</td>
<td style="text-align: right;">3.21</td>
<td style="text-align: right;">3.570</td>
<td style="text-align: right;">15.84</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">4</td>
</tr>
<tr class="even">
<td style="text-align: left;">Merc 240D</td>
<td style="text-align: right;">24.4</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">146.7</td>
<td style="text-align: right;">62</td>
<td style="text-align: right;">3.69</td>
<td style="text-align: right;">3.190</td>
<td style="text-align: right;">20.00</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Merc 230</td>
<td style="text-align: right;">22.8</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">140.8</td>
<td style="text-align: right;">95</td>
<td style="text-align: right;">3.92</td>
<td style="text-align: right;">3.150</td>
<td style="text-align: right;">22.90</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="even">
<td style="text-align: left;">Merc 280</td>
<td style="text-align: right;">19.2</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">167.6</td>
<td style="text-align: right;">123</td>
<td style="text-align: right;">3.92</td>
<td style="text-align: right;">3.440</td>
<td style="text-align: right;">18.30</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">4</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Merc 280C</td>
<td style="text-align: right;">17.8</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">167.6</td>
<td style="text-align: right;">123</td>
<td style="text-align: right;">3.92</td>
<td style="text-align: right;">3.440</td>
<td style="text-align: right;">18.90</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">4</td>
</tr>
<tr class="even">
<td style="text-align: left;">Merc 450SE</td>
<td style="text-align: right;">16.4</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">275.8</td>
<td style="text-align: right;">180</td>
<td style="text-align: right;">3.07</td>
<td style="text-align: right;">4.070</td>
<td style="text-align: right;">17.40</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">3</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Merc 450SL</td>
<td style="text-align: right;">17.3</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">275.8</td>
<td style="text-align: right;">180</td>
<td style="text-align: right;">3.07</td>
<td style="text-align: right;">3.730</td>
<td style="text-align: right;">17.60</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">3</td>
</tr>
<tr class="even">
<td style="text-align: left;">Merc 450SLC</td>
<td style="text-align: right;">15.2</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">275.8</td>
<td style="text-align: right;">180</td>
<td style="text-align: right;">3.07</td>
<td style="text-align: right;">3.780</td>
<td style="text-align: right;">18.00</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">3</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Cadillac Fleetwood</td>
<td style="text-align: right;">10.4</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">472.0</td>
<td style="text-align: right;">205</td>
<td style="text-align: right;">2.93</td>
<td style="text-align: right;">5.250</td>
<td style="text-align: right;">17.98</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">4</td>
</tr>
<tr class="even">
<td style="text-align: left;">Lincoln Continental</td>
<td style="text-align: right;">10.4</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">460.0</td>
<td style="text-align: right;">215</td>
<td style="text-align: right;">3.00</td>
<td style="text-align: right;">5.424</td>
<td style="text-align: right;">17.82</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">4</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Chrysler Imperial</td>
<td style="text-align: right;">14.7</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">440.0</td>
<td style="text-align: right;">230</td>
<td style="text-align: right;">3.23</td>
<td style="text-align: right;">5.345</td>
<td style="text-align: right;">17.42</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">4</td>
</tr>
<tr class="even">
<td style="text-align: left;">Fiat 128</td>
<td style="text-align: right;">32.4</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">78.7</td>
<td style="text-align: right;">66</td>
<td style="text-align: right;">4.08</td>
<td style="text-align: right;">2.200</td>
<td style="text-align: right;">19.47</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Honda Civic</td>
<td style="text-align: right;">30.4</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">75.7</td>
<td style="text-align: right;">52</td>
<td style="text-align: right;">4.93</td>
<td style="text-align: right;">1.615</td>
<td style="text-align: right;">18.52</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="even">
<td style="text-align: left;">Toyota Corolla</td>
<td style="text-align: right;">33.9</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">71.1</td>
<td style="text-align: right;">65</td>
<td style="text-align: right;">4.22</td>
<td style="text-align: right;">1.835</td>
<td style="text-align: right;">19.90</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Toyota Corona</td>
<td style="text-align: right;">21.5</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">120.1</td>
<td style="text-align: right;">97</td>
<td style="text-align: right;">3.70</td>
<td style="text-align: right;">2.465</td>
<td style="text-align: right;">20.01</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">Dodge Challenger</td>
<td style="text-align: right;">15.5</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">318.0</td>
<td style="text-align: right;">150</td>
<td style="text-align: right;">2.76</td>
<td style="text-align: right;">3.520</td>
<td style="text-align: right;">16.87</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">AMC Javelin</td>
<td style="text-align: right;">15.2</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">304.0</td>
<td style="text-align: right;">150</td>
<td style="text-align: right;">3.15</td>
<td style="text-align: right;">3.435</td>
<td style="text-align: right;">17.30</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="even">
<td style="text-align: left;">Camaro Z28</td>
<td style="text-align: right;">13.3</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">350.0</td>
<td style="text-align: right;">245</td>
<td style="text-align: right;">3.73</td>
<td style="text-align: right;">3.840</td>
<td style="text-align: right;">15.41</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">4</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Pontiac Firebird</td>
<td style="text-align: right;">19.2</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">400.0</td>
<td style="text-align: right;">175</td>
<td style="text-align: right;">3.08</td>
<td style="text-align: right;">3.845</td>
<td style="text-align: right;">17.05</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="even">
<td style="text-align: left;">Fiat X1-9</td>
<td style="text-align: right;">27.3</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">79.0</td>
<td style="text-align: right;">66</td>
<td style="text-align: right;">4.08</td>
<td style="text-align: right;">1.935</td>
<td style="text-align: right;">18.90</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Porsche 914-2</td>
<td style="text-align: right;">26.0</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">120.3</td>
<td style="text-align: right;">91</td>
<td style="text-align: right;">4.43</td>
<td style="text-align: right;">2.140</td>
<td style="text-align: right;">16.70</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="even">
<td style="text-align: left;">Lotus Europa</td>
<td style="text-align: right;">30.4</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">95.1</td>
<td style="text-align: right;">113</td>
<td style="text-align: right;">3.77</td>
<td style="text-align: right;">1.513</td>
<td style="text-align: right;">16.90</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Ford Pantera L</td>
<td style="text-align: right;">15.8</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">351.0</td>
<td style="text-align: right;">264</td>
<td style="text-align: right;">4.22</td>
<td style="text-align: right;">3.170</td>
<td style="text-align: right;">14.50</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">4</td>
</tr>
<tr class="even">
<td style="text-align: left;">Ferrari Dino</td>
<td style="text-align: right;">19.7</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">145.0</td>
<td style="text-align: right;">175</td>
<td style="text-align: right;">3.62</td>
<td style="text-align: right;">2.770</td>
<td style="text-align: right;">15.50</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">6</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Maserati Bora</td>
<td style="text-align: right;">15.0</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">301.0</td>
<td style="text-align: right;">335</td>
<td style="text-align: right;">3.54</td>
<td style="text-align: right;">3.570</td>
<td style="text-align: right;">14.60</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">8</td>
</tr>
<tr class="even">
<td style="text-align: left;">Volvo 142E</td>
<td style="text-align: right;">21.4</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">121.0</td>
<td style="text-align: right;">109</td>
<td style="text-align: right;">4.11</td>
<td style="text-align: right;">2.780</td>
<td style="text-align: right;">18.60</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">2</td>
</tr>
</tbody>
</table>
<p>mtcars</p>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">p1</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">mtcars</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">mpg</span>, <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">disp</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">p2</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">mtcars</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html">geom_boxplot</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">gear</span>, <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">disp</span>, group <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">gear</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">p3</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">mtcars</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">gear</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">cyl</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">p4</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">mtcars</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">carb</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">p5</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">mtcars</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/geom_violin.html">geom_violin</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">cyl</span>, <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">mpg</span>, group <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">cyl</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">p6</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">mtcars</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">mpg</span>, <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">disp</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">cyl</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span></code></pre></div>
</div>
<p><code>patchwork</code>는 여러 개의 ggplot 결과물들을 하나(한장)의 그래픽에 간단하게 배치할 수 있게 하는 R 패키지이다. 유사한 목적으로 <code>patchwork</code>외에 <code>gridExtra</code>나 <code>cowplot</code>등의 다른 패키지도 사용할 수 있다.</p>
<p><code>patchwork</code>의 사용법은 크게 <code>+</code>, <code>|</code>, <code>( )</code>, <code>/</code>로 구성된다.</p>
<section id="vertical-bar" class="level3"><h3 class="anchored" data-anchor-id="vertical-bar">| (vertical bar)</h3>
<p>먼저 <code>|</code> 는 여러 이미지를 <strong>하나의 행</strong>에 배치하는 역할을 한다.</p>
<div class="cell">
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">p1</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">p2</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">p3</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">p4</span></span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><figcaption>patchwork - vertical bar</figcaption><p><img src="https://blog.zarathu.com/posts/2024-05-17-patchwork/index_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section><section id="section" class="level3"><h3 class="anchored" data-anchor-id="section">+</h3>
<p>두번째로 <code>+</code>는 여러 이미지를 배치하는데 이때 행과 열은 <strong>grid</strong> 형태로, <strong>행 순서</strong>로 채우는 방식을 사용한다.</p>
<div class="cell">
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">p1</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">p2</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">p3</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">p4</span></span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><figcaption>patchwork - plus</figcaption><p><img src="https://blog.zarathu.com/posts/2024-05-17-patchwork/index_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>이때 이미지 배치를 특별히 지정을 하기 위해서는 <code>plot_layout</code>이라는 함수를 사용한다.</p>
<div class="cell">
<div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">p1</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">p2</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">p3</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">p4</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">p5</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot_layout</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>ncol <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, byrow <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><figcaption>patchwork - plot_layout</figcaption><p><img src="https://blog.zarathu.com/posts/2024-05-17-patchwork/index_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section><section id="section-1" class="level3"><h3 class="anchored" data-anchor-id="section-1">/</h3>
<p>이어서 <code>/</code>를 사용하면 이미지를 <strong>열</strong>로 이어서 배치할 수 있다.</p>
<div class="cell">
<div class="sourceCode" id="cb5" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">p1</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">p2</span> </span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><figcaption>patchwork - slash</figcaption><p><img src="https://blog.zarathu.com/posts/2024-05-17-patchwork/index_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section><section id="section-2" class="level3"><h3 class="anchored" data-anchor-id="section-2">( )</h3>
<p>마지막으로 <code>( )</code>를 사용하면 이미지를 <strong>하나의 그룹</strong>으로 묶어서 배치할 수 있다.</p>
<div class="cell">
<div class="sourceCode" id="cb6" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">p1</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">p2</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">p3</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><figcaption>patchwork - parenthesis</figcaption><p><img src="https://blog.zarathu.com/posts/2024-05-17-patchwork/index_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>물론 이 외에도 <code>patchwork</code>는 다양한 기능을 제공하는데, 자세한 내용은 <a href="https://patchwork.data-imaginist.com/" target="_blank">공식 문서</a>를 참고하자.</p>
<p>이를 활용해서 이제 앞에서 만들었던 예시 이미지 6개를 한장의 ppt에 배치해보자.</p>
<div class="cell">
<div class="sourceCode" id="cb7" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">combined_plot</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">p1</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">p2</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">p3</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span></span>
<span>  <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">p4</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">p5</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">p6</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>plot.margin <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/element.html">margin</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> </span>
<span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">combined_plot</span></span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><figcaption>patchwork - combined</figcaption><p><img src="https://blog.zarathu.com/posts/2024-05-17-patchwork/index_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section></section><section id="cowplot" class="level2"><h2 class="anchored" data-anchor-id="cowplot">cowplot</h2>
<p>이어서 <code>cowplot</code>을 사용해 이미지 사이에 <strong>캡션</strong>과 <strong>박스</strong>를 추가하는 방법을 다루겠다.</p>
<p>우선 첫 이미지 3장을 표현하는 가상의 캡션을 <code>list</code> 형태로 생성한다. 참고로 <code>&lt;br&gt;</code>은 줄넘김을 의미한다.</p>
<p><em>내용은 <a href="https://www.lipsum.com/" target="_blank">lorem ipsum</a>을 활용했다.</em></p>
<div class="cell">
<div class="sourceCode" id="cb8" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">text</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span></span>
<span>  p1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Lorem ipsum dolor sit amet &lt;br&gt; consectetur adipiscing elit."</span>,</span>
<span>  p2 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Integer lectus risus, &lt;br&gt; tincidunt eget felis non."</span>,</span>
<span>  p3 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Cras varius sapien et est consectetur porttitor."</span></span>
<span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span></code></pre></div>
</div>
<p>이를 이전 <code>combined_plot</code>에 추가한다.</p>
<div class="cell">
<div class="sourceCode" id="cb9" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">combined_plot</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">p1</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">p2</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">p3</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span></span>
<span>  <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">text</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">p1</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">text</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">p2</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">text</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">p3</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span></span>
<span>  <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">p4</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">p5</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">p6</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>plot.margin <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/element.html">margin</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> </span>
<span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># combined_plot </span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ERROR !!</span></span></code></pre></div>
</div>
<p>그러나 이 상태로는 text 오브젝트가 ggplot 결과가 아닌 단순 텍스트만을 포함하기 때문에 에러가 발생한다. 이를 해결하기 위해 <code>cowplot</code>의 <code>ggdraw</code> 함수를 사용한다.</p>
<section id="ggdraw" class="level3"><h3 class="anchored" data-anchor-id="ggdraw">ggdraw</h3>
<p>우선 <code>cowplot</code>은 ggplot2의 결과물에 annotation, theme를 추가하는 기능등을 제공하는 R 패키지로, <code>ggdraw</code>는 ggplot2의 결과물에 추가적인 그래픽을 그릴 수 있게 제일 상위 레벨에 레이어를 추가한다고 생각하면 편하다.</p>
<div class="cell">
<div class="sourceCode" id="cb10" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">scatter</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">mpg</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">displ</span>, <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">cty</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal_grid</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">draft</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggdraw</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">scatter</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">draw_label</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Draft"</span>, colour <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#80404080"</span>, size <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">120</span>, angle <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">45</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">scatter</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">draft</span></span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><figcaption>cowplot - ggdraw</figcaption><p><img src="https://blog.zarathu.com/posts/2024-05-17-patchwork/index_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>이 <code>ggdraw</code>를 사용해 이전의 text 내용 중 <strong>첫번째 라벨(p1)을 label로 갖는 ggplot 오브젝트</strong>를 생성하고 이를 <code>combined_plot</code>에 추가한다.</p>
<div class="cell">
<div class="sourceCode" id="cb11" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">combined_plot</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">p1</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">p2</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">p3</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span></span>
<span>  <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span> </span>
<span>    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggdraw</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span>      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>subtitle <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">text</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">p1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span>      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_void</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span>      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span></span>
<span>        text <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>size <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span>,</span>
<span>        plot.subtitle <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggtext</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_textbox_simple</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span></span>
<span>          hjust <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,</span>
<span>          halign <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,</span>
<span>          margin <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/element.html">margin</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span>        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span>,</span>
<span>        plot.margin <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/element.html">margin</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span>      <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> </span>
<span>  <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span></span>
<span>  <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">p4</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">p5</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">p6</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>plot.margin <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/element.html">margin</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> </span>
<span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">combined_plot</span></span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><figcaption>cowplot - combined with caption</figcaption><p><img src="https://blog.zarathu.com/posts/2024-05-17-patchwork/index_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>이어서 남은 라벨을 추가하기 전, 라벨 커스텀에 반복적으로 쓰이는 기능들을 별도의 함수로 만들어 사용하자. 추가로 caption과 그래프를 동일한 1:1:1의 높이로 할당하지 않고 caption 부분을 줄이기 위해 <code>plot_layout</code>의 <code>height</code>로 높이를 조절한다.</p>
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><figcaption>cowplot - caption function</figcaption><p><img src="https://blog.zarathu.com/posts/2024-05-17-patchwork/index_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>다음은 각 시각화를 박스(테두리)로 감싸는 방법을 다룬다. 이를 위해 각 시각화에 <code>ggdraw</code>를 사용하여 레이어를 만들고, 그 레이어에 <code>draw_line</code> 함수를 사용해 (0,0) 부터 (1,1)을 지나는 직선을 추가하는 방법을 사용한다.</p>
<p>추가로 각 시각화에 text 속성을 조절하기 위해 <code>theme</code> 함수를 사용한다.</p>
<div class="cell">
<div class="sourceCode" id="cb12" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">text_theme</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span></span>
<span>  text <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>size <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span>, </span>
<span>  axis.text <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>size <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span>, </span>
<span>  axis.title <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>size <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span>,</span>
<span>  axis.title.x <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>size <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span>, </span>
<span>  axis.title.y <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>size <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span>, </span>
<span>  plot.title <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>size <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span>,</span>
<span>  legend.text <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>size <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span>,</span>
<span>  legend.title <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>size <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span></span>
<span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span></span>
<span>  <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">p1</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|</span> </span>
<span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggdraw</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">p1</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">text_theme</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span>    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">draw_line</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span></span>
<span>      x <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span>, </span>
<span>        y <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span>, </span>
<span>        color <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>, </span>
<span>        size <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span></span>
<span>    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><figcaption>cowplot - box</figcaption><p><img src="https://blog.zarathu.com/posts/2024-05-17-patchwork/index_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>이전과 마찬가지로 (반복되는) 박스를 만드는 기능들을 함수로 만들어 사용하자.</p>
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><figcaption>cowplot - box function</figcaption><p><img src="https://blog.zarathu.com/posts/2024-05-17-patchwork/index_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section></section><section id="officer" class="level2"><h2 class="anchored" data-anchor-id="officer">officer</h2>
<p>이제 <code>officer</code> 패키지를 사용해 위에서 만든 그래프를 ppt에 추가해보자.</p>
<p>기본적인 <code>officer</code>에 대한 소개는 이전 <a href="https://blog.zarathu.com/posts/2023-07-01-officer/" target="_blank">아티클</a>을 참고하면 좋다.</p>
<p><code>officer</code>에서는 <code>read_pptx</code> 함수로 ppt 오브젝트를 생성하는데 이때 읽을 파일을 입력하지 않으면 너비와 높이가 <strong>4:3 비율</strong>인 새로운 오브젝트를 생성하여 사용한다.</p>
<p>만약 이를 그대로 사용한다면 다음 그림과 같이 애써만든 레이아웃이 깨지는 상황이 발생할 수 있기 때문에, ppt에서 임의의 사이즈를 갖는 템플릿을 만들고 이를 파일로 읽어 사용한다.</p>
<p><img src="https://blog.zarathu.com/posts/2024-05-17-patchwork/img/11.png" width="100%"></p>
<div class="callout callout-style-simple callout-note">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-body-container">
<p>ppt를 생성한 다음, <code>페이지 설정</code>에서 <strong>16:9</strong> 혹은 <strong>와이드 스크린</strong>으로 변경하는 방법도 있지만, 이 방법 또한 마찬가지로 그래프 요소들을 다시 배치해야 한다는 점은 동일하다.</p>
</div>
</div>
</div>
<p><img src="https://blog.zarathu.com/posts/2024-05-17-patchwork/img/ws.png" width="100%"></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb13-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read_pptx</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"~/Documents/template.pptx"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb13-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">remove_slide</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb13-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">add_slide</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb13-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ph_with</span>(</span>
<span id="cb13-5">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">value =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Example Title (baseline ~ X)"</span>, </span>
<span id="cb13-6">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">location =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ph_location_type</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"title"</span>)</span>
<span id="cb13-7">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb13-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ph_with</span>(</span>
<span id="cb13-9">    rvg<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dml</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ggobj =</span> combined_plot), </span>
<span id="cb13-10">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">location =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ph_location</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">left =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">top =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.5</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">height =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">width =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">13.333</span>)</span>
<span id="cb13-11">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb13-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">print</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">target =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"output2.pptx"</span>)</span></code></pre></div>
</div>
<p>위 코드에서 2번째 줄 <code>remove_slide</code> 함수를 사용하지 않으면, 기존 템플릿의 슬라이드 <strong>이후</strong> 에 ggplot 결과를 담는 슬라이드를 만들기 때문에 아래와 같이 불필요한 첫페이지를 가지고 시작하게 된다.</p>
<p><img src="https://blog.zarathu.com/posts/2024-05-17-patchwork/img/empty.png" width="100%"></p>
<p>한편 <code>remove_slide</code>와 <code>add_slide</code>를 둘 다 제거하고 <code>ph_with</code>으로 이미지만 더하게 되면 아래와 같이 템플릿의 제목과 새로 추가한 제목이 겹쳐서 보여지게 된다.</p>
<div class="cell">
<div class="sourceCode" id="cb14" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read_pptx</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"~/Documents/template.pptx"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ph_with</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span></span>
<span>    value <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Example Title (baseline ~ X)"</span>, </span>
<span>    location <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ph_location_type</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>type <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"title"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span>  <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ph_with</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span></span>
<span>    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rvg</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://davidgohel.github.io/rvg/reference/dml.html">dml</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>ggobj <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">combined_plot</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span>, </span>
<span>    location <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ph_location</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>left <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, top <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.5</span>, height <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>, width <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">13.333</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span>  <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>target <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"output2.pptx"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span></code></pre></div>
</div>
<p><img src="https://blog.zarathu.com/posts/2024-05-17-patchwork/img/overlap.png" width="100%"></p>
<p>그러므로 템플릿을 사용하는 경우에는 <code>remove_slide</code>와 <code>add_slide</code>를 활용하는 것을 권장한다.</p>
</section><section id="summary" class="level2"><h2 class="anchored" data-anchor-id="summary">summary</h2>
<p>이번 아티클에서는 <code>patchwork</code>와 <code>cowplot</code>을 사용해 여러 그래프를 하나로 합치고 약간의 커스텀을 거쳐, <code>officer</code>를 사용해 ppt에 추가하는 방법을 알아보았다. 이처럼 R의 기능과 ppt를 연결하는 방법은 다양하게 활용할 수 있으며, 이를 통해 보다 효율적인 작업을 할 수 있을 것이다.</p>
<p><img src="https://blog.zarathu.com/posts/2024-05-17-patchwork/img/res2.png" width="100%"></p>
<p>최종 코드는 다음과 같다.</p>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb15" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;"><a href="https://patchwork.data-imaginist.com">patchwork</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;"><a href="https://wilkelab.org/cowplot/">cowplot</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;"><a href="https://ardata-fr.github.io/officeverse/">officer</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">p1</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">mtcars</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">mpg</span>, <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">disp</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">p2</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">mtcars</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html">geom_boxplot</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">gear</span>, <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">disp</span>, group <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">gear</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">p3</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">mtcars</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">gear</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">cyl</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">p4</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">mtcars</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">carb</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">p5</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">mtcars</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/geom_violin.html">geom_violin</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">cyl</span>, <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">mpg</span>, group <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">cyl</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">p6</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">mtcars</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">mpg</span>, <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">disp</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">cyl</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">text</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span></span>
<span>  p1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Lorem ipsum dolor sit amet &lt;br&gt; consectetur adipiscing elit."</span>,</span>
<span>  p2 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Integer lectus risus, &lt;br&gt; tincidunt eget felis non."</span>,</span>
<span>  p3 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Cras varius sapien et est consectetur porttitor."</span></span>
<span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">cap</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">text</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://wilkelab.org/cowplot/reference/ggdraw.html">ggdraw</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span>    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>subtitle <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">text</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span>    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_void</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span>    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span></span>
<span>      text <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>size <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span>,</span>
<span>      plot.margin <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/element.html">margin</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span>    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">text_theme</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span></span>
<span>  text <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>size <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span>, </span>
<span>  axis.text <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>size <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span>, </span>
<span>  axis.title <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>size <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span>,</span>
<span>  axis.title.x <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>size <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span>, </span>
<span>  axis.title.y <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>size <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span>, </span>
<span>  plot.title <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>size <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span>,</span>
<span>  legend.text <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>size <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span>,</span>
<span>  legend.title <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>size <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">with.box</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">p</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://wilkelab.org/cowplot/reference/ggdraw.html">ggdraw</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">p</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">text_theme</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span>    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cowplot</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://wilkelab.org/cowplot/reference/draw_line.html">draw_line</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span></span>
<span>      x <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span>, </span>
<span>      y <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span>, </span>
<span>      color <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>, </span>
<span>      size <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span></span>
<span>    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> </span>
<span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">combined_plot</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">with.box</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">p1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">with.box</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">p2</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">with.box</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">p3</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span></span>
<span>  <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cap</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">text</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">p1</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">text_theme</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cap</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">text</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">p2</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">text_theme</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cap</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">text</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">p3</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">text_theme</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span></span>
<span>  <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">with.box</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">p4</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">with.box</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">p5</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">with.box</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">p6</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot_layout</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>heights <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>plot.margin <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/element.html">margin</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> </span>
<span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">combined_plot</span></span>
<span></span>
<span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://davidgohel.github.io/officer/reference/read_pptx.html">read_pptx</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"~/Documents/template.pptx"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://davidgohel.github.io/officer/reference/ph_with.html">ph_with</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span></span>
<span>    value <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Example Title (baseline ~ X)"</span>, </span>
<span>    location <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://davidgohel.github.io/officer/reference/ph_location_type.html">ph_location_type</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>type <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"title"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span>  <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://davidgohel.github.io/officer/reference/ph_with.html">ph_with</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span></span>
<span>    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rvg</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://davidgohel.github.io/rvg/reference/dml.html">dml</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>ggobj <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">combined_plot</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span>, </span>
<span>    location <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://davidgohel.github.io/officer/reference/ph_location.html">ph_location</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>left <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, top <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.5</span>, height <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>, width <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">13.333</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span>  <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>target <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"output2.pptx"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span></code></pre></div>
</details>
</div>


</section><div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-reuse"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div class="quarto-appendix-contents"><div><a rel="license" href="https://creativecommons.org/licenses/by-nc/4.0/">CC BY-NC 4.0</a></div></div></section><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{kim2024,
  author = {Kim, Jinhwan},
  title = {Patchwork를 {활용한} {고급} {시각화}},
  date = {2024-05-17},
  url = {https://blog.zarathu.com/posts/2024-05-17-patchwork},
  langid = {en}
}
</code></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-kim2024" class="csl-entry quarto-appendix-citeas">
Kim, Jinhwan. 2024. <span>“Patchwork를 활용한 고급 시각화.”</span> May
17, 2024. <a href="https://blog.zarathu.com/posts/2024-05-17-patchwork">https://blog.zarathu.com/posts/2024-05-17-patchwork</a>.
</div></div></section></div> ]]></description>
  <category>R</category>
  <category>cowpot</category>
  <category>ggplot2</category>
  <category>officer</category>
  <category>patchwork</category>
  <category>powerpoint</category>
  <guid>https://blog.zarathu.com/posts/2024-05-17-patchwork/</guid>
  <pubDate>Thu, 16 May 2024 15:00:00 GMT</pubDate>
  <media:content url="https://blog.zarathu.com/posts/2024-05-17-patchwork/img/logo.png" medium="image" type="image/png" height="62" width="144"/>
</item>
<item>
  <title>rhub와 Github action를 활용한 OS별 R 패키지 검증</title>
  <dc:creator>Jinhwan Kim</dc:creator>
  <link>https://blog.zarathu.com/posts/2024-05-13-rhub/</link>
  <description><![CDATA[ 
<!-- Google tag (gtag.js) -->

<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-L0DYYSH9KM"></script>

<script>

  window.dataLayer = window.dataLayer || [];

  function gtag(){dataLayer.push(arguments);}

  gtag('js', new Date());



  gtag('config', 'G-L0DYYSH9KM');

</script>





<section id="r-cmd-check" class="level2">
<h2 class="anchored" data-anchor-id="r-cmd-check">R CMD CHECK</h2>
<p><code>R CMD CHECK</code>란 R 패키지를 개발한 이후 “정상적으로 개발 되었는지” 검증하는 약 50개 이상의 체크리스트를 실행하는 과정으로, 함수의 사용법이 제대로 작성되었는지, 함수의 parameter가 제대로 작성되었는지 등을 포함한다.</p>
<p>물론 <code>R CMD CHECK</code>를 엄격하게 수행하지 않아도 github 를 통해 패키지를 배포하고 실행하는 것에 문제는 없지만, 이러한 과정을 통해 패키지의 오류를 최소화하고 사용자에게 안정적인 패키지를 제공할 수 있다는 것이 검증 되어야만 CRAN과 같은 공식 리포지토리를 통해 패키지를 공유할 수 있다.</p>
<p>이 포스팅에서는 구체적인 내용을 다루진 않지만, 관심이 있다면 Hadley Wickham의 <a href="https://r-pkgs.org/R-CMD-check.html" target="_blank">R Packages</a>를 참고하는 것도 좋다.</p>
<p>아무튼 <code>R CMD CHECK</code> 는 <code>devtools</code>패키지를 사용하여 R 패키지를 만들었다면, <code>devtools::check()</code>함수 또는 Rstudio에서 <code>Check</code> 버튼으로 할 수 있고, Warnings, Errors, Notes 등을 통해 수정되길 권고하는 문제들을 확인할 수 있다.</p>
<p><img src="https://blog.zarathu.com/posts/2024-05-13-rhub/img/check.png" width="100%"></p>
<p>그러나 이 <code>R CMD CHECK</code>의 특징 중 한가지는 패키지를 개발하는 PC의 환경을 기준으로 체크를 진행한다는 것이다. 즉, 아래의 이미지 같은 경우 macOS (Apple clang) 환경에서는 패키지가 테스트 되었고 실행이 보장되지만 만약 사용자의 OS가 mac이 아닌 window, linux 같은 경우에는 패키지가 정상적으로 작동하지 않을 수도 있다.</p>
<p>CRAN은 기본 OS를 정하지 않고 있지만 Windows, macOS, linux 중 최소 2개 이상의 OS에서의 테스트에서 문제가 없길 요구하는 만큼 R 패키지를 개발하는 것은 다양한 OS에서의 테스트를 포함하기도 한다.</p>
<p>이를 위해 다양한 OS 하드웨어, 즉 windows PC, mac, linux 서버가 있다면 베스트겠지만 이러한 경우는 많지 않고 대부분 Github action, AppVeyor, Travis CI 등의 CI/CD 서비스를 활용해 다양한 OS에서의 테스트를 수행하게 된다.</p>
</section>
<section id="github-action" class="level2">
<h2 class="anchored" data-anchor-id="github-action">Github action</h2>
<p>이 포스팅에서는 Github action을 기준으로 소개하지만 다른 서비스도 과정과 프로세스는 대동소이하다.</p>
<p>Github action은 Github에서 제공하는 CI/CD 서비스로, Github에서 제공하는 다양한 Action을 사용하여 (github 이 제공하는 서버에서의 명령어 실행을 통해) 자동화된 테스트, 빌드, 배포 등을 수행할 수 있다.</p>
<p><img src="https://blog.zarathu.com/posts/2024-05-13-rhub/img/gha.png" width="100%"></p>
<p>여기서 Action이란 yml 파일로 구성된 명령어들의 모음 정도로 생각해도 충분하며, 예시로는 서버에 R을 설치하기, R 패키지를 설치하기, R CMD CHECK를 실행하기 등이 있다. <a href="https://github.com/r-hub/actions" target="_blank">R-hub action 모음</a>, <a href="https://github.com/r-lib/actions" target="_blank">R-lib action 모음</a> 참고.</p>
<p>즉, 이 <code>R CMD CHECK</code>를 포함한 Action들을 github action을 통해 server에서 실행하고 그 결과를 확인하여 CRAN에 올리는 과정을 거치게 되는데 github action의 문제점 중 하나는 아래의 예시와 같이 action을 사용하기 위한 yml 문법이 상당히 이질적이라는 것이다.</p>
<p><img src="https://blog.zarathu.com/posts/2024-05-13-rhub/img/yml.png" width="100%"></p>
</section>
<section id="r-hub2" class="level2">
<h2 class="anchored" data-anchor-id="r-hub2">r-hub2</h2>
<p>r-hub 프로젝트는 R 컨소시엄의 프로젝트 중 하나로, R 개발자들이 R 패키지를 더 잘 개발할 수 있게 하는 목적을 가지고 있다. 다양한 OS에서의 테스트를 수행하는 것을 돕는 것 또한 그 중 하나로 위에서 언급한 Github Action을 개발한다거나 인프라를 제공하거나, 커뮤니티를 통해 문제 해결을 돕는 등의 역할이 있다.</p>
<p>그런데 이 R-hub 프로젝트에서 최근 이 GHA 설정을 돕기 위한 R 패키지, <code>rhub</code>를 개발하여 공개했다.</p>
<p>공식 블로그에 설명 되어 있는 것처럼, 사용 방법은 기존의 Github Action을 사용하지 않았더라도 다양한 OS에서 <code>R CMD CHECK</code>를 손쉽게 수행할 수 있는 Github Action을 설정할 수 있다.</p>
<p>제일 먼저 해야하는 것은 당연하게도 <code>rhub</code> 패키지를 설치하는 것이다. 여기서 <code>pak</code>은 기존의 <code>install.packages</code>와 <code>remotes::install_github</code> 같이 다양한 소스에서의 R 패키지 설치를 통합하여 지원하는 함수로 기존의 패키지 설치 방법들을 대체하기를 권장하고 있다.</p>
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1">pak<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pkg_install</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"rhub"</span>)</span></code></pre></div>
<p>주의할 점으로 <code>rhub</code> 패키지는 공식적인 버전은 2이지만 <code>rhub2</code>가 아닌 <code>rhub</code>로 설치, 실행해야 하며 포스팅에서는 <code>rhub</code>로 표기하겠다.</p>
<p>이 <code>rhub</code> 패키지를 실행하기 위해서는 아래 3가지가 필요한데, R 패키지를 개발하여 github에 공유한 경험이 있다면 별도로 새롭게 준비해야 할 것은 없다.</p>
<ol type="1">
<li>github 계정</li>
<li>R package를 올린 repository. 이때 CRAN을 목적으로 한다면 당연히 Public이어야 한다.</li>
<li>Github PAT (Personal Access Token), github 에서 발급 받을 수 있고, <code>gitcreds</code>라는 또 다른 R 패키지를 사용해도 좋다.</li>
</ol>
<section id="setup" class="level3">
<h3 class="anchored" data-anchor-id="setup">Setup</h3>
<p><code>rhub</code> 패키지를 마친 이후 제일 먼저 해야하는 것은 <strong>R 패키지 디렉토리</strong>에서 <code>rhub_setup</code> 함수를 실행하는 것이다. 이 함수의 역할은 디렉토리의 git repository를 인식하고, Github Action을 위한 yml 파일을 생성한다.</p>
<p>이전에 만들었던 <code>gemini.R</code> 패키지를 아래 이미지 예시로 사용했다.</p>
<p><img src="https://blog.zarathu.com/posts/2024-05-13-rhub/img/setup.png" width="100%"></p>
<p>큰 문제가 없다면, rhub 패키지에서는 이후 진행해야 할 단계도 안내해준다. 즉, 추가된 yml 파일이 추가된 내용을 github에 커밋하여 업데이트를 반영하고 난 뒤 <code>rhub_doctor</code> 함수를 실행한다.</p>
</section>
<section id="doctor" class="level3">
<h3 class="anchored" data-anchor-id="doctor">Doctor</h3>
<p><code>rhub_doctor</code> 함수에서는 Github PAT가 제대로 설정되어 있는지를 확인한다. 이후 소개할 <code>rhub</code>의 <code>rhub_check</code>함수는 Rstudio의 콘솔에서 언급한 Github PAT를 사용하여 수동으로 Github Action을 실행하는 역할을 하기 때문에 PAT의 설정 확인이 필요하다.</p>
<p>Github PAT는 “https://github.com/settings/tokens” 링크에서 생성하되 <code>repo</code>와 <code>workflow</code> 권한을 반드시 부여하여 생성해야하만 한다.</p>
<p><img src="https://blog.zarathu.com/posts/2024-05-13-rhub/img/pat.png" width="100%"></p>
<p>Rstudio에 Github PAT를 설정 하는 방법은 <code>credential</code> 패키지의 <code>set_github_pat</code> 함수를 이용한다. <a href="https://forum.posit.co/t/how-to-i-use-a-new-github-pat/112700" target="_blank">링크 참고</a></p>
<p><code>rhub_doctor</code> 함수가 정상적으로 작동했다면 이제 남은 것은 rhub_check 함수를 실행하는 것이다.</p>
<p><img src="https://blog.zarathu.com/posts/2024-05-13-rhub/img/doctor.png" width="100%"></p>
</section>
<section id="check" class="level3">
<h3 class="anchored" data-anchor-id="check">Check</h3>
<p>이전 단계는 이 함수를 위한 준비 작업이었다 라고 해도 과언이 아니다.</p>
<p><img src="https://blog.zarathu.com/posts/2024-05-13-rhub/img/check2.png" width="100%"></p>
<p><code>rhub_check</code> 함수는 github repository와 PAT를 인식한 다음 어떤 OS에서 <code>R CMD CHECK</code>를 수행할 것인지 입력값으로 받는다.</p>
<p>이 때 단순히 Windows, macOS, Linux 외에도 이미지처럼 (rhub 프로젝트에서 제공하는) 다양한 OS를 숫자와 쉼표를 통해 구분하여 선택할 수 있다.</p>
<p>함수를 실행한 후에는 GHA 페이지로 연결할 수 있는 링크를 제공하는데 이를 통해 진행 상황을 확인할 수 있다.</p>
<p><img src="https://blog.zarathu.com/posts/2024-05-13-rhub/img/actionpage.png" width="100%"></p>
<p>최종적으로 rhub와 GHA를 사용한 테스트 패스를 repository에 뱃지로 추가하면 아래와 같이 나타난다.</p>
<p><img src="https://blog.zarathu.com/posts/2024-05-13-rhub/img/badge.png" width="100%"></p>
<p>이 때 readme에 뱃지 아이콘을 추가하기 위해서는 다음과 같이 작성해야한다.</p>
<pre><code>![example workflow](https://github.com/&lt;OWNER&gt;/&lt;REPOSITORY&gt;/actions/workflows/&lt;WORKFLOW_FILE&gt;/badge.svg)</code></pre>
<p>예시로 사용한 <code>gemini.R</code>은 <owner> 대신 jhk0530, <repository> 대신 gemini.R, <workflow_file> 대신 rhub.yaml로 대체한다.</workflow_file></repository></owner></p>
<p>주의할 점으로 이 Github Action을 통한 <code>R CMD CHECK</code>에는 다소 시간이 소요되기 때문에 우선 개발중인 PC에서 <code>R CMD CHECK</code>를 완료한 이후에 실행하는 것을 권장한다.</p>
<p>물론 rhub에는 github나 public repository가 아닌 경우를 위한 안내도 있지만, 이는 대부분의 R 패키지, 특히 CRAN과는 크게 연관이 없기 때문에 별도로 서술하지 않는다.</p>
</section>
</section>
<section id="summary" class="level2">
<h2 class="anchored" data-anchor-id="summary">Summary</h2>
<p>이번 포스팅에서는 R 패키지 개발자를 위한 Github Action을 활용하기 위한 <code>rhub</code> 패키지를 소개했다. 이를 통해 R 패키지 개발자는 로컬 환경에서 뿐 아니라 다양한 OS에서의 <code>R CMD CHECK</code>를 통해 패키지의 오류를 최소화하고 더 좋은 패키지를 만들 수 있을 것이다.</p>
<p>원문을 포함한 더 자세한 정보는 <a href="https://blog.r-hub.io/2024/04/11/rhub2/" target="_blank">rhub의 블로그 </a>에서도 확인할 수 있다.</p>


</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-reuse"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div class="quarto-appendix-contents"><div><a rel="license" href="https://creativecommons.org/licenses/by-nc/4.0/">CC BY-NC 4.0</a></div></div></section><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{kim2024,
  author = {Kim, Jinhwan},
  title = {Rhub와 {Github} {action를} {활용한} {OS별} {R} {패키지}
    {검증}},
  date = {2024-05-13},
  url = {https://blog.zarathu.com/posts/2024-05-13-rhub},
  langid = {en}
}
</code></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-kim2024" class="csl-entry quarto-appendix-citeas">
Kim, Jinhwan. 2024. <span>“Rhub와 Github Action를 활용한 Os별 R 패키지
검증.”</span> May 13, 2024. <a href="https://blog.zarathu.com/posts/2024-05-13-rhub">https://blog.zarathu.com/posts/2024-05-13-rhub</a>.
</div></div></section></div> ]]></description>
  <category>R</category>
  <category>rpackage</category>
  <category>github</category>
  <category>github action</category>
  <category>rhub</category>
  <category>rcmdcheck</category>
  <guid>https://blog.zarathu.com/posts/2024-05-13-rhub/</guid>
  <pubDate>Sun, 12 May 2024 15:00:00 GMT</pubDate>
  <media:content url="https://blog.zarathu.com/posts/2024-05-13-rhub/img/logo.png" medium="image" type="image/png" height="63" width="144"/>
</item>
<item>
  <title>bslib: input_task_button 소개</title>
  <dc:creator>Jinhwan Kim</dc:creator>
  <link>https://blog.zarathu.com/posts/2024-03-30-input-task-button/</link>
  <description><![CDATA[ <!-- Google tag (gtag.js) --><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-L0DYYSH9KM"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-L0DYYSH9KM');
</script><section id="bslib" class="level2"><h2 class="anchored" data-anchor-id="bslib">bslib</h2>
<p>bslib이란 bootstrap의 css를 R에서 사용할 수 있도록 만든 패키지입니다. 정확한 원문 설명은 <strong>Tools for theming Shiny and R Markdown via Bootstrap 3, 4, or 5.</strong> 으로, Shiny와 Rmarkdown (당연히 Quarto를 포함)에서 여러 테마를 활용할 수 있게 합니다.</p>
<p><img src="https://blog.zarathu.com/posts/2024-03-30-input-task-button/img/themer.gif" width="100%"></p>
<p>이 글에서는 bslib의 활용 방법들중 Shiny에 집중하여 설명합니다.</p>
<p>사실 Shiny는 기본적으로 디자인을 위해 bootstrap을 사용합니다. 그런데 Shiny는 패키지를 이루고 있는 구성 요소들과, 관계가 너무 복잡하게 얽혀 있는 상당히 <strong>무거운</strong> 패키지가 되어버렸고 이로 인해 업데이트에 영향을 받는 부분이 많아, 기능 위주의 업데이트를 하는 것으로 알려져 있습니다.</p>
<p>즉, UI를 주로 다루는 bootstrap 부분은 5년 전의 버전인 3.4.1 버전을 사용하고 있고, 별도의 테마 설정을 하지 않는다면 특유의 파랑 / 회색 테마를 기본적으로 사용하게 됩니다.(최근 버전은 5.3.3)</p>
<p><img src="https://blog.zarathu.com/posts/2024-03-30-input-task-button/img/shiny-bootstrap.png" width="100%"></p>
<p>그래서 shiny에서는 정체된 UI를 업데이트 하기 위해 UI를 다루는 별도의 R 패키지를 만들어 덮어 씌우듯 최근 bootstrap의 기능들을 제공하게 됩니다.</p>
<div class="callout callout-style-simple callout-warning">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-body-container">
<p>이 글에서는 bslib의 주요 사용법은 다루지 않습니다.</p>
</div>
</div>
</div>
</section><section id="actionbutton" class="level2"><h2 class="anchored" data-anchor-id="actionbutton">actionButton</h2>
<p>Shiny에서 제공하는 기능들은 정말 다양하지만, 핵심 기능을 꼽으라면 <code>actionButton</code>을 꼽을 수 있습니다.</p>
<p><code>actionButton</code>이란 사용자가 버튼을 누르면 server에서 미리 선언한 특정 동작을 수행하도록 하는 기능으로 보통은 사용자가 데이터를 업로드 하고 나면, 이 데이터를 활용해 계산 결과를 만들어내게 하는 것에 쓰입니다.</p>
<p>actionButton의 사용 예시로는 아래의 코드와 같이 (<code><a href="https://rdrr.io/pkg/shiny/man/actionButton.html">?shiny::actionButton</a></code>으로 확인할 수 있습니다) 사용자의 선택한 관측수에 맞는 히스토그램을 그릴 수 있게 합니다.</p>
<div class="cell">
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;"><a href="https://shiny.posit.co/">shiny</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">ui</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/pkg/shiny/man/fluidPage.html">fluidPage</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span></span>
<span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/pkg/shiny/man/sliderInput.html">sliderInput</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"obs"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Number of observations"</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">500</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span>,</span>
<span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/pkg/shiny/man/actionButton.html">actionButton</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"goButton"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Go!"</span>, class <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"btn-success"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span>,</span>
<span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/pkg/shiny/man/plotOutput.html">plotOutput</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"distPlot"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">server</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">input</span>, <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">output</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span>  <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">output</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">distPlot</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/pkg/shiny/man/renderPlot.html">renderPlot</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span>    <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">input</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">goButton</span></span>
<span>    <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">dist</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/pkg/shiny/man/isolate.html">isolate</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">input</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">obs</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span>    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/graphics/hist.html">hist</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">dist</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span>  <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span></span>
<span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/pkg/shiny/man/shinyApp.html">shinyApp</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">ui</span>, <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">server</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span></code></pre></div>
</div>
<p><img src="https://blog.zarathu.com/posts/2024-03-30-input-task-button/img/action.png" width="100%"></p>
</section><section id="long-actionbutton" class="level2"><h2 class="anchored" data-anchor-id="long-actionbutton">long actionButton</h2>
<p>그런데 이 <code>actionButton</code>의 문제점 중 하나는 만약 연산에 시간이 오래걸린다면 사용자는 버튼을 누르고 결과를 기다리는 동안 아무것도 할 수 없다는 것입니다.</p>
<p>심지어 단순히 아무것도 할 수 없는 것을 넘어, 버튼이 클릭되지 않은 것으로 오해하고 버튼을 여러번 클릭하기도 합니다.</p>
<p>만약 대용량 유전체 데이터를 활용한 계산을 위한 Shiny라면 연산 한번에 분 단위 시간이 필요할 수도 있는데 이는 여러가지 문제점을 초래할 수 있습니다.</p>
<p>특히 여러번 클릭을 했다면 오랜 시간을 거쳐 연산을 마친 직후 다시 동일한 연산을 또 하고, 또 기다리고, … 의 악순환에 빠지기도 합니다.</p>
<p><img src="https://blog.zarathu.com/posts/2024-03-30-input-task-button/img/waiting.jpg" width="100%"></p>
</section><section id="shiny-with-loading" class="level2"><h2 class="anchored" data-anchor-id="shiny-with-loading">shiny with loading</h2>
<p><code>actionButton</code>의 이 문제를 해결하기 위해 여러 방법들이 존재했습니다.</p>
<ol type="1">
<li>
<a href="https://shiny.posit.co/r/articles/build/progress/"><strong>progress indicator</strong></a>를 사용</li>
</ol>
<p>이 방법은 shiny에서 기본적으로 제공하는 Progress Indicator UI를 활용하는 방법으로 연산의 과정 / 단계가 진행됨에 따라 진행 정도를 사용자에게 보여줄 수 있습니다.</p>
<div class="cell">
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">server</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">input</span>, <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">output</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span>  <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">output</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">plot</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/pkg/shiny/man/renderPlot.html">renderPlot</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span>    <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">input</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">goPlot</span> </span>
<span></span>
<span>    <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">dat</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>x <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/numeric.html">numeric</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span>, y <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/numeric.html">numeric</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span></span>
<span>    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/pkg/shiny/man/withProgress.html">withProgress</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>message <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Making plot'</span>, value <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span>      <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">n</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span></span>
<span></span>
<span>      <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">i</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">n</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span>        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">dat</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">dat</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>x <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span>, y <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span>        <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/pkg/shiny/man/withProgress.html">incProgress</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">n</span>, detail <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Doing part"</span>, <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">i</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span>        <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/Sys.sleep.html">Sys.sleep</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span>      <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span>    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span></span>
<span>    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">dat</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">x</span>, <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">dat</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">y</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span>  <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">ui</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/pkg/shiny/man/shinyUI.html">shinyUI</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/pkg/shiny/man/bootstrapPage.html">basicPage</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span></span>
<span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/pkg/shiny/man/plotOutput.html">plotOutput</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'plot'</span>, width <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"300px"</span>, height <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"300px"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span>,</span>
<span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/pkg/shiny/man/actionButton.html">actionButton</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'goPlot'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Go plot'</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span></span>
<span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/pkg/shiny/man/shinyApp.html">shinyApp</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>ui <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">ui</span>, server <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">server</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span></code></pre></div>
</div>
<p><img src="https://blog.zarathu.com/posts/2024-03-30-input-task-button/img/progress.png" width="100%"></p>
<p>그러나 이는 <code>withProgress</code>, <code>incProgress</code> 또는 <code>Progress</code>등의 함수와 오브젝트를 시간이 오래걸리는 연산에 <strong>추가로 코드를 작성해야한다</strong>는 단점이 있습니다.</p>
<ol start="2" type="1">
<li>별도의 R 패키지 사용</li>
</ol>
<p>R의 생태계에는 해결하려는 여러 문제가 있고, 그 문제마다의 R 패키지가 있다고 생각해도 과언이 아닌데요. actionButton과 연산 결과 사이의 긴 공백을 UI에 표기하기 위한 기능 또한 마찬가지입니다.</p>
<p>이전의 progress indicator와 유사하게 <strong>추가 코드를 작성하여 해결해야하며</strong> 조금 더 디자인이나 세부 설정을 할 수 있는 커스텀 기능이 있다고 생각하면 좋습니다.</p>
<p>아래는 몇가지 예시 패키지와 사례입니다 (알파벳순).</p>
<ul>
<li><a href="https://github.com/dreamRs/shinybusy/">shinybusy</a></li>
</ul>
<p><img src="https://blog.zarathu.com/posts/2024-03-30-input-task-button/img/shinybusy.gif" width="100%"></p>
<ul>
<li><a href="https://github.com/daattali/shinycssloaders">shinycssloaders</a></li>
</ul>
<p><img src="https://blog.zarathu.com/posts/2024-03-30-input-task-button/img/shinycssloaders.gif" width="100%"></p>
<ul>
<li><a href="https://github.com/emitanaka/shinycustomloader">shinycustomloader</a></li>
</ul>
<p><img src="https://blog.zarathu.com/posts/2024-03-30-input-task-button/img/shinycustomloader.gif" width="100%"></p>
<ul>
<li><a href="https://github.com/JohnCoene/waiter/">waiter</a></li>
</ul>
<p><img src="https://blog.zarathu.com/posts/2024-03-30-input-task-button/img/waiter-basic.gif" width="100%"></p>
</section><section id="input_task_button" class="level2"><h2 class="anchored" data-anchor-id="input_task_button">input_task_button</h2>
<p><code>input_task_button</code>은 위의 방법들과는 다르게 <code>actionButton</code>을 확장한 기능으로, <code>actionButton</code>을 누르면 연산이 진행중임을 알리며 버튼이 비활성화 되며, 연산이 끝나면 다시 버튼이 활성화되는 기능을 제공합니다.</p>
<p>무엇보다도 가장 큰 차이점은 <code>actionButton</code>을 대체할 수 있기에 추가 코드를 사용할 필요가 없다는 것입니다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(shiny)</span>
<span id="cb3-2"></span>
<span id="cb3-3">ui <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">fluidPage</span>(</span>
<span id="cb3-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sliderInput</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"obs"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Number of observations"</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">500</span>),</span>
<span id="cb3-5">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># actionButton("goButton", "Go!", class = "btn-success"),</span></span>
<span id="cb3-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">input_task_button</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"goButton"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Go!"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"success"</span>),</span>
<span id="cb3-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plotOutput</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"distPlot"</span>)</span>
<span id="cb3-8">)</span>
<span id="cb3-9"></span>
<span id="cb3-10">server <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(input, output) {</span>
<span id="cb3-11">  output<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>distPlot <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">renderPlot</span>({</span>
<span id="cb3-12">    input<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>goButton</span>
<span id="cb3-13">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">Sys.sleep</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>)</span>
<span id="cb3-14">    dist <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">isolate</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(input<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>obs))</span>
<span id="cb3-15">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">hist</span>(dist)</span>
<span id="cb3-16">  })</span>
<span id="cb3-17">}</span>
<span id="cb3-18"></span>
<span id="cb3-19"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">shinyApp</span>(ui, server)</span></code></pre></div>
</div>
<p><img src="https://blog.zarathu.com/posts/2024-03-30-input-task-button/img/input_task_button.gif" width="100%"></p>
<p><code>input_task_button</code>의 사용을 위해 5번째 줄의 <code>actionButton</code>을 6번째 줄의 <code>input_task_button</code>으로 대체하였고, 추가로 의도적으로 오래 걸리는 연산을 만들기 위해 13번째 줄의 <code><a href="https://rdrr.io/r/base/Sys.sleep.html">Sys.sleep()</a></code> 코드를 활용하여 5초를 지연시켰습니다. input_task_button 사용 방법은 다음과 같습니다.</p>
<div class="callout callout-style-simple callout-note">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-body-container">
<p><code>input_task_button</code>은 <code>actionButton</code>을 무리없이 대체할 수 있지만 약간의 parameter 수정이 필요합니다.</p>
</div>
</div>
</div>
<table class="caption-top table">
<thead><tr class="header">
<th style="text-align: center;">actionButton</th>
<th style="text-align: center;">input_task_button</th>
<th style="text-align: center;">역할</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">inputId</td>
<td style="text-align: center;">id</td>
<td style="text-align: center;">버튼 id</td>
</tr>
<tr class="even">
<td style="text-align: center;">label</td>
<td style="text-align: center;">label</td>
<td style="text-align: center;">버튼 라벨</td>
</tr>
<tr class="odd">
<td style="text-align: center;">icon</td>
<td style="text-align: center;">icon</td>
<td style="text-align: center;">버튼 아이콘</td>
</tr>
<tr class="even">
<td style="text-align: center;"></td>
<td style="text-align: center;">label_busy</td>
<td style="text-align: center;">버튼 비활성화시 라벨</td>
</tr>
<tr class="odd">
<td style="text-align: center;"></td>
<td style="text-align: center;">icon_busy</td>
<td style="text-align: center;">버튼 비활성화시 아이콘</td>
</tr>
<tr class="even">
<td style="text-align: center;">class</td>
<td style="text-align: center;">type</td>
<td style="text-align: center;">버튼 테마 / 색상</td>
</tr>
</tbody>
</table>
<ul>
<li><a href="https://github.com/rstudio/bslib/releases/tag/v0.7.0">릴리스 노트 원본</a></li>
<li><a href="https://rstudio.github.io/bslib/reference/input_task_button.html">input_task_button 매뉴얼</a></li>
</ul></section><section id="정리" class="level2"><h2 class="anchored" data-anchor-id="정리">정리</h2>
<p>이번 글에서는 bslib의 최신 기능인 input_task_button과 간단한 사용 사례를 소개했습니다.</p>
<p>이는 잠재적으로 사용자 경험을 향상시키는 기능이며, 기존의 shiny에서는 추가 코드를 작성해야하는 번거로움을 해결해주는 기능이라고 생각합니다.</p>
<p>특히 다른 웹 어플리케이션과 다르게 Shiny에서는 대용량 데이터 연산으로 인해 시간이 오래 걸리는 경우가 많지만, 상대적으로 빈약한 UI/UX를 가지고 있어 기존의 <code>actionButton</code>을 <code>input_task_button</code>으로 대체할 경우 이를 보완하는데 큰 도움이 될 것입니다.</p>
<p>이번 글이 도움이 되었길 바라며, 다음 글에서 또 만나요!</p>


</section><div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-reuse"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div class="quarto-appendix-contents"><div><a rel="license" href="https://creativecommons.org/licenses/by-nc/4.0/">CC BY-NC 4.0</a></div></div></section><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{kim2024,
  author = {Kim, Jinhwan},
  title = {Bslib: Input\_task\_button {소개}},
  date = {2024-03-30},
  url = {https://blog.zarathu.com/posts/2024-03-30-input-task-button},
  langid = {en}
}
</code></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-kim2024" class="csl-entry quarto-appendix-citeas">
Kim, Jinhwan. 2024. <span>“Bslib: Input_task_button 소개.”</span> March
30, 2024. <a href="https://blog.zarathu.com/posts/2024-03-30-input-task-button">https://blog.zarathu.com/posts/2024-03-30-input-task-button</a>.
</div></div></section></div> ]]></description>
  <category>R</category>
  <category>shiny</category>
  <category>bslib</category>
  <category>ux</category>
  <guid>https://blog.zarathu.com/posts/2024-03-30-input-task-button/</guid>
  <pubDate>Fri, 29 Mar 2024 15:00:00 GMT</pubDate>
  <media:content url="https://blog.zarathu.com/posts/2024-03-30-input-task-button/img/logo.png" medium="image" type="image/png" height="62" width="144"/>
</item>
<item>
  <title>Process macro 소개</title>
  <dc:creator>Heeseok Choi</dc:creator>
  <link>https://blog.zarathu.com/posts/2024-03-14-process-macro/</link>
  <description><![CDATA[ <!-- Google tag (gtag.js) --><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-L0DYYSH9KM"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-L0DYYSH9KM');
</script><section id="개요" class="level1"><h1>개요</h1>
<p>Process macro에 대해 알아보고 R에서 사용가능한 패키지를 소개합니다.</p>
</section><section id="process-macro" class="level1"><h1>Process macro</h1>
<p>Process macro는 회귀분석을 바탕으로 하는 매개효과, 조절효과 분석을 위한 도구입니다.</p>
<p>사회과학, 경영학, 보건학 등에서 광범위하게 직접효과, 간접효과, 상호작용 등을 확인하기 위해 쓰입니다.</p>
<section id="매개효과" class="level2"><h2 class="anchored" data-anchor-id="매개효과">매개효과</h2>
<p>매개효과 분석은 설명변수가 반응변수에 영향을 미치는 경로, 매커니즘을 확인하기 위한 분석방법입니다. 단순매개모형(4번 모델)은 다음과 같은 다이아그램으로 표현할 수 있습니다.</p>
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="https://blog.zarathu.com/posts/2024-03-14-process-macro/index_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption>Figure.1</figcaption></figure>
</div>
</div>
</div>
<p>먼저 R에서 process macro를 사용하려면 패키지를 설치하거나 파일을 다운받아야 합니다. 패키지로는 가톨릭대학교 문건웅 교수님이 만든 <a href="https://github.com/cardiomoon/processR">processR</a>이라는 패키지를 다음과 같이 다운로드하고 불러올 수 있습니다.</p>
<div class="cell">
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">devtools</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://remotes.r-lib.org/reference/install_github.html">install_github</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"cardiomoon/processR"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">processR</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span></code></pre></div>
</div>
<p><code>processR</code> 패키지를 사용하려면 <code>lavaan</code> 패키지가 필요합니다. 아래 코드로 다운로드하고 불러올 수 있습니다.</p>
<div class="cell">
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lavaan"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;"><a href="https://lavaan.ugent.be">lavaan</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span></code></pre></div>
</div>
<p>아래 코드로 <code>processR</code> 패키지에서 지원하는 모델의 번호를 확인할 수 있습니다.</p>
<div class="cell">
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">pmacro</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">no</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1]  0.0  1.0  2.0  3.0  4.0  4.2  5.0  6.0  6.3  6.4  7.0  8.0  9.0 10.0 11.0
[16] 12.0 13.0 14.0 15.0 16.0 17.0 18.0 19.0 20.0 21.0 22.0 23.0 24.0 28.0 29.0
[31] 30.0 31.0 35.0 36.0 40.0 41.0 45.0 49.0 50.0 58.0 59.0 60.0 61.0 62.0 63.0
[46] 64.0 65.0 66.0 67.0 74.0 75.0 76.0 25.0 26.0 27.0 58.2  4.3</code></pre>
</div>
</div>
<p>직접 다운받아 사용하시려면 process macro를 개발한 Andrew F. Hayes가 제공하는 파일을 <a href="https://haskayne.ucalgary.ca/CCRAM/resource-hub">여기</a>서 내려받을 수 있습니다. <code>process.R</code>파일을 실행시키거나 분석을 진행할 R파일 상단에 <code>source("process.R")</code>코드를 실행하면 함수를 사용할 수 있습니다. <code>processR</code>패키지와 <code>process.R</code>파일은 서로 다른 도구이니 혼동하지 않도록 주의해야 합니다. 이 포스트에서 <code>processR</code> 패키지에서 제공하는 함수는 코드 상단에 <code># processR</code>로, <code>process.R</code>에서 제공하는 함수는 <code># process.R</code>로 주석을 달아놓겠습니다.</p>
<p>예시 데이터로 단순매개효과를 설명해보겠습니다.</p>
<p>미국의 1,338명의 의료비용에 대한 데이터입니다.</p>
<div class="cell">
<div class="sourceCode" id="cb5" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">cost</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Medical_Cost.csv"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span></code></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead><tr class="header">
<th style="text-align: right;">age</th>
<th style="text-align: left;">sex</th>
<th style="text-align: right;">bmi</th>
<th style="text-align: right;">children</th>
<th style="text-align: left;">smoker</th>
<th style="text-align: left;">region</th>
<th style="text-align: right;">charges</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">19</td>
<td style="text-align: left;">female</td>
<td style="text-align: right;">27.900</td>
<td style="text-align: right;">0</td>
<td style="text-align: left;">yes</td>
<td style="text-align: left;">southwest</td>
<td style="text-align: right;">16884.924</td>
</tr>
<tr class="even">
<td style="text-align: right;">18</td>
<td style="text-align: left;">male</td>
<td style="text-align: right;">33.770</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">no</td>
<td style="text-align: left;">southeast</td>
<td style="text-align: right;">1725.552</td>
</tr>
<tr class="odd">
<td style="text-align: right;">28</td>
<td style="text-align: left;">male</td>
<td style="text-align: right;">33.000</td>
<td style="text-align: right;">3</td>
<td style="text-align: left;">no</td>
<td style="text-align: left;">southeast</td>
<td style="text-align: right;">4449.462</td>
</tr>
<tr class="even">
<td style="text-align: right;">33</td>
<td style="text-align: left;">male</td>
<td style="text-align: right;">22.705</td>
<td style="text-align: right;">0</td>
<td style="text-align: left;">no</td>
<td style="text-align: left;">northwest</td>
<td style="text-align: right;">21984.471</td>
</tr>
<tr class="odd">
<td style="text-align: right;">32</td>
<td style="text-align: left;">male</td>
<td style="text-align: right;">28.880</td>
<td style="text-align: right;">0</td>
<td style="text-align: left;">no</td>
<td style="text-align: left;">northwest</td>
<td style="text-align: right;">3866.855</td>
</tr>
</tbody>
</table>
</div>
</div>
<p><code>process.R</code>의 <code>process()</code>함수를 실행해보겠습니다. 인자는 다음과 같습니다.</p>
<ul>
<li><p>data = 데이터셋</p></li>
<li><p>x = 설명변수</p></li>
<li><p>y = 반응변수</p></li>
<li><p>m = 매개변수</p></li>
<li><p>model = 모델번호</p></li>
<li><p>boot = 부트스트래핑 횟수</p></li>
<li><p>total = 총효과 출력(0이면 출력하지 않음)</p></li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb6" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">cost</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">sex</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">cost</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">sex</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"male"</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">cost</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">smoker</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">cost</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">smoker</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"yes"</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># process.R</span></span>
<span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">process</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>data <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">cost</span>, x <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"smoker"</span>, y <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"charges"</span>, m <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bmi"</span>, model <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>, boot <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, total <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
********************* PROCESS for R Version 4.3.1 ********************* 
 
           Written by Andrew F. Hayes, Ph.D.  www.afhayes.com              
   Documentation available in Hayes (2022). www.guilford.com/p/hayes3   
 
*********************************************************************** 
               
Model : 4      
    Y : charges
    X : smoker 
    M : bmi    

Sample size: 1338


*********************************************************************** 
Outcome Variable: bmi

Model Summary: 
          R      R-sq       MSE         F       df1       df2         p
     0.0038    0.0000   37.2152    0.0188    1.0000 1336.0000    0.8910

Model: 
             coeff        se         t         p      LLCI      ULCI
constant   30.6518    0.1870  163.8953    0.0000   30.2849   31.0187
smoker      0.0567    0.4133    0.1371    0.8910   -0.7541    0.8674

*********************************************************************** 
Outcome Variable: charges

Model Summary: 
          R      R-sq           MSE         F       df1       df2         p
     0.8111    0.6579 50238769.3992 1283.9234    2.0000 1335.0000    0.0000

Model: 
              coeff        se         t         p       LLCI       ULCI
constant -3459.0955  998.2795   -3.4651    0.0005 -5417.4628 -1500.7282
smoker   23593.9810  480.1805   49.1357    0.0000 22651.9905 24535.9715
bmi        388.0152   31.7875   12.2065    0.0000   325.6564   450.3741

************************ TOTAL EFFECT MODEL *************************** 
Outcome Variable: charges

Model Summary: 
          R      R-sq           MSE         F       df1       df2         p
     0.7873    0.6198 55804130.1996 2177.6149    1.0000 1336.0000    0.0000

Model: 
              coeff        se         t         p       LLCI       ULCI
constant  8434.2683  229.0142   36.8286    0.0000  7985.0017  8883.5348
smoker   23615.9635  506.0753   46.6649    0.0000 22623.1748 24608.7523

************ TOTAL, DIRECT, AND INDIRECT EFFECTS OF X ON Y ************

Total effect of X on Y:
      effect        se         t         p       LLCI       ULCI
  23615.9635  506.0753   46.6649    0.0000 22623.1748 24608.7523

Direct effect of X on Y:
      effect        se         t         p       LLCI       ULCI
  23593.9810  480.1805   49.1357    0.0000 22651.9905 24535.9715

Indirect effect(s) of X on Y:
       Effect
bmi   21.9825

******************** ANALYSIS NOTES AND ERRORS ************************ 

Level of confidence for all confidence intervals in output: 95</code></pre>
</div>
</div>
<p>우선 Figure.1에서 보았던 경로의 이름을 정하겠습니다.<br><img src="https://latex.codecogs.com/png.latex?X%20%E2%86%92%20M%20:%20a"><br><img src="https://latex.codecogs.com/png.latex?M%20%E2%86%92%20Y%20:%20b"><br><img src="https://latex.codecogs.com/png.latex?X%20%E2%86%92%20Y%20:%20c'"><br> 단순매개모형에서 설명변수가 0, 1로 이루어진 변수일때, <img src="https://latex.codecogs.com/png.latex?a%20=%20%5B%5Cbar%7BM%7D%7C(X%20=%201)%5D%20-%20%5B%5Cbar%7BM%7D%7C(X%20=%200)%5D%20=%200.0567">이며 X가 1일때 M의 평균과 X가 0일때 M의 평균의 차이와 같고 <code>lm(bmi ~ smoker, data = cost)</code>의 기울기와 같습니다.<br><img src="https://latex.codecogs.com/png.latex?b%20=%20%5B%5Chat%7BY%7D%7C(M%20=%20m,%20X%20=%20x)%5D%20-%20%5B%5Chat%7BY%7D%7C(M%20=%20m%20-%201,%20X%20=%20x)%5D%20=%20388.0152">이며 이는 <code>lm(charges ~ smoker + bmi, data = cost)</code>에서 bmi의 기울기와 같고 아래처럼 계산할 수도 있습니다.</p>
<div class="cell">
<div class="sourceCode" id="cb8" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">model</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">charges</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">bmi</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">smoker</span>, data <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">cost</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">cost.1</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">cost</span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">cost.1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">bmi</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">cost.1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">bmi</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span></span>
<span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">model</span>, <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">cost</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">]</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">model</span>, <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">cost.1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">]</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       1 
388.0152 </code></pre>
</div>
</div>
<p><img src="https://latex.codecogs.com/png.latex?c'%20=%20%5B%5Chat%7BY%7D%7C(X%20=%20x,%20M%20=%20m)%5D%20-%20%5B%5Chat%7BY%7D%7C(X%20=%20x%20-%201,%20M%20=%20m)%5D%20=%2023593.9810">이며 <code>lm(charges ~ smoker + bmi, data = cost)</code>의 smoker의 기울기와 같고 다음과 같이 계산할 수도 있습니다.</p>
<div class="cell">
<div class="sourceCode" id="cb10" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">model</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">charges</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">bmi</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">smoker</span>, data <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">cost</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">smoke1</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">cost</span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">smoke1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">smoker</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">smoke0</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">cost</span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">smoke0</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">smoker</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span></span>
<span></span>
<span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">model</span>, <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">smoke1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">]</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">model</span>, <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">smoke0</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">]</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       1 
23593.98 </code></pre>
</div>
</div>
<p>단순매개모형에서 <img src="https://latex.codecogs.com/png.latex?ab">를 간접효과, <img src="https://latex.codecogs.com/png.latex?c'">을 직접효과, 이 둘을 더한 값을 <img src="https://latex.codecogs.com/png.latex?c">(총효과)라고 하며 총효과는 <code>lm(charges ~ smoker, data = cost)</code>의 기울기와 같습니다.<br> 간접효과는 매개변수를 통했을 때 흡연자는 비흡연자보다 의료비용이 21.9825만큼 높다는 것을 의미하며, 직접효과는 매개변수가 고정되어있을 때 흡연자는 의료비용이 23593.981만큼 더 높다는 것을 의미합니다.<br> 이제 <code>processR</code> 패키지를 실행해보겠습니다.</p>
<div class="cell">
<div class="sourceCode" id="cb12" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># processR</span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">labels</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>X <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"smoker"</span>, Y <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"charges"</span>, M <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bmi"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">meanSummaryTable</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>labels <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">labels</span>, data <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">cost</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span></code></pre></div>
<div class="cell-output-display">
<div class="tabwid">
<style>.cl-2604d412{}.cl-26015be8{font-family:'Helvetica';font-size:12pt;font-weight:normal;font-style:italic;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-26015bfc{font-family:'Helvetica';font-size:12pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-2602cdde{margin:0;text-align:center;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:2pt;padding-top:2pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-2602cde8{margin:0;text-align:right;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:2pt;padding-top:2pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-2602d82e{width:2.5in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(237, 189, 62, 1.00);border-top: 2pt solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-2602d838{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(237, 189, 62, 1.00);border-top: 2pt solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-2602d839{width:2.5in;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(237, 189, 62, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-2602d83a{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(237, 189, 62, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-2602d842{width:2.5in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-2602d843{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-2602d844{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1pt solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-2602d84c{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 1pt solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-2602d84d{width:2.5in;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-2602d856{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style>
<table data-quarto-disable-processing="true" class="cl-2604d412">
<thead>
<tr style="overflow-wrap:break-word;">
<th class="cl-2602d82e"><p class="cl-2602cdde"><span class="cl-26015be8"></span></p></th>
<th class="cl-2602d838"><p class="cl-2602cdde"><span class="cl-26015be8"> </span></p></th>
<th class="cl-2602d838"><p class="cl-2602cdde"><span class="cl-26015be8">Y</span></p></th>
<th class="cl-2602d838"><p class="cl-2602cdde"><span class="cl-26015be8">M</span></p></th>
<th class="cl-2602d838"><p class="cl-2602cdde"><span class="cl-26015be8">Y</span></p></th>
</tr>
<tr style="overflow-wrap:break-word;">
<th class="cl-2602d839"><p class="cl-2602cdde"><span class="cl-26015be8"></span></p></th>
<th class="cl-2602d83a"><p class="cl-2602cdde"><span class="cl-26015be8"></span></p></th>
<th class="cl-2602d83a"><p class="cl-2602cdde"><span class="cl-26015be8">charges</span></p></th>
<th class="cl-2602d83a"><p class="cl-2602cdde"><span class="cl-26015be8">bmi</span></p></th>
<th class="cl-2602d83a"><p class="cl-2602cdde"><span class="cl-26015be8">adjusted</span></p></th>
</tr>
</thead>
<tbody>
<tr style="overflow-wrap:break-word;">
<td class="cl-2602d842"><p class="cl-2602cde8"><span class="cl-26015bfc">smoker(X) = 0</span></p></td>
<td class="cl-2602d843"><p class="cl-2602cde8"><span class="cl-26015bfc">Mean</span></p></td>
<td class="cl-2602d843"><p class="cl-2602cde8"><span class="cl-26015bfc">8434.268</span></p></td>
<td class="cl-2602d843"><p class="cl-2602cde8"><span class="cl-26015bfc">30.652</span></p></td>
<td class="cl-2602d843"><p class="cl-2602cde8"><span class="cl-26015bfc">8438.77</span></p></td>
</tr>
<tr style="overflow-wrap:break-word;">
<td class="cl-2602d842"><p class="cl-2602cde8"><span class="cl-26015bfc"></span></p></td>
<td class="cl-2602d843"><p class="cl-2602cde8"><span class="cl-26015bfc">SD</span></p></td>
<td class="cl-2602d843"><p class="cl-2602cde8"><span class="cl-26015bfc">5993.782</span></p></td>
<td class="cl-2602d843"><p class="cl-2602cde8"><span class="cl-26015bfc">6.043</span></p></td>
<td class="cl-2602d843"><p class="cl-2602cde8"><span class="cl-26015bfc"></span></p></td>
</tr>
<tr style="overflow-wrap:break-word;">
<td class="cl-2602d842"><p class="cl-2602cde8"><span class="cl-26015bfc">smoker(X) = 1</span></p></td>
<td class="cl-2602d843"><p class="cl-2602cde8"><span class="cl-26015bfc">Mean</span></p></td>
<td class="cl-2602d843"><p class="cl-2602cde8"><span class="cl-26015bfc">32050.232</span></p></td>
<td class="cl-2602d843"><p class="cl-2602cde8"><span class="cl-26015bfc">30.708</span></p></td>
<td class="cl-2602d843"><p class="cl-2602cde8"><span class="cl-26015bfc">32032.751</span></p></td>
</tr>
<tr style="overflow-wrap:break-word;">
<td class="cl-2602d842"><p class="cl-2602cde8"><span class="cl-26015bfc"></span></p></td>
<td class="cl-2602d844"><p class="cl-2602cde8"><span class="cl-26015bfc">SD</span></p></td>
<td class="cl-2602d844"><p class="cl-2602cde8"><span class="cl-26015bfc">11541.547</span></p></td>
<td class="cl-2602d844"><p class="cl-2602cde8"><span class="cl-26015bfc">6.319</span></p></td>
<td class="cl-2602d844"><p class="cl-2602cde8"><span class="cl-26015bfc"></span></p></td>
</tr>
<tr style="overflow-wrap:break-word;">
<td class="cl-2602d842"><p class="cl-2602cde8"><span class="cl-26015bfc"></span></p></td>
<td class="cl-2602d84c"><p class="cl-2602cde8"><span class="cl-26015bfc">Mean</span></p></td>
<td class="cl-2602d84c"><p class="cl-2602cde8"><span class="cl-26015bfc">13270.422</span></p></td>
<td class="cl-2602d84c"><p class="cl-2602cde8"><span class="cl-26015bfc">30.663</span></p></td>
<td class="cl-2602d84c"><p class="cl-2602cde8"><span class="cl-26015bfc"></span></p></td>
</tr>
<tr style="overflow-wrap:break-word;">
<td class="cl-2602d84d"><p class="cl-2602cde8"><span class="cl-26015bfc"></span></p></td>
<td class="cl-2602d856"><p class="cl-2602cde8"><span class="cl-26015bfc">SD</span></p></td>
<td class="cl-2602d856"><p class="cl-2602cde8"><span class="cl-26015bfc">12110.011</span></p></td>
<td class="cl-2602d856"><p class="cl-2602cde8"><span class="cl-26015bfc">6.098</span></p></td>
<td class="cl-2602d856"><p class="cl-2602cde8"><span class="cl-26015bfc"></span></p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Adjusted mean은 <img src="https://latex.codecogs.com/png.latex?adjusted%5C;mean(%5Cbar%7BY%7D%5E*)%20=%20i_%7BY%7D%20+%20b%5Cbar%7BM%7D%20+%20c'X">로 계산할 수 있습니다. 설명변수가 0일때는 <img src="https://latex.codecogs.com/png.latex?%5Cbar%7BY%7D%5E*%20=%20-3459.10%20+%20388.02%20*%2030.6634%20+%2023593.98%20*%200">이고 설명변수가 1일때는 <img src="https://latex.codecogs.com/png.latex?%5Cbar%7BY%7D%5E*%20=%20-3459.10%20+%20388.02%20*%2030.6634%20+%2023593.98%20*%201">로 계산할 수 있습니다. 보정평균은 <img src="https://latex.codecogs.com/png.latex?X">일때 평균적인 <img src="https://latex.codecogs.com/png.latex?M">의 값을 가지는 사람은 보정평균만큼의 <img src="https://latex.codecogs.com/png.latex?Y">를 갖는다는 것을 의미합니다.</p>
<p>아래처럼 각 계수를 깔끔하게 출력하는 함수도 존재합니다.</p>
<div class="cell">
<div class="sourceCode" id="cb13" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># processR</span></span>
<span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">modelsSummaryTable</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>labels <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">labels</span>, data <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">cost</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span></code></pre></div>
<div class="cell-output-display">
<div class="tabwid">
<style>.cl-261ddd86{}.cl-261a676e{font-family:'Helvetica';font-size:12pt;font-weight:bold;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-261a676f{font-family:'Helvetica';font-size:12pt;font-weight:bold;font-style:italic;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-261a6778{font-family:'Helvetica';font-size:12pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-261a6779{font-family:'Helvetica';font-size:12pt;font-weight:normal;font-style:italic;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-261a6782{font-family:'Helvetica';font-size:7.2pt;font-weight:normal;font-style:italic;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;position: relative;top:3.6pt;}.cl-261bb182{margin:0;text-align:center;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-261bb18c{margin:0;text-align:right;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-261bbd94{width:0.3in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 2pt solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-261bbd95{width:1.1in;background-color:transparent;vertical-align: middle;border-bottom: 1pt solid rgba(0, 0, 0, 1.00);border-top: 2pt solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-261bbd9e{width:0.001in;background-color:transparent;vertical-align: middle;border-bottom: 1pt solid rgba(0, 0, 0, 1.00);border-top: 2pt solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-261bbda8{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1pt solid rgba(0, 0, 0, 1.00);border-top: 2pt solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-261bbda9{width:0.3in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(255, 255, 255, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-261bbdb2{width:1.1in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1pt solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-261bbdbc{width:1.1in;background-color:transparent;vertical-align: middle;border-bottom: 1pt solid rgba(0, 0, 0, 1.00);border-top: 1pt solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-261bbdbd{width:0.001in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1pt solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-261bbdc6{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1pt solid rgba(0, 0, 0, 1.00);border-top: 1pt solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-261bbdc7{width:0.001in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(255, 255, 255, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-261bbdd0{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1pt solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-261bbdd1{width:0.3in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-261bbdd2{width:1.1in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-261bbdda{width:1.1in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-261bbddb{width:0.001in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-261bbddc{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-261bbde4{width:0.3in;background-color:transparent;vertical-align: middle;border-bottom: 1pt solid rgba(190, 190, 190, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-261bbde5{width:1.1in;background-color:transparent;vertical-align: middle;border-bottom: 1pt solid rgba(190, 190, 190, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-261bbdee{width:1.1in;background-color:transparent;vertical-align: middle;border-bottom: 1pt solid rgba(190, 190, 190, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-261bbdef{width:0.001in;background-color:transparent;vertical-align: middle;border-bottom: 1pt solid rgba(190, 190, 190, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-261bbdf0{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1pt solid rgba(190, 190, 190, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-261bbdf8{width:0.3in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 1pt solid rgba(190, 190, 190, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-261bbdf9{width:1.1in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 1pt solid rgba(190, 190, 190, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-261bbe02{width:0.001in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 1pt solid rgba(190, 190, 190, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-261bbe03{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 1pt solid rgba(190, 190, 190, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-261bbe04{width:0.001in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-261bbe0c{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-261bbe0d{width:0.3in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-261bbe16{width:1.1in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-261bbe17{width:0.001in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-261bbe18{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style>
<table data-quarto-disable-processing="true" class="cl-261ddd86">
<thead>
<tr style="overflow-wrap:break-word;">
<th class="cl-261bbd94"><p class="cl-261bb182"><span class="cl-261a676e"></span></p></th>
<th colspan="11" class="cl-261bbd95"><p class="cl-261bb182"><span class="cl-261a676e">Consequent</span></p></th>
</tr>
<tr style="overflow-wrap:break-word;">
<th class="cl-261bbda9"><p class="cl-261bb182"><span class="cl-261a676e"></span></p></th>
<th class="cl-261bbdb2"><p class="cl-261bb182"><span class="cl-261a676e"></span></p></th>
<th colspan="4" class="cl-261bbdbc"><p class="cl-261bb182"><span class="cl-261a676e">bmi(M)</span></p></th>
<th class="cl-261bbdbd"><p class="cl-261bb182"><span class="cl-261a676e"></span></p></th>
<th class="cl-261bbdb2"><p class="cl-261bb182"><span class="cl-261a676e"></span></p></th>
<th colspan="4" class="cl-261bbdc6"><p class="cl-261bb182"><span class="cl-261a676e">charges(Y)</span></p></th>
</tr>
<tr style="overflow-wrap:break-word;">
<th class="cl-261bbda9"><p class="cl-261bb182"><span class="cl-261a676e">Antecedent</span></p></th>
<th class="cl-261bbdb2"><p class="cl-261bb182"><span class="cl-261a676e"></span></p></th>
<th class="cl-261bbdb2"><p class="cl-261bb182"><span class="cl-261a676f">Coef</span></p></th>
<th class="cl-261bbdb2"><p class="cl-261bb182"><span class="cl-261a676f">SE</span></p></th>
<th class="cl-261bbdb2"><p class="cl-261bb182"><span class="cl-261a676f">t</span></p></th>
<th class="cl-261bbdb2"><p class="cl-261bb182"><span class="cl-261a676e">p</span></p></th>
<th class="cl-261bbdc7"><p class="cl-261bb182"><span class="cl-261a676e"></span></p></th>
<th class="cl-261bbdb2"><p class="cl-261bb182"><span class="cl-261a676e"></span></p></th>
<th class="cl-261bbdd0"><p class="cl-261bb182"><span class="cl-261a676f">Coef</span></p></th>
<th class="cl-261bbdd0"><p class="cl-261bb182"><span class="cl-261a676f">SE</span></p></th>
<th class="cl-261bbdd0"><p class="cl-261bb182"><span class="cl-261a676f">t</span></p></th>
<th class="cl-261bbdd0"><p class="cl-261bb182"><span class="cl-261a676e">p</span></p></th>
</tr>
</thead>
<tbody>
<tr style="overflow-wrap:break-word;">
<td class="cl-261bbdd1"><p class="cl-261bb182"><span class="cl-261a6778">smoker(X)</span></p></td>
<td class="cl-261bbdd2"><p class="cl-261bb182"><span class="cl-261a6779">a</span><span class="cl-261a6782"></span></p></td>
<td class="cl-261bbdda"><p class="cl-261bb18c"><span class="cl-261a6778">0.057</span></p></td>
<td class="cl-261bbdda"><p class="cl-261bb18c"><span class="cl-261a6778">0.413</span></p></td>
<td class="cl-261bbdda"><p class="cl-261bb18c"><span class="cl-261a6778">0.137</span></p></td>
<td class="cl-261bbdda"><p class="cl-261bb18c"><span class="cl-261a6778">.891</span></p></td>
<td class="cl-261bbddb"><p class="cl-261bb18c"><span class="cl-261a6778"></span></p></td>
<td class="cl-261bbdd2"><p class="cl-261bb182"><span class="cl-261a6779">c'</span><span class="cl-261a6782"></span></p></td>
<td class="cl-261bbddc"><p class="cl-261bb18c"><span class="cl-261a6778">23593.981</span></p></td>
<td class="cl-261bbddc"><p class="cl-261bb18c"><span class="cl-261a6778">480.180</span></p></td>
<td class="cl-261bbddc"><p class="cl-261bb18c"><span class="cl-261a6778">49.136</span></p></td>
<td class="cl-261bbddc"><p class="cl-261bb18c"><span class="cl-261a6778">&lt;.001</span></p></td>
</tr>
<tr style="overflow-wrap:break-word;">
<td class="cl-261bbdd1"><p class="cl-261bb182"><span class="cl-261a6778">bmi(M)</span></p></td>
<td class="cl-261bbdd2"><p class="cl-261bb182"><span class="cl-261a6779"></span><span class="cl-261a6782"></span></p></td>
<td class="cl-261bbdda"><p class="cl-261bb18c"><span class="cl-261a6778"></span></p></td>
<td class="cl-261bbdda"><p class="cl-261bb18c"><span class="cl-261a6778"></span></p></td>
<td class="cl-261bbdda"><p class="cl-261bb18c"><span class="cl-261a6778"></span></p></td>
<td class="cl-261bbdda"><p class="cl-261bb18c"><span class="cl-261a6778"></span></p></td>
<td class="cl-261bbddb"><p class="cl-261bb18c"><span class="cl-261a6778"></span></p></td>
<td class="cl-261bbdd2"><p class="cl-261bb182"><span class="cl-261a6779">b</span><span class="cl-261a6782"></span></p></td>
<td class="cl-261bbddc"><p class="cl-261bb18c"><span class="cl-261a6778">388.015</span></p></td>
<td class="cl-261bbddc"><p class="cl-261bb18c"><span class="cl-261a6778">31.787</span></p></td>
<td class="cl-261bbddc"><p class="cl-261bb18c"><span class="cl-261a6778">12.207</span></p></td>
<td class="cl-261bbddc"><p class="cl-261bb18c"><span class="cl-261a6778">&lt;.001</span></p></td>
</tr>
<tr style="overflow-wrap:break-word;">
<td class="cl-261bbde4"><p class="cl-261bb182"><span class="cl-261a6778">Constant</span></p></td>
<td class="cl-261bbde5"><p class="cl-261bb182"><span class="cl-261a6779">i</span><span class="cl-261a6782">M</span></p></td>
<td class="cl-261bbdee"><p class="cl-261bb18c"><span class="cl-261a6778">30.652</span></p></td>
<td class="cl-261bbdee"><p class="cl-261bb18c"><span class="cl-261a6778">0.187</span></p></td>
<td class="cl-261bbdee"><p class="cl-261bb18c"><span class="cl-261a6778">163.895</span></p></td>
<td class="cl-261bbdee"><p class="cl-261bb18c"><span class="cl-261a6778">&lt;.001</span></p></td>
<td class="cl-261bbdef"><p class="cl-261bb18c"><span class="cl-261a6778"></span></p></td>
<td class="cl-261bbde5"><p class="cl-261bb182"><span class="cl-261a6779">i</span><span class="cl-261a6782">Y</span></p></td>
<td class="cl-261bbdf0"><p class="cl-261bb18c"><span class="cl-261a6778">-3459.096</span></p></td>
<td class="cl-261bbdf0"><p class="cl-261bb18c"><span class="cl-261a6778">998.279</span></p></td>
<td class="cl-261bbdf0"><p class="cl-261bb18c"><span class="cl-261a6778">-3.465</span></p></td>
<td class="cl-261bbdf0"><p class="cl-261bb18c"><span class="cl-261a6778">.001</span></p></td>
</tr>
<tr style="overflow-wrap:break-word;">
<td class="cl-261bbdf8"><p class="cl-261bb182"><span class="cl-261a6778">Observations</span></p></td>
<td class="cl-261bbdf9"><p class="cl-261bb182"><span class="cl-261a6779"></span><span class="cl-261a6782"></span></p></td>
<td colspan="4" class="cl-261bbdf9"><p class="cl-261bb182"><span class="cl-261a6778">1338</span></p></td>
<td class="cl-261bbe02"><p class="cl-261bb182"><span class="cl-261a6778"></span></p></td>
<td class="cl-261bbdf9"><p class="cl-261bb182"><span class="cl-261a6779"></span><span class="cl-261a6782"></span></p></td>
<td colspan="4" class="cl-261bbe03"><p class="cl-261bb182"><span class="cl-261a6778">1338</span></p></td>
</tr>
<tr style="overflow-wrap:break-word;">
<td class="cl-261bbdd1"><p class="cl-261bb182"><span class="cl-261a6778">R2</span></p></td>
<td class="cl-261bbdd2"><p class="cl-261bb182"><span class="cl-261a6779"></span><span class="cl-261a6782"></span></p></td>
<td colspan="4" class="cl-261bbdd2"><p class="cl-261bb182"><span class="cl-261a6778">0.000</span></p></td>
<td class="cl-261bbe04"><p class="cl-261bb182"><span class="cl-261a6778"></span></p></td>
<td class="cl-261bbdd2"><p class="cl-261bb182"><span class="cl-261a6779"></span><span class="cl-261a6782"></span></p></td>
<td colspan="4" class="cl-261bbe0c"><p class="cl-261bb182"><span class="cl-261a6778">0.658</span></p></td>
</tr>
<tr style="overflow-wrap:break-word;">
<td class="cl-261bbdd1"><p class="cl-261bb182"><span class="cl-261a6778">Adjusted R2</span></p></td>
<td class="cl-261bbdd2"><p class="cl-261bb182"><span class="cl-261a6779"></span><span class="cl-261a6782"></span></p></td>
<td colspan="4" class="cl-261bbdd2"><p class="cl-261bb182"><span class="cl-261a6778">-0.001</span></p></td>
<td class="cl-261bbe04"><p class="cl-261bb182"><span class="cl-261a6778"></span></p></td>
<td class="cl-261bbdd2"><p class="cl-261bb182"><span class="cl-261a6779"></span><span class="cl-261a6782"></span></p></td>
<td colspan="4" class="cl-261bbe0c"><p class="cl-261bb182"><span class="cl-261a6778">0.657</span></p></td>
</tr>
<tr style="overflow-wrap:break-word;">
<td class="cl-261bbdd1"><p class="cl-261bb182"><span class="cl-261a6778">Residual SE</span></p></td>
<td class="cl-261bbdd2"><p class="cl-261bb182"><span class="cl-261a6779"></span><span class="cl-261a6782"></span></p></td>
<td colspan="4" class="cl-261bbdd2"><p class="cl-261bb182"><span class="cl-261a6778">6.100 ( df = 1336)</span></p></td>
<td class="cl-261bbe04"><p class="cl-261bb182"><span class="cl-261a6778"></span></p></td>
<td class="cl-261bbdd2"><p class="cl-261bb182"><span class="cl-261a6779"></span><span class="cl-261a6782"></span></p></td>
<td colspan="4" class="cl-261bbe0c"><p class="cl-261bb182"><span class="cl-261a6778">7087.931 ( df = 1335)</span></p></td>
</tr>
<tr style="overflow-wrap:break-word;">
<td class="cl-261bbe0d"><p class="cl-261bb182"><span class="cl-261a6778">F statistic</span></p></td>
<td class="cl-261bbe16"><p class="cl-261bb182"><span class="cl-261a6779"></span><span class="cl-261a6782"></span></p></td>
<td colspan="4" class="cl-261bbe16"><p class="cl-261bb182"><span class="cl-261a6778">F(1,1336) = 0.019, p = .891</span></p></td>
<td class="cl-261bbe17"><p class="cl-261bb182"><span class="cl-261a6778"></span></p></td>
<td class="cl-261bbe16"><p class="cl-261bb182"><span class="cl-261a6779"></span><span class="cl-261a6782"></span></p></td>
<td colspan="4" class="cl-261bbe18"><p class="cl-261bb182"><span class="cl-261a6778">F(2,1335) = 1283.923, p &lt; .001</span></p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>간접효과, 직접효과, 총효과를 다음 함수로 출력할 수 있습니다.</p>
<div class="cell">
<div class="sourceCode" id="cb14" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># processR</span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">model</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tripleEquation</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>labels <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">labels</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">semfit</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sem</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>model <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">model</span>, data <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">cost</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span></span>
<span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">medSummaryTable</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">semfit</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span></code></pre></div>
<div class="cell-output-display">
<div class="tabwid">
<style>.cl-2638bdea{}.cl-263569e2{font-family:'Helvetica';font-size:12pt;font-weight:bold;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-263569f6{font-family:'Helvetica';font-size:12pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-2636a1cc{margin:0;text-align:center;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:2pt;padding-top:2pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-2636a1d6{margin:0;text-align:right;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:2pt;padding-top:2pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-2636a9ec{width:1.351in;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(0, 0, 0, 1.00);border-top: 2pt solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-2636a9f6{width:1.327in;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(0, 0, 0, 1.00);border-top: 2pt solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-2636a9f7{width:1.073in;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(0, 0, 0, 1.00);border-top: 2pt solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-2636a9f8{width:2.203in;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(0, 0, 0, 1.00);border-top: 2pt solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-2636a9f9{width:1.351in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-2636aa00{width:1.327in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-2636aa01{width:1.073in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-2636aa02{width:2.203in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-2636aa0a{width:1.351in;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-2636aa0b{width:1.327in;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-2636aa0c{width:1.073in;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-2636aa14{width:2.203in;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style>
<table data-quarto-disable-processing="true" class="cl-2638bdea">
<thead><tr style="overflow-wrap:break-word;">
<th class="cl-2636a9ec"><p class="cl-2636a1cc"><span class="cl-263569e2">Effect</span></p></th>
<th class="cl-2636a9f6"><p class="cl-2636a1cc"><span class="cl-263569e2">Equation</span></p></th>
<th class="cl-2636a9f7"><p class="cl-2636a1cc"><span class="cl-263569e2">estimate</span></p></th>
<th class="cl-2636a9f8"><p class="cl-2636a1cc"><span class="cl-263569e2">95% CI</span></p></th>
</tr></thead>
<tbody>
<tr style="overflow-wrap:break-word;">
<td class="cl-2636a9f9"><p class="cl-2636a1cc"><span class="cl-263569f6">indirect</span></p></td>
<td class="cl-2636aa00"><p class="cl-2636a1cc"><span class="cl-263569f6">(a)*(b)</span></p></td>
<td class="cl-2636aa01"><p class="cl-2636a1d6"><span class="cl-263569f6">21.983</span></p></td>
<td class="cl-2636aa02"><p class="cl-2636a1cc"><span class="cl-263569f6">(-292.098 to 336.063)</span></p></td>
</tr>
<tr style="overflow-wrap:break-word;">
<td class="cl-2636a9f9"><p class="cl-2636a1cc"><span class="cl-263569f6">direct</span></p></td>
<td class="cl-2636aa00"><p class="cl-2636a1cc"><span class="cl-263569f6">c</span></p></td>
<td class="cl-2636aa01"><p class="cl-2636a1d6"><span class="cl-263569f6">23593.981</span></p></td>
<td class="cl-2636aa02"><p class="cl-2636a1cc"><span class="cl-263569f6">(22653.900 to 24534.062)</span></p></td>
</tr>
<tr style="overflow-wrap:break-word;">
<td class="cl-2636a9f9"><p class="cl-2636a1cc"><span class="cl-263569f6">total</span></p></td>
<td class="cl-2636aa00"><p class="cl-2636a1cc"><span class="cl-263569f6">direct+indirect</span></p></td>
<td class="cl-2636aa01"><p class="cl-2636a1d6"><span class="cl-263569f6">23615.964</span></p></td>
<td class="cl-2636aa02"><p class="cl-2636a1cc"><span class="cl-263569f6">(22624.816 to 24607.111)</span></p></td>
</tr>
<tr style="overflow-wrap:break-word;">
<td class="cl-2636aa0a"><p class="cl-2636a1cc"><span class="cl-263569f6">prop.mediated</span></p></td>
<td class="cl-2636aa0b"><p class="cl-2636a1cc"><span class="cl-263569f6">indirect/total</span></p></td>
<td class="cl-2636aa0c"><p class="cl-2636a1d6"><span class="cl-263569f6">0.001</span></p></td>
<td class="cl-2636aa14"><p class="cl-2636a1cc"><span class="cl-263569f6">(-0.012 to 0.014)</span></p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</section><section id="조절효과" class="level2"><h2 class="anchored" data-anchor-id="조절효과">조절효과</h2>
<p>조절효과는 설명변수가 반응변수에 미치는 영향이 다른 변수에 의해 변화될 때, 이 변화를 조절효과라고 하며, 이러한 영향을 주는 변수를 조절변수라고 합니다.</p>
<p>단순조절효과(1번모델)는 다음의 다이아그램으로 나타낼 수 있습니다.</p>
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="https://blog.zarathu.com/posts/2024-03-14-process-macro/index_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption>Figure.2</figcaption></figure>
</div>
</div>
</div>
<p><code>process()</code>함수로 단순조절효과를 알아보겠습니다. <code>plot</code> 인자는 출력결과 하단에 테이블을 만드어줍니다.</p>
<div class="cell">
<div class="sourceCode" id="cb15" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># process.R</span></span>
<span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">process</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>data <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">cost</span>, x <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"smoker"</span>, y <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"charges"</span>, w <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"age"</span>, model <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, plot <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
********************* PROCESS for R Version 4.3.1 ********************* 
 
           Written by Andrew F. Hayes, Ph.D.  www.afhayes.com              
   Documentation available in Hayes (2022). www.guilford.com/p/hayes3   
 
*********************************************************************** 
               
Model : 1      
    Y : charges
    X : smoker 
    W : age    

Sample size: 1338


*********************************************************************** 
Outcome Variable: charges

Model Summary: 
          R      R-sq           MSE         F       df1       df2         p
     0.8495    0.7217 40903347.7298 1153.1995    3.0000 1334.0000    0.0000

Model: 
              coeff        se         t         p       LLCI       ULCI
constant -2091.4206  582.5654   -3.5900    0.0003 -3234.2647  -948.5764
smoker   22385.5487 1278.7311   17.5061    0.0000 19877.0057 24894.0917
age        267.2489   13.9285   19.1872    0.0000   239.9247   294.5731
Int_1       37.9887   31.0950    1.2217    0.2220   -23.0116    98.9890

Product terms key:
Int_1  :  smoker  x  age      

Test(s) of highest order unconditional interaction(s):
      R2-chng         F       df1       df2         p
X*W    0.0003    1.4925    1.0000 1334.0000    0.2220
----------
Focal predictor: smoker (X)
      Moderator: age (W)

Data for visualizing the conditional effect of the focal predictor:
     smoker       age    charges
     0.0000   22.0000  3788.0555
     1.0000   22.0000 27009.3554
     0.0000   39.0000  8331.2870
     1.0000   39.0000 32198.3946
     0.0000   56.0000 12874.5186
     1.0000   56.0000 37387.4338

******************** ANALYSIS NOTES AND ERRORS ************************ 

Level of confidence for all confidence intervals in output: 95</code></pre>
</div>
</div>
<p>단순조절효과의 계수는 <code>lm(charges ~ smoker + age + smoker * charges, data = cost)</code>의 계수와 동일합니다.</p>
<p><img src="https://latex.codecogs.com/png.latex?%5Chat%7BY%7D%20=%20i_%7BY%7D%20+%20b_%7B1%7DX%20+%20b_%7B2%7DW%20+%20b_%7B3%7DXW">일때, <img src="https://latex.codecogs.com/png.latex?b_%7B1%7D%20=%2023385.55">, <img src="https://latex.codecogs.com/png.latex?b_%7B2%7D%20=%20267.25">, <img src="https://latex.codecogs.com/png.latex?b_%7B3%7D%20=%2037.99">이며 각 계수를 다음과 같은 의미를 가지고 있습니다.</p>
<ul>
<li><p><img src="https://latex.codecogs.com/png.latex?b_%7B1%7D%20=%20W">가 <img src="https://latex.codecogs.com/png.latex?0">일때 <img src="https://latex.codecogs.com/png.latex?X">가 <img src="https://latex.codecogs.com/png.latex?Y">에 미치는 조건부 효과이고 <img src="https://latex.codecogs.com/png.latex?X">가 <img src="https://latex.codecogs.com/png.latex?Y">에 미치는 조건부 효과는 <img src="https://latex.codecogs.com/png.latex?%5Ctheta_%7BX%E2%86%92Y%7D%20=%20b_%7B1%7D%20+%20b_%7B3%7DW">로 계산합니다.</p></li>
<li><p><img src="https://latex.codecogs.com/png.latex?b_%7B2%7D%20=%20X">가 <img src="https://latex.codecogs.com/png.latex?0">일때 <img src="https://latex.codecogs.com/png.latex?W">가 <img src="https://latex.codecogs.com/png.latex?Y">에 미치는 조건부 효과이고 <img src="https://latex.codecogs.com/png.latex?W">가 <img src="https://latex.codecogs.com/png.latex?Y">에 미치는 조건부 효과는 <img src="https://latex.codecogs.com/png.latex?%5Ctheta_%7BW%E2%86%92Y%7D%20=%20b_%7B2%7D%20+%20b_%7B3%7DX">로 계산합니다.</p></li>
<li><p><img src="https://latex.codecogs.com/png.latex?b_%7B3%7D%20=%20W">가 한 단위 바뀔 때, <img src="https://latex.codecogs.com/png.latex?X">의 한 단위 변화가 <img src="https://latex.codecogs.com/png.latex?Y">에 영향을 미치는 정도의 차이입니다.</p></li>
</ul>
<p><code>proceeR</code> 패키지로 확인해보겠습니다.</p>
<div class="cell">
<div class="sourceCode" id="cb17" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">labels</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>X <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"smoker"</span>, Y <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"charges"</span>, W <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"age"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">model</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">charges</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">smoker</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">age</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">smoker</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">age</span>, data <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">cost</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># processR</span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m.summary</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">modelsSummary</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">model</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span>, labels <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">labels</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">modelsSummaryTable</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m.summary</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span></code></pre></div>
<div class="cell-output-display">
<div class="tabwid">
<style>.cl-2679eb9e{}.cl-2676cf4a{font-family:'Helvetica';font-size:12pt;font-weight:bold;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-2676cf5e{font-family:'Helvetica';font-size:12pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-2676cf68{font-family:'Helvetica';font-size:12pt;font-weight:normal;font-style:italic;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-2676cf69{font-family:'Helvetica';font-size:7.2pt;font-weight:normal;font-style:italic;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;position: relative;top:3.6pt;}.cl-26780dec{margin:0;text-align:center;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-26780df6{margin:0;text-align:right;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-26781648{width:0.3in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 2pt solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-26781649{width:1.1in;background-color:transparent;vertical-align: middle;border-bottom: 1pt solid rgba(0, 0, 0, 1.00);border-top: 2pt solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-2678164a{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1pt solid rgba(0, 0, 0, 1.00);border-top: 2pt solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-26781652{width:0.3in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(255, 255, 255, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-26781653{width:1.1in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1pt solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-26781654{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1pt solid rgba(0, 0, 0, 1.00);border-top: 1pt solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-2678165c{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1pt solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-2678165d{width:0.3in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-2678165e{width:1.1in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-26781666{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-26781667{width:0.3in;background-color:transparent;vertical-align: middle;border-bottom: 1pt solid rgba(190, 190, 190, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-26781668{width:1.1in;background-color:transparent;vertical-align: middle;border-bottom: 1pt solid rgba(190, 190, 190, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-26781669{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1pt solid rgba(190, 190, 190, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-26781670{width:0.3in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 1pt solid rgba(190, 190, 190, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-26781671{width:1.1in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 1pt solid rgba(190, 190, 190, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-26781672{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 1pt solid rgba(190, 190, 190, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-26781673{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-2678167a{width:0.3in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-2678167b{width:1.1in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-2678167c{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style>
<table data-quarto-disable-processing="true" class="cl-2679eb9e">
<thead>
<tr style="overflow-wrap:break-word;">
<th class="cl-26781648"><p class="cl-26780dec"><span class="cl-2676cf4a"></span></p></th>
<th colspan="5" class="cl-26781649"><p class="cl-26780dec"><span class="cl-2676cf4a">Consequent</span></p></th>
</tr>
<tr style="overflow-wrap:break-word;">
<th class="cl-26781652"><p class="cl-26780dec"><span class="cl-2676cf4a"></span></p></th>
<th class="cl-26781653"><p class="cl-26780dec"><span class="cl-2676cf4a"></span></p></th>
<th colspan="4" class="cl-26781654"><p class="cl-26780dec"><span class="cl-2676cf4a">charges(Y)</span></p></th>
</tr>
<tr style="overflow-wrap:break-word;">
<th class="cl-26781652"><p class="cl-26780dec"><span class="cl-2676cf4a">Antecedent</span></p></th>
<th class="cl-26781653"><p class="cl-26780dec"><span class="cl-2676cf4a"></span></p></th>
<th class="cl-2678165c"><p class="cl-26780dec"><span class="cl-2676cf4a">Coef</span></p></th>
<th class="cl-2678165c"><p class="cl-26780dec"><span class="cl-2676cf4a">SE</span></p></th>
<th class="cl-2678165c"><p class="cl-26780dec"><span class="cl-2676cf4a">t</span></p></th>
<th class="cl-2678165c"><p class="cl-26780dec"><span class="cl-2676cf4a">p</span></p></th>
</tr>
</thead>
<tbody>
<tr style="overflow-wrap:break-word;">
<td class="cl-2678165d"><p class="cl-26780dec"><span class="cl-2676cf5e">smoker(X)</span></p></td>
<td class="cl-2678165e"><p class="cl-26780dec"><span class="cl-2676cf68">c</span><span class="cl-2676cf69">1</span></p></td>
<td class="cl-26781666"><p class="cl-26780df6"><span class="cl-2676cf5e">22385.549</span></p></td>
<td class="cl-26781666"><p class="cl-26780df6"><span class="cl-2676cf5e">1278.731</span></p></td>
<td class="cl-26781666"><p class="cl-26780df6"><span class="cl-2676cf5e">17.506</span></p></td>
<td class="cl-26781666"><p class="cl-26780df6"><span class="cl-2676cf5e">&lt;.001</span></p></td>
</tr>
<tr style="overflow-wrap:break-word;">
<td class="cl-2678165d"><p class="cl-26780dec"><span class="cl-2676cf5e">age(W)</span></p></td>
<td class="cl-2678165e"><p class="cl-26780dec"><span class="cl-2676cf68">c</span><span class="cl-2676cf69">2</span></p></td>
<td class="cl-26781666"><p class="cl-26780df6"><span class="cl-2676cf5e">267.249</span></p></td>
<td class="cl-26781666"><p class="cl-26780df6"><span class="cl-2676cf5e">13.929</span></p></td>
<td class="cl-26781666"><p class="cl-26780df6"><span class="cl-2676cf5e">19.187</span></p></td>
<td class="cl-26781666"><p class="cl-26780df6"><span class="cl-2676cf5e">&lt;.001</span></p></td>
</tr>
<tr style="overflow-wrap:break-word;">
<td class="cl-2678165d"><p class="cl-26780dec"><span class="cl-2676cf5e">smoker:age(X:W)</span></p></td>
<td class="cl-2678165e"><p class="cl-26780dec"><span class="cl-2676cf68">c</span><span class="cl-2676cf69">3</span></p></td>
<td class="cl-26781666"><p class="cl-26780df6"><span class="cl-2676cf5e">37.989</span></p></td>
<td class="cl-26781666"><p class="cl-26780df6"><span class="cl-2676cf5e">31.095</span></p></td>
<td class="cl-26781666"><p class="cl-26780df6"><span class="cl-2676cf5e">1.222</span></p></td>
<td class="cl-26781666"><p class="cl-26780df6"><span class="cl-2676cf5e">.222</span></p></td>
</tr>
<tr style="overflow-wrap:break-word;">
<td class="cl-26781667"><p class="cl-26780dec"><span class="cl-2676cf5e">Constant</span></p></td>
<td class="cl-26781668"><p class="cl-26780dec"><span class="cl-2676cf68">i</span><span class="cl-2676cf69">Y</span></p></td>
<td class="cl-26781669"><p class="cl-26780df6"><span class="cl-2676cf5e">-2091.421</span></p></td>
<td class="cl-26781669"><p class="cl-26780df6"><span class="cl-2676cf5e">582.565</span></p></td>
<td class="cl-26781669"><p class="cl-26780df6"><span class="cl-2676cf5e">-3.590</span></p></td>
<td class="cl-26781669"><p class="cl-26780df6"><span class="cl-2676cf5e">&lt;.001</span></p></td>
</tr>
<tr style="overflow-wrap:break-word;">
<td class="cl-26781670"><p class="cl-26780dec"><span class="cl-2676cf5e">Observations</span></p></td>
<td class="cl-26781671"><p class="cl-26780dec"><span class="cl-2676cf68"></span><span class="cl-2676cf69"></span></p></td>
<td colspan="4" class="cl-26781672"><p class="cl-26780dec"><span class="cl-2676cf5e">1338</span></p></td>
</tr>
<tr style="overflow-wrap:break-word;">
<td class="cl-2678165d"><p class="cl-26780dec"><span class="cl-2676cf5e">R2</span></p></td>
<td class="cl-2678165e"><p class="cl-26780dec"><span class="cl-2676cf68"></span><span class="cl-2676cf69"></span></p></td>
<td colspan="4" class="cl-26781673"><p class="cl-26780dec"><span class="cl-2676cf5e">0.722</span></p></td>
</tr>
<tr style="overflow-wrap:break-word;">
<td class="cl-2678165d"><p class="cl-26780dec"><span class="cl-2676cf5e">Adjusted R2</span></p></td>
<td class="cl-2678165e"><p class="cl-26780dec"><span class="cl-2676cf68"></span><span class="cl-2676cf69"></span></p></td>
<td colspan="4" class="cl-26781673"><p class="cl-26780dec"><span class="cl-2676cf5e">0.721</span></p></td>
</tr>
<tr style="overflow-wrap:break-word;">
<td class="cl-2678165d"><p class="cl-26780dec"><span class="cl-2676cf5e">Residual SE</span></p></td>
<td class="cl-2678165e"><p class="cl-26780dec"><span class="cl-2676cf68"></span><span class="cl-2676cf69"></span></p></td>
<td colspan="4" class="cl-26781673"><p class="cl-26780dec"><span class="cl-2676cf5e">6395.573 ( df = 1334)</span></p></td>
</tr>
<tr style="overflow-wrap:break-word;">
<td class="cl-2678167a"><p class="cl-26780dec"><span class="cl-2676cf5e">F statistic</span></p></td>
<td class="cl-2678167b"><p class="cl-26780dec"><span class="cl-2676cf68"></span><span class="cl-2676cf69"></span></p></td>
<td colspan="4" class="cl-2678167c"><p class="cl-26780dec"><span class="cl-2676cf5e">F(3,1334) = 1153.199, p &lt; .001</span></p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</section></section><section id="마치며" class="level1"><h1>마치며</h1>
<p>이 포스트에서는 간단한 모델만을 다뤘기 때문에 사용하지 못한 함수나 개념이 많습니다.</p>
<p>추후에 기회가 된다면 포스트를 수정보완하여 좀 더 복잡한 모델을 소개할 수 있기를 바랍니다.</p>
<p>Process macro에 대해 좀 더 알고 싶으신 분들은 문재성 교수님의 <a href="https://github.com/cardiomoon/processRWorkshop">processRWorkshop</a> 또는 Andrew F. Hayes의 “Introduction to Mediation, Moderation, and Conditional Process Analysis”를 참고하시면 도움이 될 수 있습니다.</p>


</section><div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{choi2024,
  author = {Choi, Heeseok},
  title = {Process Macro {소개}},
  date = {2024-03-14},
  url = {https://blog.zarathu.com/posts/2024-03-14-process-macro},
  langid = {en}
}
</code></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-choi2024" class="csl-entry quarto-appendix-citeas">
Choi, Heeseok. 2024. <span>“Process Macro 소개.”</span> March 14, 2024.
<a href="https://blog.zarathu.com/posts/2024-03-14-process-macro">https://blog.zarathu.com/posts/2024-03-14-process-macro</a>.
</div></div></section></div> ]]></description>
  <category>R</category>
  <guid>https://blog.zarathu.com/posts/2024-03-14-process-macro/</guid>
  <pubDate>Wed, 13 Mar 2024 15:00:00 GMT</pubDate>
  <media:content url="https://blog.zarathu.com/posts/2024-03-14-process-macro/img/logo.png" medium="image" type="image/png" height="62" width="144"/>
</item>
<item>
  <title>shinylive 를 활용한 quarto 블로그에 shiny 추가 방법</title>
  <dc:creator>Jinhwan Kim</dc:creator>
  <link>https://blog.zarathu.com/posts/2024-03-04-shinylive/</link>
  <description><![CDATA[ <!-- Google tag (gtag.js) --><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-L0DYYSH9KM"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-L0DYYSH9KM');
</script><section id="review-wasm" class="level2"><h2 class="anchored" data-anchor-id="review-wasm">Review wasm</h2>
<p>이전에 작성한 <a href="https://blog.zarathu.com/posts/2023-09-10-wasm2/" target="_blank">글</a>에서 별도의 서버 없이 작동하는 정적 페이지에서 어떻게 shiny application을 사용할 수 있는 방법을 소개한 적 있다.</p>
<p>이 방법의 핵심은 <strong>wasm</strong>이라는 기술로, 웹 브라우저에서 사용할 수 있게 변환 된 R과 Shiny 관련 라이브러리, 파일들을 불러오고 이를 활용하는 방법이었는데, wasm의 가장 큰 문제는 R 개발자들에게도 환경 설정 자체가 어렵다는 것이었다.</p>
<p>다행히 몇개월 정도의 시간이 지나고 이 환경 설정을 해결해주는 R 패키지가 나왔고, 이를 활용하여 정적 페이지에 shiny application을 추가하는 방법을 소개하고자 한다.</p>
</section><section id="shinylive" class="level2"><h2 class="anchored" data-anchor-id="shinylive">shinylive</h2>
<p>shinylive는 <a href="https://github.com/posit-dev/py-shinylive" target="_blank">python 버전</a>과 <a href="https://github.com/posit-dev/r-shinylive" target="_blank">r 버전</a>이 있으며, 이 글에서는 r 버전을 기준으로 소개한다.</p>
<p>shinylive는 웹 페이지 생성에 필요한 HTML, Javscript, CSS 등의 요소와 shiny 를 사용하기 위한 wasm 관련 파일들을 생성하는 일을 한다.</p>
<p>shinylive로 만든 예시는 <a href="https://shinylive.io/r/examples/" target="_blank">이 링크</a>에서 확인할 수 있다.</p>
<p><img src="https://blog.zarathu.com/posts/2024-03-04-shinylive/img/shinylive.png" width="100%"></p>
<section id="shinylive-설치" class="level3"><h3 class="anchored" data-anchor-id="shinylive-설치">shinylive 설치</h3>
<p>shinylive는 CRAN에 올라가 있기도 하지만 최근 릴리즈 된 버전이 0.1.1인만큼 수시로 업데이트 될 수 있어 github의 최신 버전을 사용하는 것을 권장한다. 추가로 <code>pak</code>는 최근 posit에서 R 패키지를 설치하기 위해 권장하는 R 패키지로, 기존의 <code><a href="https://rdrr.io/r/utils/install.packages.html">install.packages()</a></code>, <code><a href="https://remotes.r-lib.org/reference/install_github.html">remotes::install_github()</a></code> 등의 함수를 대체할 수 있다.</p>
<div class="cell">
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># install.packages("pak")</span></span>
<span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pak</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pak</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"posit-dev/r-shinylive"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span></code></pre></div>
</div>
<div class="callout callout-style-default callout-tip callout-titled" data-appearnce="simple">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Version
</div>
</div>
<div class="callout-body-container callout-body">
<p>통상적으로 1.0 이전의 버전은 아직 개발 중인 버전이라고 생각해도 좋다.</p>
</div>
</div>
</section><section id="shinylive-사용방법" class="level3"><h3 class="anchored" data-anchor-id="shinylive-사용방법">shinylive 사용방법</h3>
<p>shinylive는 기존에 만든 shiny application에 wasm을 추가하는 것으로 생각할 수 있다. 즉, 먼저 shiny application을 만들어야 한다.</p>
<p>예시 실습을 위해 shiny에서 기본으로 제공하는 코드를 사용한다.(이는 Rstudio 콘솔에서 <code>shiny::runExample("01_hello")</code>를 입력해서 확인할 수도 있다.)</p>
<div class="cell">
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;"><a href="https://shiny.posit.co/">shiny</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">ui</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/pkg/shiny/man/fluidPage.html">fluidPage</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span></span>
<span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/pkg/shiny/man/titlePanel.html">titlePanel</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Hello Shiny!"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span>,</span>
<span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/pkg/shiny/man/sidebarLayout.html">sidebarLayout</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span></span>
<span>    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/pkg/shiny/man/sidebarLayout.html">sidebarPanel</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span></span>
<span>      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/pkg/shiny/man/sliderInput.html">sliderInput</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span></span>
<span>        inputId <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bins"</span>,</span>
<span>        label <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Number of bins:"</span>,</span>
<span>        min <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,</span>
<span>        max <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>,</span>
<span>        value <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span></span>
<span>      <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span>    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span>,</span>
<span>    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/pkg/shiny/man/sidebarLayout.html">mainPanel</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span></span>
<span>      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/pkg/shiny/man/plotOutput.html">plotOutput</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>outputId <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"distPlot"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span>    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span>  <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">server</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">input</span>, <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">output</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span>  <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">output</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">distPlot</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/pkg/shiny/man/renderPlot.html">renderPlot</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span>    <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">x</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">faithful</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">waiting</span></span>
<span>    <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">bins</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">x</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">x</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span>, length.out <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">input</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">bins</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span>    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/graphics/hist.html">hist</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">x</span>,</span>
<span>      breaks <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">bins</span>, col <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#75AADB"</span>, border <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"white"</span>,</span>
<span>      xlab <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Waiting time to next eruption (in mins)"</span>,</span>
<span>      main <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Histogram of waiting times"</span></span>
<span>    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span>  <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span></span>
<span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/pkg/shiny/man/shinyApp.html">shinyApp</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>ui <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">ui</span>, server <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">server</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span></code></pre></div>
</div>
<p>이 코드는 아래 그림과 같이 사용자의 입력에 반응하여 갯수만큼 histogram을 만드는 간단한 shiny application을 만들어 낸다.</p>
<p><img src="https://blog.zarathu.com/posts/2024-03-04-shinylive/img/hello.png" width="100%"></p>
<p>이 코드를 shinylive를 사용해 정적인 페이지를 만드는 방법은 2가지가 있는데 하나는 별도의 웹페이지로 만들어내는 것이고, 다른 하나는 이 기술 블로그 같은 quarto 블로그 페이지에 내부 콘텐츠로 심는 것이다.</p>
<p>먼저 별도의 웹페이지를 만드는 방법은 다음과 같다.</p>
</section></section><section id="shinylive-via-web-page" class="level2"><h2 class="anchored" data-anchor-id="shinylive-via-web-page">shinylive via Web page</h2>
<p>별도의 정적 웹페이지에서 shiny를 제공하려면, 이전에 설치했던 shinylive 패키지를 사용하여 app.R을 웹페이지로 변환하는 과정이 필요하다.</p>
<p>내 문서(Documents)의 shinylive라는 폴더를 만들고 이 안에 app.R을 저장했을 때를 기준으로, <code>export</code> 함수의 사용 예시는 다음과 같다.</p>
<div class="cell">
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># library(shinylive)</span></span>
<span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">shinylive</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://posit-dev.github.io/r-shinylive/reference/export.html">export</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'~/Documents/shinylive'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'~/Documents/shinylive_out'</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span></code></pre></div>
</div>
<p>이 코드를 실행하면 shinylive와 동일한 위치, 즉 내 문서(Documents)에 shinylive_out이라는 폴더를 새롭게 만들고 그 안에 shinylive 패키지를 사용해 변환된 wasm 버전의 shiny 코드를 생성한다.</p>
<p>이 shinylive_out 폴더의 내용물을 확인해보면 다음과 같으며 이전 글에서 언급했던 webr, serviceworker 등이 포함되어 있는 것을 확인할 수 있다.</p>
<p><img src="https://blog.zarathu.com/posts/2024-03-04-shinylive/img/out.png" width="100%"></p>
<p>조금 더 구체적으로 <code>export</code> 함수는 현재 R studio를 실행하고 있는 로컬 PC에서 shinylive 패키지의 파일들, 즉 shiny와 관련된 라이브러리 파일들을 out 디렉토리에 추가하는 역할을 한다.</p>
<p><img src="https://blog.zarathu.com/posts/2024-03-04-shinylive/img/console.png" width="100%"></p>
<p>이제 이 폴더의 내용물을 기준으로 github page등을 만들면 shiny 를 제공하는 정적인 웹페이지를 제공할 수 있으며 그 결과는 아래의 명령어를 통해 미리 확인해 볼 수 있다.</p>
<div class="callout callout-style-default callout-tip callout-titled" data-appearnce="simple">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
github page
</div>
</div>
<div class="callout-body-container callout-body">
<p>깃허브 페이지 배포를 위해서는 이전에 작성했던 <a href="https://blog.zarathu.com/posts/2023-03-17-pkgdown/#%EC%9B%B9%EC%82%AC%EC%9D%B4%ED%8A%B8-%EB%B9%8C%EB%93%9C-%EB%B0%B0%ED%8F%AC" target="_blank"> pkgdown의 글 </a>을 참고하길 권장하며, 이를 위해 shinylive_out 대신 docs 폴더로 결과를 내보내길 권장한다.</p>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">httpuv</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/pkg/httpuv/man/runStaticServer.html">runStaticServer</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"~/Documents/shinylive_out"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span></code></pre></div>
</div>
</section><section id="shinylive-in-quarto" class="level2"><h2 class="anchored" data-anchor-id="shinylive-in-quarto">shinylive in Quarto</h2>
<p>quarto 블로그에 shiny application을 추가하기 위해서는 별도의 extension을 사용해야한다. quarto extension은 quarto의 기능을 확장하는 별도의 패키지로, 기본 R에 R 패키지를 사용해 기능을 추가하는 것과 유사하다.</p>
<p>먼저 Rstudio의 터미널에서 다음 코드를 실행하여 quarto extenstion을 추가해야 한다.</p>
<div class="sourceCode" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb5-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">quarto</span> add quarto-ext/shinylive</span></code></pre></div>
<p>quarto 블로그에 shiny 를 심기 위해서 별도의 파일을 만들 필요는 없으며, <code>{shinylive-r}</code>이라는 코드 블록을 사용한다. 추가로 index.qmd의 yaml에 shinylive 를 설정해야만 한다.</p>
<div class="sourceCode" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb6-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filters</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span></span>
<span id="cb6-2"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> shinylive</span></span></code></pre></div>
<p>이후 <code>shinylive-r</code> 블록에 앞서 만든 app.R 의 내용을 작성한다.</p>
<div class="sourceCode" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb7-1"><span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">```{shinylive-r}</span></span>
<span id="cb7-2"><span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#| standalone: true</span></span>
<span id="cb7-3"><span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#| viewerHeight: 800</span></span>
<span id="cb7-4"></span>
<span id="cb7-5"><span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">library(shiny)</span></span>
<span id="cb7-6"></span>
<span id="cb7-7"><span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">ui &lt;- fluidPage(</span></span>
<span id="cb7-8"><span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">  titlePanel("Hello Shiny!"),</span></span>
<span id="cb7-9"><span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">  sidebarLayout(</span></span>
<span id="cb7-10"><span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    sidebarPanel(</span></span>
<span id="cb7-11"><span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">      sliderInput(</span></span>
<span id="cb7-12"><span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        inputId = "bins",</span></span>
<span id="cb7-13"><span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        label = "Number of bins:",</span></span>
<span id="cb7-14"><span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        min = 1,</span></span>
<span id="cb7-15"><span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        max = 50,</span></span>
<span id="cb7-16"><span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        value = 30</span></span>
<span id="cb7-17"><span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">      )</span></span>
<span id="cb7-18"><span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    ),</span></span>
<span id="cb7-19"><span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    mainPanel(</span></span>
<span id="cb7-20"><span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">      plotOutput(outputId = "distPlot")</span></span>
<span id="cb7-21"><span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    )</span></span>
<span id="cb7-22"><span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">  )</span></span>
<span id="cb7-23"><span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span id="cb7-24"></span>
<span id="cb7-25"><span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">server &lt;- function(input, output) {</span></span>
<span id="cb7-26"><span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">  output$distPlot &lt;- renderPlot({</span></span>
<span id="cb7-27"><span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    x &lt;- faithful$waiting</span></span>
<span id="cb7-28"><span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    bins &lt;- seq(min(x), max(x), length.out = input$bins + 1)</span></span>
<span id="cb7-29"><span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    hist(x,</span></span>
<span id="cb7-30"><span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">         breaks = bins, col = "#75AADB", border = "white",</span></span>
<span id="cb7-31"><span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">         xlab = "Waiting time to next eruption (in mins)",</span></span>
<span id="cb7-32"><span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">         main = "Histogram of waiting times"</span></span>
<span id="cb7-33"><span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    )</span></span>
<span id="cb7-34"><span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">  })</span></span>
<span id="cb7-35"><span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb7-36"></span>
<span id="cb7-37"><span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">shinyApp(ui = ui, server = server)</span></span>
<span id="cb7-38"><span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">```</span></span></code></pre></div>
<p>아래는 실제 코드 블록이 어플리케이션으로 실행되는 결과이며 slider를 움직일때 반응하여 histogram을 그리는 것을 확인할 수 있다.</p>
<pre class="shinylive-r" data-engine="r"><code><a href="https://shiny.posit.co/">#| standalone: true
#| viewerHeight: 800

library(shiny)

ui &lt;- fluidPage(
  titlePanel("Hello Shiny!"),
  sidebarLayout(
    sidebarPanel(
      sliderInput(
        inputId = "bins",
        label = "Number of bins:",
        min = 1,
        max = 50,
        value = 30
      )
    ),
    mainPanel(
      plotOutput(outputId = "distPlot")
    )
  )
)

server &lt;- function(input, output) {
  output$distPlot &lt;- renderPlot({
    x &lt;- faithful$waiting
    bins &lt;- seq(min(x), max(x), length.out = input$bins + 1)
    hist(x,
         breaks = bins, col = "#75AADB", border = "white",
         xlab = "Waiting time to next eruption (in mins)",
         main = "Histogram of waiting times"
    )
  })
}

shinyApp(ui = ui, server = server)</a></code></pre>
</section><section id="정리" class="level2"><h2 class="anchored" data-anchor-id="정리">정리</h2>
<p>shinylive는 wasm을 활용해 깃허브 페이지 또는 quarto 블로그 같은 정적 페이지에서 shiny를 실행할 수 있게 하는 기능으로 각각 R 패키지와 quarto extension을 통해 사용할 수 있다.</p>
<p>물론 아직 나온지 1년이 되지 않은 기능인만큼 모든 기능이 제공되는 것은 아니며 정적 페이지를 사용하는 만큼 별도의 shiny server를 활용하는 것에 비하면 단점이 있기도 하다.</p>
<p>그러나 shiny 사용법이나 간단한 통계 분석을 소개하고, 이를 웹사이트에서 별도의 R 설치 없이도 바로 실습할 수 있다는 점에서 많이 사용되고 있으며 앞으로도 더 많은 기능이 추가될 것으로 기대된다.</p>
<p>이 블로그에 사용한 코드는 <a href="https://github.com/zarathucorp/blog/blob/master/posts/2024-03-04-shinylive/index.qmd" target="_blank">링크</a>에서 확인할 수 있다.</p>


</section><div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-reuse"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div class="quarto-appendix-contents"><div><a rel="license" href="https://creativecommons.org/licenses/by-nc/4.0/">CC BY-NC 4.0</a></div></div></section><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{kim2024,
  author = {Kim, Jinhwan},
  title = {Shinylive {를} {활용한} Quarto {블로그에} Shiny {추가}
    {방법}},
  date = {2024-03-05},
  url = {https://blog.zarathu.com/posts/2024-03-04-shinylive},
  langid = {en}
}
</code></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-kim2024" class="csl-entry quarto-appendix-citeas">
Kim, Jinhwan. 2024. <span>“Shinylive 를 활용한 Quarto 블로그에 Shiny
추가 방법.”</span> March 5, 2024. <a href="https://blog.zarathu.com/posts/2024-03-04-shinylive">https://blog.zarathu.com/posts/2024-03-04-shinylive</a>.
</div></div></section></div> ]]></description>
  <category>R</category>
  <category>shiny</category>
  <category>githubpage</category>
  <category>documentation</category>
  <category>website</category>
  <category>quarto</category>
  <guid>https://blog.zarathu.com/posts/2024-03-04-shinylive/</guid>
  <pubDate>Mon, 04 Mar 2024 15:00:00 GMT</pubDate>
  <media:content url="https://blog.zarathu.com/posts/2024-03-04-shinylive/img/logo.png" medium="image" type="image/png" height="66" width="144"/>
</item>
<item>
  <title>R&amp;D 시험인증 후기 및 개발, 행정 관련 느낀 점</title>
  <dc:creator>Changwoo Lim</dc:creator>
  <link>https://blog.zarathu.com/posts/2024-01-23-RND-review/</link>
  <description><![CDATA[ 
<!-- Google tag (gtag.js) -->

<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-L0DYYSH9KM"></script>

<script>

  window.dataLayer = window.dataLayer || [];

  function gtag(){dataLayer.push(arguments);}

  gtag('js', new Date());



  gtag('config', 'G-L0DYYSH9KM');

</script>





<p>공개SW 기반의 클라우드 통계 패키지SW 과제를 수행하면서, 외부 공인 기관에 시험인증을 의뢰해야 했습니다. 이와 관련된 후기, 또 전반적인 과제 관련 정보를 남깁니다. 당사로서는 처음 수행하는 R&amp;D였습니다. 저희 팀원들과 공동연구기관에서 다 같이 열심히 참여하였기에 잘 완수할 수 있었습니다. 그러나 그 과정에서 어쩔 수 없이 겪은 몇가지 어려움이 있었기에 이를 공유합니다.</p>
<section id="개발" class="level3">
<h3 class="anchored" data-anchor-id="개발">개발</h3>
<p>최초에 R&amp;D 연구개발계획서를 작성하면서, 계획서 표지(요약 페이지)와 하단에, 높은 TRL단계를 달성하겠다고 기재하였습니다. 또, 하단에는 외부 기관으로부터 인증을 받겠다고도 기재하였습니다.</p>
<p>이를 인지하지 못하고 있다, 2차년도 10/26에 최초로 위와 같이 기재한 것을 발견하였습니다. 관련하여 주관 기관에, 수행하지 않아도 될지에 대해 문의하였으나 외부 시험이 필요할 것이라는 회신을 받았습니다(사유: 최초 연구개발계획서에 기재되어 있고, TRL이 높은 단계인 점 등 고려)</p>
<p>그 후, 12/18에 현장 테스트가 완료되었으며, 12/27경 최종 보고서 초안를 받았습니다. 시험 준비부터 완료까지 거의 2달이 소요됩니다. 만약 이러한 준비가 되어 있지 않은 경우 마감이 아주 촉박해 제때 마무리 하지 못할 우려가 있습니다. 우리만 준비되면 되는 것이 아니고, 시험인증 업체측 일정도 고려해야 합니다. SW인증업체가 전국에 10개소 정도밖에 되지 않는 것으로 알고 있습니다. SW R&amp;D는 최소 100건은 될 것입니다. 모두가 시험인증을 거치는 것은 아니지만, 미리 준비해야 합니다. 제가 10월 말경 문의하였을때 이미 12월 말까지 일정이 있어 의뢰받지 못한다고 회신한 업체도 2~3개정도 있었습니다.</p>
<p>시험인증은 상당히 시간이 많이 소요되는 작업입니다. 가능하다면 피하는 것이 좋으나, 현재 우리 회사의 기술 수준을 볼 때 대부분 상용화/성숙 단계 R&amp;D일 것이므로 피하기 어려울 것입니다. 미리 준비해야 합니다.</p>
<section id="연구개발계획서-내용을-rd-참가-인원과-잘-공유하고-우리가-해야-할-것을-정리" class="level5">
<h5 class="anchored" data-anchor-id="연구개발계획서-내용을-rd-참가-인원과-잘-공유하고-우리가-해야-할-것을-정리">연구개발계획서 내용을 R&amp;D 참가 인원과 잘 공유하고, 우리가 해야 할 것을 정리</h5>
<p>처음 연구개발계획서를 가장 잘 쓰는 것이 중요하고, 그 R&amp;D 전 기간에 거쳐 참가할 사람과 공유하여 향후 어떠한 검증을 외부 업체에서 받아야 하는지를 사전에 알고 있는 것이 중요합니다. 그렇게 해야만 해당 부분의 유지보수를 조금 더 잘 할 수 있으리라 생각합니다.</p>
<p>현재는 연구개발계획서를 다 같이 보는 것이 아니라, 대표님이 작성하시고 그것을 개개인이 읽어 보는 형태로 진행되고 있습니다. 하지만 앞으로는 <strong>한 자리에 모여 다같이 연구개발계획서를 검토하고, 비현실적인 부분이 있는지, 또는 미리 준비해야 하는 부분이 있는지</strong>를 검토하고 가능하면 쉽게 수행할 수 있도록 향후 우려되는 요소를 미리 제거한 연구개발계획서를 작성하는 것이 중요하겠습니다.</p>
</section>
<section id="rfp에-기반한-목표치를-알맞게-설정" class="level5">
<h5 class="anchored" data-anchor-id="rfp에-기반한-목표치를-알맞게-설정">RFP에 기반한 목표치를 알맞게 설정</h5>
<p>RFP의 ‘국내 기업 최고치’, ‘해외 기업 최고치’를 준용하지 않는 경우(즉, 해당 값을 변경하거나 새로운 기준을 만드는 경우)에는 ’국내 기업 최고치’, ’해외 기업 최고치’가 해당 값인 것도 우리가 입증해야 함에 주의하여야 합니다(간사 문의사항). 다행히도, 이번 과제의 경우 RFP상에서 국내/해외 기업 최고치를 제시하였기에 우리가 입증 할 필요가 없었습니다. 시험인증이 불가하여 외부에 위탁하지는 않았지만, 예를 들어 ’분석 속도’에 정확한 기준을 적지 않은 채, 해외 기업을 100%라고 한 경우 매우 곤란한 경우가 생길 수도 있으리라 생각됩니다. 연구개발계획서를 작성 할 때에는 상대적인 수치가 아닌, <strong>절대치로 기재하는것이 좋겠으며</strong> 달성이 어렵더라도, <strong>입증 자체는 쉽게 할 수 있는 항목을 기재</strong>하는 것이 최종 결과보고서 작성에 유리합니다.</p>
</section>
<section id="다른-업체와의-업무-분담-명확화" class="level5">
<h5 class="anchored" data-anchor-id="다른-업체와의-업무-분담-명확화">다른 업체와의 업무 분담 명확화</h5>
<p>이번 시험인증에서는 다른 공동연구개발기관와 함께 시험인증을 진행했습니다. 그 공동연구개발기관 역시 시험인증에 대한 준비가 되지 않은 상황이었으며, 상대측 실무자 또한 경험이 많이 없어 미숙한 면이 있었다고 보입니다. 마찬가지로 연구개발계획서를 작성 할 때에 언제쯤, 어떻게 시험을 진행할 지, 각자 서류작업(페이퍼워크)의 분담은 어떻게 할 지 등을 미리 검토 할 필요가 있습니다. 그렇지 않으면 서로 소통이 되지 않아 일을 이중으로 하게 됩니다.</p>
<p>이번 시험인증의 경우 다른 공동연구개발기관에 요청한 서류 대부분을 사용하지 못하고 우리 회사측에서 새로 작성하였습니다. 주관기관으로 참여할 경우 대부분의 페이퍼워크를 우리가 부담해야 하니 미리 알고 있을 필요가 있습니다.</p>
</section>
<section id="사전에-검증-가능한-항목인지-공인인증-업체에-미리-확인" class="level5">
<h5 class="anchored" data-anchor-id="사전에-검증-가능한-항목인지-공인인증-업체에-미리-확인">사전에 검증 가능한 항목인지, 공인인증 업체에 미리 확인</h5>
<p>통계분석 시간 단축률 항목의 경우, 다른 상용 프로그램과의 비교가 불가능하다는 시험인증 업체의 회신을 받았습니다, 이는 최종 평가에서 분명히 마이너스 요소가 될 수 있는 사안입니다. 다음 연구개발계획서 작성 시에는, 평가 항목을 사전에 업체와 조율하여 평가가 가능한지를 파악한 후 이를 기재하는것이 바람직하리라 생각됩니다.</p>
</section>
<section id="개발-시-시험항목과-테스트-항목에-맞추어-개발" class="level5">
<h5 class="anchored" data-anchor-id="개발-시-시험항목과-테스트-항목에-맞추어-개발">개발 시 시험항목과 테스트 항목에 맞추어 개발</h5>
<p>기능을 개발 할 때에, 시험항목에 포함되는 개발 항목과, 시험 항목에 포함되지는 않지만 연구개발계획서에는 존재하는 항목이 있습니다. 시험인증을 하지 않아도 되는 항목의 경우 일단 구현만 하면 연구개발계획서를 어기지는 않은 반면, 시험인증을 해야 하는 항목의 경우 여러 번/여러 플랫폼에서 테스트를 할 필요가 있고, 기능 명세도 작성해야 합니다. 또 이러한 항목의 경우 코드에 <strong>주석 작업을 철저히 하여 추후 오류가 발생했을 때 쉽게 수정할 수 있어야</strong> 할 것입니다. 미리미리 해 두지 않으면 추후 유지보수가 굉장히 어려워, 시간이 2~3배 더 소요될 수 있습니다.</p>
</section>
<section id="양식-작성-시-스크린샷은-최대한-자세하게" class="level5">
<h5 class="anchored" data-anchor-id="양식-작성-시-스크린샷은-최대한-자세하게">양식 작성 시 스크린샷은 최대한 자세하게</h5>
<p>이번 시험인증을 진행한 업체를 포함해, 약 4개정도의 업체에서 견적을 받거나, 최소한 문의하여 양식을 작성했습니다. 공통적인(비슷한) 양식이 있는 것을 보니 정형화된 서류가 존재하는 듯 합니다.</p>
<p>이번에 수행한 업체의 경우, 해당 서류를 작성해서 제출했음에도 불구하고, 그 이후에 해당 서류의 내용을 바탕으로 전체적인 테스트를 수행한 후 보내달라고 하였습니다. 최초에 테스트 할 항목을 작성할 때, 미리 테스트를 겸하여 어떻게 작동되는지를 스크린샷으로 촬영 해 두면 간편하게 시험인증을 마무리 할 수 있습니다.</p>
</section>
<section id="테스트-도구의-도입" class="level5">
<h5 class="anchored" data-anchor-id="테스트-도구의-도입">테스트 도구의 도입</h5>
<p>아직 한번도 이런 도구를 사용해보진 못했지만, 이러한 도구의 필요성을 절실히 느꼈습니다. 예를 들어, statgarten의 ML 중 lightGBM 패키지가 업데이트 되어, 특정 버전을 지정하여 설치하도록 한 경우에는 다른 ML에 영향이 없는지 확인이 필요합니다. 어떤 dependency가 업데이트 되었을 때, 테스트 도구가 없다면 매번 모든 항목을 수동으로 테스트 해야 합니다. 이런 번거로움을 막고자 테스트 도구 도입을 검토 할 필요가 있습니다.</p>
</section>
</section>
<section id="행정" class="level3">
<h3 class="anchored" data-anchor-id="행정">행정</h3>
<section id="연구비는-인건비와-연구활동비-위주로-편성" class="level5">
<h5 class="anchored" data-anchor-id="연구비는-인건비와-연구활동비-위주로-편성">연구비는 인건비와 연구활동비 위주로 편성</h5>
<p>연구비로 회사에 필요한 비품을 구매하거나, 용역을 주는 것은 쉽지 않습니다, 이번 IITP에서 회계를 제가 담당할 때는 대부분 인건비와 식비였기에 예산 집행에 큰 어려움은 없었습니다. 하지만 그 후에, NIPA나 창업도약패키지 연구비 집행을 옆에서 지켜 본 결과, 사실상 인건비와 식사 이외에는 사용하지 말라는 의도라고 생각하게 되었습니다. 실물 재료가 필요한 다른 연구와는 달리, 우리는 SW개발업이기에 인건비가 가장 많은 비중을 차지하고, 최대한 인건비를 연구비로 계상하는 것이 중요할 것 같습니다. 만약 다른 항목(예: 장비 구매 등)이 꼭 필요하다면, “협약 초기”에 끝내는 것이 좋겠습니다.</p>
<p>2024년 1월 추가: 2023년 12월 28일부터 회의비 사용이 어려워졌습니다. 대부분 인건비로 처리가 필요합니다.</p>
</section>
<section id="간사와의-연락은-메일로" class="level5">
<h5 class="anchored" data-anchor-id="간사와의-연락은-메일로">간사와의 연락은 메일로</h5>
<p>출장 등으로 전화가 잘 되지 않을 뿐더러, 상대가 전화를 선호하지 않습니다. 한 명의 간사가 10개 이상의 사업을 관리하는 경우도 있기에 메일이 좋습니다. 또 추후 문제가 생겼을 때 우리가 대응하기 굉장히 껄끄러운 상대방입니다. 따라서 가능한 한 기록이 남는 메일로 연락을 주고받는것이 좋겠습니다.</p>
</section>
<section id="협약-변경은-한번에" class="level5">
<h5 class="anchored" data-anchor-id="협약-변경은-한번에">협약 변경은 한번에</h5>
<p>비교적 자유로웠던 IITP과제와는 달리, 현재 수행중인 타 과제는 협약 변경이 매우 번거롭습니다. 그 기관의 특성으로 보이나, 연구 분야를 보았을 때 우리가 추가로 R&amp;D를 수행한다면 그 기관 과제일 확률이 매우 높습니다. 앞에 언급 한 것처럼 최대한 최초 연구개발계획서에 구체적으로, 우리가 유리한 방향으로 작성하는것이 좋습니다.</p>
<p>또 위 기관의 경우 한번 협약 변경에 오랜 시일이 걸립니다. 지난 10월경 협약변경한 건은 약 1개월 걸렸으며, 그 과정에서 반려도 최소 5회 이상 당했습니다. 또, 과제 종료 시기(11월 이후?)가 되면, 원래는 협약변경 가능한 시기임에도 불구하고 협약변경을 잘 해주지 않으려 합니다. 이 점 감안하셔서, 하반기 진입 시 과제 상황을 한 번 체크하시는 것이 좋습니다.</p>
</section>
<section id="전문연구사업자" class="level5">
<h5 class="anchored" data-anchor-id="전문연구사업자">전문연구사업자</h5>
<p>전문연구사업자 자격이 있으므로 기존인력 인건비 계상이 가능합니다. 현재 수행하고 있는 R&amp;D의 주관기관은 거부하였는데 해당 법령 소관기관인 과기부 문의 결과 부처 상관없이 기존인력 인건비 계상이 가능하여야 합니다. 현재는 기존인력인건비 계상이 꼭 필요하지는 않았지만, 앞으로 필요시 과기부 문의 결과를 바탕으로 요청해보아야 할 것 같습니다.</p>
</section>
<section id="slack을-통한-계획서-공유는-지양" class="level5">
<h5 class="anchored" data-anchor-id="slack을-통한-계획서-공유는-지양">Slack을 통한 계획서 공유는 지양</h5>
<p>Slack으로 계획서를 공유하면 간편하지만, 버전 관리 문제가 발생합니다. 같은 파일에 각기 다른 내용이 추가되고, 이들을 합칠 수 없는 문제가 생깁니다. 그리 길지 않은 문서라면 대조하며 확인이 가능하지만, 백 페이지가 넘는 문서들은 그렇게 대조하는 것이 매우 고통스러운 작업일 것입니다. 가급적이면 버전 관리가 가능한 회사 드라이브를 통해 하는 것이 좋습니다.</p>
</section>
<section id="주관기관이-대부분의-일을-합니다" class="level5">
<h5 class="anchored" data-anchor-id="주관기관이-대부분의-일을-합니다">주관기관이 대부분의 일을 합니다</h5>
<p>만약 우리가 주관기관으로 참여하게 되면 대부분의 서류 작업을 우리가 해야 합니다. 각 기관별 예산/성과등은 각 기관에게 요청할 수 있지만, 대부분의 페이퍼워크를 우리가 해야 하므로 미리 준비해야 합니다.</p>
</section>
</section>
<section id="결론-요약" class="level3">
<h3 class="anchored" data-anchor-id="결론-요약">결론 요약</h3>
<ol type="1">
<li>과제 지원/시작 단계에서 다같이 모여 연구개발계획서와 (있는 경우) 과업지시서를 읽고 논의하자</li>
<li>개발 단계부터 체계를 갖추고, 테스트를 잘 수행하자</li>
<li>협약 관련 사항은 여름까지는 완료하고, 인건비 이외 지출항목은 가능하면 연초에 소진하자</li>
</ol>


</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-reuse"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div class="quarto-appendix-contents"><div><a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a></div></div></section><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{lim2024,
  author = {Lim, Changwoo},
  title = {R\&amp;D {시험인증} {후기} {및} {개발,} {행정} {관련} {느낀}
    {점}},
  date = {2024-01-23},
  url = {https://blog.zarathu.com/posts/2024-01-23-RND-review},
  langid = {en}
}
</code></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-lim2024" class="csl-entry quarto-appendix-citeas">
Lim, Changwoo. 2024. <span>“R&amp;D 시험인증 후기 및 개발, 행정 관련
느낀 점.”</span> January 23, 2024. <a href="https://blog.zarathu.com/posts/2024-01-23-RND-review">https://blog.zarathu.com/posts/2024-01-23-RND-review</a>.
</div></div></section></div> ]]></description>
  <category>R&amp;D</category>
  <category>review</category>
  <category>IITP</category>
  <category>시험인증</category>
  <category>행정</category>
  <guid>https://blog.zarathu.com/posts/2024-01-23-RND-review/</guid>
  <pubDate>Mon, 22 Jan 2024 15:00:00 GMT</pubDate>
</item>
<item>
  <title>RStudio Server에 2FA(OTP) 도입하기</title>
  <dc:creator>Changwoo Lim</dc:creator>
  <link>https://blog.zarathu.com/posts/2024-01-05-RStudio-Server-2FA/</link>
  <description><![CDATA[ 
<!-- Google tag (gtag.js) -->

<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-L0DYYSH9KM"></script>

<script>

  window.dataLayer = window.dataLayer || [];

  function gtag(){dataLayer.push(arguments);}

  gtag('js', new Date());



  gtag('config', 'G-L0DYYSH9KM');

</script>





<section id="개요" class="level2">
<h2 class="anchored" data-anchor-id="개요">개요</h2>
<p>OTP는 One Time Password의 약자로, 일회용 비밀번호를 뜻합니다. 고정된 비밀번호와 달리, 필요 할 때마다 발급되어 한 번만 사용할 수 있습니다. 대부분의 경우, 6자리 숫자가 30초마다 갱신되는 형태로, 휴대폰 어플리케이션이나 실물 OTP 생성기 등으로 발급합니다.</p>
<p>차라투에서는 여러 개의 RStudio Server를 구동하고 있습니다. 이 중 인턴십을 위해 사용하는 서버에 시범적으로 도입 해 보고자 하였고, 후기를 남깁니다.</p>
<p>본 게시글은 <a href="https://www.r-bloggers.com/2023/05/using-otp-one-time-passwords-in-rstudio-server-open-source/">R-bloggers 게시글</a>을 참고해 작성되었습니다.</p>
</section>
<section id="과정---서버-1" class="level2">
<h2 class="anchored" data-anchor-id="과정---서버-1">과정 - 서버 1</h2>
<p>OTP 도입을 위해서는 서버와 사용자의 설정이 필요합니다. 이 문단에서는 우선 서버측의 작업에 대해 다루겠습니다.</p>
<pre><code>apt-get update</code></pre>
<p>명령어를 통해 패키지를 최신화합니다. 그 후,</p>
<pre><code>apt-get install -y libpam-google-authenticator</code></pre>
<p>로 libpam-google-authenticator 패키지를 설치합니다.</p>
</section>
<section id="과정---사용자" class="level2">
<h2 class="anchored" data-anchor-id="과정---사용자">과정 - 사용자</h2>
<p>다음으로, 사용자 측에서 수행할 작업입니다.</p>
<ul>
<li>첫째로, 우선 RStudio Server에 로그인합니다.</li>
</ul>
<p><img src="https://blog.zarathu.com/posts/2024-01-05-RStudio-Server-2FA/img/rstudiologin.png" class="img-fluid" width="300"></p>
<ul>
<li>둘째로, Terminal에서,</li>
</ul>
<pre><code>google-authenticator</code></pre>
<p>를 실행합니다.</p>
<p><img src="https://blog.zarathu.com/posts/2024-01-05-RStudio-Server-2FA/img/terminal_google_authenticator.png" class="img-fluid" width="500"></p>
<ul>
<li>셋째로, <code>y</code> 를 입력합니다.</li>
</ul>
<p><img src="https://blog.zarathu.com/posts/2024-01-05-RStudio-Server-2FA/img/time based y.png" class="img-fluid" width="500"></p>
<ul>
<li>넷째로, 아래와 같은 QR코드와 secret key가 나타납니다.</li>
</ul>
<p><img src="https://blog.zarathu.com/posts/2024-01-05-RStudio-Server-2FA/img/QR.png" class="img-fluid" width="200"></p>
<p>휴대폰의 “Google Authenticator”나, 또는 이와 유사한 OTP 지원 어플리케이션으로, 화면에 제시된 QR코드를 입력(촬영)하거나, 아래의 secret key를 OTP 어플리케이션에 등록합니다.</p>
<p><img src="https://blog.zarathu.com/posts/2024-01-05-RStudio-Server-2FA/img/코드추가.png" class="img-fluid" width="350"> <img src="https://blog.zarathu.com/posts/2024-01-05-RStudio-Server-2FA/img/QR코드스캔.png" class="img-fluid" width="350"></p>
<ul>
<li>중요한 작업은 거의 끝났습니다. 간단한 설정을 수행합니다.</li>
</ul>
<ol type="a">
<li>관련 사항을 저장하는 옵션입니다. <code>y</code>로 설정합니다.</li>
</ol>
<p><img src="https://blog.zarathu.com/posts/2024-01-05-RStudio-Server-2FA/img/misc1.png" class="img-fluid" width="550"></p>
<ol start="2" type="a">
<li>하나의 코드로 한 번만 로그인을 허용할지 결정하는 옵션입니다. <code>y</code>로 설정합니다.</li>
</ol>
<p><img src="https://blog.zarathu.com/posts/2024-01-05-RStudio-Server-2FA/img/misc2.png" class="img-fluid" width="550"></p>
<ol start="3" type="a">
<li>기본적으로 현재의 코드, 이전 코드, 이후 코드의 3개의 코드로만 로그인이 허용됩니다. 이 옵션을 허용하면 현재의 코드, 앞 8개 코드, 뒤 8개 코드의 총 17개로 로그인이 가능하게 허용됩니다. 사용자와 서버의 시간 문제가 발생하면 <code>y</code>로 설정하면 되나, 현재는 필요 없어 <code>n</code>으로 설정했습니다.</li>
</ol>
<p><img src="https://blog.zarathu.com/posts/2024-01-05-RStudio-Server-2FA/img/misc3.png" class="img-fluid" width="550"></p>
<ol start="4" type="a">
<li>30초에 3번만 로그인을 시도할 수 있도록 하는 옵션입니다. <code>y</code>로 설정합니다.</li>
</ol>
<p><img src="https://blog.zarathu.com/posts/2024-01-05-RStudio-Server-2FA/img/misc4.png" class="img-fluid" width="550"></p>
</section>
<section id="과정---서버-2" class="level2">
<h2 class="anchored" data-anchor-id="과정---서버-2">과정 - 서버 2</h2>
<p>위 과정을 다 수행한 후, RStudio의 인증 프로파일을 수정하기 위하여 아래와 같이 서버 설정을 진행합니다.</p>
<p><code>vi /etc/pam.d/rstudio</code> 파일에,</p>
<pre><code>auth required pam_google_authenticator.so
@include common-account
@include common-session</code></pre>
<p>위 내용을 추가합니다.</p>
<p><code>vi /etc/rstudio/rserver.conf</code> 파일에,</p>
<pre><code># Server Configuration File
auth-pam-require-password-prompt=0</code></pre>
<p>위 내용을 추가합니다.</p>
<p>이렇게 설정한 후, RStudio Server 서비스를 재시작합니다.</p>
<p>우리 회사는 Docker Container 내에서 RStudio Server를 실행하고 있으므로, 아래와 같이 Docker Container를 재시작 하였습니다. 만약 다른 방법으로 사용하고 계신 경우, 적절한 방법으로 서비스를 재시작하시면 됩니다.</p>
<pre><code># 컨테이너명: internship
docker restart internship</code></pre>
<p>이제, 휴대폰 OTP에 표시된 6자리 숫자로 로그인이 가능합니다.</p>
</section>
<section id="마치며" class="level2">
<h2 class="anchored" data-anchor-id="마치며">마치며</h2>
<p>기존에는 정적인 비밀번호를 사용하고 있었지만, OTP를 통해 비밀번호를 계속 변경하는 효과를 누릴 수 있습니다. 우선 하나의 서버에만 적용하였지만, 사용성이 우수하다고 판명 될 경우 다른 서버에도 확대 적용 계획입니다.</p>
<p>RStudio Server를 사용하시는 분들께 도움이 되었으면 좋겠습니다.</p>


</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-reuse"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div class="quarto-appendix-contents"><div><a rel="license" href="https://creativecommons.org/licenses/by-nc/4.0/">CC BY-NC 4.0</a></div></div></section><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{lim2024,
  author = {Lim, Changwoo},
  title = {RStudio {Server에} {2FA(OTP)} {도입하기}},
  date = {2024-01-05},
  url = {https://blog.zarathu.com/posts/2024-01-05-RStudio-Server-2FA},
  langid = {en}
}
</code></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-lim2024" class="csl-entry quarto-appendix-citeas">
Lim, Changwoo. 2024. <span>“RStudio Server에 2FA(OTP) 도입하기.”</span>
January 5, 2024. <a href="https://blog.zarathu.com/posts/2024-01-05-RStudio-Server-2FA">https://blog.zarathu.com/posts/2024-01-05-RStudio-Server-2FA</a>.
</div></div></section></div> ]]></description>
  <category>R</category>
  <category>rstudio server</category>
  <category>security</category>
  <guid>https://blog.zarathu.com/posts/2024-01-05-RStudio-Server-2FA/</guid>
  <pubDate>Thu, 04 Jan 2024 15:00:00 GMT</pubDate>
  <media:content url="https://blog.zarathu.com/posts/2024-01-05-RStudio-Server-2FA/img/logo.png" medium="image" type="image/png" height="62" width="144"/>
</item>
<item>
  <title>Quarto Dashboard를 이용해 대시보드 개발하기</title>
  <dc:creator>Jinhwan Kim</dc:creator>
  <link>https://blog.zarathu.com/posts/2023-12-11-quarto-dashboard/</link>
  <description><![CDATA[ <!-- Google tag (gtag.js) --><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-L0DYYSH9KM"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-L0DYYSH9KM');
</script><section id="개요" class="level2"><h2 class="anchored" data-anchor-id="개요">개요</h2>
<p>Quarto는 R Markdown을 기반으로 하는 문서 작성 도구입니다.</p>
<p>R Markdown은 RStudio에서 제공하는 문서 작성 도구로, R 코드와 문서를 한 번에 작성할 수 있습니다.</p>
<p>Quarto는 R Markdown의 <a href="https://pkgs.rstudio.com/flexdashboard/">flexdashboard</a>의 역할을 이어가는 기능으로써, R Markdown의 장점을 그대로 가져오면서, R 뿐만 아니라 Python, Julia 등 다양한 언어를 지원합니다.</p>
<p>본 게시글은 <a href="https://quarto.org/docs/dashboards/">Quarto 공식 문서</a>를 참고해 작성되었습니다.</p>
</section><section id="quarto-dashboard-소개" class="level2"><h2 class="anchored" data-anchor-id="quarto-dashboard-소개">Quarto Dashboard 소개</h2>
<div class="callout callout-style-simple callout-warning callout-titled" title="Quarto Versione">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Quarto Versione
</div>
</div>
<div class="callout-body-container callout-body">
<p>Quarto Dashboard는 현재 개발 중인 기능으로, 1.4 버전 이상의 Quarto를 사용해야 합니다.</p>
</div>
</div>
<p>이번 글에서는 Quarto를 사용하여 <strong>Markdown</strong>과 <code>R</code>, <code>Python</code>, <code>Julia</code>등을 활용해 <strong>아래 이미지 같은</strong> 인터랙티브한 대시보드를 만드는 방법을 소개합니다.</p>
<p style="align:center">
<img src="https://blog.zarathu.com/posts/2023-12-11-quarto-dashboard/img/dashboard.png" width="100%"></p>
<p>더 많은 예시는 <a href="https://quarto.org/docs/dashboards/examples/">링크</a>에서 확인 할 수 있습니다.</p>
<p>Quarto dashboard는 다양한 언어를 활용할 수 있기 때문에 이들로 부터 파생되는 <a href="https://plotly.com/python/">Plotly</a>, <a href="https://ipyleaflet.readthedocs.io/en/latest/">Leaflet</a>, <a href="https://quarto.org/docs/interactive/widgets/jupyter.html">Jupyter Widgets</a>, <a href="https://www.htmlwidgets.org/">Htmlwidgets</a>를 포함한 다양한 커스텀 위젯을 사용할 수 있습니다.</p>
<div class="callout callout-style-simple callout-tip callout-titled" title="Prerequisite">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Prerequisite
</div>
</div>
<div class="callout-body-container callout-body">
<p><a href="https://education.zarathu.com/day3/quartodocu.html">Quarto</a>와 <a href="https://blog.zarathu.com/posts/2019-01-03-rmarkdown/">Rmarkdown</a>에 대한 설명은 이전의 글과 자료를 참고하시길 바랍니다.</p>
</div>
</div>
</section><section id="대시보드의-구성" class="level2"><h2 class="anchored" data-anchor-id="대시보드의-구성">대시보드의 구성</h2>
<p>보통 대시보드의 구성은 아래 그림과 같이 5개의 영역으로 구분합니다.</p>
<p style="align:center">
<img src="https://blog.zarathu.com/posts/2023-12-11-quarto-dashboard/img/layout.png" width="100%"></p>
<ul>
<li>Main: 대시보드에서 주요 지표를 포함한 내용을 표현하는 공간입니다.</li>
<li>Header / Footer : 대시보드에 대한 일반적인 메타 정보를 소개합니다.</li>
<li>Navigator: 대시보드가 여러 개의 내용을 담고 있어 main을 구분해야하는 경우 각 페이지를 구분짓는 역할을 합니다.</li>
<li>Side: 대시보드의 내용을 조절하는 역할을 합니다.</li>
</ul>
<p>즉, 위의 예시에서 보여진 <code>Labor and Delivery Dashboard</code>는 아래와 같이 영역을 구분해볼 수 있습니다.</p>
<p style="align:center">
<img src="https://blog.zarathu.com/posts/2023-12-11-quarto-dashboard/img/layout2.png" width="100%"></p>
</section><section id="대시보드-만들기" class="level2"><h2 class="anchored" data-anchor-id="대시보드-만들기">대시보드 만들기</h2>
<p>qmd 파일에서 (이후 배포를 고려하면 파일명은 <code>index.qmd</code>를 권장합니다.)</p>
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb1-1"><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">---</span></span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">format</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> dashboard</span></span>
<span id="cb1-3"><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">---</span></span></code></pre></div>
<p>를 추가하여 quarto dashboard를 만들 수 있습니다.</p>
<p>Quarto dashboard에서 반드시 알아야 하는 컨셉은 3가지이며 하나씩 소개하면더 대시보드를 만들어가겠습니다.</p>
<ol type="1">
<li>카드</li>
<li>대시보드 내부 요소 배치 (레이아웃)</li>
<li>대시보드 구성 (페이지)</li>
</ol>
<section id="카드" class="level3"><h3 class="anchored" data-anchor-id="카드">카드</h3>
<p><code>카드</code>는 대시보드의 Main을 구성하는 <strong>그래프나 테이블, 값등을 포함하는 하나의 단위</strong>입니다.</p>
<p>quarto에서는 다음과 같이 사용합니다.</p>
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:::</span> {.card}</span>
<span id="cb2-2">This text will be displayed within a card</span>
<span id="cb2-3"><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:::</span></span></code></pre></div>
<p>추가로</p>
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1">```{r}</span>
<span id="cb3-2">...</span>
<span id="cb3-3">```</span></code></pre></div>
<p>를 사용하는 기본 코드 블록은 Dashboard format에서 자동으로 카드로 변경됩니다.</p>
<p>이때 카드에 사용할 수 있는 주요 옵션은 아래와 같습니다.</p>
<ul>
<li>
<code>title</code>: 카드의 제목</li>
<li>
<code>expandable</code>: 카드를 접을 수 있을지의 여부</li>
<li>
<code>output</code>: 결과를 출력할지 여부</li>
<li>
<code>layout-ncol</code>: 카드 내용을 구분할 column의 개수 (<code>layout-nrow</code>)</li>
</ul>
<p>이 외에 기본 코드블록을 사용하기 때문에 코드 블록의 <a href="https://quarto.org/docs/output-formats/html-code.html">옵션</a>들을 사용 가능합니다.</p>
<p>이제 카드를 qmd에 2개 추가해보겠습니다.</p>
<div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1">```{r}</span>
<span id="cb4-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#| echo: false</span></span>
<span id="cb4-3">library(ggplot2)</span>
<span id="cb4-4">```</span>
<span id="cb4-5"></span>
<span id="cb4-6">```{r}</span>
<span id="cb4-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#| title: "Card 1"</span></span>
<span id="cb4-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#| layout-ncol: 2</span></span>
<span id="cb4-9">mtcars <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb4-10">  ggplot(aes(x <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> mpg, y <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> wt)) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb4-11">  geom_point()</span>
<span id="cb4-12"></span>
<span id="cb4-13">mtcars <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb4-14">  ggplot(aes(x <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> mpg, y <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> qsec)) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb4-15">  geom_point()</span>
<span id="cb4-16">```</span>
<span id="cb4-17"></span>
<span id="cb4-18">```{r}</span>
<span id="cb4-19"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#| title: "Card 2"</span></span>
<span id="cb4-20"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#| output: false</span></span>
<span id="cb4-21">mtcars <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb4-22">  ggplot(aes(x <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> mpg, y <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> vs)) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb4-23">  geom_point()</span>
<span id="cb4-24">```</span>
<span id="cb4-25"></span>
<span id="cb4-26">```{r}</span>
<span id="cb4-27"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#| title: "Card 3"</span></span>
<span id="cb4-28"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#| expandable: false</span></span>
<span id="cb4-29">mtcars <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb4-30">  ggplot(aes(x <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> mpg, y <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> vs)) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb4-31">  geom_point()</span>
<span id="cb4-32">```</span></code></pre></div>
<p>위 코드의 실행결과는 아래 그림처럼 2개의 카드를 만들어냅니다. (2번째는 <code>output:false</code>)</p>
<p style="align:center">
<img src="https://blog.zarathu.com/posts/2023-12-11-quarto-dashboard/img/card.png" width="100%"></p>
</section><section id="레이아웃" class="level3"><h3 class="anchored" data-anchor-id="레이아웃">레이아웃</h3>
<p>대시보드의 레이아웃은 특별한 설정을 하지 않으면 (위 예시처럼) 1개의 카드가 1개의 행으로 배치됩니다.</p>
<p>그런데 <code>## Row</code> 태그를 사용하면 <code>## Row</code> 태그 아래에 있는 카드들을 1개의 행에 배치할 수 있습니다.</p>
<p>(마찬가지로 별도의 설정을 하지 않으면 <code>Column</code>에 같은 크기로 배치됩니다)</p>
<div class="sourceCode" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">## Row {height=70%}</span></span>
<span id="cb5-2"></span>
<span id="cb5-3">:::{.card}</span>
<span id="cb5-4">Card <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb5-5">:::</span>
<span id="cb5-6"></span>
<span id="cb5-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">## Row {height=30%}</span></span>
<span id="cb5-8"></span>
<span id="cb5-9">:::{.card}</span>
<span id="cb5-10">Card <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb5-11">:::</span>
<span id="cb5-12"></span>
<span id="cb5-13">:::{.card}</span>
<span id="cb5-14">Card <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span></span>
<span id="cb5-15">:::</span></code></pre></div>
<p style="align:center">
<img src="https://blog.zarathu.com/posts/2023-12-11-quarto-dashboard/img/card2.png" width="100%"></p>
<p>추가로, <code>Row</code>로 먼저 행을 구분 한뒤, <code>Column</code>을 사용해 디테일한 배치도 가능합니다.</p>
<p>이때 Column은 <code>### Column</code>으로 <code>## Row</code>안에만 사용할 수 있습니다.</p>
<div class="sourceCode" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">## Row {height=70%}</span></span>
<span id="cb6-2"></span>
<span id="cb6-3">:::{.card}</span>
<span id="cb6-4">Card <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb6-5">:::</span>
<span id="cb6-6"></span>
<span id="cb6-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">## Row {height=30%}</span></span>
<span id="cb6-8"></span>
<span id="cb6-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">### Column {width=40%}</span></span>
<span id="cb6-10">:::{.card}</span>
<span id="cb6-11">Card <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb6-12">:::</span>
<span id="cb6-13"></span>
<span id="cb6-14"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">### Column {width=60%}</span></span>
<span id="cb6-15">:::{.card}</span>
<span id="cb6-16">Card <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span></span>
<span id="cb6-17">:::</span></code></pre></div>
<p style="align:center">
<img src="https://blog.zarathu.com/posts/2023-12-11-quarto-dashboard/img/card3.png" width="100%"></p>
<div class="callout callout-style-simple callout-tip callout-titled" title="Scroll">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Scroll
</div>
</div>
<div class="callout-body-container callout-body">
<p>별 다른 설정을 하지 않으면 각 Row에 배치된 요소의 높이들의 합이 100%에 맞추어 크기가 일괄적으로 조절되지만, <strong>Scrolling</strong> 옵션을 사용하여 요소의 원래 크기를 유지하며 화면이 스크롤 되게 변경할 수 있습니다.</p>
<div class="sourceCode" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb7-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">format</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span></span>
<span id="cb7-2"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dashboard</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb7-3"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scrolling</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">true</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span></span></code></pre></div>
</div>
</div>
</section><section id="tabset" class="level3"><h3 class="anchored" data-anchor-id="tabset">Tabset</h3>
<p>카드를 행과 열로 배치하는 것 외에도, <code>Tabset</code>을 사용하여 카드를 탭으로 구분할 수 있습니다.</p>
<div class="sourceCode" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">## Row {.tabset}</span></span></code></pre></div>
<p style="align:center">
<img src="https://blog.zarathu.com/posts/2023-12-11-quarto-dashboard/img/tabset1.png" width="49%"><img src="https://blog.zarathu.com/posts/2023-12-11-quarto-dashboard/img/tabset2.png" width="49%"></p>
</section><section id="페이지" class="level3"><h3 class="anchored" data-anchor-id="페이지">페이지</h3>
<p>대시보드에 여러 요소들을 담아야 한다면 별도의 페이지로 구분하여 만들 수 있습니다.</p>
<p>이때 페이지는 <code>#</code> 태그를 사용하고, yaml에 “title”을 설정해야합니다.</p>
<div class="sourceCode" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb9-1"><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">---</span></span>
<span id="cb9-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">title</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dashboard"</span></span>
<span id="cb9-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">format</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> dashboard</span></span>
<span id="cb9-4"><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">---</span></span></code></pre></div>
<div class="sourceCode" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Page A</span></span>
<span id="cb10-2"></span>
<span id="cb10-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">## Row {height=70%}</span></span>
<span id="cb10-4"></span>
<span id="cb10-5">:::{.card}</span>
<span id="cb10-6">Card <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb10-7">:::</span>
<span id="cb10-8"></span>
<span id="cb10-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">## Row {height=30%}</span></span>
<span id="cb10-10"></span>
<span id="cb10-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">### Column {width=40%}</span></span>
<span id="cb10-12">:::{.card}</span>
<span id="cb10-13">Card <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb10-14">:::</span>
<span id="cb10-15"></span>
<span id="cb10-16"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">### Column {width=60%}</span></span>
<span id="cb10-17">:::{.card}</span>
<span id="cb10-18">Card <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span></span>
<span id="cb10-19">:::</span>
<span id="cb10-20"></span>
<span id="cb10-21"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Page B</span></span>
<span id="cb10-22"></span>
<span id="cb10-23">:::{.card}</span>
<span id="cb10-24">Card <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span></span>
<span id="cb10-25">:::</span></code></pre></div>
<p style="align:center">
<img src="https://blog.zarathu.com/posts/2023-12-11-quarto-dashboard/img/card4.png" width="49%"><img src="https://blog.zarathu.com/posts/2023-12-11-quarto-dashboard/img/card5.png" width="49%"></p>
<p>이처럼 title을 설정하면 Header가 생성되며 Page 가 존재한다면 Navigation 역할도 같이 수행합니다.</p>
</section><section id="header" class="level3"><h3 class="anchored" data-anchor-id="header">Header</h3>
<p>Header에서는 <code>title</code> 외에 <code>author</code>를 사용해 일종의 “subtitle” 역할을 할 수 있습니다. 추가로 <code>logo</code>를 사용하여 대시보드의 로고를 설정하거나, 외부 링크나 자료로 연동할 수 있는 <code>nav-buttons</code>도 사용가능합니다.</p>
<p>네비게이션 버튼을 커스텀으로 제작하는 것에 대해서는 설명하지 않고 <a href="https://quarto.org/docs/reference/projects/websites.html#nav-items">공식문서의 링크</a>로 대체합니다.</p>
<div class="callout callout-style-simple callout-warning callout-titled" title="Quarto Versione">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Quarto Versione
</div>
</div>
<div class="callout-body-container callout-body">
<p>Quarto 1.4.455 버전을 기준으로, 네비게이션 버튼은 버그로 아직 작동하지 않습니다.</p>
</div>
</div>
</section><section id="sidebar" class="level3"><h3 class="anchored" data-anchor-id="sidebar">Sidebar</h3>
<p>Sidebar는 <code>sidebar</code> 태그를 사용하여 만들 수 있으며 특정 페이지에 종속되지 않습니다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># {.sidebar}</span></span>
<span id="cb11-2"></span>
<span id="cb11-3">Sidebar content </span></code></pre></div>
</div>
<p>로고와 sidebar를 설정하고 난 대시보드의 결과는 다음과 같습니다.</p>
<p style="align:center">
<img src="https://blog.zarathu.com/posts/2023-12-11-quarto-dashboard/img/sidebar.png" width="100%"></p>
</section></section><section id="대시보드-채우기" class="level2"><h2 class="anchored" data-anchor-id="대시보드-채우기">대시보드 채우기</h2>
<p>대시보드에 들어갈 수 있는 내용은 주로 <code>r</code>로 만든 결과물이지만, 다른 형태의 요소들도 활용할 수 있습니다.</p>
<section id="테이블" class="level3"><h3 class="anchored" data-anchor-id="테이블">테이블</h3>
<p>여러 옵션이 있으며, <code>kable</code>, <code>DT</code>, <code>reactable</code> 정도가 사용됩니다.</p>
<div class="cell">
<div class="sourceCode" id="cb12" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">knitr</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">mtcars</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># kable</span></span>
<span></span>
<span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">DT</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/pkg/DT/man/datatable.html">datatable</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">mtcars</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># DT</span></span>
<span></span>
<span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">reactable</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://glin.github.io/reactable/reference/reactable.html">reactable</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">mtcars</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># reactable</span></span></code></pre></div>
</div>
<p style="align:center">
<img src="https://blog.zarathu.com/posts/2023-12-11-quarto-dashboard/img/table.png" width="100%"></p>
</section><section id="value-box" class="level3"><h3 class="anchored" data-anchor-id="value-box">Value Box</h3>
<p>Quarto 대시보드에서만 사용할 수 있는 “지표를 표현하기 위한” 특별한 방법입니다.</p>
<p>아래 예시처럼 <code>{.valuebox}</code> 코드로 사용할 수 있습니다.</p>
<p>옵션으로 <strong>색상</strong>은 <code>primary</code>, <code>secondary</code>, <code>success</code>, <code>danger</code>, <code>warning</code>, <code>info</code>, <code>light</code>, <code>dark</code>를 사용할 수 있으며, 사용 가능한 (bootstrap) <strong>아이콘</strong>의 종류는 <a href="https://icons.getbootstrap.com/">링크</a>에서 확인 가능합니다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:::</span> {.valuebox icon<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"pencil"</span> color<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span>primary}</span>
<span id="cb13-2">Articles per day</span>
<span id="cb13-3"></span>
<span id="cb13-4"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">r articles</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span></span>
<span id="cb13-5"><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:::</span></span></code></pre></div>
</div>
<p style="align:center">
<img src="https://blog.zarathu.com/posts/2023-12-11-quarto-dashboard/img/valuebox.png" width="100%"></p>
</section><section id="theme" class="level3"><h3 class="anchored" data-anchor-id="theme">Theme</h3>
<p>다른 Quarto 기능들과 마찬가지로 Quarto Dashboard도 yaml에서 사용되어 색상과 스타일을 꾸밀 수 있는 Theme 기능을 제공합니다.</p>
<p>기본 값은 cosmo이고, 가능한 값의 목록은 <a href="https://bootswatch.com/">링크</a>에서 확인 가능합니다.</p>
<div class="sourceCode" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb14-1"><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">---</span></span>
<span id="cb14-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">format</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span></span>
<span id="cb14-3"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dashboard</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb14-4"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">logo</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> Zarathu.png</span></span>
<span id="cb14-5"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> sandstone</span></span>
<span id="cb14-6"><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">---</span></span></code></pre></div>
<p style="align:center">
<img src="https://blog.zarathu.com/posts/2023-12-11-quarto-dashboard/img/theme.png" width="100%"></p>
<div class="callout callout-style-simple callout-tip callout-titled" title="대시보드 게시하기">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
대시보드 게시하기
</div>
</div>
<div class="callout-body-container callout-body">
<p>Quarto로 만든 Dashboard는 Quarto pub, Github page, Posit connect, Netlify 등의 서비스를 활용하여 공유할 수 있습니다.</p>
<p>이 글에서는 다루지 않으며, 차라투의 Quarto <a href="https://education.zarathu.com/day3/quartodocu.html">교육자료</a> 17페이지를 참고하시길 바랍니다.</p>
</div>
</div>
</section></section><section id="다른-대시보드-툴과-quarto-dashboard의-차이" class="level2"><h2 class="anchored" data-anchor-id="다른-대시보드-툴과-quarto-dashboard의-차이">다른 대시보드 툴과 Quarto Dashboard의 차이</h2>
<p style="align:center">
<img src="https://blog.zarathu.com/posts/2023-12-11-quarto-dashboard/img/figure.png" width="100%"></p>
<p><code>Quarto Dashboard</code>는 <code>Tableau</code>, <code>Power BI</code>, <code>Shiny</code>나 <code>Streamlit</code>과 같은 대시보드를 만들 수 있는 도구와 비교될 수 있습니다.</p>
<p>제일 먼저 대시보드 사용에 필요한 비용입니다. 즉 <code>Tableau</code>, <code>Power BI</code>등 상용 서비스는 <strong>클릭</strong>으로 쉽게 만들 수 있지만 사용하기 위해 비용이 발생합니다.</p>
<p>한편 <code>Quarto Dashboard</code>는 별도의 비용은 없지만, 개발을 통해 대시보드를 만들어야 합니다.</p>
<p>두번째로는 대시보드의 내용이 변하는 가의 여부입니다.</p>
<p>즉 사용자의 선택 값에 따라 값이 <strong>동적</strong>으로 바뀌어야 한다면 <code>Shiny</code>나 <code>Streamlit</code>을 사용하는 것이 좋습니다.</p>
<p>반면 사용자의 선택은 없고 값이 <strong>정적</strong>으로 고정되어 있다면 <code>Quarto Dashboard</code>를 사용하는 것이 좋습니다.</p>
<p>이 둘의 차이는 <strong>동적</strong> 대시보드는 사용자의 입력을 처리하고 결과를 호스팅할 <strong>서버</strong>가 필요하고 이를 한 비용이 필요합니다. (<strong>정적</strong>은 비용이 들지 않습니다)</p>
<div class="callout callout-style-simple callout-tip callout-titled" title="정적/동적">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
정적/동적
</div>
</div>
<div class="callout-body-container callout-body">
<p>예를 들어, 어제의 매출 데이터를 계산하여 보여주는 대시보드는 날마다 값이 변하긴 하지만, 사용자의 입력이 없기 때문에 <strong>정적</strong>으로 이루어져 <code>Quarto Dashboard</code>로도 충분합니다.</p>
<p>그런데 동일한 매출 데이터이지만, 사용자로부터 날짜를 입력 받고, 그에 따라 매출 데이터를 계산하여 보여주는 대시보드는 데이터가 변해야하기 때문에 <code>Shiny</code>나 <code>Streamlit</code> 과 같은 <strong>동적</strong> 대시보드가 필요합니다.</p>
</div>
</div>
<p>(Quarto Dashboard에서의 <strong>페이지</strong>나 <strong>탭셋</strong>은 모든 결과를 만들어두고 필요에 따라 보여주는 내용을 다르게 한다의 관점으로 데이터가 변하지 않는 <strong>정적</strong> 기능입니다.)</p>
</section><section id="마치며" class="level2"><h2 class="anchored" data-anchor-id="마치며">마치며</h2>
<p>이번 아티클에서는 새롭게 공개된 <code>Quarto Dashboard</code>를 통해 대시보드를 구성하는 방법에 대해 알아보았습니다.</p>
<p>꼭 <strong>헬스케어</strong>, <strong>메디컬</strong> <strong>IT</strong> 업계에서뿐 아니라 다양한 산업과 역할에서 데이터를 활용하기 위해 대시보드를 활용하고 있습니다.</p>
<p><code>Quarto</code>와 사용 가능한 <code>R</code>이나 <code>Python을</code> 활용할 수 있다면 <code>Quarto Dashboard</code>를 사용해 정적 대시보드 구성과 공유가 더욱 편리하게 이루어지기를 기대하며 글을 마칩니다.</p>


</section><div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-reuse"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div class="quarto-appendix-contents"><div><a rel="license" href="https://creativecommons.org/licenses/by-nc/4.0/">CC BY-NC 4.0</a></div></div></section><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{kim2023,
  author = {Kim, Jinhwan},
  title = {Quarto {Dashboard를} {이용해} {대시보드} {개발하기}},
  date = {2023-12-11},
  url = {https://blog.zarathu.com/posts/2023-12-11-quarto-dashboard},
  langid = {en}
}
</code></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-kim2023" class="csl-entry quarto-appendix-citeas">
Kim, Jinhwan. 2023. <span>“Quarto Dashboard를 이용해 대시보드
개발하기.”</span> December 11, 2023. <a href="https://blog.zarathu.com/posts/2023-12-11-quarto-dashboard">https://blog.zarathu.com/posts/2023-12-11-quarto-dashboard</a>.
</div></div></section></div> ]]></description>
  <category>R</category>
  <category>python</category>
  <category>quarto</category>
  <category>quarto dashboard</category>
  <category>dashboard</category>
  <guid>https://blog.zarathu.com/posts/2023-12-11-quarto-dashboard/</guid>
  <pubDate>Sun, 10 Dec 2023 15:00:00 GMT</pubDate>
  <media:content url="https://blog.zarathu.com/posts/2023-12-11-quarto-dashboard/img/logo.png" medium="image" type="image/png" height="35" width="144"/>
</item>
<item>
  <title>Rstudio에서 Copilot을 활용해 AI로 코딩하기</title>
  <dc:creator>Jinhwan Kim</dc:creator>
  <link>https://blog.zarathu.com/posts/2023-11-21-copilot/</link>
  <description><![CDATA[ <!-- Google tag (gtag.js) --><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-L0DYYSH9KM"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-L0DYYSH9KM');
</script><section id="rstudio에서-copilot을-활용해-ai로-코딩하기" class="level1"><h1>Rstudio에서 Copilot을 활용해 AI로 코딩하기</h1>
<section id="github-copilot이란" class="level2"><h2 class="anchored" data-anchor-id="github-copilot이란">1. Github Copilot이란?</h2>
<p style="text-align: center;">
<img src="https://blog.zarathu.com/posts/2023-11-21-copilot/img/copilot.png" width="400px"></p>
<p>Github Copilot은 OpenAI의 GPT-3를 기반으로 만들어진 <strong>AI 코딩 도우미</strong>로, Github에 있는 수많은 “Public Repository”의 코드들을 학습하여, 자동 완성 형태의 제안을 통해 사용자의 코드 제작을 돕습니다.</p>
<p>Github에는 코드도 있지만, README와 같은 여러 종류의 설명 글 또한 있기 때문에 Copilot에서는 아래 이미지처럼 (<code>Quarto로 블로그 작성</code>) 다양한 종류의 자동 완성을 제공합니다.</p>
<p style="text-align: center;">
<img src="https://blog.zarathu.com/posts/2023-11-21-copilot/img/example.gif" width="400px"></p>
</section><section id="chatgpt와의-차이점" class="level2"><h2 class="anchored" data-anchor-id="chatgpt와의-차이점">2. chatGPT와의 차이점</h2>
<p><a href="https://support.microsoft.com/ko-kr/topic/chatgpt-vs-microsoft-365-copilot-%EC%B0%A8%EC%9D%B4%EC%A0%90%EC%9D%80-%EB%AC%B4%EC%97%87%EC%9D%B8%EA%B0%80%EC%9A%94-8fdec864-72b1-46e1-afcb-8c12280d712f" target="_blank">Microsoft의 설명</a>에 따르면 chatGPT는 <strong>자연어 처리 기술</strong>로, Microsoft 365 Copilot은 <strong>코드 생성 기술</strong>로 설명하고 있습니다. (Microsoft 365 copilot과 github copilot은 살짝 다르긴합니다.)</p>
<p>즉, chatGPT는 자연어 처리 기술을 통해 사용자의 <strong>질문에 대한 답변</strong>을 생성하는 것이 주 역할입니다.</p>
<p>따라서 chatGPT는 아래 작업 용도로 활용되기도 합니다.</p>
<ul>
<li>에세이, 이메일 및 커버 레터 작성</li>
<li>목록 만들기</li>
<li>예술에 대해 자세히 설명</li>
<li>코드 작성</li>
<li>콘텐츠 요약</li>
<li>시와 노래 가사 만들기</li>
<li>이력서 작성</li>
</ul>
<p>한편 Copilot은 Github에서의 학습을 바탕으로 <strong>코드 스니펫</strong>을 제공하는 것에 더 큰 장점을 가지고 있습니다.</p>
<p>코드 스니펫이란 아래 이미지처럼 자주 사용되는 <strong>조각 코드</strong>를 미리 작성해 놓은 것을 말합니다.</p>
<p style="text-align: center;">
<img src="https://blog.zarathu.com/posts/2023-11-21-copilot/img/snippet.png" width="400px"></p>
<p>얼핏보면 큰 차이가 없어보이지만, chatGPT는 최근의 기술은 잘 반영하지 못한다는 단점이 있습니다. 또한 Copilot은 IDE (Rstudio)에서 바로 사용할 수 있다는 장점도 있습니다.</p>
<p>어느 것이 좋다/나쁘다 라기보단 서로 다른 특징을 가지고 있기에, 두 방법 모두를 필요한 목적에 따라 적절히 활용하는 것을 권장합니다.</p>
</section><section id="github-copilot을-사용하기-위한-준비" class="level2"><h2 class="anchored" data-anchor-id="github-copilot을-사용하기-위한-준비">3. Github Copilot을 사용하기 위한 준비</h2>
<p>Copilot을 사용하기 위해서는 몇가지 준비가 필요합니다.</p>
<div class="callout callout-style-simple callout-warning">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-body-container">
<p>이 글에서는 Github 에서의 Copilot 결제를 비롯한 요금제에 대해서는 설명하지 않습니다.</p>
</div>
</div>
</div>
<ol type="1">
<li>Github 개인 계정 (무료)</li>
<li>IDE (코드 에디터) - VS Code, <strong>Rstudio</strong> 등. 글에서는 Rstudio를 기준으로 설명</li>
<li>Github Copilot 가입 (첫 한달은 무료, 이후 <strong>월 10달러의 유료</strong>, <a href="https://docs.github.com/en/copilot/overview-of-github-copilot/about-github-copilot-individual#understanding-the-differences-between-copilot-individual-and-copilot-business" target="_blank"> Pricing </a> 참조)</li>
</ol>
<p>Copilot의 공식 홈페이지에서 설명이 제공하는 개발 도구는 Azure Data studio, JetBrains IDEs, Vim/NeoVim, Visual Studio, Visual Studio Code가 있지만 다행히 Rstudio에서도 사용가능합니다.</p>
<p style="text-align: center;">
<img src="https://blog.zarathu.com/posts/2023-11-21-copilot/img/ide.png" width="400px"></p>
<div class="callout callout-style-simple callout-note">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-body-container">
<p>현재는 Rstudio Desktop 2023.09.0 이상 버전에서만 사용 가능하며 Rstudio Server나 Posit Workbench에서는 관리자 설정 이후 사용 가능합니다.</p>
<p>버전을 확인하기 위해서는 Rstudio에서 <code>Help &gt; About Rstudio</code>를 클릭하면 됩니다.</p>
</div>
</div>
</div>
</section><section id="rstudio에서-github-copilot-사용-설정" class="level2"><h2 class="anchored" data-anchor-id="rstudio에서-github-copilot-사용-설정">4. Rstudio에서 Github Copilot 사용 설정</h2>
<p>이후 Copilot 설정 과정은 다음과 같습니다.</p>
<ol type="1">
<li>Rstudio에서 <code>Tools &gt; Global Options &gt; copilot</code>을 클릭합니다.</li>
</ol>
<p style="text-align: center;">
<img src="https://blog.zarathu.com/posts/2023-11-21-copilot/img/setting1.png" width="400px"></p>
<ol start="2" type="1">
<li>“Enable Github Copilot”을 체크합니다.</li>
</ol>
<p style="text-align: center;">
<img src="https://blog.zarathu.com/posts/2023-11-21-copilot/img/setting2.png" width="400px"></p>
<ol start="3" type="1">
<li>“Sign in”을 클릭합니다.</li>
</ol>
<p style="text-align: center;">
<img src="https://blog.zarathu.com/posts/2023-11-21-copilot/img/setting3.png" width="400px"></p>
<ol start="4" type="1">
<li>이후 나타나는 Device Activation에 Rstudio에서 보여지는 코드를 입력합니다.</li>
</ol>
<p style="text-align: center;">
<img src="https://blog.zarathu.com/posts/2023-11-21-copilot/img/setting4.png" width="400px"></p>
<ol start="5" type="1">
<li>이제 Github Copilot을 사용할 수 있습니다.</li>
</ol>
<p style="text-align: center;">
<img src="https://blog.zarathu.com/posts/2023-11-21-copilot/img/setting5.png" width="400px"></p>
</section><section id="github-copilot-사용하기" class="level2"><h2 class="anchored" data-anchor-id="github-copilot-사용하기">5. Github Copilot 사용하기</h2>
<p>Copilot은 <code>"Ghost text"</code>라고 불리는 방법으로 사용자의 코드를 자동 완성합니다.</p>
<p>앞서 본 gif 이미지나, 아래의 예시처럼 코드의 일정 부분을 작성하면 나머지 부분을 회색으로 보여주어 탭 키를 누르는 것으로 완성할 수 있습니다.</p>
<p style="text-align: center;">
<img src="https://blog.zarathu.com/posts/2023-11-21-copilot/img/copilot-rstudio.png" width="400px"></p>
<ol type="1">
<li>Copilot이 인지할 코드: 이때 꼭 주석으로 하지 않아도 이전 코드를 기반으로 copilot이 자동으로 제안합니다.</li>
<li>Copilot이 제안하는 코드: 회색으로 보여지는 부분이 제안되는 부분입니다.</li>
<li>Copilot 상태바: <code>Waiting for Completions</code>(대기), <code>Completion response received</code>(코드 제안 완료), <code>No completions available</code>(제안 없음) 등의 상태를 보여줍니다.</li>
</ol>
<p>한편 상태바 옆의 언어 설정을 통해 어떤 코드를 자동생성할지 설정할 수 있습니다.</p>
<p style="text-align: center;">
<img src="https://blog.zarathu.com/posts/2023-11-21-copilot/img/language.png" width="400px"></p>
<p>추가로 Copilot 옵션에서 Index project files… 를 선택하여 현재 Rstudio 프로젝트의 파일을 코드제안에 반영할 수도 있습니다.</p>
<section id="사용-방법-1-code" class="level3"><h3 class="anchored" data-anchor-id="사용-방법-1-code">사용 방법 1: Code</h3>
<p>Copilot을 사용하는 가장 기본적인 방법은 코드를 자동완성하는 것입니다.</p>
<p style="text-align: center;">
<img src="https://blog.zarathu.com/posts/2023-11-21-copilot/img/code.png" width="400px"></p>
<p>위의 예시처럼, 함수의 기능을 잘 설명하는 이름을 작성하는 것으로 Copilot은 함수의 목적을 이해하고, 함수의 기능에 맞는 코드를 제안합니다.</p>
<p style="text-align: center;">
<img src="https://blog.zarathu.com/posts/2023-11-21-copilot/img/code2.png" width="400px"></p>
<p>한편 함수 이름에 기능을 명시하지 않고 적절한 <strong>한글 주석을 통해서도</strong> 함수를 자동으로 완성할 수 있습니다.</p>
<p>물론 이를 위해서는 (이름으로나 주석으로나) 함수의 목적을 명확하게 알아야만 합니다.</p>
</section><section id="사용-방법-2-questions" class="level3"><h3 class="anchored" data-anchor-id="사용-방법-2-questions">사용 방법 2: Questions</h3>
<p>Copilot은 코드를 자동완성하는 것 외에도, 코드를 작성하는데 도움을 주는 질문을 제안합니다.</p>
<p style="text-align: center;">
<img src="https://blog.zarathu.com/posts/2023-11-21-copilot/img/question.png" width="400px"></p>
<p>이때 질문을 위해서는 코드와는 다르게 주석에 <code>q:</code>와 <code>a:</code>형식을 맞춰야만 합니다.</p>
<div class="cell">
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># q: QUESTION</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># a: </span></span></code></pre></div>
</div>
<p>개인적으로 이러한 방법의 활용을 위해서는 코드를 위주로 학습한 Copilot보다는, <code>chatGPT</code>를 바로 쓰거나 <code>gptStudio</code>, <code>chattr</code> 패키지를 사용해 LLM 모델을 사용하는 것도 좋다고 생각합니다.</p>
<div class="callout callout-style-simple callout-note">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-body-container">
<p><a href="https://medium.com/@jhk0530/chatgpt-in-rstudio-with-gptstudio-5125f8eac429" target="_blank"> gptStudio 설명글 </a></p>
<p><a href="https://mlverse.github.io/chattr/" target="_blank"> chattr 패키지 웹페이지</a></p>
</div>
</div>
</div>
</section><section id="사용-방법-3-comments" class="level3"><h3 class="anchored" data-anchor-id="사용-방법-3-comments">사용 방법 3: Comments</h3>
<p>Copilot은 코드를 작성하는데 도움을 주는 질문 외에도, 주석을 작성하는데에도 쓰일 수 있습니다.</p>
<p>예를 들면, 아래의 표준 편차를 계산하는 함수에 대해 주석을 작성하게 할 수도 있습니다.</p>
<div class="cell">
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">calc_se</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">x</span>, <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">na.rm</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span>  <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/numeric.html">is.numeric</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">x</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span>    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/stop.html">stop</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"x must be numeric"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span>  <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span>  <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">na.rm</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span>    <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">x</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">x</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">x</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">]</span></span>
<span>  <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/stats/cor.html">var</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">x</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">x</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span></span>
<span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">calc_se</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.9574271</code></pre>
</div>
</div>
<p style="text-align: center;">
<img src="https://blog.zarathu.com/posts/2023-11-21-copilot/img/comment.png" width="400px"></p>
</section><section id="사용-방법-4-test" class="level3"><h3 class="anchored" data-anchor-id="사용-방법-4-test">사용 방법 4: Test</h3>
<p>Copilot은 코드를 작성하는데 도움을 주는 질문 외에도, 코드의 품질을 올리기 위한 목적의 테스트 코드를 작성하기 위해서도(!) 쓰일 수 있습니다.</p>
<p style="text-align: center;">
<img src="https://blog.zarathu.com/posts/2023-11-21-copilot/img/test.gif" width="400px"></p>
</section></section><section id="정리" class="level2"><h2 class="anchored" data-anchor-id="정리">6. 정리</h2>
<p>당연한 이야기지만, Copilot은 유용한 코드를 생성하는 경우가 많지만 항상 유효하거나 의도한 문제를 정확하게 해결하지 않을 수도 있습니다.</p>
<p>또한 Github의 다양한 수준의 코드를 학습한 만큼 안전하지 않은 코딩 패턴이나, 버그, 비효율적인 관행등을 포함한 코드를 만들 수 도 있기 때문에 완전히 신뢰할 수는 없습니다.</p>
<p>그러나 대부분의 R 사용자에게는 크게 체감될만한 문제가 없을 것으로 보이며, 특히 데이터 매니지먼트의 목적으로는 매우 유용하게 사용할 수 있을 것으로 보입니다.</p>
<p>꼭 Rstudio가 아니더라도 다른 IDE에서 SQL, SASS 등의 다른 언어를 목적으로도 사용할 수 있기에 Copilot은 대체로 코드 작업에 아주 아주 효과적인 방법입니다.</p>
<p>그러나 개인 기준 월 10달러의 비용이 들기 때문에, 코딩 작업이 많이 필요하지 않은 사람에게는 다소 부담스러울 수도 있으니 무료 기간동안 활용해보고 결정하는 것도 좋을 것 같습니다.</p>
<p><em>비교를 위한 넷플릭스의 요금제</em></p>
<p style="text-align: center;">
<img src="https://blog.zarathu.com/posts/2023-11-21-copilot/img/netflix.png" width="400px"></p>
<div class="callout callout-style-simple callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
🤗 Let’s talk
</div>
</div>
<div class="callout-body-container callout-body">
<p>차라투에서는 R과 Shiny에 대한 컨설팅을 제공합니다. 진행중인 프로젝트 관련하여 도움이 필요하시다면 jinhwan@zarathu.com 으로 알려주세요!</p>
</div>
</div>


</section></section><div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-reuse"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div class="quarto-appendix-contents"><div><a rel="license" href="https://creativecommons.org/licenses/by-nc/4.0/">CC BY-NC 4.0</a></div></div></section><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{kim2023,
  author = {Kim, Jinhwan},
  title = {Rstudio에서 {Copilot을} {활용해} {AI로} {코딩하기}},
  date = {2023-11-21},
  url = {https://blog.zarathu.com/posts/2023-11-21-copilot},
  langid = {en}
}
</code></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-kim2023" class="csl-entry quarto-appendix-citeas">
Kim, Jinhwan. 2023. <span>“Rstudio에서 Copilot을 활용해 Ai로
코딩하기.”</span> November 21, 2023. <a href="https://blog.zarathu.com/posts/2023-11-21-copilot">https://blog.zarathu.com/posts/2023-11-21-copilot</a>.
</div></div></section></div> ]]></description>
  <category>R</category>
  <category>github</category>
  <category>rstudio</category>
  <category>copilot</category>
  <guid>https://blog.zarathu.com/posts/2023-11-21-copilot/</guid>
  <pubDate>Mon, 20 Nov 2023 15:00:00 GMT</pubDate>
  <media:content url="https://blog.zarathu.com/posts/2023-11-21-copilot/img/logo.png" medium="image" type="image/png" height="62" width="144"/>
</item>
<item>
  <title>Discourse 기반 커뮤니티 구축</title>
  <dc:creator>Jisoo Kim</dc:creator>
  <link>https://blog.zarathu.com/posts/2023-11-10-discourse1/</link>
  <description><![CDATA[ 
<!-- Google tag (gtag.js) -->

<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-L0DYYSH9KM"></script>

<script>

  window.dataLayer = window.dataLayer || [];

  function gtag(){dataLayer.push(arguments);}

  gtag('js', new Date());



  gtag('config', 'G-L0DYYSH9KM');

</script>





<p><img src="https://blog.zarathu.com/posts/2023-11-10-discourse1/img/logo.png" class="img-fluid"></p>
<section id="개요" class="level2">
<h2 class="anchored" data-anchor-id="개요">개요</h2>
<p>이번 글에서는 차라투에서 사용하는 커뮤니티 플랫폼인 Discourse를 사용해서 커뮤니티를 구축하는 과정에 대해 소개합니다.</p>
</section>
<section id="discourse" class="level2">
<h2 class="anchored" data-anchor-id="discourse">Discourse</h2>
<p>Discourse는 쉽게 모던한 커뮤니티를 만들 수 있는 오픈소스 커뮤니티 플랫폼이며 사이트 개발과 배포를 완벽히 조절할 수 있도록 다양한 커스텀 옵션과 설치 방식을 제공합니다. 또한 10년이 넘게 수많은 테스트를 거쳐왔으며 카카오, Zoom, Jetbrain 등의 다양한 회사에서 사용 되고 있고 지속적으로 업데이트 되고 있습니다.</p>
<p>또한 적절히 분리된 게시판에 Markdown 게시글을 작성하는 기능부터 채팅 기능까지 사용할 수 있고, 다양한 테마를 다운받아 사용하거나 직접 코드를 수정해서 커뮤니티를 꾸밀 수 있습니다. 마지막으로 AI를 통한 챗봇이나 Data Explorer를 사용한 SQL 분석 기능 등 다양한 범위의 플러그인을 제공하며 이를 직접 개발할 수도 있습니다.</p>
<p align="center">
<img src="https://blog.zarathu.com/posts/2023-11-10-discourse1/img/kakao-dev.png" align="center" width="48%"> <img src="https://blog.zarathu.com/posts/2023-11-10-discourse1/img/twitter-dev.png" align="center" width="48%">
</p>
<p align="center">
<img src="https://blog.zarathu.com/posts/2023-11-10-discourse1/img/ohdsi.png" align="center" width="32%"> <img src="https://blog.zarathu.com/posts/2023-11-10-discourse1/img/posit-community.png" align="center" width="32%"> <img src="https://blog.zarathu.com/posts/2023-11-10-discourse1/img/zoom-dev.png" align="center" width="32%">
</p>
</section>
<section id="discourse-커뮤니티-만들기" class="level2">
<h2 class="anchored" data-anchor-id="discourse-커뮤니티-만들기">Discourse 커뮤니티 만들기</h2>
<p>Discourse는 다양한 설치 방식을 지원하지만 공식적으로 지원되는 유일한 방법은 Docker 기반입니다.</p>
<p>Docker를 사용하면 빌드에 시간이 걸리는 단점이 있지만 Discourse를 제작하는데 사용된 Rails 웹 애플리케이션 프레임워크의 복잡한 설정을 하지 않아도 되며, 쉽게 배포하고 업데이트 할 수 있습니다.</p>
<p>반면에 macOS / Ubuntu / Windows 환경에 직접 설치하는 방법도 공식 GitHub에 자세히 작성되어 있습니다.</p>
<section id="메일서버-설정" class="level3">
<h3 class="anchored" data-anchor-id="메일서버-설정">1. 메일서버 설정</h3>
<p>메일 서비스는 계정 관리, 알림에 쓰이며 필수적으로 구성해야 합니다. 일반적인 Gmail과 같은 서비스가 아닌 transactional 이메일 서버를 사용해야 합니다.</p>
<p>저는 지원되는 이메일 서비스 중 Mailjet을 사용했습니다. Mailjet은 무료 요금제를 사용했을 때 일일 200건/월 6000건의 이메일을 보낼 수 있기에 적합하다고 생각했습니다.</p>
<section id="도메인-인증받기" class="level4">
<h4 class="anchored" data-anchor-id="도메인-인증받기">도메인 인증받기</h4>
<p>Mailjet 서비스에 회원 가입을 했다면 <a href="https://app.mailjet.com/account/sender?type=domain">설정 페이지</a>에 들어가서 도메인을 등록해줍니다.</p>
<p><img src="https://blog.zarathu.com/posts/2023-11-10-discourse1/img/mailjet-1.png" class="img-fluid"></p>
<p>Pending 우측 톱니바퀴 버튼 → Validate → TXT DNS 레코드 등록을 통해서 도메인을 인증해줍니다.</p>
<p><img src="https://blog.zarathu.com/posts/2023-11-10-discourse1/img/mailjet-2.png" class="img-fluid"></p>
<p>도메인 인증이 되었다면 Authenticate this domain 버튼을 클릭해서 SPF 및 DKIM 설정을 진행합니다.</p>
<p><img src="https://blog.zarathu.com/posts/2023-11-10-discourse1/img/mailjet-3.png" class="img-fluid"></p>
<p>TXT DNS 레코드를 추가해서 SPF 및 DomainKeys를 설정해서 mailjet 서비스가 도메인을 사용할 수 있도록 합니다.(반영까지는 시간이 걸릴 수 있으니 새로고침 해주시면 됩니다)</p>
<p><img src="https://blog.zarathu.com/posts/2023-11-10-discourse1/img/mailjet-4.png" class="img-fluid"></p>
<p>설정이 모두 되었다면 위 사진처럼 Active 라고 나옵니다.</p>
</section>
<section id="발신-이메일-정하기" class="level4">
<h4 class="anchored" data-anchor-id="발신-이메일-정하기">발신 이메일 정하기</h4>
<p>도메인 인증 바로 밑에 발송 주소를 정할 수 있는 부분이 있으며 메일의 발송자를 지정할 수 있는 부분입니다.</p>
<p>Discourse는 알림 용도로 메일 서비스를 사용하기 때문에 noreply를 붙여서 설정했습니다.</p>
<p><img src="https://blog.zarathu.com/posts/2023-11-10-discourse1/img/mailjet-5.png" class="img-fluid"></p>
</section>
<section id="api-key-발급받기" class="level4">
<h4 class="anchored" data-anchor-id="api-key-발급받기">API Key 발급받기</h4>
<p><a href="https://app.mailjet.com/account/apikeys">계정관리 페이지</a>에서 Main account의 API KEY를 확인하고 SECRET KEY를 받을 수 있습니다. 추후에 다시 다운받으려면 재발급이 필요하기에 꼭 어딘가에 저장해둬야 합니다.</p>
<p><img src="https://blog.zarathu.com/posts/2023-11-10-discourse1/img/mailjet-6.png" class="img-fluid"></p>
</section>
</section>
<section id="discourse-설치" class="level3">
<h3 class="anchored" data-anchor-id="discourse-설치">2. Discourse 설치</h3>
<p>Discourse를 도커에 설치하는 방법은 <a href="https://github.com/discourse/discourse/blob/main/docs/INSTALL-cloud.md">공식 가이드</a>를 참조했습니다.</p>
<p>먼저 명령어를 실행해서 도커 이미지를 다운로드 받습니다. root 권한은 빌드 등에 필요합니다.</p>
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">$</span> sudo <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-s</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># root 권한 얻기</span></span>
<span id="cb1-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">$</span> git clone https://github.com/discourse/discourse_docker.git /var/discourse</span>
<span id="cb1-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">$</span> cd /var/discourse</span>
<span id="cb1-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">$</span> chmod 700 containers <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 권한설정</span></span>
<span id="cb1-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">$</span> vim containers/discourse.yml <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 설정파일 생성(이름을 다르게 만들어서 구분이 용이하게 하려고 합니다.)</span></span></code></pre></div>
<p>공식 가이드 에서는 <code>discourse-setup</code> 라는 자동 설정 툴을 사용해서 질문에 답변을 하는 형태로 직관적인 설정을 지원하나, 디테일한 설정을 위해 설정 파일을 직접 만들어 주었습니다.</p>
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb2-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">## discourse.yml</span></span>
<span id="cb2-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">## 밑에 expose에서 443을 제외했기 때문에 ssl template를 주석처리 했습니다.</span></span>
<span id="cb2-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">templates:</span></span>
<span id="cb2-4">  <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"templates/postgres.template.yml"</span></span>
<span id="cb2-5">  <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"templates/redis.template.yml"</span></span>
<span id="cb2-6">  <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"templates/web.template.yml"</span></span>
<span id="cb2-7">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">## Uncomment the next line to enable the IPv6 listener</span></span>
<span id="cb2-8">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#- "templates/web.ipv6.template.yml"</span></span>
<span id="cb2-9">  <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"templates/web.ratelimited.template.yml"</span></span>
<span id="cb2-10">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">## Uncomment these two lines if you wish to add Lets Encrypt (https)</span></span>
<span id="cb2-11">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#- "templates/web.ssl.template.yml"</span></span>
<span id="cb2-12">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#- "templates/web.letsencrypt.ssl.template.yml"</span></span>
<span id="cb2-13"></span>
<span id="cb2-14"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">## which TCP/IP ports should this container expose?</span></span>
<span id="cb2-15"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">## If you want Discourse to share a port with another webserver like Apache or nginx,</span></span>
<span id="cb2-16"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">## see https://meta.discourse.org/t/17247 for details</span></span>
<span id="cb2-17"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">## Nginx에서 직접 SSL 설정을 하려고 하므로 443을 제외했습니다.</span></span>
<span id="cb2-18"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">expose:</span></span>
<span id="cb2-19">  <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"80:80"</span>   <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># http</span></span>
<span id="cb2-20">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#  - "443:443" # https</span></span>
<span id="cb2-21"></span>
<span id="cb2-22"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">params:</span></span>
<span id="cb2-23">  <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">db_default_text_search_config:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"pg_catalog.english"</span></span>
<span id="cb2-24"></span>
<span id="cb2-25">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">## Set db_shared_buffers to a max of 25% of the total memory.</span></span>
<span id="cb2-26">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">## will be set automatically by bootstrap based on detected RAM, or you can override</span></span>
<span id="cb2-27">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#db_shared_buffers: "256MB"</span></span>
<span id="cb2-28"></span>
<span id="cb2-29">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">## can improve sorting performance, but adds memory usage per-connection</span></span>
<span id="cb2-30">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#db_work_mem: "40MB"</span></span>
<span id="cb2-31"></span>
<span id="cb2-32">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">## Which Git revision should this container use? (default: tests-passed)</span></span>
<span id="cb2-33">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">## 기본 설정은 beta 버전으로 설치됩니다. 안정성을 위해 stable 버전으로 꼭 지정해주어야 합니다.</span></span>
<span id="cb2-34">  <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">version:</span> v3.1.2</span>
<span id="cb2-35"></span>
<span id="cb2-36"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">## 다중 언어를 지원하므로 꼭 ko로 하지 않아도 됩니다.</span></span>
<span id="cb2-37"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">env:</span></span>
<span id="cb2-38">  <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">LC_ALL:</span> en_US.UTF-8</span>
<span id="cb2-39">  <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">LANG:</span> en_US.UTF-8</span>
<span id="cb2-40">  <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">LANGUAGE:</span> en_US.UTF-8</span>
<span id="cb2-41">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># DISCOURSE_DEFAULT_LOCALE: en</span></span>
<span id="cb2-42"></span>
<span id="cb2-43">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">## How many concurrent web requests are supported? Depends on memory and CPU cores.</span></span>
<span id="cb2-44">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">## will be set automatically by bootstrap based on detected CPUs, or you can override</span></span>
<span id="cb2-45">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#UNICORN_WORKERS: 3</span></span>
<span id="cb2-46"></span>
<span id="cb2-47">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">## Discourse를 배포할 도메인</span></span>
<span id="cb2-48">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">## </span><span class="al" style="color: #AD0000;
background-color: null;
font-style: inherit;">TODO</span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">: The domain name this Discourse instance will respond to</span></span>
<span id="cb2-49">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">## Required. Discourse will not work with a bare IP number.</span></span>
<span id="cb2-50">  <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">DISCOURSE_HOSTNAME:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'community.zarathu.com'</span></span>
<span id="cb2-51"></span>
<span id="cb2-52">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">## Uncomment if you want the container to be started with the same</span></span>
<span id="cb2-53">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">## hostname (-h option) as specified above (default "$hostname-$config")</span></span>
<span id="cb2-54">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#DOCKER_USE_HOSTNAME: true</span></span>
<span id="cb2-55"></span>
<span id="cb2-56">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">## 관리자 이메일</span></span>
<span id="cb2-57">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">## </span><span class="al" style="color: #AD0000;
background-color: null;
font-style: inherit;">TODO</span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">: List of comma delimited emails that will be made admin and developer</span></span>
<span id="cb2-58">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">## on initial signup example 'user1@example.com,user2@example.com'</span></span>
<span id="cb2-59">  <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">DISCOURSE_DEVELOPER_EMAILS:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'office@zarathu.com'</span></span>
<span id="cb2-60"></span>
<span id="cb2-61">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">## 메일서버 설정값</span></span>
<span id="cb2-62">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">## </span><span class="al" style="color: #AD0000;
background-color: null;
font-style: inherit;">TODO</span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">: The SMTP mail server used to validate new accounts and send notifications</span></span>
<span id="cb2-63">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># SMTP ADDRESS, username, and password are required</span></span>
<span id="cb2-64">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># </span><span class="al" style="color: #AD0000;
background-color: null;
font-style: inherit;">WARNING</span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> the char '#' in SMTP password can cause problems!</span></span>
<span id="cb2-65">  <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">DISCOURSE_SMTP_ADDRESS:</span> in-v3.mailjet.com</span>
<span id="cb2-66">  <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">DISCOURSE_SMTP_PORT:</span> 587</span>
<span id="cb2-67">  <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">DISCOURSE_SMTP_USER_NAME:</span> API KEY</span>
<span id="cb2-68">  <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">DISCOURSE_SMTP_PASSWORD:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"SECRET KEY"</span></span>
<span id="cb2-69">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#DISCOURSE_SMTP_ENABLE_START_TLS: true           # (optional, default true)</span></span>
<span id="cb2-70">  <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">DISCOURSE_SMTP_DOMAIN:</span> community.zarathu.com <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># mailjet에 등록한 도메인</span></span>
<span id="cb2-71">  <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">DISCOURSE_NOTIFICATION_EMAIL:</span> noreply@community.zarathu.com <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 등록해둔 발신자 주소</span></span>
<span id="cb2-72"></span>
<span id="cb2-73">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">## If you added the Lets Encrypt template, uncomment below to get a free SSL certificate</span></span>
<span id="cb2-74">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#LETSENCRYPT_ACCOUNT_EMAIL: me@example.com</span></span>
<span id="cb2-75"></span>
<span id="cb2-76">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">## The http or https CDN address for this Discourse instance (configured to pull)</span></span>
<span id="cb2-77">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">## see https://meta.discourse.org/t/14857 for details</span></span>
<span id="cb2-78">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#DISCOURSE_CDN_URL: https://discourse-cdn.example.com</span></span>
<span id="cb2-79">  </span>
<span id="cb2-80">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">## The maxmind geolocation IP address key for IP address lookup</span></span>
<span id="cb2-81">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">## see https://meta.discourse.org/t/-/137387/23 for details</span></span>
<span id="cb2-82">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#DISCOURSE_MAXMIND_LICENSE_KEY: 1234567890123456</span></span>
<span id="cb2-83"></span>
<span id="cb2-84"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">## 도커 컨테이너와 연결될 호스트 볼륨 경로 / 로그파일 경로</span></span>
<span id="cb2-85"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">## The Docker container is stateless; all data is stored in /shared</span></span>
<span id="cb2-86"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">volumes:</span></span>
<span id="cb2-87">  <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-</span> volume:</span>
<span id="cb2-88">      <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">host:</span> /var/discourse/shared/standalone</span>
<span id="cb2-89">      <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">guest:</span> /shared</span>
<span id="cb2-90">  <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-</span> volume:</span>
<span id="cb2-91">      <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">host:</span> /var/discourse/shared/standalone/log/var-log</span>
<span id="cb2-92">      <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">guest:</span> /var/log</span>
<span id="cb2-93"></span>
<span id="cb2-94"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">## 플러그인 설정</span></span>
<span id="cb2-95"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">## 빌드 전/후 실행될 명령어를 작성할 수 있음</span></span>
<span id="cb2-96"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">## Plugins go here</span></span>
<span id="cb2-97"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">## see https://meta.discourse.org/t/19157 for details</span></span>
<span id="cb2-98"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">hooks:</span></span>
<span id="cb2-99">  <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">after_code:</span></span>
<span id="cb2-100">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-</span> exec:</span>
<span id="cb2-101">        <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">cd:</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$home</span>/plugins</span>
<span id="cb2-102">        <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">cmd:</span></span>
<span id="cb2-103">          <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-</span> git clone https://github.com/discourse/docker_manager.git</span>
<span id="cb2-104"></span>
<span id="cb2-105"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">## Any custom commands to run after building</span></span>
<span id="cb2-106"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">run:</span></span>
<span id="cb2-107">  <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-</span> exec: echo <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Beginning of custom commands"</span></span>
<span id="cb2-108">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">## If you want to set the 'From' email address for your first registration, uncomment and change:</span></span>
<span id="cb2-109">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">## After getting the first signup email, re-comment the line. It only needs to run once.</span></span>
<span id="cb2-110">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#- exec: rails r "SiteSetting.notification_email='info@unconfigured.discourse.org'"</span></span>
<span id="cb2-111">  <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-</span> exec: echo <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"End of custom commands"</span></span></code></pre></div>
<p>위 설정 파일은 <code>/var/discourse/sample/standalone.yml</code> 을 베이스로 만들어진 예시입니다.</p>
<p>Discourse는 SSL을 위한 Let’s encrypt 인증서 관리를 자동으로 해주지만 추후에 와일드카드 인증서를 사용하기 위해 비활성화 시켰습니다. 기본 SSL을 활성화 시키려면 설정 파일에서 아래 부분을 수정해주시면 됩니다.</p>
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb3-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">## discourse.yml</span></span>
<span id="cb3-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">templates:</span></span>
<span id="cb3-3">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">...</span></span>
<span id="cb3-4">  <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"templates/web.ssl.template.yml"</span></span>
<span id="cb3-5">  <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"templates/web.letsencrypt.ssl.template.yml"</span></span>
<span id="cb3-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">...</span></span>
<span id="cb3-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">expose:</span></span>
<span id="cb3-8">  <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"80:80"</span>   <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># http</span></span>
<span id="cb3-9">  <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"443:443"</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># https</span></span>
<span id="cb3-10"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">...</span></span>
<span id="cb3-11"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">env:</span></span>
<span id="cb3-12">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">...</span></span>
<span id="cb3-13">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">LETSENCRYPT_ACCOUNT_EMAIL:</span> me@example.com</span></code></pre></div>
<p>Discourse 버전은 <a href="https://github.com/discourse/discourse/tags">공식 GitHub Tags</a> 에서 버전명을 확인한 뒤에 안정적인 최신 버전으로 수정할 수 있습니다.</p>
</section>
<section id="discourse-시작" class="level3">
<h3 class="anchored" data-anchor-id="discourse-시작">3. Discourse 시작</h3>
<p>설정 파일을 저장하고 Discourse를 실행하는 단계입니다. Discours는 bootstrap(빌드)을 하는데 약 2-8분이 소요되므로 설정을 수정하면 꽤 오랜 시간을 기다려야 합니다.</p>
<p>설정 파일의 이름이 <code>discourse.yml</code> 이므로 <strong>파일명을 꼭 명시</strong>해줘야 합니다. 만약 파일명을 잘못 입력한다면 충돌이 일어나서 DB가 초기화될 수 있습니다.(경험담)</p>
<div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb4-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">## /var/discourse/launcher 명령어 설정파일명</span></span>
<span id="cb4-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">$</span> /var/discourse/launcher rebuild discourse</span></code></pre></div>
<p>rebuild 명령어는 아래 3개의 명령어를 실행하는 것과 동일하게 작동합니다. 만약 설정파일을 수정했다면, 간단하게 위 명령어를 사용해서 다시 배포하면 새로운 수정 사항이 반영됩니다.</p>
<div class="sourceCode" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb5-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">## equivalent with launcher rebuild</span></span>
<span id="cb5-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">$</span> /var/discourse/launcher stop discourse</span>
<span id="cb5-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">$</span> /var/discourse/launcher bootstrap discourse</span>
<span id="cb5-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">$</span> /var/discourse/launcher start discourse</span></code></pre></div>
<p>작업이 완료됐다면, 설정 파일에 명시한 HOST_NAME인 <a href="http://community.zarathu.com"><code>http://community.zarathu.com</code></a> 으로 접속할 수 있으며 관리자 계정 생성을 하고 가이드를 따라서 초기 설정을 해주시면 됩니다. (SSL이 비활성화된 상태이므로 http로 접속가능)</p>
</section>
<section id="외부-nginx를-이용한-배포" class="level3">
<h3 class="anchored" data-anchor-id="외부-nginx를-이용한-배포">4. 외부 Nginx를 이용한 배포</h3>
<p>서비스 관리의 단순화, 서버 리소스 효율성, 와일드카드 인증서를 사용하기 위해 단일 Nginx 도커 인스턴스를 사용해서 Discourse를 운영하기로 결정했습니다.</p>
<p>이를 위해 설정 파일을 수정해서 외부 포트 노출을 제거합니다.</p>
<div class="sourceCode" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb6-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">## discourse.yml</span></span>
<span id="cb6-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">...</span></span>
<span id="cb6-3"></span>
<span id="cb6-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">## "80:80" -&gt; "80"</span></span>
<span id="cb6-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">expose:</span></span>
<span id="cb6-6">  <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"80"</span>   <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># http</span></span>
<span id="cb6-7">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#  - "443:443" # https</span></span></code></pre></div>
<p>Docker Network의 Bridge Network를 통해 Nginx와 Discourse 컨테이너를 연결해줍니다. Nginx 컨테이너는 실행되고 있다고 가정합니다.</p>
<div class="sourceCode" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb7-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">## mybridge라는 이름의 bridge 네트워크 생성</span></span>
<span id="cb7-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">$</span> docker network create <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--driver</span> bridge mybridge</span>
<span id="cb7-3"></span>
<span id="cb7-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">## nginx, discourse 컨테이너를 mybridge 네트워크에 연결</span></span>
<span id="cb7-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">$</span> docker network connect mybridge nginx</span>
<span id="cb7-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">$</span> docker network connect mybridge discourse</span></code></pre></div>
<p>Nginx <code>sites-available</code> 설정 파일을 생성합니다.</p>
<div class="sourceCode" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb8-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">## community.conf</span></span>
<span id="cb8-2"></span>
<span id="cb8-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">## 80포트(http)</span></span>
<span id="cb8-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">server</span> {</span>
<span id="cb8-5">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">listen</span> 80<span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb8-6">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">listen</span> <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">[</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">::</span><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">]</span>:80<span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb8-7">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">server_name</span> community.zarathu.com<span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb8-8"></span>
<span id="cb8-9">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">add_header</span> Content-Security-Policy upgrade-insecure-requests<span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb8-10">        </span>
<span id="cb8-11">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">## https로 upgrade</span></span>
<span id="cb8-12">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">location</span> / {</span>
<span id="cb8-13">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">301</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">https://</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$server_name$request_uri</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb8-14">    <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb8-15"><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb8-16"></span>
<span id="cb8-17"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">## 443 포트(https)</span></span>
<span id="cb8-18"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">server</span> {</span>
<span id="cb8-19">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">listen</span> 443 ssl http2<span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb8-20">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">server_name</span> community.zarathu.com<span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb8-21">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">underscores_in_headers</span> on<span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb8-22"></span>
<span id="cb8-23">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">## 따로 만들어둔 와일드카드 인증서 경로</span></span>
<span id="cb8-24">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ssl_certificate</span> /etc/letsencrypt/fullchain.pem<span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb8-25">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ssl_certificate_key</span> /etc/letsencrypt/privkey.pem<span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb8-26">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ssl_protocols</span>        SSLv3 TLSv1 TLSv1.1 TLSv1.2<span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb8-27">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ssl_ciphers</span>          HIGH:!aNULL:!MD5<span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb8-28"></span>
<span id="cb8-29">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">## 보안을 위한 헤더</span></span>
<span id="cb8-30">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">add_header</span> Strict-Transport-Security max-age=31536000<span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb8-31">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">add_header</span> X-Content-Type-Options <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"nosniff"</span> always<span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb8-32">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">add_header</span> X-Frame-Options <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"SAMEORIGIN"</span> always<span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb8-33">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">add_header</span> X-XSS-Protection <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"1; mode=block"</span> always<span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb8-34">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">add_header</span> Content-Security-Policy upgrade-insecure-requests<span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb8-35"></span>
<span id="cb8-36">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ssl_stapling</span> on<span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb8-37">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ssl_stapling_verify</span> on<span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb8-38">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">client_max_body_size</span> 4G<span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">;</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 사이트 업로드 크기 제한</span></span>
<span id="cb8-39"></span>
<span id="cb8-40">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">## Docker network를 이용한 프록시</span></span>
<span id="cb8-41">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">## discourse 컨테이너 내부 80포트로 연결됩니다.</span></span>
<span id="cb8-42">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">location</span> / {</span>
<span id="cb8-43">        <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">proxy_pass</span> http://discourse<span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb8-44"></span>
<span id="cb8-45">        <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">proxy_set_header</span> Host <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$host</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb8-46">        <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">proxy_set_header</span> X-Real-IP <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$remote_addr</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb8-47">        <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">proxy_set_header</span> X-Forwarded-For <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$proxy_add_x_forwarded_for</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb8-48">                <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">proxy_set_header</span> X-Forwarded-Proto https<span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb8-49">                <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">proxy_set_header</span> X-Forwarded-Scheme https<span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb8-50"></span>
<span id="cb8-51">        <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">proxy_buffer_size</span>          128k<span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb8-52">        <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">proxy_buffers</span>              4 256k<span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb8-53">        <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">proxy_busy_buffers_size</span>    256k<span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb8-54">    <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb8-55">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">location</span> = /robots.txt {</span>
<span id="cb8-56">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">200</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"User-agent: *\nDisallow: /"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb8-57">    <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb8-58"><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div>
<p>설정 파일을 활성화 시키기 위해서 <code>sites-enabled</code>에 심볼릭 링크를 생성합니다.</p>
<div class="sourceCode" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb9-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">## nginx 설정 파일 위치는 /etc/nginx 로 가정</span></span>
<span id="cb9-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">$</span> ln <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-s</span> /etc/nginx/sites-available/community.conf /etc/nginx/sites-enabled/community.conf</span></code></pre></div>
<p>변경된 설정을 반영하기 위해 Nginx를 다시 로드해줍니다. 기존에 배포된 서비스의 <strong>중단을 최소화</strong> 하기 위해 reload를 사용했습니다.</p>
<div class="sourceCode" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb10-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">## nginx 컨테이너의 nginx reload 명령 실행</span></span>
<span id="cb10-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">## docker exec -it 컨테이너명 nginx -s reload</span></span>
<span id="cb10-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">$</span> docker exec <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-it</span> nginx nginx <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-s</span> reload</span></code></pre></div>
</section>
<section id="개발-서버를-위한-다중-사이트-구성" class="level3">
<h3 class="anchored" data-anchor-id="개발-서버를-위한-다중-사이트-구성">5. 개발 서버를 위한 다중 사이트 구성</h3>
<p>Discourse는 설정 변경 후 bootstrap(빌드)을 하는데 <strong>매우 많은 시간</strong>이 소요되며 그 동안 기존의 서비스의 운영이 중단됩니다. 또한 여러 설정을 수정하거나 플러그인을 추가했을 때 오류가 발생할 수 있으므로 매우 위험합니다. 따라서 테스트를 할 수 있도록 개발용 Discourse 커뮤니티를 배포하게 되었습니다.</p>
<p>메인 커뮤니티와 동일한 파일 경로를 공유하고 같은 DB를 사용하게 할 수도 있지만 사이트의 안정성을 위해 <strong>완전한 분리</strong>를 하려고 하므로 새로운 discourse를 설치했습니다.</p>
<div class="sourceCode" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb11-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">$</span> git clone https://github.com/discourse/discourse_docker.git /var/discourse-dev</span>
<span id="cb11-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">$</span> cd /var/discourse-dev</span>
<span id="cb11-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">$</span> chmod 700 containers <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 권한설정</span></span>
<span id="cb11-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">$</span> vim containers/discourse-dev.yml <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 설정파일 생성(이름을 다르게 만들어서 구분이 용이하게 하려고 합니다.)</span></span></code></pre></div>
<p>새로운 Discourse 설정 파일을 생성합니다. 대부분의 내용은 메인 커뮤니티와 동일합니다.</p>
<div class="sourceCode" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb12-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">## discourse-dev.yml</span></span>
<span id="cb12-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">...</span></span>
<span id="cb12-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">DISCOURSE_HOSTNAME:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'community.dev.zarathu.com'</span></span>
<span id="cb12-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">...</span></span>
<span id="cb12-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">volumes:</span></span>
<span id="cb12-6">  <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-</span> volume:</span>
<span id="cb12-7">      <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">host:</span> /var/discourse-dev/shared/standalone</span>
<span id="cb12-8">      <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">guest:</span> /shared</span>
<span id="cb12-9">  <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-</span> volume:</span>
<span id="cb12-10">      <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">host:</span> /var/discourse-dev/shared/standalone/log/var-log</span>
<span id="cb12-11">      <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">guest:</span> /var/log</span>
<span id="cb12-12"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">...</span></span></code></pre></div>
<p>개발용 Discourse 커뮤니티를 실행합니다.</p>
<div class="sourceCode" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb13-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">$</span> /var/discourse-dev/launcher rebuild discourse-dev</span></code></pre></div>
<p>이후에 외부 Nginx를 이용한 배포 설정도 메인 커뮤니티 설정과 동일하나 dev 커뮤니티 도메인과 컨테이너 이름 등을 수정해서 배포해 주시면 됩니다.</p>
<p>배포가 완료됐다면 메인 커뮤니티와 개발용 커뮤니티의 데이터를 동기화하기 위해 메인 커뮤니티를 백업합니다.</p>
<p><img src="https://blog.zarathu.com/posts/2023-11-10-discourse1/img/dev-server-1.png" class="img-fluid"></p>
<p>백업이 완료됐다면 목록에 표시되며 다운로드 버튼을 클릭해서 파일로 저장합니다.</p>
<p><img src="https://blog.zarathu.com/posts/2023-11-10-discourse1/img/dev-server-2.png" class="img-fluid"></p>
<p>저장한 파일을 개발 커뮤니티에 업로드한 뒤 복구를 진행하면 메인 커뮤니티의 사용자, 글, 설정 등이 개발용 서버에도 동일하게 적용됩니다.</p>
<p><img src="https://blog.zarathu.com/posts/2023-11-10-discourse1/img/dev-server-3.png" class="img-fluid"></p>
<p>디스코스를 설치 한 다음, 몇가지 커스텀을 거쳐 실제로 사용하는 커뮤니티의 이미지는 다음과 같습니다.</p>
<p><img src="https://blog.zarathu.com/posts/2023-11-10-discourse1/img/community.png" class="img-fluid"></p>
<p><em>이어지는 글에서 커스텀 과정을 소개합니다.</em></p>


</section>
</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-reuse"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div class="quarto-appendix-contents"><div><a rel="license" href="https://creativecommons.org/licenses/by-nc/4.0/">CC BY-NC 4.0</a></div></div></section><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{kim2023,
  author = {Kim, Jisoo},
  title = {Discourse {기반} {커뮤니티} {구축}},
  date = {2023-11-10},
  url = {https://blog.zarathu.com/posts/2023-11-10-discourse1},
  langid = {en}
}
</code></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-kim2023" class="csl-entry quarto-appendix-citeas">
Kim, Jisoo. 2023. <span>“Discourse 기반 커뮤니티 구축.”</span> November
10, 2023. <a href="https://blog.zarathu.com/posts/2023-11-10-discourse1">https://blog.zarathu.com/posts/2023-11-10-discourse1</a>.
</div></div></section></div> ]]></description>
  <category>docker</category>
  <category>website</category>
  <category>discourse</category>
  <category>community</category>
  <guid>https://blog.zarathu.com/posts/2023-11-10-discourse1/</guid>
  <pubDate>Thu, 09 Nov 2023 15:00:00 GMT</pubDate>
  <media:content url="https://blog.zarathu.com/posts/2023-11-10-discourse1/img/logo.png" medium="image" type="image/png" height="42" width="144"/>
</item>
<item>
  <title>Quarto Manuscripts를 이용해 학술 논문 작성하기</title>
  <dc:creator>Jihee Han</dc:creator>
  <link>https://blog.zarathu.com/posts/2023-10-19-quarto-manuscript/</link>
  <description><![CDATA[ <!-- Google tag (gtag.js) --><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-L0DYYSH9KM"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-L0DYYSH9KM');
</script><section id="개요" class="level2"><h2 class="anchored" data-anchor-id="개요">개요</h2>
<p>지난 9월 R Studio 2023.09.0 버전이 공개되었습니다. 새롭게 추가된 여러 기능 중에서 .qmd 파일을 이용해 학술 논문을 작성하고 웹페이지로 발행할 수 있는 <strong>Quarto Manuscript Project</strong>를 소개합니다. 본 게시글은 <a href="https://quarto.org/docs/manuscripts/">Quarto manuscript 공식 문서</a>를 참고해 작성되었습니다.</p>
</section><section id="quarto-manuscript-소개" class="level2"><h2 class="anchored" data-anchor-id="quarto-manuscript-소개">Quarto Manuscript 소개</h2>
<p>Quarto Manuscript는 .qmd 파일을 통해 학술 논문을 작성할 수 있는 프로젝트로, 다음과 같은 장점을 갖습니다.</p>
<ol type="1">
<li>그림, 표, 수식, 인용 정보, 코드 블록 등 학술 논문에 필요한 모든 요소를 포함한 원고를 작성할 수 있습니다.</li>
<li>작성한 원고를 웹사이트로 발행할 수 있어 공유가 쉽습니다.</li>
<li>원고를 PDF, docx, 압축 파일 등 다양한 형식으로 손쉽게 다운로드할 수 있습니다.</li>
</ol>
<p>Quarto Manuscript를 활용해 작성한 학술 논문 예시는 <a href="https://quarto-ext.github.io/manuscript-template-jupyter/">여기</a>에서 확인할 수 있습니다. 이 예시를 참고해 Quarto manuscript 원고를 작성하고 웹사이트로 발행해보겠습니다.</p>
</section><section id="quarto-manuscript로-학술-논문-작성하기" class="level2"><h2 class="anchored" data-anchor-id="quarto-manuscript로-학술-논문-작성하기">Quarto Manuscript로 학술 논문 작성하기</h2>
<section id="준비하기" class="level3"><h3 class="anchored" data-anchor-id="준비하기">1. 준비하기</h3>
<p>Quarto Manuscript를 사용하기에 앞서 (1) <a href="https://posit.co/downloads/">2023.09 버전 이상의 RStudio</a>와 (2) <a href="https://quarto.org/docs/download/prerelease">1.4 버전 이상의 Quarto</a>를 설치해야 합니다.</p>
</section><section id="원고-작성하기" class="level3"><h3 class="anchored" data-anchor-id="원고-작성하기">2. 원고 작성하기</h3>
<p>RStudio에서 <strong>New project &gt; New Directory &gt; Quarto Manuscript</strong>를 선택해 프로젝트를 생성합니다.</p>
<p>학술 논문 원고는 <code>index.qmd</code> 파일에서 작성합니다. 우선 작성할 논문의 제목, 저자, 키워드, 초록과 같은 정보를 아래 예시와 같이 YAML header에 입력합니다.</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>index.qmd</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># YAML head 작성 예시</span></span>
<span id="cb1-2"></span>
<span id="cb1-3"><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">---</span></span>
<span id="cb1-4">title<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> La Palma Earthquakes</span>
<span id="cb1-5">author<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb1-6">  <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> name<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> Steve Purves</span>
<span id="cb1-7">    orcid<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0000-0002-0760-5497</span></span>
<span id="cb1-8">    corresponding<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> true</span>
<span id="cb1-9">    email<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> steve<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">@</span>curvenote.com</span>
<span id="cb1-10">    roles<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb1-11">      <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> Investigation</span>
<span id="cb1-12">      <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> Project administration</span>
<span id="cb1-13">      <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> Software</span>
<span id="cb1-14">      <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> Visualization</span>
<span id="cb1-15">    affiliations<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb1-16">      <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> Curvenote</span>
<span id="cb1-17">  <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> name<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> Rowan Cockett</span>
<span id="cb1-18">    orcid<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0000-0002-7859-8394</span></span>
<span id="cb1-19">    corresponding<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> false</span>
<span id="cb1-20">    roles<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> []</span>
<span id="cb1-21">    affiliations<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb1-22">      <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> Curvenote</span>
<span id="cb1-23">keywords<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb1-24">  <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> La Palma</span>
<span id="cb1-25">  <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> Earthquakes</span>
<span id="cb1-26">abstract<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">|</span></span>
<span id="cb1-27">  In September <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2021</span>, a significant jump <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> seismic activity on the island of La <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">Palma</span> (Canary Islands, Spain) signaled the start of a volcanic crisis that still continues at the time of writing. Earthquake data is continually collected and published by the Instituto Geográphico <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">Nacional</span> (IGN). ...</span>
<span id="cb1-28">plain<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>language<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>summary<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">|</span></span>
<span id="cb1-29">  Earthquake data <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> the island of La Palma from the September <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2021</span> eruption is found ...</span>
<span id="cb1-30">key<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>points<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb1-31">  <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> A web scraping script was developed to pull data from the Instituto Geogràphico Nacional into a machine<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>readable form <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> analysis</span>
<span id="cb1-32">  <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> Earthquake events on La Palma are consistent with the presence of both mantle and crustal reservoirs.</span>
<span id="cb1-33">date<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> last<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>modified</span>
<span id="cb1-34">bibliography<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> references.bib</span>
<span id="cb1-35">citation<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb1-36">  container<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>title<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> Earth and Space Science</span>
<span id="cb1-37">number<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>sections<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> true</span>
<span id="cb1-38"><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">---</span></span></code></pre></div>
</div>
</div>
<p>YAML header 아래에 본문을 작성합니다. 본문은 Quarto markdown 형식으로 작성하며, 기본적인 사용법은 <a href="https://quarto.org/docs/authoring/markdown-basics.html">Quarto Markdown Basics 공식 문서</a> 혹은 R markdown 기초를 다루었던 <a href="https://blog.zarathu.com/posts/2019-01-03-rmarkdown/#r-chunk">이전 게시글</a>에서 참고할 수 있습니다. 본 게시글에서는 논문 작성에 필요한 몇 가지 기능을 중점적으로 살펴보겠습니다.</p>
<section id="sec-figure" class="level4"><h4 class="anchored" data-anchor-id="sec-figure">2.1. figure 삽입하기</h4>
<p>r 코드 블록을 활용해 figure를 삽입할 수 있습니다. 아래 예시와 같이 figure을 생성하는 코드와 함께 figure의 label, caption, alt text, width, height 등을 입력합니다. 본문에는 figure와 캡션만 표시되고 코드는 Article Notebook에서 모아 볼 수 있습니다. 본문에서 <code>@fig-timeline</code>와 같이 <code>@</code> 기호와 figure의 label을 입력하면 figure을 인용할 수 있습니다.</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>index.qmd</strong></pre>
</div>
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># figure 작성 예시</span></span>
<span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ```{r}</span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">eruptions</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1492</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1585</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1646</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1677</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1712</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1949</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1971</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2021</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">n_eruptions</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">eruptions</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ```</span></span>
<span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ```{r}</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#| label: fig-timeline</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#| fig-cap: Timeline of recent earthquakes on La Palma</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#| fig-alt: An event plot of the years of the last 8 eruptions on La Palma.</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#| fig-height: 1.5</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#| fig-width: 6</span></span>
<span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>mar <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">eruptions</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">n_eruptions</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span>, </span>
<span>  pch <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"|"</span>, axes <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/graphics/axis.html">axis</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/graphics/box.html">box</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ```</span></span>
<span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ```{r}</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#| output: false</span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">avg_years_between_eruptions</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/diff.html">diff</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">eruptions</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">n_eruptions</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">]</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">avg_years_between_eruptions</span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#```</span></span></code></pre></div>
</div>
</div>
</section><section id="다른-.qmd-파일에-작성한-plot-삽입하기" class="level4"><h4 class="anchored" data-anchor-id="다른-.qmd-파일에-작성한-plot-삽입하기">2.2. 다른 .qmd 파일에 작성한 plot 삽입하기</h4>
<p>Section&nbsp;3.2.1 에서와 같이 간단한 그림이 아닌, 연구에서 사용된 데이터를 통해 plot을 그리고 이를 본문에 삽입하기 위해서는 디렉토리에 <code>notebooks</code> 폴더를 생성해야 합니다. 생성한 notebooks 폴더 안에 데이터 파일을 넣고 새로운 .qmd 파일을 만들어 plot을 그리는 r 코드 블록을 작성합니다.</p>
<p>이후 <code>index.qmd</code> 파일로 돌아와 아래와 같은 코드를 작성하면 plot이 삽입됩니다.</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>index.qmd</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># explore-earthquakes.qmd 파일에 작성한 fig-spatial-plot 삽입 예시</span></span>
<span id="cb3-2"></span>
<span id="cb3-3">{{<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> embed notebooks<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>explore<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>earthquakes.qmd<span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#fig-spatial-plot &gt;}}</span></span></code></pre></div>
</div>
</div>
<p>notebooks 폴더의 .qmd 파일에서 작성한 코드는 마찬가지로 Article Notebook에서 모아 볼 수 있습니다.</p>
</section><section id="참고문헌-작성하기" class="level4"><h4 class="anchored" data-anchor-id="참고문헌-작성하기">2.3. 참고문헌 작성하기</h4>
<p>참고문헌은 아래 예시와 같이 <code>references.bib</code> 파일에 BibTeX 형태로 작성합니다. <code>index.qmd</code> 파일의 본문에서 <code>@marrero2019</code>와 같이 <code>@</code> 기호와 참고문헌의 label을 입력하면 참고문헌을 인용할 수 있습니다.</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>references.bib</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 참고문헌 작성 예시</span></span>
<span id="cb4-2"></span>
<span id="cb4-3"><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">@</span>article{marrero2019,</span>
<span id="cb4-4">  author <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> {Marrero, Jos{\<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">' e} and Garc{</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\'</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;"> i}a, Alicia and Berrocoso, Manuel and Llinares, {</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\'</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;"> A}ngeles and Rodr{</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\'</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;"> i}guez-Losada, Antonio and Ortiz, R.},</span></span>
<span id="cb4-5"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  journal = {Journal of Applied Volcanology},</span></span>
<span id="cb4-6"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  year = {2019},</span></span>
<span id="cb4-7"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  month = {7},</span></span>
<span id="cb4-8"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  pages = {},</span></span>
<span id="cb4-9"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  title = {Strategies for the development of volcanic hazard maps in monogenetic volcanic fields: the example of {La} {Palma} ({Canary} {Islands})},</span></span>
<span id="cb4-10"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  volume = {8},</span></span>
<span id="cb4-11"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  doi = {10.1186/s13617-019-0085-5},</span></span>
<span id="cb4-12"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div>
</div>
</div>
</section><section id="journal-template-적용하기" class="level4"><h4 class="anchored" data-anchor-id="journal-template-적용하기">2.4. journal template 적용하기</h4>
<p>journal template은 PDF에 적용됩니다. .qmd 파일을 PDF 파일로 내보내려면 <code>tinytex</code> 패키지가 설치되어 있어야 합니다. 아래 코드를 통해 패키지를 설치하겠습니다.</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>console</strong></pre>
</div>
<div class="sourceCode" id="cb5" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># tinytex 설치 후 로드</span></span>
<span></span>
<span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/utils/installed.packages.html">installed.packages</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"tinytex"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tinytex</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/pkg/tinytex/man/install_tinytex.html">install_tinytex</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span></span>
<span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;"><a href="https://github.com/rstudio/tinytex">tinytex</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span></code></pre></div>
</div>
</div>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>console</strong></pre>
</div>
<div class="sourceCode" id="cb6" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 패키지 설치 확인(True가 출력되면 성공적으로 설치된 것임)</span></span>
<span></span>
<span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tinytex</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/pkg/tinytex/man/is_tinytex.html">is_tinytex</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span></code></pre></div>
</div>
</div>
<p>journal format을 추가하기 위해 <a href="https://quarto.org/docs/extensions/listing-journals.html">Quarto Extensions: Journal Articles</a>를 참고해 터미널에 아래 코드를 실행시켜 익스텐션을 설치합니다.</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>terminal</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># acs format 설치 예시</span></span>
<span id="cb7-2"></span>
<span id="cb7-3">quarto install extension quarto<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>journals<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>acs</span></code></pre></div>
</div>
</div>
<p>이후 <code>_quarto.yml</code> 파일의 <code>format:</code>에 <code>acs-pdf: default</code>를 추가하면 acs format이 적용됩니다.</p>
<p>웹페이지를 발행한 뒤 PDF 파일을 다운로드하면 아래와 같이 journal format이 적용된 것을 확인할 수 있습니다.</p>
<figure style="text-align: center;" class="figure"><div>

</div>
<div class="quarto-layout-panel" data-layout-ncol="2">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<p><img src="https://blog.zarathu.com/posts/2023-10-19-quarto-manuscript/img/acs.png" width="500px" class="figure-img"></p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<p><img src="https://blog.zarathu.com/posts/2023-10-19-quarto-manuscript/img/elsevier.png" width="500px" class="figure-img"></p>
</div>
</div>
</div>
<figcaption>
(좌) acs format, (우) elsevier format 적용 예시
</figcaption></figure></section></section><section id="깃허브-페이지를-통해-웹으로-발행하기" class="level3"><h3 class="anchored" data-anchor-id="깃허브-페이지를-통해-웹으로-발행하기">3. 깃허브 페이지를 통해 웹으로 발행하기</h3>
<p>원고를 깃허브 페이지를 통해 웹으로 발행하기 위해 <code>_quarto.yml</code>파일의 <code>project:</code>에 <code>output-dir: docs</code> 설정을 추가합니다. 이후 <code>index.qmd</code> 파일으로 돌아와 터미널에 <code>quarto render</code>을 입력합니다. 모든 변경사항을 깃허브에 commit 후 push 하면, 원고가 깃허브 페이지를 통해 웹으로 발행됩니다. 깃허브의 해당 레포지토리의 <strong>settings &gt; pages</strong>에서 웹페이지 링크를 확인할 수 있습니다.</p>
</section></section><section id="마치며" class="level2"><h2 class="anchored" data-anchor-id="마치며">마치며</h2>
<p>이번 게시글에서는 새롭게 공개된 Quarto Manuscript를 통해 학술 논문 원고를 작성하고 깃허브 페이지를 통해 웹으로 발행하는 방법을 알아보았습니다. Quarto Manuscript를 통해 논문 작성과 공유가 더욱 편리하게 이루어지기를 기대하며 글을 마칩니다.</p>


</section><div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-reuse"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div class="quarto-appendix-contents"><div><a rel="license" href="https://creativecommons.org/licenses/by-nc/4.0/">CC BY-NC 4.0</a></div></div></section><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{han2023,
  author = {Han, Jihee},
  title = {Quarto {Manuscripts를} {이용해} {학술} {논문} {작성하기}},
  date = {2023-10-18},
  url = {https://blog.zarathu.com/posts/2023-10-19-quarto-manuscript},
  langid = {en}
}
</code></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-han2023" class="csl-entry quarto-appendix-citeas">
Han, Jihee. 2023. <span>“Quarto Manuscripts를 이용해 학술 논문
작성하기.”</span> October 18, 2023. <a href="https://blog.zarathu.com/posts/2023-10-19-quarto-manuscript">https://blog.zarathu.com/posts/2023-10-19-quarto-manuscript</a>.
</div></div></section></div> ]]></description>
  <category>R</category>
  <category>quarto</category>
  <category>quarto manuscript</category>
  <category>article</category>
  <guid>https://blog.zarathu.com/posts/2023-10-19-quarto-manuscript/</guid>
  <pubDate>Tue, 17 Oct 2023 15:00:00 GMT</pubDate>
  <media:content url="https://blog.zarathu.com/posts/2023-10-19-quarto-manuscript/img/logo.png" medium="image" type="image/png" height="35" width="144"/>
</item>
<item>
  <title>R로 만든 PPT 슬라이드 고해상도로 저장하기</title>
  <dc:creator>Jihee Han</dc:creator>
  <link>https://blog.zarathu.com/posts/2023-09-27-high-dpi-slide/</link>
  <description><![CDATA[ <!-- Google tag (gtag.js) --><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-L0DYYSH9KM"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-L0DYYSH9KM');
</script><section id="개요" class="level2"><h2 class="anchored" data-anchor-id="개요">개요</h2>
<p><a href="https://blog.zarathu.com/posts/2023-07-01-officer/" target="_blank"> 지난 게시글</a>에서 <code>officer</code> 패키지를 활용해 R으로 만든 그림을을 벡터 이미지로 저장하는 방법을 다루었습니다. 이렇게 저장한 벡터 이미지는 확대를 해도 깨지지 않고 파워포인트에서 편집이 가능하다는 장점이 있습니다. 하지만 파워포인트 슬라이드를 그림으로 내보내기하면 저해상도의 이미지로 저장된다는 문제가 있습니다. 따라서 이번 글에서는 파워포인트로 저장한 벡터 이미지를 300DPI의 고해상도로 내보내는 방법을 알아보고자 합니다.</p>
</section><section id="dpi란" class="level2"><h2 class="anchored" data-anchor-id="dpi란">DPI란?</h2>
<div style="text-align: center;">
<figure style="display: inline-block;" class="figure"><img src="https://blog.zarathu.com/posts/2023-09-27-high-dpi-slide/img/DPI.png" text-align="center" class="figure-img"><figcaption>
이미지 출처: https://itwiki.kr/w/DPI
</figcaption></figure>
</div>
<p>DPI란 <strong>Dot Per Inch</strong>의 약자로, 인쇄물에서 1인치(= 2.54cm)에 몇 개의 점이 찍히는지를 나타내는 단위입니다. DPI 값이 높을 수록 고해상도의 결과물을 얻을 수 있으며, 깨끗한 이미지를 얻기 위해서는 300DPI 이상이 권장됩니다.</p>
</section><section id="고해상도로-슬라이드-내보내기" class="level2"><h2 class="anchored" data-anchor-id="고해상도로-슬라이드-내보내기">고해상도로 슬라이드 내보내기</h2>
<section id="officer-패키지를-사용해-파워포인트로-이미지-저장하기" class="level3"><h3 class="anchored" data-anchor-id="officer-패키지를-사용해-파워포인트로-이미지-저장하기">1. officer 패키지를 사용해 파워포인트로 이미지 저장하기</h3>
<p>우선 지난 게시글에서 다루었던 <code>officer</code>과 <code>rvg</code> 패키지를 활용해 벡터 이미지를 파워포인트로 저장하겠습니다.</p>
<div class="cell">
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;"><a href="https://ardata-fr.github.io/officeverse/">officer</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;"><a href="https://ardata-fr.github.io/officeverse/">rvg</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 이미지 생성</span></span>
<span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">plotObj</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">iris</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>x <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">Sepal.Length</span>, y <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">Sepal.Width</span>, color <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">Species</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span></span>
<span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ppt</span></span>
<span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://davidgohel.github.io/officer/reference/read_pptx.html">read_pptx</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ppt 생성, 별도의 오브젝트로 저장하지 않아도 됨.</span></span>
<span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://davidgohel.github.io/officer/reference/add_slide.html">add_slide</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 슬라이드 추가</span></span>
<span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://davidgohel.github.io/officer/reference/ph_with.html">ph_with</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 이미지 추가</span></span>
<span>    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://davidgohel.github.io/rvg/reference/dml.html">dml</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>ggobj <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">plotObj</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span>, </span>
<span>    location <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://davidgohel.github.io/officer/reference/ph_location_fullsize.html">ph_location_fullsize</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> </span>
<span>  <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'image.pptx'</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ppt 저장 </span></span></code></pre></div>
</div>
<p>파워포인트의 <strong>파일</strong> 탭에서 <strong>다른 이름으로 저장/이미지로 저장</strong>을 선택하면 슬라이드가 각각 JPEG 파일로 저장됩니다. 저장된 이미지의 속성을 살펴보면 파워포인트 이미지 내보내기의 디폴드 해상도인 <strong>96DPI</strong>로 저장된 것을 확인할 수 있습니다.</p>
<div class="columns" style="text-align: center;">
<div class="column" style="width:70%;">
<figure class="figure"><img src="https://blog.zarathu.com/posts/2023-09-27-high-dpi-slide/img/lowResolution.png" width="80%" class="figure-img"></figure>
</div><div class="column" style="width:30%;">
<figure class="figure"><img src="https://blog.zarathu.com/posts/2023-09-27-high-dpi-slide/img/dpi96.png" width="90%" class="figure-img"></figure>
</div>
</div>
</section><section id="내보내기-해상도-설정-변경하기" class="level3"><h3 class="anchored" data-anchor-id="내보내기-해상도-설정-변경하기">2. 내보내기 해상도 설정 변경하기</h3>
<p>슬라이드를 고해상도 이미지로 저장하려면, 파워포인트의 내보내기 해상도 설정을 변경해야 합니다. 설정을 변경하기에 앞서, 모든 Windows 기반 프로그램을 종료하시길 바랍니다. 실행 중인 프로그램은 <code>Ctrl + Shift + ESC</code> 단축키를 통해 확인할 수 있습니다.</p>
<ol type="1">
<li><p><strong>시작</strong> 단추를 우클릭한 뒤, <strong>실행</strong>을 선택합니다.</p></li>
<li><p><strong>열기</strong> 상자에 <strong>regedit</strong>을 입력한 다음 <strong>확인</strong>을 선택합니다.</p></li>
<li>
<p>사용 중인 파워포인트 버전에 따라 아래 레지스트리 하위 키를 찾습니다.</p>
<p>파워포인트 버전별 레지스트리 하위 키는 다음과 같습니다.</p>
<figure class="figure"><p><img src="https://blog.zarathu.com/posts/2023-09-27-high-dpi-slide/img/key.png" width="80%" class="figure-img"></p>
</figure>
</li>
<li><p><strong>Option</strong> 하위 키를 선택하고, <strong>편집</strong> 탭의 <strong>새로 만들기/DWORD(32비트) 값</strong>을 선택합니다</p></li>
<li><p><strong>ExportBitmapResolution</strong>을 입력한 다음 엔터키를 누릅니다.</p></li>
<li><p><strong>ExportBitmapResolution</strong>이 선택되어 있는지 확인한 다음 <strong>편집</strong> 탭의 <strong>수정</strong>을 선택합니다.</p></li>
<li><p><strong>DWORD 값 편집</strong> 대화 상자에서 <strong>10진수</strong>를 선택한 뒤, <strong>값 데이터</strong>에 <strong>300</strong>을 입력하고 <strong>확인</strong>을 선택합니다.</p></li>
</ol>
<figure style="text-align: center;" class="figure"><img src="https://blog.zarathu.com/posts/2023-09-27-high-dpi-slide/img/editor.png" width="70%" class="figure-img"></figure><ol start="8" type="1">
<li>
<strong>파일</strong> 메뉴에서 <strong>끝내기</strong>를 선택해 레지스트리 편집기를 종료합니다.</li>
</ol></section><section id="슬라이드를-고해상도-그림으로-내보내기" class="level3"><h3 class="anchored" data-anchor-id="슬라이드를-고해상도-그림으로-내보내기">3. 슬라이드를 고해상도 그림으로 내보내기</h3>
<p>앞서 저장했던 파워포인트 파일을 다시 열어 <strong>파일</strong> 탭의 <strong>다른 이미지로 저장/이미지로 저장</strong>을 선택해 다시 슬라이드를 JPEG 파일로 저장합니다. 이번에는 <strong>300DPI</strong>의 고해상도 이미지로 잘 저장된 것을 확인할 수 있습니다.</p>
<div class="columns" style="text-align: center;">
<div class="column" style="width:70%;">
<figure class="figure"><img src="https://blog.zarathu.com/posts/2023-09-27-high-dpi-slide/img/highResolution.png" width="80%" class="figure-img"></figure>
</div><div class="column" style="width:30%;">
<figure class="figure"><img src="https://blog.zarathu.com/posts/2023-09-27-high-dpi-slide/img/dpi300.png" width="90%" class="figure-img"></figure>
</div>
</div>
</section></section><section id="정리" class="level2"><h2 class="anchored" data-anchor-id="정리">정리</h2>
<p>이번 글에서는 레지스트리 편집기에서 해상도 설정을 변경하여 파워포인트 슬라이드를 고해상도 이미지로 내보내는 방법에 대해 알아보았습니다. <code>officer</code> 패키지를 다룬 지난 글과 함께 R을 통해 이미지를 자유자재로 다루는 데 도움이 되기를 기대합니다.</p>


</section><div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-reuse"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div class="quarto-appendix-contents"><div><a rel="license" href="https://creativecommons.org/licenses/by-nc/4.0/">CC BY-NC 4.0</a></div></div></section><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{han2023,
  author = {Han, Jihee},
  title = {R로 {만든} {PPT} {슬라이드} {고해상도로} {저장하기}},
  date = {2023-09-27},
  url = {https://blog.zarathu.com/posts/2023-09-27-high-dpi-slide},
  langid = {en}
}
</code></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-han2023" class="csl-entry quarto-appendix-citeas">
Han, Jihee. 2023. <span>“R로 만든 PPT 슬라이드 고해상도로
저장하기.”</span> September 27, 2023. <a href="https://blog.zarathu.com/posts/2023-09-27-high-dpi-slide">https://blog.zarathu.com/posts/2023-09-27-high-dpi-slide</a>.
</div></div></section></div> ]]></description>
  <category>R</category>
  <category>powerpoint</category>
  <category>visualization</category>
  <guid>https://blog.zarathu.com/posts/2023-09-27-high-dpi-slide/</guid>
  <pubDate>Tue, 26 Sep 2023 15:00:00 GMT</pubDate>
  <media:content url="https://blog.zarathu.com/posts/2023-09-27-high-dpi-slide/img/DPI.png" medium="image" type="image/png" height="86" width="144"/>
</item>
<item>
  <title>electron forge를 활용하여 Standalone Shiny Application 제작하기</title>
  <dc:creator>Jinhwan Kim</dc:creator>
  <link>https://blog.zarathu.com/posts/2023-09-18-shinyexe/</link>
  <description><![CDATA[ 
<!-- Google tag (gtag.js) -->

<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-L0DYYSH9KM"></script>

<script>

  window.dataLayer = window.dataLayer || [];

  function gtag(){dataLayer.push(arguments);}

  gtag('js', new Date());



  gtag('config', 'G-L0DYYSH9KM');

</script>





<section id="개요" class="level2">
<h2 class="anchored" data-anchor-id="개요">개요</h2>
<p>이번 글에서는 R Shiny 앱을 별도의 설치나 외부 연결 없이 폐쇄 환경에서도 실행할 수 있는 (Standalone) <strong>exe</strong> 파일로 패키징하는 과정을 소개합니다.</p>
</section>
<section id="standalone-app" class="level2">
<h2 class="anchored" data-anchor-id="standalone-app">Standalone App</h2>
<p>먼저 글의 맥락을 더 효과적으로 전달하기 위해 <strong>Standalone App</strong>에 대해 간단히 정의해보겠습니다.</p>
<p><em>An app that can run independently without any external help.</em></p>
<p>즉, 외부에 의존하지 않고 독립적으로 실행 가능한 앱으로 정의하고 싶은데요.</p>
<p>여기서 <strong>외부</strong>에는 보통 Shiny를 실행하기 위해 쓰이는 웹 브라우저(크롬)가 포함될 수 있습니다.</p>
<p>한편, R과 Rstudio 또한 Shiny를 실행하기 위해서 (로컬에서) 필요한 <strong>외부</strong>로 볼 수 있습니다.</p>
<p>이러한 외부의 도움을 받지 않고, 다운로드 이후 압축만 풀어서 바로 실행할 수 있는 것을 Standalone App이라고 하며, 이러한 예시에는 (아는 사람은 아는 ㅎㅎ) <strong>피카츄 배구.exe</strong>가 있습니다.</p>
<p style="text-align: center;">
<img src="https://blog.zarathu.com/posts/2023-09-18-shinyexe/img/pikachu.png" width="100%" text-align="center">
</p>
<p><em>출처: https://gbworld.tistory.com/1362</em></p>
<p>이후 내용에서 소개되는 Shiny를 standalone app으로 만드는 것은 일반적인 R Shiny 개발과는 상당히 다르고 동시에 복잡합니다.</p>
<p>그렇다면 Standalone app으로 만드는 것은 Shiny를 사용자에게 제공하는 다른 방법들과 어떤 차이점이 있을까요?</p>
<p style="text-align: center;">
<img src="https://blog.zarathu.com/posts/2023-09-18-shinyexe/img/flow.png" width="100%" text-align="center">
</p>
<p>이에는 여러가지를 생각해 볼 수 있지만 크게 2가지의 차이점이 있습니다.</p>
<ol type="1">
<li>사용자 경험</li>
</ol>
<p>electron으로 만들어진 <strong>Standalone App은 Shiny를 제공하는 서버와의 네트워크 연결이 불필요</strong>합니다. Shiny를 사용하기 위해 브라우저를 열고 특정 URL에 접속하는 대신 설치된 프로그램을 실행하는 것으로 충분합니다.</p>
<p>이로 인해 네트워크와의 데이터를 주고 받는 과정에 리소스가 쓰이지 않고, 사용자의 (로컬 PC) 자원을 활용하기 때문에 살짝 더 좋은 퍼포먼스를 보일 수 있습니다.</p>
<ol start="2" type="1">
<li>폐쇄성 환경</li>
</ol>
<p>또한 네트워크가 연결되지 않는다는 점은 <strong>shiny에 입력하는 값이 사용자의 PC 외부로 나가지 않고, 동시에 외부의 리소스가 PC에 들어오지 않는다</strong>는 이야기이기도 합니다.</p>
<p>그렇기 때문에 금융이나 병원등 망분리 / 폐쇄 되어 있는 개발 환경에서도 Shiny를 실행할 수 있고 더 뛰어난 보안성을 가지게 됩니다. (단, Shiny가 계산을 위해 외부의 API 같은 자원을 사용하려면 네트워크 연결이 필요합니다)</p>
</section>
<section id="electron" class="level2">
<h2 class="anchored" data-anchor-id="electron">Electron</h2>
<p>Electron (정확히는 <a href="https://www.electronjs.org/" target="_blank">electron.js</a>) 은 크로미움 (크롬)과 node.js를 활용하여 html과 css, js 같은 웹 개발 결과물 (shiny가 이에 포함됩니다) 을 임베디드 형태로 만들 수 있는 프레임워크입니다.</p>
<p style="text-align: center;">
<img src="https://blog.zarathu.com/posts/2023-09-18-shinyexe/img/electron.png" width="100%" text-align="center">
</p>
<p>Standalone App을 만들기 위해서 electron의 기술적인 원리를 이해할 필요는 없지만, 흐름을 표현하면 아래와 같습니다.</p>
<p style="text-align: center;">
<img src="https://blog.zarathu.com/posts/2023-09-18-shinyexe/img/electron-shiny.webp" width="100%" text-align="center">
</p>
<p>이 기술을 활용하여 shiny로 standalone app을 만들려는 시도는 꽤 오래 전부터 있었고, 2020년에 공유된 <a href="https://www.r-bloggers.com/2020/10/turn-a-shiny-application-into-a-tablet-or-desktop-app/" target="_blank">Turn a shiny application into a tablet or desktop app</a> 아티클도 있지만, 관련된 자료들이 2022년을 마지막으로 아카이브되어 업데이트 되지 않았기 때문에 최신의 내용을 반영한 업데이트가 필요했습니다.</p>
<p>차라투에서는 연구를 통해 기존의 내용 중 일부를 최적화하고, 최근 내용들을 반영한 뒤, <a href="https://github.com/zarathucorp/shiny-electron-template-windows-2023" target="_blank">Windows</a>와 <a href="https://github.com/zarathucorp/shiny-electron-template-m1-2023" target="_blank">M1 Mac</a> 2개의 OS에서 Standalone App을 개발하여 분리 환경에서 Shiny를 사용해야 하는 (공공기관을 포함한) 고객에게 제공하였고, 이후 개발에 활용할 수 있는 템플릿과 가이드를 제공하고 있습니다.</p>
<p><em>국내에는 윈도우 사용자가 더 많기 때문에, 이번 글에서는 윈도우를 기준으로 방법을 소개합니다.</em></p>
</section>
<section id="개발-준비" class="level2">
<h2 class="anchored" data-anchor-id="개발-준비">개발 준비</h2>
<p>Standalone shiny app을 개발하기 위해 shiny 개발에 필요한 R과 Rstudio 외에 추가 설치가 필요합니다.</p>
<section id="node.js-설치" class="level3">
<h3 class="anchored" data-anchor-id="node.js-설치">1. <a href="https://nodejs.org/ko" target="_blank">node.js</a> 설치</h3>
<p><em>글이 작성되는 23년 9월을 기준으로, LTS인 18.17.1 버전을 설치합니다.</em></p>
<p style="text-align: center;">
<img src="https://blog.zarathu.com/posts/2023-09-18-shinyexe/img/node.png" width="100%" text-align="center">
</p>
<p>이제 Rstudio를 <strong>관리자 권한으로 실행</strong>합니다. (아이콘을 오른쪽 클릭 후 선택)</p>
<p>정상적으로 설치가 되었다면 Rstudio의 터미널에서 <code>node -v</code>, <code>npm -v</code>를 실행하여 설치 버전을 확인할 수 있습니다.</p>
</section>
<section id="electron-forge-설치" class="level3">
<h3 class="anchored" data-anchor-id="electron-forge-설치">2. electron-forge 설치</h3>
<p><code>electron-forge</code>는 electron을 조금 더 쉽게 사용할 수 있게 하는 패키지라고 생각하셔도 좋습니다.</p>
<p>이는 npm을 사용해 (R의 <code>install.packages</code>와 유사) 설치할 수 있으며, 마찬가지로 Rstudio의 터미널에서 아래의 명령어를 입력하여 설치합니다.</p>
<p><code>npm i -g @electron-forge/cli</code></p>
</section>
<section id="템플릿-포크-클론" class="level3">
<h3 class="anchored" data-anchor-id="템플릿-포크-클론">3. 템플릿 포크 / 클론</h3>
<p>차라투 github에서 제공하는 템플릿을 자신의 계정에 포크 후, 클론하여 로컬 PC에 다운로드 받습니다.</p>
<p><a href="https://github.com/zarathucorp/shiny-electron-template-windows-2023" class="uri">https://github.com/zarathucorp/shiny-electron-template-windows-2023</a></p>
<div class="columns" style="text-align: center;">
<div class="column">
<p style="text-align: center;">
<img src="https://blog.zarathu.com/posts/2023-09-18-shinyexe/img/fork.png" width="100%" text-align="center">
</p>
</div><div class="column">
<p style="text-align: center;">
<img src="https://blog.zarathu.com/posts/2023-09-18-shinyexe/img/clone.png" width="100%" text-align="center">
</p>
</div>
</div>
</section>
<section id="r-project-열기" class="level3">
<h3 class="anchored" data-anchor-id="r-project-열기">4. R project 열기</h3>
<p>템플릿 폴더의 <strong>shiny-elecgtron-template-windows-2023.Rproj</strong>를 Rstudio에서 실행합니다.</p>
<p>이제 Rstudio 터미널의 작업 디렉토리가 해당 프로젝트의 위치로 변경됩니다.</p>
</section>
</section>
<section id="electron-app-만들기" class="level2">
<h2 class="anchored" data-anchor-id="electron-app-만들기">Electron App 만들기</h2>
<section id="electron-app-템플릿을-설치" class="level3">
<h3 class="anchored" data-anchor-id="electron-app-템플릿을-설치">1. electron app 템플릿을 설치</h3>
<p>Rstudio의 터미널에서 <code>npx create-electron-app myApp</code>을 실행하여 템플릿을 설치합니다.</p>
<p>이때 <code>myApp</code>이 Standalone App의 이름이 되며 <code>app</code>을 제외한 다른 이름으로 변경할 수 있습니다.</p>
<p>정상적으로 실행되었다면 디렉토리에 <code>myApp</code> 폴더가 새롭게 생기는 것을 확인할 수 있습니다.</p>
<p style="text-align: center;">
<img src="https://blog.zarathu.com/posts/2023-09-18-shinyexe/img/myApp.png" width="100%" text-align="center">
</p>
</section>
<section id="github-템플릿의-파일을-myapp으로-이동" class="level3">
<h3 class="anchored" data-anchor-id="github-템플릿의-파일을-myapp으로-이동">2. github 템플릿의 파일을 myApp으로 이동</h3>
<p>electron app 에서 기본으로 제공하는 템플릿은 shiny를 개발하기에는 약간 다른 내용들이 있어서 차라투 github에 제공된 파일로 교체합니다.</p>
<p>이때 만들어진 myApp으로 이동해야 하는 파일은 아래의 5개입니다.</p>
<ul>
<li>shiny (폴더)</li>
<li>src (폴더)</li>
<li>add-cran-binary-pkgs.R</li>
<li>get-r-win.sh</li>
<li>start-shiny.R</li>
</ul>
<p style="text-align: center;">
<img src="https://blog.zarathu.com/posts/2023-09-18-shinyexe/img/move.png" width="100%" text-align="center">
</p>
<p>이후 Rstudio의 터미널에서 <code>cd myApp</code>으로 디렉토리를 이동합니다.</p>
</section>
<section id="standalone-r-설치" class="level3">
<h3 class="anchored" data-anchor-id="standalone-r-설치">3. Standalone R 설치</h3>
<p>electron 에 포함 시킬 local R을 현재 프로젝트에 설치합니다.</p>
<p>단, 이때 기존에 사용중인 R의 버전과 동일한 버전을 설치해야 하며, 23년 9월에 최신 버전인 4.3.1을 기준으로 사용합니다.</p>
<p>local R은 Rstudio의 터미널에서 <code>sh ./get-r-win.sh</code>를 실행하는 것으로 설치할 수 있습니다.</p>
<p>정상적으로 실행되었다면 <strong>Done.</strong> 메세지와 함께 폴더에 <code>r-win</code> 이라는 폴더가 새롭게 만들어 진 것을 확인할 수 있습니다. <code>r-win</code> 내부의 구조는 아래와 같습니다.</p>
<p style="text-align: center;">
<img src="https://blog.zarathu.com/posts/2023-09-18-shinyexe/img/r-win.png" width="100%" text-align="center">
</p>
</section>
<section id="shiny-패키지-설치" class="level3">
<h3 class="anchored" data-anchor-id="shiny-패키지-설치">4. Shiny 패키지 설치</h3>
<p>예시에서 사용하는 shiny는 shiny 폴더의 <code>app.R</code> 코드를 사용합니다. (shiny 외의 다른 패키지를 사용하지 않는다면 해당 코드로 바꿔도 작동합니다) 이를 실행하기 위해 기본 R 에서 제공하는 패키지외에 (shiny를 포함한) 추가 CRAN 패키지를 설치합니다.</p>
<p>Rstudio의 터미널에서 <code>Rscript add-cran-binary-pkgs.R</code>을 입력하여 패키지를 설치합니다.</p>
<p>실행전 (기본 R 패키지)</p>
<p style="text-align: center;">
<img src="https://blog.zarathu.com/posts/2023-09-18-shinyexe/img/before.png" width="100%" text-align="center">
</p>
<p>실행후 (<strong>shiny를 포함한</strong> 패키지)</p>
<p style="text-align: center;">
<img src="https://blog.zarathu.com/posts/2023-09-18-shinyexe/img/after.png" width="100%" text-align="center">
</p>
</section>
<section id="node-패키지-설치" class="level3">
<h3 class="anchored" data-anchor-id="node-패키지-설치">5. node 패키지 설치</h3>
<p>package.json의 내용을 다음과 같이 <code>[fix] package-json</code>의 내용으로 복사 붙여넣기합니다.</p>
<p>이때 <code>author</code>와 <code>repository</code>는 본인의 내용에 맞게 수정해야합니다.</p>
<p style="text-align: center;">
<img src="https://blog.zarathu.com/posts/2023-09-18-shinyexe/img/package-json.png" width="100%" text-align="center">
</p>
<p>이후 Rstudio 터미널에서 <code>npm install</code>을 입력하여 패키지를 설치할 수 있습니다.</p>
</section>
</section>
<section id="shiny-실행-및-패키징" class="level2">
<h2 class="anchored" data-anchor-id="shiny-실행-및-패키징">Shiny 실행 및 패키징</h2>
<p><code>app.R</code>은 개발 의도대로, 정상적으로 실행된다는 가정하에 Electron으로 shiny 를 실행하기 위해 Rstudio의 터미널에 <code>electron-forge start</code>를 입력합니다.</p>
<p style="text-align: center;">
<img src="https://blog.zarathu.com/posts/2023-09-18-shinyexe/img/start.gif" width="100%" text-align="center">
</p>
<p>큰 문제 없이 실행이 되었다면 이제 <code>electron-forge make</code>로 패키지를 만들 차례입니다.(zip)</p>
<p>패키지 빌드를 위한 약간의 시간이 지난 후 <code>out</code> 디렉토리에서 앱과 zip 파일을 확인할 수 있습니다.</p>
</section>
<section id="정리" class="level2">
<h2 class="anchored" data-anchor-id="정리">정리</h2>
<p>이번 글에서는 Standalone의 특징과 electron을 활용하여 shiny를 standalone app으로 만드는 방법을 다뤄봤습니다.</p>
<p>Electron을 활용하여 Standalone Shiny app을 만드는 것은 소개된 것처럼 R외의 개발 지식을 필요로 하기 때문에 경험이 없다면 다소 복잡하게 느껴질 수 있습니다. (글에서 다루지 않은 내용들도 있습니다)</p>
<p>특히 electron 내부에서 local R과 electron을 위한 node 패키지들을 이미 포함해야 하기 때문에 간단한 shiny app도 용량이 200 메가바이트 정도부터 시작한다는 치명적인 단점도 존재합니다.</p>
<p>그럼에도 불구하고 이는 Standalone 특유의 몇가지 특징들이 있어 사용자의 환경에 따라 적합한 shiny 개발 방법으로 고려해볼 수 있는 선택지 중 하나입니다.</p>
<div class="callout callout-style-simple callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
🤗 Let’s talk
</div>
</div>
<div class="callout-body-container callout-body">
<p>차라투에서는 R과 Shiny에 대한 컨설팅을 제공합니다. 진행중인 프로젝트 관련하여 도움이 필요하시다면 jinhwan@zarathu.com 으로 알려주세요!</p>
</div>
</div>


</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-reuse"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div class="quarto-appendix-contents"><div><a rel="license" href="https://creativecommons.org/licenses/by-nc/4.0/">CC BY-NC 4.0</a></div></div></section><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{kim2023,
  author = {Kim, Jinhwan},
  title = {Electron {forge를} {활용하여} {Standalone} {Shiny}
    {Application} {제작하기}},
  date = {2023-09-18},
  url = {https://blog.zarathu.com/posts/2023-09-18-shinyexe},
  langid = {en}
}
</code></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-kim2023" class="csl-entry quarto-appendix-citeas">
Kim, Jinhwan. 2023. <span>“Electron Forge를 활용하여 Standalone Shiny
Application 제작하기.”</span> September 18, 2023. <a href="https://blog.zarathu.com/posts/2023-09-18-shinyexe">https://blog.zarathu.com/posts/2023-09-18-shinyexe</a>.
</div></div></section></div> ]]></description>
  <category>R</category>
  <category>electron forge</category>
  <category>shiny</category>
  <category>quarto</category>
  <category>standalone</category>
  <category>exe</category>
  <category>windows</category>
  <guid>https://blog.zarathu.com/posts/2023-09-18-shinyexe/</guid>
  <pubDate>Sun, 17 Sep 2023 15:00:00 GMT</pubDate>
  <media:content url="https://blog.zarathu.com/posts/2023-09-18-shinyexe/img/logo.png" medium="image" type="image/png" height="62" width="144"/>
</item>
<item>
  <title>web assembly를 이용하여 웹페이지에서 Shiny App 활용하기</title>
  <dc:creator>Jinhwan Kim</dc:creator>
  <link>https://blog.zarathu.com/posts/2023-09-10-wasm2/</link>
  <description><![CDATA[ 
<!-- Google tag (gtag.js) -->

<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-L0DYYSH9KM"></script>

<script>

  window.dataLayer = window.dataLayer || [];

  function gtag(){dataLayer.push(arguments);}

  gtag('js', new Date());



  gtag('config', 'G-L0DYYSH9KM');

</script>





<section id="개요" class="level2">
<h2 class="anchored" data-anchor-id="개요">개요</h2>
<p>이번 글은 <a href="https://blog.zarathu.com/posts/2023-09-09-wasm/" target="_blank">이전 글 </a>에이어 정적 페이지에서 shiny application을 <code>webR</code>로 제공하는 방법에 대해 소개합니다.</p>
</section>
<section id="webr-r과-shiny의-차이" class="level2">
<h2 class="anchored" data-anchor-id="webr-r과-shiny의-차이">webR (R)과 shiny의 차이</h2>
<p>webR을 사용하기 위해 R과 Shiny의 차이점중 한가지를 짚고 넘어가는 것이 좋습니다.</p>
<p>R은 한번에 하나의 코드만 실행 가능합니다. 즉, 새로운 코드를 실행하기 위해서는 <strong>이전의 연산이 종료</strong>된 상태여야 합니다.</p>
<p>그런데 Shiny는 (app.R이라는) <strong>코드를 실행</strong>한 상태에서 사용자로부터 입력을 받고, 이를 통해 새로운 계산을 진행합니다.</p>
<p style="text-align: center;">
<img src="https://blog.zarathu.com/posts/2023-09-10-wasm2/img/runapp.png" width="100%" text-align="center">
</p>
<p>이는 webR과 유사하게 shiny에서 ( 로컬에 ) 별도의 <code>server</code>를 만들고, 브라우저의 입력값과 계산된 출력 값을 서버와 주고 받으면서 <code>ui</code>로 보내주는 과정을 거칩니다.</p>
<p>그래서 webR과 Shiny를 이어주려면 아래 그림처럼 또 하나의 브라우저 (<strong>service worker</strong>)를 만든다고 이해하는 것이 편합니다.</p>
<p style="text-align: center;">
<img src="https://blog.zarathu.com/posts/2023-09-10-wasm2/img/webr.png" width="100%" text-align="center">
</p>
<p>Shiny를 사용자의 브라우저에서 실행시키면 얻을 수 있는 장점과 단점은 webR의 장단점과 대체로 유사합니다.</p>
<p>그러나 <code>service worker</code>라는 추가 개념이 등장했고, 이로 인한 <strong>Cross-Origin Isolation</strong>이라는 새로운 문제점이 발생합니다.</p>
</section>
<section id="cross-origin-isolation" class="level2">
<h2 class="anchored" data-anchor-id="cross-origin-isolation">Cross-Origin Isolation</h2>
<p>Shiny를 정적 페이지에서 제공하기 위해 Cross-Origin Isolation의 정확한 개념을 이해할 필요는 없지만, 설명을 하면 다음과 같습니다.</p>
<p>service worker는 별도의 프로세스를 위해 외부에서 (자체 실행을 위한) 파일을 다운로드 받고 이를 사용합니다.</p>
<p>그런데 최근의 웹페이지에서는 보안 이슈로 인해 (검증되지 않은) 외부의 파일을 실행하는 것을 정책적으로 막고 있습니다.</p>
<p>이를 위해 정적 페이지를 제공하는 서비스 (github, netlify, wordpress 등)에서 외부 파일의 실행을 허용하는 설정을 해야합니다.</p>
<p>차라투 블로그가 사용하는 github page를 위해서는 <a href="https://github.com/josephrocca/clip-image-sorter/blob/main/enable-threads.js" target="_blank"> enable-thread.js </a>라는 스크립트를 실행해야합니다.</p>
<p>마찬가지로 Quarto를 활용해 웹페이지를 만들고, Shiny에서 기본으로 제공하는 <code>01_hello</code> 심도록 하겠습니다.</p>
</section>
<section id="quarto-페이지의-구성" class="level2">
<h2 class="anchored" data-anchor-id="quarto-페이지의-구성">Quarto 페이지의 구성</h2>
<p>Shiny를 정적페이지로 제공하는 quarto page에는 3가지가 필요합니다.</p>
<ol type="1">
<li>Javascript 파일:</li>
</ol>
<ul>
<li>service worker를 만들기 위한 <code>httpuv-serviceworker.js</code> (from <a href="https://github.com/georgestagg/shiny-standalone-webr-demo" target="_blank">Inspired from Here</a>)</li>
<li>(github blog 기준) Cross origin isolation을 풀기 위한 <code>enable-threads.js</code></li>
</ul>
<ol start="2" type="1">
<li><p>Button &amp; iframe: shiny는 webR에 비해 조금 더 로딩이 필요하기 때문에 진행 상태를 보여줄 버튼과, shiny app을 심을 iframe이 필요합니다.</p></li>
<li><p>Javascript 파일: webR을 준비하고, iframe에 Shiny를 심는 <code>loadshiny.js</code></p></li>
</ol>
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode html code-with-copy"><code class="sourceCode html"><span id="cb1-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;!-- 1. scripts --&gt;</span></span>
<span id="cb1-2"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&lt;</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">script</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;"> src</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'httpuv-serviceworker.js'</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&gt;&lt;/</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">script</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb1-3"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&lt;</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">script</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;"> src</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'enable-threads.js'</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&gt;&lt;/</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">script</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb1-4"></span>
<span id="cb1-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;!-- 2. button &amp; iframe --&gt;</span></span>
<span id="cb1-6"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&lt;</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">button</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;"> class</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"btn btn-success btn-sm"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;"> type</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"button"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;"> style</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"background-color: dodgerblue"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;"> id</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"statusButton"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb1-7">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&lt;</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">i</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;"> class</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"fas fa-spinner fa-spin"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&gt;&lt;/</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">i</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&gt;</span>Loading webR...</span>
<span id="cb1-8"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&lt;/</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">button</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb1-9"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&lt;</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">div</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;"> id</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"iframeContainer"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&gt;&lt;/</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">div</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb1-10"></span>
<span id="cb1-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;!-- 3. webR &amp; shiny--&gt;</span></span>
<span id="cb1-12"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&lt;</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">script</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;"> type=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"module"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;"> src</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'loadshiny.js'</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&gt;&lt;/</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">script</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&gt;</span></span></code></pre></div>
<p>추가적으로 <code>loadshiny.js</code>의 두 부분을 커스텀 해야합니다. (<strong>TODO</strong>로 표기)</p>
<ol type="1">
<li><p>임베드할 shiny app을 담고 있는 url 코드 (app.R): 이 글의 경우 차라투 블로그의 github에 (공개 된) 있는 <a href="https://github.com/zarathucorp/blog/blob/master/posts/2023-09-10-wasm2/app.R" target="_blank">코드</a>를 사용합니다.</p></li>
<li><p>service worker를 적용할 범위: <code>httpuv-serviceworker.js</code>를 등록하고, <code>index.html</code>을 담고 있는 디렉토리를 scope에 저장합니다.</p></li>
</ol>
<p>마지막으로 디렉토리 구조는 다음과 같습니다.</p>
<ul>
<li>2023-09-10-wasm2
<ul>
<li>enable-threads.js</li>
<li>index.qmd</li>
<li>index.html</li>
<li>loadshiny.js</li>
<li>httpuv-serviceworker.js</li>
</ul></li>
</ul>
</section>
<section id="실제-webr-shiny-결과" class="level2">
<h2 class="anchored" data-anchor-id="실제-webr-shiny-결과">실제 webR + shiny 결과</h2>
<!-- scripts -->
<script src="httpuv-serviceworker.js"></script>
<script src="enable-threads.js"></script>
<!-- button & iframe -->
<button class="btn btn-success btn-sm" type="button" style="background-color: dodgerblue" id="statusButton">
  <i class="fas fa-spinner fa-spin"></i>Loading webR...
</button>
<div id="iframeContainer"></div>
<!-- webR & shiny-->
<script type="module" src="loadshiny.js"></script>
</section>
<section id="정리" class="level2">
<h2 class="anchored" data-anchor-id="정리">정리</h2>
<p>단순히 webR을 심는 것보다 shiny를 심는 것은 3가지 이유에서 조금 더 복잡합니다.</p>
<ol type="1">
<li>service worker 의 구성 및 연결</li>
<li>shiny app의 실행을 위한 shiny 패키지를 webR에 설치</li>
<li>실제 정적 페이지에 배포하기 전까지 로컬 PC 에서는 shiny 결과를 확인할 수 없음</li>
</ol>
<p>또한 이전의 webR과 마찬가지로 단순한 shiny app만 webR로 구현이 가능합니다.</p>
<p>가벼운 (특히 shiny 교육) 용도로는 shiny app을 별도의 서버를 구성하지 않고도 정적 페이지로 사용자에게 제공할 수 있다는 점은 꽤 흥미롭고, (수초의 시간이 더 필요하긴 하지만) 여전히 개선할 수 있는 부분이 존재합니다.</p>
<p>다만 R과 quarto를 넘어서 javascript를 포함한 웹 개발 지식과 service worker 구성을 위한 네트워크와 인프라 구성에 대한 경험이 없다면 많은 시행착오가 필요하기도 합니다.</p>
<p>이 webR에 대해 <a href="https://appsilon.com/bringing-webr-into-shiny/">appsilon</a>은 초창기 기술인 만큼 아쉬운 점도 있지만 동적 페이지에서 제공되는 shiny app을 대체할 기술이라기보단, 상호간에 보조할 수 있는 방법이라고 평가했습니다.</p>
<hr>
<p>이전 글과 이번 글을 통해서 webR과 shiny를 정적페이지로 사용자에게 제공하는 방법을 알아보았습니다.</p>
<p>배경 지식이 없다면 한번에 이해하긴 어렵고, 이렇게 사용할 수 도 있다는 것만 기억하셔도 충분합니다.</p>
<div class="callout callout-style-simple callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
🤗 Let’s talk
</div>
</div>
<div class="callout-body-container callout-body">
<p>차라투에서는 R과 Shiny에 대한 컨설팅을 제공합니다. 진행중인 프로젝트 관련하여 도움이 필요하시다면 jinhwan@zarathu.com 으로 알려주세요!</p>
</div>
</div>


</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-reuse"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div class="quarto-appendix-contents"><div><a rel="license" href="https://creativecommons.org/licenses/by-nc/4.0/">CC BY-NC 4.0</a></div></div></section><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{kim2023,
  author = {Kim, Jinhwan},
  title = {Web {assembly를} {이용하여} {웹페이지에서} {Shiny} {App}
    {활용하기}},
  date = {2023-09-10},
  url = {https://blog.zarathu.com/posts/2023-09-10-wasm2},
  langid = {en}
}
</code></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-kim2023" class="csl-entry quarto-appendix-citeas">
Kim, Jinhwan. 2023. <span>“Web Assembly를 이용하여 웹페이지에서 Shiny
App 활용하기.”</span> September 10, 2023. <a href="https://blog.zarathu.com/posts/2023-09-10-wasm2">https://blog.zarathu.com/posts/2023-09-10-wasm2</a>.
</div></div></section></div> ]]></description>
  <category>R</category>
  <category>webR</category>
  <category>shiny</category>
  <category>wasm</category>
  <category>github page</category>
  <category>quarto</category>
  <guid>https://blog.zarathu.com/posts/2023-09-10-wasm2/</guid>
  <pubDate>Sat, 09 Sep 2023 15:00:00 GMT</pubDate>
  <media:content url="https://blog.zarathu.com/posts/2023-09-10-wasm2/img/logo.png" medium="image" type="image/png" height="62" width="144"/>
</item>
<item>
  <title>web assembly를 이용하여 웹페이지에서 R 활용하기</title>
  <dc:creator>Jinhwan Kim</dc:creator>
  <link>https://blog.zarathu.com/posts/2023-09-09-wasm/</link>
  <description><![CDATA[ <!-- Google tag (gtag.js) --><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-L0DYYSH9KM"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-L0DYYSH9KM');
</script><section id="개요" class="level2"><h2 class="anchored" data-anchor-id="개요">개요</h2>
<p>이번 글에서는 R 패키지 <code>webR</code>를 사용하여 별도의 서버 기능을 제공하지 않는 정적 웹페이지(이 블로그 같은!) 에서 R을 사용할 수 있게 하는 과정에 대해 소개합니다.</p>
<p>단 이 글에서는 wasm에 대한 이론적 배경 내용보다는 wasm을 활용하는 방법을 위주로 소개합니다.</p>
</section><section id="정적-페이지" class="level2"><h2 class="anchored" data-anchor-id="정적-페이지">정적 페이지</h2>
<p>webR의 이해를 돕기 위해서 먼저 정적 페이지 (Static Page)를 설명하겠습니다.</p>
<p>위키피디아의 설명을 인용하면, 정적 페이지는 <strong>모든 상황에서 모든 사용자에게 동일한 정보를 표시하는 페이지</strong>로, 처음 만들어 놓은 콘텐츠만이 사용자에게 전달되는 페이지(HTML 문서)라고 볼 수 있습니다.</p>
<p>서버에 저장되어 있는 데이터가 변경되지 않는한, 사용자와의 상호작용이나 요청에 관계 없이 동일한 정보를 보여주기 때문에 회사의 홈페이지나 개인의 <a href="https://education.zarathu.com/instructor.html" target="_blank"> 이력서 페이지</a>, 기술 문서나 설명서, 블로그 등이 이에 해당됩니다.</p>
<p style="text-align: center;">
<img src="https://blog.zarathu.com/posts/2023-09-09-wasm/img/staticpage.png" width="100%" text-align="center"></p>
<p>반대로 동적 페이지는 서버에서 사용자의 입력을 기반으로 추가 연산을 거쳐 결과물을 만들어내는 페이지로, 댓글이나 날씨, 잔여 재고수 , 연산 프로그램 등 정보의 업데이트가 있어야 하는 곳 등 대부분의 웹페이지에 사용됩니다.</p>
<p style="text-align: center;">
<img src="https://blog.zarathu.com/posts/2023-09-09-wasm/img/dynamicpage.png" width="100%" text-align="center"></p>
<p>정적 페이지의 주요 특징 중 하나는 동적 페이지에 비해 배포가 쉽고, 비용이 거의 들지 않는 다는 것입니다.</p>
<p>가령 동적 페이지의 예시중 하나인 shiny 어플리케이션을 제공하려면 별도의 서버를 준비하고 shiny server를 설치하여 배포 해야하지만 정적 페이지인 블로그의 경우 단순히 markdown을 github 에 올리는 것만으로 배포가 가능합니다.</p>
<p>(연산 로직이 필요하지 않아 사실상 콘텐츠를 <strong>print로 출력</strong>하는 것과 큰 차이가 없습니다.)</p>
</section><section id="웹과-r" class="level2"><h2 class="anchored" data-anchor-id="웹과-r">웹과 R</h2>
<p>차라투에서는 openstat이라는 사용자의 PC에 R을 설치하거나, 프로그래밍을 하지 않고도 웹에서 R의 기능을 이용할 수 있게 하는 의학통계 앱을 서비스로 제공하고 있습니다.</p>
<p style="text-align: center;">
<img src="https://blog.zarathu.com/posts/2023-09-09-wasm/img/openstat.png" width="100%" text-align="center"></p>
<p>이 서비스는 간단하게 표현하면 다음과 같은 구조로 이루어져 있습니다.</p>
<p style="text-align: center;">
<img src="https://blog.zarathu.com/posts/2023-09-09-wasm/img/openstat2.png" width="100%" text-align="center"></p>
<p>즉, openstat은 R의 연산 기능을 웹에서 활용하기 위해 동적 페이지를 구성했기 때문에 다음과 같은 문제점이 발생할 수 있습니다.</p>
<ol type="1">
<li><p>사용량이 많아지면 서버가 뻗을 가능성 존재. 특히나 R은 모든 작업들을 메모리에서 하기 때문에 데이터에 따라 사용자 당 GB 단위 이상을 필요로 하기도 합니다.</p></li>
<li><p>서버에 데이터가 왔다갔다하는 과정에서 (네트워크에서의) 보안 문제가 발생할 수도 있습니다.</p></li>
<li><p>모든 연산 결과를 네트워크를 통해 전달해야하기 때문에 사용자의 PC 성능이 아닌, 네트워크 연결 상태와 서버의 PC 성능에 어플리케이션의 퍼포먼스가 영향을 받습니다.</p></li>
</ol>
<p>물론 openstat에서 제공하는 (의학 연구용) 분석은, 스케일이나 컴퓨팅 퍼포먼스가 필요하지 않은 간단한 통계 분석 작업이 많기 때문에 별다른 문제가 발생하지는 않습니다.</p>
</section><section id="wasm-webr" class="level2"><h2 class="anchored" data-anchor-id="wasm-webr">wasm &amp; webR</h2>
<p>wasm은 Web Assembly의 줄임말로, 웹 브라우저 (크롬)에서 실행할 수 있는 프로그래밍 언어 정도로 이해해도 충분합니다.</p>
<p>2017년에 처음 등장한 개념으로, 각 프로그래밍 언어를 대상으로 작업되고 있으며 R에서는 <a href="https://docs.r-wasm.org/webr/latest/" target="_blank">webR</a>이라는 이름으로 2022년 1월부터 작업이 진행되고 있습니다.</p>
<p>이 webR의 정확한 원리는 복잡하지만, 간단하게는 아래 그림과 같이 자바스크립트 코드를 통해 사용자 PC에 백그라운드에서 실행되는 별도의 브라우저(web worker)를 만들어 서버 역할을 하게 한다 정도로 생각하셔도 충분합니다.</p>
<p style="text-align: center;">
<img src="https://blog.zarathu.com/posts/2023-09-09-wasm/img/webr2.png" width="100%" text-align="center"></p>
<p>webR을 사용하기 위해서는 웹페이지에 web worker를 실행하기 위한 자바스크립트 코드를 추가해야 하는데, quarto를 사용해서 간단한 웹페이지를 만들어 보겠습니다. 이후 배포는 github (github page)를 사용하며, 이 글에서는 이를 다루지 않습니다.</p>
</section><section id="quarto-page의-구성" class="level2"><h2 class="anchored" data-anchor-id="quarto-page의-구성">Quarto page의 구성</h2>
<p>webR을 정적 페이지에서 활용하기 위해 1. 코드를 입력할 공간과 2. 실행 결과를 보여줄 공간 (에디터), 3. 입력된 코드를 실행하게 할 버튼, 4. 마지막으로 앞서 언급했던 자바스크립트 코드를 추가해야합니다. (단, 자바스크립트가 에디터보다 먼저 로드되어야 하므로 앞서 선언해야함)</p>
<p>quarto에서 html을 실행하게 하기 위해서 아래의 내용을 <strong>```{=html} … ```</strong>로 감싸야 합니다.</p>
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode html code-with-copy"><code class="sourceCode html"><span id="cb1-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;!-- 4. scripts --&gt;</span></span>
<span id="cb1-2"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&lt;</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">link</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;"> rel</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"stylesheet"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;"> href</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"codemirror.min.css"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb1-3"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&lt;</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">script</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;"> src</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"codemirror.min.js"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&gt;&lt;/</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">script</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb1-4"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&lt;</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">script</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;"> src</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"r.js"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&gt;&lt;/</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">script</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb1-5"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&lt;</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">script</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;"> src</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'webr-worker.js'</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&gt;&lt;/</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">script</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&gt;</span> </span>
<span id="cb1-6"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&lt;</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">script</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;"> src</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'webr-serviceworker.js'</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&gt;&lt;/</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">script</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&gt;</span> </span>
<span id="cb1-7"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&lt;</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">script</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;"> type=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"module"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;"> src</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'editor.js'</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&gt;&lt;/</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">script</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb1-8"></span>
<span id="cb1-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;!-- editor --&gt;</span></span>
<span id="cb1-10"></span>
<span id="cb1-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;!-- 1. code editor --&gt;</span></span>
<span id="cb1-12"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&lt;</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">h4</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&gt;</span>Editor<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&lt;/</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">h4</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb1-13"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&lt;</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">div</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;"> id</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"editor"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&gt;&lt;/</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">div</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb1-14"></span>
<span id="cb1-15"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;!-- 3. run button --&gt;</span></span>
<span id="cb1-16"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&lt;</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">p</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;"> style</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text-align: right;"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb1-17">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&lt;</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">button</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;"> class</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"btn btn-success btn-sm"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;"> disabled type</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"button"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;"> id</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"runButton"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb1-18">    Loading webR...</span>
<span id="cb1-19">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&lt;/</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">button</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb1-20"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&lt;/</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">p</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb1-21"></span>
<span id="cb1-22"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;!-- 2. code result --&gt;</span></span>
<span id="cb1-23"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&lt;</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">h4</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&gt;</span>Result<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&lt;/</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">h4</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb1-24"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&lt;</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">pre</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&gt;&lt;</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">code</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;"> id</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"out"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&gt;&lt;/</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">code</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&gt;&lt;/</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">pre</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&gt;</span></span></code></pre></div>
<p>먼저 <code>4. scripts</code>는 (웹페이지에 보여지는 내용은 아니지만) 아래와 같이 크게 3종류로 구분할 수 있습니다.</p>
<ol type="1">
<li>에디터를 위한 script: <code>codemirror.min.css</code>, <code>codemirror.min.js</code>, <code>r.js</code>
</li>
<li>백그라운드 프로세스 (사용자의 PC에서의 서버)를 위한 script: <code>webr-worker.js</code>, <code>webr-serviceworker.js</code>
</li>
<li>에디터와 백그라운드 프로세스를 연결하는 script</li>
</ol>
<p>두번째로 <code>1. code editor</code>와 <code>3. run button</code> 부분은 이미지처럼 UI에 코드를 넣는 에디터(껍데기)와 이 코드를 실행하는 버튼을 만드는데 사용됩니다.</p>
<p style="text-align: center;">
<img src="https://blog.zarathu.com/posts/2023-09-09-wasm/img/editor.png" width="100%" text-align="center"></p>
<p>마지막으로 <code>2. code result</code> 부분은 아래처럼 처음에는 없지만 계산 결과를 보여주는 공간을 만드는데 사용됩니다.</p>
<p style="text-align: center;">
<img src="https://blog.zarathu.com/posts/2023-09-09-wasm/img/result.png" width="100%" text-align="center"></p>
<p>추가로 script 파일의 경우는 아래처럼 CDN(웹)에서 불러와도 되지만 해당 파일도 다운로드 받아 미리 정적 페이지에서 제공하게 실행할 수도 있습니다.</p>
<p><code>&lt;link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/6.65.7/codemirror.min.css"&gt;</code> (웹에서 사용자가 실시간으로 다운로드)</p>
<p><code>&lt;link rel="stylesheet" href="codemirror.min.css"&gt;</code> (페이지에서 미리 다운로드 후 제공)</p>
</section><section id="실제-webr-결과" class="level2"><h2 class="anchored" data-anchor-id="실제-webr-결과">실제 webR 결과</h2>
<p>아래는 실제 위 코드를 차라투 블로그 (정적 페이지)에 추가해 빌드한 결과물로 <code>Run code</code> 버튼을 누를때마다 랜덤한 값을 생성하고 평균과 표준편차를 계산하는 webR 예시입니다.</p>
<p>특별히 설치가 필요한 R 패키지와 함수를 사용하지 않는 이상</p>
<div class="cell">
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">iris</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span></code></pre></div>
</div>
<p>위의 내용처럼 코드를 바꿔 작성하면 그 결과도 바뀌는 것을 확인할 수 있습니다.</p>
<link rel="stylesheet" href="../../webr/codemirror.min.css">
<script src="../../webr/codemirror.min.js"></script><script src="../../webr/r.js"></script><script src="webr-worker.js"></script><script src="webr-serviceworker.js"></script><script type="module" src="editor.js"></script><h4 class="anchored">Editor</h4>
<div id="editor"></div>

<p style="text-align:right;">
  <button class="btn btn-success btn-sm" type="button" id="runButton">
    Loading webR...
  </button>
</p>

<h4 class="anchored">Result</h4>
<pre><code id="out"></code></pre>
</section><section id="정리" class="level2"><h2 class="anchored" data-anchor-id="정리">정리</h2>
<p>이번 글에서는 webR을 이용하여 정적 페이지에서 사용자가 R을 실행할 수 있는 방법을 정리했습니다.</p>
<p>이러한 방법의 장단점은 다음과 같습니다.</p>
<section id="장점" class="level3"><h3 class="anchored" data-anchor-id="장점">장점</h3>
<ol type="1">
<li>R의 간단한 개념을 설명할때 효과적</li>
</ol>
<blockquote class="blockquote">
<p>ex) <code><a href="https://rdrr.io/r/utils/head.html">head()</a></code>를 사용하면 데이터의 처음 6개 행을 보여준다</p>
</blockquote>
<p>코드와 실행 결과를 이미지로 첨부할 수도 있지만, <code>head(iris)</code> 같은 코드를 webR로 심어두는 것으로 내용을 더욱 효과적으로 전달할 수 있습니다.</p>
<p>만약 <a href="https://rstudio.github.io/learnr/" target="_blank">learnr</a>패키지를 함께 사용한다면 더욱 효과적으로 활용할 수 있습니다.</p>
<ol start="2" type="1">
<li>동적 페이지를 위한 서버 비용을 지출 없음</li>
</ol>
<p>정적페이지는 무료로 제공할 수 있는 서비스가 많이 있고, 모든 R 연산은 사용자의 PC에서 이루어지기 때문에 별도의 서버 비용을 신경쓰지 않아도 좋습니다. (파일만 미리 서버에 넣어두면)</p>
<ol start="3" type="1">
<li>데이터가 오고 가지 않기 때문에 보안상의 문제가 전혀 발생하지 않습니다. (이론상으로는 페이지의 모든 내용을 사용자가 저장해두면 오프라인 상태에서도 webR 활용 가능)</li>
</ol></section><section id="단점" class="level3"><h3 class="anchored" data-anchor-id="단점">단점</h3>
<ol type="1">
<li><p>webR은 아직 초기 단계이기 때문에 지원되지 않는 기능이나, 활용할 수 있는 자료가 거의 없습니다.</p></li>
<li><p>파일을 업로드/다운로드 하는 것 같이 <strong>단순하지 않은 작업</strong>은 webR에서 할 수 없습니다.</p></li>
</ol></section></section><section id="번외" class="level2"><h2 class="anchored" data-anchor-id="번외">번외</h2>
<div class="callout callout-style-simple callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
quarto
</div>
</div>
<div class="callout-body-container callout-body">
<p>추가로, 위처럼 별도의 스크립트 파일 준비 없이 quarto에서 바로 webR을 사용할 수 있게 하는 템플릿도 있어 <a href="https://github.com/coatless/quarto-webr"> 링크</a>를 첨부합니다.</p>
</div>
</div>
<div class="callout callout-style-simple callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Shiny
</div>
</div>
<div class="callout-body-container callout-body">
<p><a href="https://present.do/documents/64e98f167b111b10ca473ab4" target="_blank">shiny application</a> 또한 webR을 이용해서 정적페이지에서 제공할 수 있습니다.</p>
</div>
</div>


</section><div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-reuse"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div class="quarto-appendix-contents"><div><a rel="license" href="https://creativecommons.org/licenses/by-nc/4.0/">CC BY-NC 4.0</a></div></div></section><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{kim2023,
  author = {Kim, Jinhwan},
  title = {Web {assembly를} {이용하여} {웹페이지에서} {R} {활용하기}},
  date = {2023-09-09},
  url = {https://blog.zarathu.com/posts/2023-09-09-wasm},
  langid = {en}
}
</code></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-kim2023" class="csl-entry quarto-appendix-citeas">
Kim, Jinhwan. 2023. <span>“Web Assembly를 이용하여 웹페이지에서 R
활용하기.”</span> September 9, 2023. <a href="https://blog.zarathu.com/posts/2023-09-09-wasm">https://blog.zarathu.com/posts/2023-09-09-wasm</a>.
</div></div></section></div> ]]></description>
  <category>R</category>
  <category>webR</category>
  <category>wasm</category>
  <category>github page</category>
  <category>quarto</category>
  <guid>https://blog.zarathu.com/posts/2023-09-09-wasm/</guid>
  <pubDate>Fri, 08 Sep 2023 15:00:00 GMT</pubDate>
  <media:content url="https://blog.zarathu.com/posts/2023-09-09-wasm/img/logo.png" medium="image" type="image/png" height="62" width="144"/>
</item>
</channel>
</rss>
